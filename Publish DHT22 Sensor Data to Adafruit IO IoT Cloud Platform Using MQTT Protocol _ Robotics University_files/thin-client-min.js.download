/*! head.load - v1.0.3 */
(function(n,t){"use strict";function w(){}function u(n,t){if(n){typeof n=="object"&&(n=[].slice.call(n));for(var i=0,r=n.length;i<r;i++)t.call(n,n[i],i)}}function it(n,i){var r=Object.prototype.toString.call(i).slice(8,-1);return i!==t&&i!==null&&r===n}function s(n){return it("Function",n)}function a(n){return it("Array",n)}function et(n){var i=n.split("/"),t=i[i.length-1],r=t.indexOf("?");return r!==-1?t.substring(0,r):t}function f(n){(n=n||w,n._done)||(n(),n._done=1)}function ot(n,t,r,u){var f=typeof n=="object"?n:{test:n,success:!t?!1:a(t)?t:[t],failure:!r?!1:a(r)?r:[r],callback:u||w},e=!!f.test;return e&&!!f.success?(f.success.push(f.callback),i.load.apply(null,f.success)):e||!f.failure?u():(f.failure.push(f.callback),i.load.apply(null,f.failure)),i}function v(n){var t={},i,r;if(typeof n=="object")for(i in n)!n[i]||(t={name:i,url:n[i]});else t={name:et(n),url:n};return(r=c[t.name],r&&r.url===t.url)?r:(c[t.name]=t,t)}function y(n){n=n||c;for(var t in n)if(n.hasOwnProperty(t)&&n[t].state!==l)return!1;return!0}function st(n){n.state=ft;u(n.onpreload,function(n){n.call()})}function ht(n){n.state===t&&(n.state=nt,n.onpreload=[],rt({url:n.url,type:"cache"},function(){st(n)}))}function ct(){var n=arguments,t=n[n.length-1],r=[].slice.call(n,1),f=r[0];return(s(t)||(t=null),a(n[0]))?(n[0].push(t),i.load.apply(null,n[0]),i):(f?(u(r,function(n){s(n)||!n||ht(v(n))}),b(v(n[0]),s(f)?f:function(){i.load.apply(null,r)})):b(v(n[0])),i)}function lt(){var n=arguments,t=n[n.length-1],r={};return(s(t)||(t=null),a(n[0]))?(n[0].push(t),i.load.apply(null,n[0]),i):(u(n,function(n){n!==t&&(n=v(n),r[n.name]=n)}),u(n,function(n){n!==t&&(n=v(n),b(n,function(){y(r)&&f(t)}))}),i)}function b(n,t){if(t=t||w,n.state===l){t();return}if(n.state===tt){i.ready(n.name,t);return}if(n.state===nt){n.onpreload.push(function(){b(n,t)});return}n.state=tt;rt(n,function(){n.state=l;t();u(h[n.name],function(n){f(n)});o&&y()&&u(h.ALL,function(n){f(n)})})}function at(n){n=n||"";var t=n.split("?")[0].split(".");return t[t.length-1].toLowerCase()}function rt(t,i){function e(t){t=t||n.event;u.onload=u.onreadystatechange=u.onerror=null;i()}function o(f){f=f||n.event;(f.type==="load"||/loaded|complete/.test(u.readyState)&&(!r.documentMode||r.documentMode<9))&&(n.clearTimeout(t.errorTimeout),n.clearTimeout(t.cssTimeout),u.onload=u.onreadystatechange=u.onerror=null,i())}function s(){if(t.state!==l&&t.cssRetries<=20){for(var i=0,f=r.styleSheets.length;i<f;i++)if(r.styleSheets[i].href===u.href){o({type:"load"});return}t.cssRetries++;t.cssTimeout=n.setTimeout(s,250)}}var u,h,f;i=i||w;h=at(t.url);h==="css"?(u=r.createElement("link"),u.type="text/"+(t.type||"css"),u.rel="stylesheet",u.href=t.url,t.cssRetries=0,t.cssTimeout=n.setTimeout(s,500)):(u=r.createElement("script"),u.type="text/"+(t.type||"javascript"),u.src=t.url);u.onload=u.onreadystatechange=o;u.onerror=e;u.async=!1;u.defer=!1;t.errorTimeout=n.setTimeout(function(){e({type:"timeout"})},7e3);f=r.head||r.getElementsByTagName("head")[0];f.insertBefore(u,f.lastChild)}function vt(){for(var t,u=r.getElementsByTagName("script"),n=0,f=u.length;n<f;n++)if(t=u[n].getAttribute("data-headjs-load"),!!t){i.load(t);return}}function yt(n,t){var v,p,e;return n===r?(o?f(t):d.push(t),i):(s(n)&&(t=n,n="ALL"),a(n))?(v={},u(n,function(n){v[n]=c[n];i.ready(n,function(){y(v)&&f(t)})}),i):typeof n!="string"||!s(t)?i:(p=c[n],p&&p.state===l||n==="ALL"&&y()&&o)?(f(t),i):(e=h[n],e?e.push(t):e=h[n]=[t],i)}function e(){if(!r.body){n.clearTimeout(i.readyTimeout);i.readyTimeout=n.setTimeout(e,50);return}o||(o=!0,vt(),u(d,function(n){f(n)}))}function k(){r.addEventListener?(r.removeEventListener("DOMContentLoaded",k,!1),e()):r.readyState==="complete"&&(r.detachEvent("onreadystatechange",k),e())}var r=n.document,d=[],h={},c={},ut="async"in r.createElement("script")||"MozAppearance"in r.documentElement.style||n.opera,o,g=n.head_conf&&n.head_conf.head||"head",i=n[g]=n[g]||function(){i.ready.apply(null,arguments)},nt=1,ft=2,tt=3,l=4,p;if(r.readyState==="complete")e();else if(r.addEventListener)r.addEventListener("DOMContentLoaded",k,!1),n.addEventListener("load",e,!1);else{r.attachEvent("onreadystatechange",k);n.attachEvent("onload",e);p=!1;try{p=!n.frameElement&&r.documentElement}catch(wt){}p&&p.doScroll&&function pt(){if(!o){try{p.doScroll("left")}catch(t){n.clearTimeout(i.readyTimeout);i.readyTimeout=n.setTimeout(pt,50);return}e()}}()}i.load=i.js=ut?lt:ct;i.test=ot;i.ready=yt;i.ready(r,function(){y()&&u(h.ALL,function(n){f(n)});i.feature&&i.feature("domloaded",!0)})})(window);
/*
//# sourceMappingURL=head.load.min.js.map
*//* jstz.min.js Version: 1.0.6 Build date: 2015-11-04 */
!function(e){var a=function(){"use strict";var e="s",s={DAY:864e5,HOUR:36e5,MINUTE:6e4,SECOND:1e3,BASELINE_YEAR:2014,MAX_SCORE:864e6,AMBIGUITIES:{"America/Denver":["America/Mazatlan"],"Europe/London":["Africa/Casablanca"],"America/Chicago":["America/Mexico_City"],"America/Asuncion":["America/Campo_Grande","America/Santiago"],"America/Montevideo":["America/Sao_Paulo","America/Santiago"],"Asia/Beirut":["Asia/Amman","Asia/Jerusalem","Europe/Helsinki","Asia/Damascus","Africa/Cairo","Asia/Gaza","Europe/Minsk"],"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk","Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]}},i=function(e){var a=-e.getTimezoneOffset();return null!==a?a:0},r=function(){var a=i(new Date(s.BASELINE_YEAR,0,2)),r=i(new Date(s.BASELINE_YEAR,5,2)),n=a-r;return 0>n?a+",1":n>0?r+",1,"+e:a+",0"},n=function(){var e,a;if("undefined"!=typeof Intl&&"undefined"!=typeof Intl.DateTimeFormat&&(e=Intl.DateTimeFormat(),"undefined"!=typeof e&&"undefined"!=typeof e.resolvedOptions))return a=e.resolvedOptions().timeZone,a&&(a.indexOf("/")>-1||"UTC"===a)?a:void 0},o=function(e){for(var a=new Date(e,0,1,0,0,1,0).getTime(),s=new Date(e,12,31,23,59,59).getTime(),i=a,r=new Date(i).getTimezoneOffset(),n=null,o=null;s-864e5>i;){var t=new Date(i),A=t.getTimezoneOffset();A!==r&&(r>A&&(n=t),A>r&&(o=t),r=A),i+=864e5}return n&&o?{s:u(n).getTime(),e:u(o).getTime()}:!1},u=function l(e,a,i){"undefined"==typeof a&&(a=s.DAY,i=s.HOUR);for(var r=new Date(e.getTime()-a).getTime(),n=e.getTime()+a,o=new Date(r).getTimezoneOffset(),u=r,t=null;n-i>u;){var A=new Date(u),c=A.getTimezoneOffset();if(c!==o){t=A;break}u+=i}return a===s.DAY?l(t,s.HOUR,s.MINUTE):a===s.HOUR?l(t,s.MINUTE,s.SECOND):t},t=function(e,a,s,i){if("N/A"!==s)return s;if("Asia/Beirut"===a){if("Africa/Cairo"===i.name&&13983768e5===e[6].s&&14116788e5===e[6].e)return 0;if("Asia/Jerusalem"===i.name&&13959648e5===e[6].s&&14118588e5===e[6].e)return 0}else if("America/Santiago"===a){if("America/Asuncion"===i.name&&14124816e5===e[6].s&&1397358e6===e[6].e)return 0;if("America/Campo_Grande"===i.name&&14136912e5===e[6].s&&13925196e5===e[6].e)return 0}else if("America/Montevideo"===a){if("America/Sao_Paulo"===i.name&&14136876e5===e[6].s&&1392516e6===e[6].e)return 0}else if("Pacific/Auckland"===a&&"Pacific/Fiji"===i.name&&14142456e5===e[6].s&&13961016e5===e[6].e)return 0;return s},A=function(e,i){for(var r=function(a){for(var r=0,n=0;n<e.length;n++)if(a.rules[n]&&e[n]){if(!(e[n].s>=a.rules[n].s&&e[n].e<=a.rules[n].e)){r="N/A";break}if(r=0,r+=Math.abs(e[n].s-a.rules[n].s),r+=Math.abs(a.rules[n].e-e[n].e),r>s.MAX_SCORE){r="N/A";break}}return r=t(e,i,r,a)},n={},o=a.olson.dst_rules.zones,u=o.length,A=s.AMBIGUITIES[i],c=0;u>c;c++){var m=o[c],l=r(o[c]);"N/A"!==l&&(n[m.name]=l)}for(var f in n)if(n.hasOwnProperty(f))for(var d=0;d<A.length;d++)if(A[d]===f)return f;return i},c=function(e){var s=function(){for(var e=[],s=0;s<a.olson.dst_rules.years.length;s++){var i=o(a.olson.dst_rules.years[s]);e.push(i)}return e},i=function(e){for(var a=0;a<e.length;a++)if(e[a]!==!1)return!0;return!1},r=s(),n=i(r);return n?A(r,e):e},m=function(){var e=n();return e||(e=a.olson.timezones[r()],"undefined"!=typeof s.AMBIGUITIES[e]&&(e=c(e))),{name:function(){return e}}};return{determine:m}}();a.olson=a.olson||{},a.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas","-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Asuncion","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad","180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide","600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"},a.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:12199572e5,s:12090744e5},{e:1250802e6,s:1240524e6},{e:12858804e5,s:12840696e5},!1,!1,!1,{e:14116788e5,s:1406844e6}]},{name:"Africa/Casablanca",rules:[{e:12202236e5,s:12122784e5},{e:12508092e5,s:12438144e5},{e:1281222e6,s:12727584e5},{e:13120668e5,s:13017888e5},{e:13489704e5,s:1345428e6},{e:13828392e5,s:13761e8},{e:14142888e5,s:14069448e5}]},{name:"America/Asuncion",rules:[{e:12050316e5,s:12243888e5},{e:12364812e5,s:12558384e5},{e:12709548e5,s:12860784e5},{e:13024044e5,s:1317528e6},{e:1333854e6,s:13495824e5},{e:1364094e6,s:1381032e6},{e:13955436e5,s:14124816e5}]},{name:"America/Campo_Grande",rules:[{e:12032172e5,s:12243888e5},{e:12346668e5,s:12558384e5},{e:12667212e5,s:1287288e6},{e:12981708e5,s:13187376e5},{e:13302252e5,s:1350792e6},{e:136107e7,s:13822416e5},{e:13925196e5,s:14136912e5}]},{name:"America/Goose_Bay",rules:[{e:122559486e4,s:120503526e4},{e:125704446e4,s:123648486e4},{e:128909886e4,s:126853926e4},{e:13205556e5,s:129998886e4},{e:13520052e5,s:13314456e5},{e:13834548e5,s:13628952e5},{e:14149044e5,s:13943448e5}]},{name:"America/Havana",rules:[{e:12249972e5,s:12056436e5},{e:12564468e5,s:12364884e5},{e:12885012e5,s:12685428e5},{e:13211604e5,s:13005972e5},{e:13520052e5,s:13332564e5},{e:13834548e5,s:13628916e5},{e:14149044e5,s:13943412e5}]},{name:"America/Mazatlan",rules:[{e:1225008e6,s:12074724e5},{e:12564576e5,s:1238922e6},{e:1288512e6,s:12703716e5},{e:13199616e5,s:13018212e5},{e:13514112e5,s:13332708e5},{e:13828608e5,s:13653252e5},{e:14143104e5,s:13967748e5}]},{name:"America/Mexico_City",rules:[{e:12250044e5,s:12074688e5},{e:1256454e6,s:12389184e5},{e:12885084e5,s:1270368e6},{e:1319958e6,s:13018176e5},{e:13514076e5,s:13332672e5},{e:13828572e5,s:13653216e5},{e:14143068e5,s:13967712e5}]},{name:"America/Miquelon",rules:[{e:12255984e5,s:12050388e5},{e:1257048e6,s:12364884e5},{e:12891024e5,s:12685428e5},{e:1320552e6,s:12999924e5},{e:13520016e5,s:1331442e6},{e:13834512e5,s:13628916e5},{e:14149008e5,s:13943412e5}]},{name:"America/Santa_Isabel",rules:[{e:12250116e5,s:1207476e6},{e:12564612e5,s:12389256e5},{e:12885156e5,s:12703752e5},{e:13199652e5,s:13018248e5},{e:13514148e5,s:13332744e5},{e:13828644e5,s:13653288e5},{e:1414314e6,s:13967784e5}]},{name:"America/Santiago",rules:[{e:1206846e6,s:1223784e6},{e:1237086e6,s:12552336e5},{e:127035e7,s:12866832e5},{e:13048236e5,s:13138992e5},{e:13356684e5,s:13465584e5},{e:1367118e6,s:13786128e5},{e:13985676e5,s:14100624e5}]},{name:"America/Sao_Paulo",rules:[{e:12032136e5,s:12243852e5},{e:12346632e5,s:12558348e5},{e:12667176e5,s:12872844e5},{e:12981672e5,s:1318734e6},{e:13302216e5,s:13507884e5},{e:13610664e5,s:1382238e6},{e:1392516e6,s:14136876e5}]},{name:"Asia/Amman",rules:[{e:1225404e6,s:12066552e5},{e:12568536e5,s:12381048e5},{e:12883032e5,s:12695544e5},{e:13197528e5,s:13016088e5},!1,!1,{e:14147064e5,s:13959576e5}]},{name:"Asia/Damascus",rules:[{e:12254868e5,s:120726e7},{e:125685e7,s:12381048e5},{e:12882996e5,s:12701592e5},{e:13197492e5,s:13016088e5},{e:13511988e5,s:13330584e5},{e:13826484e5,s:1364508e6},{e:14147028e5,s:13959576e5}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:12199572e5,s:12066552e5},{e:12520152e5,s:12381048e5},{e:1281474e6,s:126964086e4},{e:1312146e6,s:130160886e4},{e:13481784e5,s:13330584e5},{e:13802292e5,s:1364508e6},{e:1414098e6,s:13959576e5}]},{name:"Asia/Irkutsk",rules:[{e:12249576e5,s:12068136e5},{e:12564072e5,s:12382632e5},{e:12884616e5,s:12697128e5},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:12231612e5,s:12066624e5},{e:1254006e6,s:1238112e6},{e:1284246e6,s:12695616e5},{e:131751e7,s:1301616e6},{e:13483548e5,s:13330656e5},{e:13828284e5,s:13645152e5},{e:1414278e6,s:13959648e5}]},{name:"Asia/Kamchatka",rules:[{e:12249432e5,s:12067992e5},{e:12563928e5,s:12382488e5},{e:12884508e5,s:12696984e5},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:12249612e5,s:12068172e5},{e:12564108e5,s:12382668e5},{e:12884652e5,s:12697164e5},!1,!1,!1,!1]},{name:"Asia/Omsk",rules:[{e:12249648e5,s:12068208e5},{e:12564144e5,s:12382704e5},{e:12884688e5,s:126972e7},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:12249504e5,s:12068064e5},{e:12564e8,s:1238256e6},{e:12884544e5,s:12697056e5},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954e6,s:120681e7},{e:12564036e5,s:12382596e5},{e:1288458e6,s:12697092e5},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:12249684e5,s:12068244e5},{e:1256418e6,s:1238274e6},{e:12884724e5,s:12697236e5},!1,!1,!1,!1]},{name:"Asia/Yerevan",rules:[{e:1224972e6,s:1206828e6},{e:12564216e5,s:12382776e5},{e:1288476e6,s:12697272e5},{e:13199256e5,s:13011768e5},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:12074076e5,s:12231342e5},{e:12388572e5,s:12545838e5},{e:12703068e5,s:12860334e5},{e:13017564e5,s:1317483e6},{e:1333206e6,s:13495374e5},{e:13652604e5,s:1380987e6},{e:139671e7,s:14124366e5}]},{name:"Australia/Perth",rules:[{e:12068136e5,s:12249576e5},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:12249828e5,s:12068388e5},{e:12564324e5,s:12382884e5},{e:12884868e5,s:1269738e6},{e:13199364e5,s:13011876e5},{e:1351386e6,s:13326372e5},{e:13828356e5,s:13646916e5},{e:14142852e5,s:13961412e5}]},{name:"Europe/Minsk",rules:[{e:12249792e5,s:12068352e5},{e:12564288e5,s:12382848e5},{e:12884832e5,s:12697344e5},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:12249756e5,s:12068316e5},{e:12564252e5,s:12382812e5},{e:12884796e5,s:12697308e5},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:13017528e5,s:13168728e5},{e:13332024e5,s:13489272e5},{e:13652568e5,s:13803768e5},{e:13967064e5,s:14118264e5}]},{name:"Pacific/Fiji",rules:[!1,!1,{e:12696984e5,s:12878424e5},{e:13271544e5,s:1319292e6},{e:1358604e6,s:13507416e5},{e:139005e7,s:1382796e6},{e:14215032e5,s:14148504e5}]},{name:"Europe/London",rules:[{e:12249828e5,s:12068388e5},{e:12564324e5,s:12382884e5},{e:12884868e5,s:1269738e6},{e:13199364e5,s:13011876e5},{e:1351386e6,s:13326372e5},{e:13828356e5,s:13646916e5},{e:14142852e5,s:13961412e5}]}]},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=a:"undefined"!=typeof define&&null!==define&&null!=define.amd?define([],function(){return a}):"undefined"==typeof e?window.jstz=a:e.jstz=a}();var load_time=(new Date).getTime();function BrowserDetection(e,t,n,r){"use strict";var i=this,o=[{string:"ua",subString:"Edge",identity:"Edge"},{string:"ua",subString:"Edg",identity:"ChromiumEdge"},{string:"ua",subString:"Samsung",identity:"SamsungBrowser"},{string:"ua",subString:"Chrome",identity:"Chrome"},{string:"ua",subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:"ua",subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:"vendor",subString:"iCab",identity:"iCab"},{string:"vendor",subString:"KDE",identity:"Konqueror"},{string:"ua",subString:"Firefox",identity:"Firefox"},{string:"vendor",subString:"Camino",identity:"Camino"},{string:"ua",subString:"Netscape",identity:"Netscape"},{string:"ua",subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:"ua",subString:"Trident",identity:"Explorer",versionSearch:"rv"},{string:"ua",subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:"ua",subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],a=e||navigator.userAgent,s=t||navigator.vendor,l=n||navigator.platform,c=r||navigator.appVersion,d={};function u(e,t){return d.hasOwnProperty(e)||(d[e]=!!t()),d[e]}this.getString=function(e){switch(e){case"ua":return a;case"vendor":return s;case"platform":return l;default:return e}},this.searchString=function(e){var t,n,r;for(t=0;t<e.length;t++)if(n=this.getString(e[t].string),r=e[t].prop,this.versionSearchString=e[t].versionSearch||e[t].identity,n){if(-1!==n.indexOf(e[t].subString))return e[t].identity}else if(r)return e[t].identity},this.searchVersion=function(e){var t=e.indexOf(this.versionSearchString);if(-1!==t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},this.searchOSVersion=function(){var e,t="Intel Mac OS X ",n=a.indexOf(t);return-1===n&&(t="iPhone OS ",n=a.indexOf(t)),-1===n?[99999,0,0]:(e=a.substring(n+t.length,n+t.length+11).replace(/_/g,".").split("."),[parseInt(e[0],10)||99999,parseInt(e[1],10)||0,parseInt(e[2],10)||0])},this.browser=this.searchString(o)||"An unknown browser",this.version=this.searchVersion(a)||this.searchVersion(c)||"an unknown version",this.OS=this.searchString([{string:"platform",subString:"Win",identity:"Windows"},{string:"ua",subString:"iPhone",identity:"iOS"},{string:"ua",subString:"iPad",identity:"iOS"},{string:"ua",subString:"iPod",identity:"iOS"},{string:"ua",subString:"Android",identity:"Android"},{string:"platform",subString:"Mac",identity:"Mac"},{string:"platform",subString:"Linux",identity:"Linux"}])||"an unknown OS";try{this.OSVersion=this.searchOSVersion()}catch(e){this.OSVersion=[99999,0,0]}this.isIE=function(){return"Explorer"===this.browser},this.isIE10=function(){return this.isIE()&&10===this.version},this.isIE11=function(){return this.isIE()&&11===this.version},this.isChrome=function(){return"Chrome"===this.browser||this.isSamsungBrowser()||this.isChromiumEdge()},this.isAndroid=function(){return"Android"===this.OS},this.isAndroidChrome=function(){return this.isChrome()&&(this.isAndroid()||this.supportsTouchEvents())},this.isSamsungBrowser=function(){return"SamsungBrowser"===this.browser},this.isEdge=function(){return"Edge"===this.browser},this.isChromiumEdge=function(){return"ChromiumEdge"===this.browser},this.isFirefox=function(){return"Firefox"===this.browser},this.isSafari=function(){return"Safari"===this.browser},this.isMobileSafari=function(){return this.isSafari()&&this.isMobile()},this.isMac=function(){return"Mac"===this.OS},this.isIOS=function(){return"iOS"===this.OS},this.isWindows=function(){return"Windows"===this.OS},this.getVersion=function(){return this.version},this.isMobile=function(){return this.supportsTouchEvents()||this.isAndroid()||this.isIOS()},this.isDesktop=function(){return!this.isMobile()},this.supportsTouchEvents=function(){return void 0!==document.ontouchstart},this.getPlatform=function(){return navigator.platform},this.isMobileSafariOnIPhone=function(){return this.isMobileSafari()&&"iPhone"===this.getPlatform()},this.supportsPassiveEventListeners=function(){if(void 0!==i.passive_option_supported)return i.passive_option_supported;i.passive_option_supported=!1;try{var e=Object.defineProperty({},"passive",{get:function(){i.passive_option_supported=!0}});window.addEventListener("fake",null,e)}catch(e){}return i.passive_option_supported},i.supportsComplexCSSClipPath=function(){return u("complex_css_clip_path",(function(){var e=document.createElement("div");return e.style.clipPath='path("M 0 0 Z")',"path("===e.style.clipPath.substr(0,5)}))},i.supportsResizeObserver=function(){return u("resize_observer",(function(){return!!window.ResizeObserver}))},i.supportsFontAPI=function(){return u("font_api",(function(){return document.fonts&&window.FontFace}))}}!function(){var e,t=function(){},n=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],r=n.length,i=window.console=window.console||{};for(window.native_console={};r--;)e=n[r],window.native_console[e]=i[e],i[e]||(i[e]=t)}();var BrowserDetect=new BrowserDetection;function diff_match_patch(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}var DIFF_DELETE=-1,DIFF_INSERT=1,DIFF_EQUAL=0;diff_match_patch.Diff,diff_match_patch.prototype.diff_main=function(e,t,n,r){void 0===r&&(r=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var i=r;if(null==e||null==t)throw new Error("Null input. (diff_main)");if(e==t)return e?[[DIFF_EQUAL,e]]:[];void 0===n&&(n=!0);var o=n,a=this.diff_commonPrefix(e,t),s=e.substring(0,a);e=e.substring(a),t=t.substring(a),a=this.diff_commonSuffix(e,t);var l=e.substring(e.length-a);e=e.substring(0,e.length-a),t=t.substring(0,t.length-a);var c=this.diff_compute_(e,t,o,i);return s&&c.unshift([DIFF_EQUAL,s]),l&&c.push([DIFF_EQUAL,l]),this.diff_cleanupMerge(c),c},diff_match_patch.prototype.diff_compute_=function(e,t,n,r){var i;if(!e)return[[DIFF_INSERT,t]];if(!t)return[[DIFF_DELETE,e]];var o=e.length>t.length?e:t,a=e.length>t.length?t:e,s=o.indexOf(a);if(-1!=s)return i=[[DIFF_INSERT,o.substring(0,s)],[DIFF_EQUAL,a],[DIFF_INSERT,o.substring(s+a.length)]],e.length>t.length&&(i[0][0]=i[2][0]=DIFF_DELETE),i;if(1==a.length)return[[DIFF_DELETE,e],[DIFF_INSERT,t]];var l=this.diff_halfMatch_(e,t);if(l){var c=l[0],d=l[1],u=l[2],_=l[3],f=l[4],p=this.diff_main(c,u,n,r),m=this.diff_main(d,_,n,r);return p.concat([[DIFF_EQUAL,f]],m)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,r):this.diff_bisect_(e,t,r)},diff_match_patch.prototype.diff_lineMode_=function(e,t,n){e=(d=this.diff_linesToChars_(e,t)).chars1,t=d.chars2;var r=d.lineArray,i=this.diff_main(e,t,!1,n);this.diff_charsToLines_(i,r),this.diff_cleanupSemantic(i),i.push([DIFF_EQUAL,""]);for(var o=0,a=0,s=0,l="",c="";o<i.length;){switch(i[o][0]){case DIFF_INSERT:s++,c+=i[o][1];break;case DIFF_DELETE:a++,l+=i[o][1];break;case DIFF_EQUAL:if(a>=1&&s>=1){i.splice(o-a-s,a+s),o=o-a-s;for(var d,u=(d=this.diff_main(l,c,!1,n)).length-1;u>=0;u--)i.splice(o,0,d[u]);o+=d.length}s=0,a=0,l="",c=""}o++}return i.pop(),i},diff_match_patch.prototype.diff_bisect_=function(e,t,n){for(var r=e.length,i=t.length,o=Math.ceil((r+i)/2),a=o,s=2*o,l=new Array(s),c=new Array(s),d=0;d<s;d++)l[d]=-1,c[d]=-1;l[a+1]=0,c[a+1]=0;for(var u=r-i,_=u%2!=0,f=0,p=0,m=0,g=0,h=0;h<o&&!((new Date).getTime()>n);h++){for(var v=-h+f;v<=h-p;v+=2){for(var w=a+v,y=(S=v==-h||v!=h&&l[w-1]<l[w+1]?l[w+1]:l[w-1]+1)-v;S<r&&y<i&&e.charAt(S)==t.charAt(y);)S++,y++;if(l[w]=S,S>r)p+=2;else if(y>i)f+=2;else if(_){if((A=a+u-v)>=0&&A<s&&-1!=c[A])if(S>=(E=r-c[A]))return this.diff_bisectSplit_(e,t,S,y,n)}}for(var b=-h+m;b<=h-g;b+=2){for(var E,A=a+b,U=(E=b==-h||b!=h&&c[A-1]<c[A+1]?c[A+1]:c[A-1]+1)-b;E<r&&U<i&&e.charAt(r-E-1)==t.charAt(i-U-1);)E++,U++;if(c[A]=E,E>r)g+=2;else if(U>i)m+=2;else if(!_){if((w=a+u-b)>=0&&w<s&&-1!=l[w]){var S;y=a+(S=l[w])-w;if(S>=(E=r-E))return this.diff_bisectSplit_(e,t,S,y,n)}}}}return[[DIFF_DELETE,e],[DIFF_INSERT,t]]},diff_match_patch.prototype.diff_bisectSplit_=function(e,t,n,r,i){var o=e.substring(0,n),a=t.substring(0,r),s=e.substring(n),l=t.substring(r),c=this.diff_main(o,a,!1,i),d=this.diff_main(s,l,!1,i);return c.concat(d)},diff_match_patch.prototype.diff_linesToChars_=function(e,t){var n=[],r={};function i(e){for(var t="",i=0,o=-1,a=n.length;o<e.length-1;){-1==(o=e.indexOf("\n",i))&&(o=e.length-1);var s=e.substring(i,o+1);i=o+1,(r.hasOwnProperty?r.hasOwnProperty(s):void 0!==r[s])?t+=String.fromCharCode(r[s]):(t+=String.fromCharCode(a),r[s]=a,n[a++]=s)}return t}return n[0]="",{chars1:i(e),chars2:i(t),lineArray:n}},diff_match_patch.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var r=e[n][1],i=[],o=0;o<r.length;o++)i[o]=t[r.charCodeAt(o)];e[n][1]=i.join("")}},diff_match_patch.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,o=0;n<i;)e.substring(o,i)==t.substring(o,i)?o=n=i:r=i,i=Math.floor((r-n)/2+n);return i},diff_match_patch.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,o=0;n<i;)e.substring(e.length-i,e.length-o)==t.substring(t.length-i,t.length-o)?o=n=i:r=i,i=Math.floor((r-n)/2+n);return i},diff_match_patch.prototype.diff_commonOverlap_=function(e,t){var n=e.length,r=t.length;if(0==n||0==r)return 0;n>r?e=e.substring(n-r):n<r&&(t=t.substring(0,n));var i=Math.min(n,r);if(e==t)return i;for(var o=0,a=1;;){var s=e.substring(i-a),l=t.indexOf(s);if(-1==l)return o;a+=l,0!=l&&e.substring(i-a)!=t.substring(0,a)||(o=a,a++)}},diff_match_patch.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0)return null;var n=e.length>t.length?e:t,r=e.length>t.length?t:e;if(n.length<4||2*r.length<n.length)return null;var i=this;function o(e,t,n){for(var r,o,a,s,l=e.substring(n,n+Math.floor(e.length/4)),c=-1,d="";-1!=(c=t.indexOf(l,c+1));){var u=i.diff_commonPrefix(e.substring(n),t.substring(c)),_=i.diff_commonSuffix(e.substring(0,n),t.substring(0,c));d.length<_+u&&(d=t.substring(c-_,c)+t.substring(c,c+u),r=e.substring(0,n-_),o=e.substring(n+u),a=t.substring(0,c-_),s=t.substring(c+u))}return 2*d.length>=e.length?[r,o,a,s,d]:null}var a,s,l,c,d,u=o(n,r,Math.ceil(n.length/4)),_=o(n,r,Math.ceil(n.length/2));return u||_?(a=_?u&&u[4].length>_[4].length?u:_:u,e.length>t.length?(s=a[0],l=a[1],c=a[2],d=a[3]):(c=a[0],d=a[1],s=a[2],l=a[3]),[s,l,c,d,a[4]]):null},diff_match_patch.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],r=0,i=null,o=0,a=0,s=0,l=0,c=0;o<e.length;)e[o][0]==DIFF_EQUAL?(n[r++]=o,a=l,s=c,l=0,c=0,i=e[o][1]):(e[o][0]==DIFF_INSERT?l+=e[o][1].length:c+=e[o][1].length,i&&i.length<=Math.max(a,s)&&i.length<=Math.max(l,c)&&(e.splice(n[r-1],0,[DIFF_DELETE,i]),e[n[r-1]+1][0]=DIFF_INSERT,r--,o=--r>0?n[r-1]:-1,a=0,s=0,l=0,c=0,i=null,t=!0)),o++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),o=1;o<e.length;){if(e[o-1][0]==DIFF_DELETE&&e[o][0]==DIFF_INSERT){var d=e[o-1][1],u=e[o][1],_=this.diff_commonOverlap_(d,u),f=this.diff_commonOverlap_(u,d);_>=f?(_>=d.length/2||_>=u.length/2)&&(e.splice(o,0,[DIFF_EQUAL,u.substring(0,_)]),e[o-1][1]=d.substring(0,d.length-_),e[o+1][1]=u.substring(_),o++):(f>=d.length/2||f>=u.length/2)&&(e.splice(o,0,[DIFF_EQUAL,d.substring(0,f)]),e[o-1][0]=DIFF_INSERT,e[o-1][1]=u.substring(0,u.length-f),e[o+1][0]=DIFF_DELETE,e[o+1][1]=d.substring(f),o++),o++}o++}},diff_match_patch.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),r=t.charAt(0),i=n.match(diff_match_patch.nonAlphaNumericRegex_),o=r.match(diff_match_patch.nonAlphaNumericRegex_),a=i&&n.match(diff_match_patch.whitespaceRegex_),s=o&&r.match(diff_match_patch.whitespaceRegex_),l=a&&n.match(diff_match_patch.linebreakRegex_),c=s&&r.match(diff_match_patch.linebreakRegex_),d=l&&e.match(diff_match_patch.blanklineEndRegex_),u=c&&t.match(diff_match_patch.blanklineStartRegex_);return d||u?5:l||c?4:i&&!a&&s?3:a||s?2:i||o?1:0}for(var n=1;n<e.length-1;){if(e[n-1][0]==DIFF_EQUAL&&e[n+1][0]==DIFF_EQUAL){var r=e[n-1][1],i=e[n][1],o=e[n+1][1],a=this.diff_commonSuffix(r,i);if(a){var s=i.substring(i.length-a);r=r.substring(0,r.length-a),i=s+i.substring(0,i.length-a),o=s+o}for(var l=r,c=i,d=o,u=t(r,i)+t(i,o);i.charAt(0)===o.charAt(0);){r+=i.charAt(0),i=i.substring(1)+o.charAt(0),o=o.substring(1);var _=t(r,i)+t(i,o);_>=u&&(u=_,l=r,c=i,d=o)}e[n-1][1]!=l&&(l?e[n-1][1]=l:(e.splice(n-1,1),n--),e[n][1]=c,d?e[n+1][1]=d:(e.splice(n+1,1),n--))}n++}},diff_match_patch.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,diff_match_patch.whitespaceRegex_=/\s/,diff_match_patch.linebreakRegex_=/[\r\n]/,diff_match_patch.blanklineEndRegex_=/\n\r?\n$/,diff_match_patch.blanklineStartRegex_=/^\r?\n\r?\n/,diff_match_patch.prototype.diff_cleanupMerge=function(e){e.push([DIFF_EQUAL,""]);for(var t,n=0,r=0,i=0,o="",a="";n<e.length;)switch(e[n][0]){case DIFF_INSERT:i++,a+=e[n][1],n++;break;case DIFF_DELETE:r++,o+=e[n][1],n++;break;case DIFF_EQUAL:r+i>1?(0!==r&&0!==i&&(0!==(t=this.diff_commonPrefix(a,o))&&(n-r-i>0&&e[n-r-i-1][0]==DIFF_EQUAL?e[n-r-i-1][1]+=a.substring(0,t):(e.splice(0,0,[DIFF_EQUAL,a.substring(0,t)]),n++),a=a.substring(t),o=o.substring(t)),0!==(t=this.diff_commonSuffix(a,o))&&(e[n][1]=a.substring(a.length-t)+e[n][1],a=a.substring(0,a.length-t),o=o.substring(0,o.length-t))),0===r?e.splice(n-i,r+i,[DIFF_INSERT,a]):0===i?e.splice(n-r,r+i,[DIFF_DELETE,o]):e.splice(n-r-i,r+i,[DIFF_DELETE,o],[DIFF_INSERT,a]),n=n-r-i+(r?1:0)+(i?1:0)+1):0!==n&&e[n-1][0]==DIFF_EQUAL?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,i=0,r=0,o="",a=""}""===e[e.length-1][1]&&e.pop();var s=!1;for(n=1;n<e.length-1;)e[n-1][0]==DIFF_EQUAL&&e[n+1][0]==DIFF_EQUAL&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),s=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),s=!0)),n++;s&&this.diff_cleanupMerge(e)},this.diff_match_patch=diff_match_patch,this.DIFF_DELETE=DIFF_DELETE,this.DIFF_INSERT=DIFF_INSERT,this.DIFF_EQUAL=DIFF_EQUAL;"use strict";function SoftAssertException(e){this.message=e}function AssertUnimplementedException(e){this.message=e}function reportAssert(e,t){var n=printStackTrace();window.reportClientEvent&&reportClientEvent(e,{stacktrace:n,message:t||"no message given"})}function soft_assert(e,t){if(!e)throw"string"!=typeof t&&(t=JSON.stringify(t)),reportAssert("tc-soft-assert",t),new SoftAssertException(t)}SoftAssertException.prototype.toString=function(){return"SoftAssertException: "+this.message},AssertUnimplementedException.prototype.toString=function(){return"AssertUnimplementedException: "+this.message};var assert_msg_count={};function assert_unimplemented(e,t){window.DEBUG&&(e||("string"!=typeof t&&(t=JSON.stringify(t)),assert_msg_count.hasOwnProperty(t)?assert_msg_count[t]+=1:(assert_msg_count[t]=1,new Logger("assert",{level:"info"}).error({event:"unimplemented",message:t}))))}function Logger(e,t){var n=t.level||"debug",r=this;function i(n,r){var i,o=n;i=function(n){var r,i,o,a=new Date,s=printStackTrace()[5],l={};if(a.setUTCHours((24+a.getUTCHours()-a.getTimezoneOffset()/60)%24),r=a.toISOString().substr(11,12)+" | "+Util.fit_string_in_fixed_len_field(e,12,"..")+" | ",s&&(i=s.indexOf("@"),s=s.slice(0,i),r+=Util.fit_string_in_fixed_len_field(s,22,"")+" | "),t.header&&(l=t.header()),"object"==typeof n)for(o in n)n.hasOwnProperty(o)&&(l[o]=n[o]);else l.detail=n;return r+=JSON.stringify(l,(function(e,t){return Util.is_string(t)?Util.string_shorten(t,4096,"..."):t})),Util.string_shorten(r,8192,"...")}(r),window.console[n]||(o="log"),"debug"===o&&"Explorer"===browser.name&&browser.version<=10&&(o="log");try{window.console[o](i)}catch(e){window.console.log(i)}}function o(e,t){try{i(e,t)}catch(e){try{window.console.log(e)}catch(e){}}}switch(r.debug=r.info=r.warn=function(e){},n){case"debug":DEBUG&&(r.debug=function(e){o("debug",e)});case"info":r.info=function(e){o("info",e)};case"warn":r.warn=function(e){o("warn",e)}}r.error=function(e){o("error",e)}}var Util={};function __randstr(e,t){var n,r,i,o=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],a=window.crypto||window.msCrypto,s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_-";for(r="",t&&(n=new window.Uint8Array(e),a.getRandomValues(n)),i=0;i<e;i+=1)r+=t?s[n[i]%s.length]:o[Math.floor(Math.random()*o.length)];return r}function __startswith(e,t){return e.substring(0,t.length)===t}function __endswith(e,t){return e.substring(e.length-t.length)===t}function __object_assign(e,t){var n;if("function"==typeof Object.assign)return Object.assign(e,t);for(var r in n=Object(e),t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function assert(e,t){if(!e&&("string"!=typeof t&&(t=JSON.stringify(t)),window.reportAssert&&reportAssert("tc-assert",t),DEBUG))throw new Error(t)}function printStackTrace(e){var t;if(e)t=e.stack.split("\n");else try{throw new Error}catch(e){t=e.stack.split("\n")}return BrowserDetect.isIE()||BrowserDetect.isChrome()?t.slice(1).map((function(e){return e.replace(/^\s*at\s+(.+)\s+\((.+)\)$/gm,"$1@$2").replace(/^\s*at\s+(.*)$/gm,"{anonymous}@$1")})):t}function ParsedURL(e){var t=this,n=document.createElement("a");n.href=e,t.defrag=function(){return n.protocol+"//"+n.hostname+n.pathname+n.search},t.hasHash=function(){return t.hash||"#"===t.href.slice(-1)},t.isCrossDocumentNav=function(e){return t.defrag()!==e.defrag()||!e.hasHash()},t.withTrackingLabel=function(){return assert(-1===n.search.indexOf("xid=")),n.search+=(n.search?"&":"")+"xid="+__randstr(16),n.href},t.href=n.href,t.protocol=n.protocol,t.hostname=n.hostname,t.host=n.host,n.port&&!("80"===n.port&&"http:"===t.protocol||"443"===n.port&&"https:"===t.protocol)?t.port=n.port:t.port="",n.pathname&&0!==n.pathname.indexOf("/")?t.pathname="/"+n.pathname:t.pathname=n.pathname,t.search=n.search,t.hash=n.hash,t.origin=n.origin||t.protocol+"//"+t.hostname+(t.port?":"+t.port:"")}function allowNavigateToURL(e){var t,n;if(__startswith(e=e.toLowerCase().trim(),"/"))return!0;if(__startswith(e,"data:")||__startswith(e,"blob:")||__startswith(e,"javascript:"))return!1;if(__startswith(e,"http:")||__startswith(e,"https:"))return!0;if(safeview.pairing_dict&&safeview.pairing_dict.client_caps&&(t=safeview.pairing_dict.client_caps.applicationLinks))for(n=0;n<t.length;n+=1)if(-1!==t[n].indexOf(":")&&__startswith(e,t[n]))return!0;return!1}function suppressReferrerIfRequired(e,t){var n,r;if(e===window){if(TPROXY_ENABLED)n="strict-origin-when-cross-origin";else{if(__startswith(t,window.location.origin))return;n="no-referrer"}(r=document.createElement("meta")).setAttribute("name","referrer"),r.setAttribute("content",n),document.head.appendChild(r)}}function ClientEventReporterCore(e){this.make_event_dict=function(e,t){var n={ctime:(new Date).toUTCString(),build_id:window.BUILD_ID,event:e,user_agent:window.navigator.userAgent,url:Util.getRawPageUrl()};return Util.simpleExtend(n,t),n},this.send_events=function(t,n,r){t.url=Util.getRawPageUrl(),t.host=window.HOST,Util.xhrRequest(e.url_builder.buildProtocolUrl("/safeview-client-logger/clientevent"),t,n,r)}}function ClientEventReporter(e){var t,n,r=new Logger("event-reporter",{level:"info"}),i=[],o=this,a={},s=0,l=!1;function c(){window.clearTimeout(s),s=window.setTimeout(o.flush,5e3)}o.flush=function(){if(i.length){var e={items:[]};for(t=0,n=i.length;t<n;t+=1)e.items.push(i[t]);e.items.length,o.core.send_events(e,(function(){i.length,i.length=0,c()}),(function(e,t,n){e.response,e.status,c()}))}else c()},o.save_ping_stats=function(e){var t=e.ping;["ping","url","user_agent","build_id"].forEach((function(t){delete e[t]})),e.tlast=t.last,e.tmin=t.min,e.tavg=t.avg,e.tstdev=t.stdev,e.tmax=t.max,e.count=t.count,e.mode=t.mode,o.ping_stats=e},o.save_to_local_stats=function(e){o.local_stats.length>=50?r.info("clientevent ClientEventReporter local_stats is full, discarding new event"):o.local_stats.push(e)},o.enqueue=function(e){100!==i.length?i.push(e):r.info("clientevent ClientEventReporter queue is full, discarding new event")},o.shouldReport=function(e){return!a[e]&&(a[e]=!0,!0)},o.report=function(e,t){switch(e){case"warn":r.warn(t);break;case"error":r.error(t);break;case"debug":break;default:r.info(t)}},o.reportSkipped=function(e){},o.flushPingStats=function(){var t,n,r,i={items:[]};o.ping_stats&&(t=e.url_builder.buildProtocolUrl("/safeview-client-logger/clientevent"),i.items.push(o.ping_stats),i.url=Util.getRawPageUrl(),i.host=window.HOST,i.build_id=BUILD_ID,n=JSON.stringify(i),navigator.sendBeacon?navigator.sendBeacon(t,n):((r=new XMLHttpRequest).open("POST",t,!1),r.withCredentials=!0,r.setRequestHeader("Content-Type","text/plain"),r.send(n)))},o.unpair=function(){var t=e.url_builder.buildProtocolUrl("/r/unpair"),n={build_id:BUILD_ID,url:location.href,host:window.HOST,transparent_mode:TPROXY_ENABLED,mpa_id:e.pairing_dict.mpa_id,tab_id:e.pairing_dict.tab_id,safe_rid:e.pairing_dict.safe_rid};navigator.sendBeacon&&(e.pairing_dict.cid&&(t+="?cid="+e.pairing_dict.cid,e.pairing_dict.cluster_id&&(t+="&cl="+e.pairing_dict.cluster_id)),navigator.sendBeacon(t,JSON.stringify(n)))},e.callback&&(e.callback.register("print-block-running",(function(){l=!0})),e.callback.register("safeview-exit",(function(){tabstore_is_reliable()||o.unpair(),o.flush(),o.flushPingStats(),l&&e.surrogate_channel.send("unblock-print",e.fid)}))),window.setTimeout(o.flush,5e3),o.local_stats=[],o.core=new ClientEventReporterCore(e)}function reportClientEventWork(e,t,n,r){var i,o=e+": "+JSON.stringify(t);r||safeview.event_reporter.shouldReport(e)?(n?safeview.event_reporter.report(t.tclevel,o):"tc-local-stats"!==t.tclevel&&"tc-ping-stats"!==t.tclevel&&safeview.event_reporter.report("debug",o),i=safeview.event_reporter.core.make_event_dict(e,t),safeview.pairing_dict&&(i.sid=safeview.pairing_dict.safe_rid,i.srouter_id=safeview.pairing_dict.cid,i.cluster_id=safeview.pairing_dict.cluster_id,i.tab=safeview.pairing_dict.tab_id,i.xff=safeview.pairing_dict.xff),"tc-local-stats"===t.tclevel?safeview.event_reporter.save_to_local_stats(i):"tc-ping-stats"===t.tclevel?safeview.event_reporter.save_ping_stats(i):safeview.event_reporter.enqueue(i)):safeview.event_reporter.reportSkipped(o)}function reportClientEventXFrame(e,t,n,r){assert("top"===safeview.role||"sub"===safeview.role),safeview.postToCommFrame({kind:"client_report_msg",event:e,extrainfo:t,warn:n,always:r})}function reportClientEvent(e,t,n,r){try{safeview.event_reporter?reportClientEventWork(e,t,n,r):reportClientEventXFrame(e,t,n,r)}catch(n){console.log("reportClientEvent threw exception: "+n.toString()+". Original log message: "+e+": "+JSON.stringify(t))}}function reportWarnClientEvent(e,t,n,r){!1!==n&&(n=!0),!0!==r&&(r=!1),void 0===t&&(t={}),t.tclevel="tc-warn",reportClientEvent(e,t,n,r)}function reportErrorClientEvent(e,t,n,r){!1!==n&&(n=!0),!0!==r&&(r=!1),void 0===t&&(t={}),t.tclevel="tc-error",reportClientEvent(e,t,n,r)}"function"!=typeof Number.isFinite&&(Number.isFinite=function(e){return"number"==typeof e&&isFinite(e)}),Function.prototype.curry=function(){var e=this,t=Array.prototype.slice.call(arguments);return function(){return e.apply(this,t.concat(Array.prototype.slice.call(arguments)))}},Util.parseConfig=function(){var e,t,n=document.getElementsByTagName("safeview-info")[0].getAttribute("session-info"),r=Util.b64Decode(n),i=JSON.parse(r);for(e in i.hasOwnProperty("DEBUG")||(window.DEBUG=!1),i)i.hasOwnProperty(e)&&(t=i[e],window[e]=t);i.hasOwnProperty("INSPECT_DOMAIN")||(window.INSPECT_DOMAIN=window.CLUSTER_DOMAIN)},Util.parseURL=function(e){var t=document.createElement("a");return t.href=e,t},Util.windowOpen=function(e,t,n){return e&&!allowNavigateToURL(e)?null:void 0!==e?void 0!==t?void 0!==n?window.open(e,t,n):window.open(e,t):window.open(e):window.open()},Util.locationSetHref=function(e,t){allowNavigateToURL(t)&&(suppressReferrerIfRequired(e,t),e.location.href=t)},Util.locationReplace=function(e,t){return allowNavigateToURL(t)?(suppressReferrerIfRequired(e,t),e.location.replace(t)):null},Util.locationAssign=function(e,t){return allowNavigateToURL(t)?(suppressReferrerIfRequired(e,t),e.location.assign(t)):null},Util.locationSet=function(e,t){allowNavigateToURL(t)&&(suppressReferrerIfRequired(e,t),e.location=t)},Util.hashCode=function(e){var t,n=0;if(!e||0===e.length)return n;for(t=0;t<e.length;t+=1)n=(n<<5)-n+e.charCodeAt(t),n&=n;return n},Util.isIpAddress=function(e){return 0===e.search(/^(\d{1,3}\.){3}\d{1,3}$/)},Util.getScrollbarThickness=function(){function e(e,t){var n,r,i=document.createElement("div"),o=document.createElement("div");return i.style.visibility="hidden",i.style[e]="100px",document.body.appendChild(i),n=i[t],i.style.overflow="scroll",o.style[e]="100%",i.appendChild(o),r=o[t],i.parentNode.removeChild(i),n-r}return Util.cached_thickness||(Util.cached_thickness=[e("width","offsetWidth"),e("height","offsetHeight")]),Util.cached_thickness},Util.getDeviceScaleFactor=function(){var e=window.devicePixelRatio||1;return e-Math.floor(e)<.1?e:Math.ceil(e)},Util.getScreenOrientationType=function(){if(void 0===window.orientation)return"portrait";switch(window.orientation){case 0:case 180:return"portrait";case 90:case-90:return"landscape";default:return assert(0),"portrait"}},Util.getScreenOrientationAngle=function(){return"number"==typeof window.orientation?window.orientation:0},Util.getInnerWidth=function(){return window.innerWidth},Util.getInnerHeight=function(){return window.innerHeight},Util.getPortraitScreenSize=function(){var e=window.screen.width,t=window.screen.height;return(BrowserDetect.isIE()||BrowserDetect.isEdge())&&(window.innerWidth&&window.innerWidth>e&&(e=window.innerWidth),window.innerHeight&&window.innerHeight>t&&(t=window.innerHeight)),BrowserDetect.isSafari()||"portrait"===Util.getScreenOrientationType()?{width:e,height:t}:{width:t,height:e}},Util.getVisualViewport=function(){return window.visualViewport},Util.getDeviceMetrics=function(){return{screen_size:Util.getPortraitScreenSize(),screen_orientation_type:Util.getScreenOrientationType(),screen_orientation_angle:Util.getScreenOrientationAngle(),device_scale_factor:window.debug_dsf||Util.getDeviceScaleFactor(),scrollbar_thickness:Util.getScrollbarThickness(),enable_touch_events:void 0!==document.ontouchstart,max_touch_points:void 0!==navigator.maxTouchPoints?navigator.maxTouchPoints:2,mobile:BrowserDetect.isMobile()}},Util.getDoctypeDecl=function(e){var t,n=e.document.doctype;return n?(t="<!DOCTYPE "+n.name,n.publicId?(t+=' PUBLIC "'+n.publicId+'"',n.systemId&&(t+=' "'+n.systemId+'"')):n.systemId&&(t+=' SYSTEM "'+n.systemId+'"'),t+=">"):t="",t},Util.persistentPolicy=function(){var e;try{e=window.history.state||{}}catch(t){e={}}return"object"!=typeof e.persistent_policy&&(e.persistent_policy={}),e.persistent_policy||{}},Util.mpa_id_from_url=function(e){var t=e.split("/",5);return 5!==t.length||"mpa"!==t[3]?"":t[4]},Util.removePrefix=function(e){var t,n=["readonly/","mpa/"];for(t=0;t<n.length;t+=1)0===e.indexOf(n[t])&&(e=e.slice(n[t].length),"mpa/"==n[t]&&e.indexOf("/")>0&&(e=e.slice(e.indexOf("/")+1)));return e},Util.getRawPageUrl=function(){var e,t;return window.TPROXY_ENABLED?location.href:(assert(2===(e=new RegExp(".+?://.+?/(.+)").exec(location.href)).length),t=e[1],new RegExp("ftp://|http(s)?://","i").test(t)||(t="http://"+t),t)},Util.isAboutBlankUrl=function(){return __endswith(Util.getRawPageUrl(),"/__about_~_blank__")},Util.isMPAPortalUrl=function(){return __endswith(Util.getRawPageUrl(),"https://portal/")},Util.getPageUrl=function(){var e=Util.removePrefix(Util.getRawPageUrl());return Util.isAboutBlankUrl()&&(e="about:blank"),e},Util.getLanguage=function(){return navigator.userAgent.indexOf("MSIE 10.0")>=0?window.navigator.browserLanguage:window.navigator.language},Util.getLanguages=function(){return window.navigator.languages?window.navigator.languages.join():""},Util.b64_chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Util.b64Decode=function(e,t){var n,r,i,o,a,s,l="",c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)n=Util.b64_chars.indexOf(e.charAt(c++))<<2|(o=Util.b64_chars.indexOf(e.charAt(c++)))>>4,r=(15&o)<<4|(a=Util.b64_chars.indexOf(e.charAt(c++)))>>2,i=(3&a)<<6|(s=Util.b64_chars.indexOf(e.charAt(c++))),l+=String.fromCharCode(n),64!==a&&(l+=String.fromCharCode(r)),64!==s&&(l+=String.fromCharCode(i));return t||(l=Util.utf8Decode(l)),l},Util.utf8Decode=function(e){for(var t,n,r,i="",o=0;o<e.length;)(t=e.charCodeAt(o))<128?(i+=String.fromCharCode(t),o++):t>191&&t<224?(n=e.charCodeAt(o+1),i+=String.fromCharCode((31&t)<<6|63&n),o+=2):(n=e.charCodeAt(o+1),r=e.charCodeAt(o+2),i+=String.fromCharCode((15&t)<<12|(63&n)<<6|63&r),o+=3);return i},Util.getFramingStatus=function(){if(window.top===window)return 0;try{if(window.parent.location.host===window.location.host)return 2}catch(e){}return 1},Util.getParam=function(e,t){var n,r,i=window.location.search.substr(1).split("&");for(n=0;n<i.length;n+=1)if(i[n].split("=")[0]===e)return r=i[n].slice(i[n].indexOf("=")+1),t||(r=decodeURIComponent(r)),r;return null},Util.appendParam=function(e,t){var n=document.location.search;return n+=(n?"&":"?")+e+"="+t,document.location.protocol+"//"+document.location.hostname+document.location.pathname+n+document.location.hash},Util.removeParam=function(e,t){var n,r,i,o="";if(-1!==(i=(r=document.location.search.substr(1).split("&")).indexOf(e+"="+t))){r.splice(i,1),r.length&&(o="?"+r.join("&")),n=document.location.protocol+"//"+document.location.hostname+document.location.pathname+o+document.location.hash;try{window.history.state&&window.history.state.url&&(window.history.state.url=n),window.history.replaceState(window.history.state,"",n)}catch(e){}}},Util.is_in_iframe=function(){try{return window.self!==window.top}catch(e){return!0}},Util.xframe_reload=function(e){var t;BrowserDetect.isIE()&&Util.is_in_iframe()?(t=window.location.href,window.location.hash&&(t=Util.appendParam("sv_reload",1)),Util.locationSetHref(window,t)):window.location.reload(e)},Util.isFrameBuster=function(){var e=window.FRAMEBUST;return e&&e.enabled&&window.top!==window.self&&0===window.innerWidth&&0===window.innerHeight&&-1!==e.domains.indexOf(window.location.hostname)},Util.simpleExtend=function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},Util.xhrRequest=function(e,t,n,r,i){var o=new XMLHttpRequest;o.open("POST",e),o.timeout=i||safeview.perf.xhr_timeout_ms,o.withCredentials=!0,n&&(o.onload=function(t){200===o.status?n(JSON.parse(o.response)):r&&r(o,t,e)}),r&&(o.onerror=function(t){r(o,t,e)},o.ontimeout=function(t){r(o,t,e)}),o.send(JSON.stringify(t))},Util.isMseSupported=function(){return!BrowserDetect.isMobileSafariOnIPhone()&&(window.MediaSource=window.MediaSource||window.WebKitMediaSource,!!window.MediaSource)},Util.getUnsupportedMediaFormats=function(){var e,t,n,r,i=[{mime_types:["audio/wav","audio/x-wav"],codecs:["1"]},{mime_types:["audio/webm"],codecs:["opus","vorbis"]},{mime_types:["video/webm"],codecs:["opus","vorbis","vp8","vp9","av01.0.08M.08"]},{mime_types:["audio/ogg"],codecs:["flac","opus","vorbis"]},{mime_types:["video/ogg","application/ogg"],codecs:["vp8","flac","opus","vorbis","theora"]},{mime_types:["audio/flac","audio/mp3","audio/x-mp3","audio/aac"],codecs:[]},{mime_types:["audio/mp4"],codecs:["flac","mp3","opus","mp4a.66","mp4a.40.2","mp4a.40.42"]},{mime_types:["audio/mpeg"],codecs:["mp3"]},{mime_types:["video/mp4"],codecs:["vp09.00.10.08","avc1.64001F","av01.0.08M.08","flac","mp3","opus","mp4a.66","mp4a.40.2","mp4a.40.42","hev1.1.0.L90.B0","hev1.2.0.L90.B0","hev1.3.0.L90.B0","hev1.4.0.L90.B0","hev1.5.0.L90.B0","hev1.6.0.L90.B0","hev1.7.0.L90.B0","hev1.8.0.L90.B0","hev1.9.0.L90.B0","hev1.10.0.L90.B0","hev1.11.0.L90.B0"]},{mime_types:["audio/x-m4a"],codecs:["mp4a.66","mp4a.40.2","mp4a.40.42"]},{mime_types:["video/x-m4v","video/3gpp"],codecs:["avc1.64001F","mp4a.66","mp4a.40.2","mp4a.40.42"]},{mime_types:["application/x-mpegurl","application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl"],codecs:["avc1.64001F","mp3","mp4a.40.2"]}],o=document.createElement("video"),a=null;if(o.canPlayType)for(a=[],e=0;e<i.length;e++)for(t=0;t<i[e].mime_types.length;t++){if(r=[],o.canPlayType(i[e].mime_types[t])){for(n=0;n<i[e].codecs.length;n++)o.canPlayType(i[e].mime_types[t]+';codecs="'+i[e].codecs[n]+'"')||r.push(i[e].codecs[n]);if(0===n)continue}else r=i[e].codecs;r.length===i[e].codecs.length?a.push(i[e].mime_types[t]):r.length&&a.push(i[e].mime_types[t]+';codecs="'+r.join(",")+'"')}return a},Util.isPermittedURL=function(e){return __startswith(e,"https:")||__startswith(e,"data:")};var ONE_LEVEL_TLDS=["com","org","int","net","edu","gov","mil"];function argumentsToArray(e){return Array.prototype.slice.call(e).slice(0)}function Countdown(e,t,n,r){var i=null,o=null,a=this;function s(){t(safeview.localization.get("ID_TC_RECONNECT_ERROR")),setTimeout((function(){a.restart()}),2e3)}function l(){var e=o/1e3;assert(e>=0),t(safeview.localization.get("ID_TC_RELOADING",e))}function c(){i&&(clearInterval(i),i=null)}function d(){var e;assert(o>=1e3),o-=1e3,l(),0===o&&(c(),e=safeview.url_builder.buildServiceURL("/safeview-director/traffic_cop"),safeview.serverCall({url:e}).done((function(t){JSON.stringify(t),reportClientEvent("tc-service-check-done",{action:t,request_url:e}),"go"===t?n():s()})).fail((function(t,n){reportClientEvent("tc-service-check-failed",{textStatus:n,request_url:e}),s()})))}this.restart=function(){c(),o=e,l(),i=setInterval(d,1e3)},this.stop=c}Util.input_text_types={text:1,password:1,search:1,email:1,url:1,tel:1,number:1},Util.input_text_types_strict=["text","email","password","search","tel","url"],Util.date_time_input_types={date:"yyyy-MM-dd",time:"hh:mm",month:"yyyy-MM",week:"yyyy-Www","datetime-local":"yyyy-MM-ddThh:mm"},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0===this.indexOf(e)}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return this.substring(this.length-e.length)===e}),"function"!=typeof Math.sign&&(Math.sign=function(e){return 0===e?0:e<0?-1:1}),"number"!=typeof Number.MAX_SAFE_INTEGER&&(Number.MAX_SAFE_INTEGER=Math.pow(2,53)-1,Number.MIN_SAFE_INTEGER=-Number.MAX_SAFE_INTEGER),Util.show_message_bar=function(e){var t,n,r=document.getElementById("__safly_message_bar");safeview.pairing_dict&&safeview.pairing_dict.client_caps&&safeview.pairing_dict.client_caps.enable_reconnect_banner&&(r||((r=document.createElement("div")).id="__safly_message_bar",r.style.cursor="pointer",r.style.display="none",r.style.position="fixed",r.style.top=0,r.style.left="27%",r.style.right="27%",r.style.margin="auto",r.style.padding="3px",r.style.width="35%",r.style.background="#fc0",r.style.textAlign="center",r.style.font="12px arial, sans-serif",r.style.opacity="0.9",r.style.zIndex="100000000000",r.style.borderBottomLeftRadius="5px",r.style.borderBottomRightRadius="5px",r.style.verticalAlign="middle",(t=document.body)||((n=document.getElementsByTagName("html")[0])||(n=document.createElement("html"),document.appendChild(n)),t=document.createElement("body"),n.appendChild(t),assert(document.body)),t.appendChild(r)),r.innerText=e,r.style.display="block")},Util.hide_message_bar=function(){var e=document.getElementById("__safly_message_bar");e&&(e.style.display="none")},Util.conf_default=function(e,t,n,r,i,o,a,s){var l,c;l=function(t){return{arr:1,array:1}.hasOwnProperty(o)&&void 0!==t?e[r][t]:e[r]},c=function(t,n){!{boolean:1,bool:1}.hasOwnProperty(o)?!{integer:1,int:1}.hasOwnProperty(o)?"func"===o&&(t||(t=function(){})):t=parseInt(t,10):t=!(!t||{0:1,no:1,false:1}.hasOwnProperty(t)),void 0!==n?e[r][n]=t:e[r]=t},t[r+"_description"]=s,void 0===t["get_"+r]&&(t["get_"+r]=l),void 0===t["set_"+r]&&(t["set_"+r]=function(t,n){if({RO:1,ro:1}.hasOwnProperty(i))throw new Error(r+" is read-only");if({WO:1,wo:1}.hasOwnProperty(i)&&void 0!==e[r])throw new Error(r+" can only be set once");c(t,n)}),void 0!==n[r]?a=n[r]:!{arr:1,array:1}.hasOwnProperty(o)||a instanceof Array||(a=[]),c(a)},Util.conf_defaults=function(e,t,n,r){var i;for(i=0;i<r.length;i+=1)Util.conf_default(e,t,n,r[i][0],r[i][1],r[i][2],r[i][3],r[i][4])},Util.objectPrototypeToString=Object.prototype.toString,Util.is_string=function(e){return"[object String]"===Util.objectPrototypeToString.call(e)},Util.is_valid_number=function(e){return Number.isFinite?Number.isFinite(e):isFinite(e)},Util.string_rpad=function(e,t){var n,r;for(n=Math.max(t-e.length,0),r=0;r<n;r+=1)e+=" ";return e},Util.string_shorten=function(e,t,n){return(n=n||"").length>t&&(n=n.substring(0,t)),e.length<=t?e:e.substring(0,t-n.length)+n},Util.fit_string_in_fixed_len_field=function(e,t,n){return Util.string_rpad(Util.string_shorten(e,t,n),t)},Util.getPosition=function(e){var t=0,n=0;if(e.offsetParent)do{t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent}while(e);return{x:t,y:n}},Util.getTopWindowMousePosition=function(e){for(var t,n={x:e.clientX,y:e.clientY},r=e.target;r=(r=(r=r.ownerDocument).defaultView||r.parentWindow).frameElement;)t=r.getBoundingClientRect(),n.x+=t.left,n.y+=t.top;return n},Util.getTopWindowPosition=function(e){for(var t,n={x:0,y:0};e;)t=e.getBoundingClientRect(),n.x+=t.left,n.y+=t.top,e=(e=(e=e.ownerDocument).defaultView||e.parentWindow).frameElement;return n.x+=document.body.scrollLeft+document.documentElement.scrollLeft,n.y+=document.body.scrollTop+document.documentElement.scrollTop,n},Util.getEventPosition=function(e,t,n){var r,i,o,a;return(r=e||window.event).pageX||r.pageY?(i=r.pageX,o=r.pageY):(r.clientX||r.clientY)&&(i=r.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,o=r.clientY+document.body.scrollTop+document.documentElement.scrollTop),void 0===n&&(n=1),{x:(i-(a=Util.getPosition(t)).x)/n,y:(o-a.y)/n}},Util.getScreenWidth=function(){return document.documentElement.clientWidth},Util.getScreenHeight=function(){return document.documentElement.clientHeight},Util.htmlMsg=function(e){return"<!DOCTYPE html><html><body>"+e+"</body></html>"},Util.isSameDomain=function(e,t){var n=Util.parseURL(e).hostname,r=Util.parseURL(t).hostname,i=n.split("."),o=r.split(".");return JSON.stringify(i.slice(-2))===JSON.stringify(o.slice(-2))&&(i.slice(-2)[0].length>3||i.length<3||o.length<3||ONE_LEVEL_TLDS.indexOf(i.slice(-1)[0])>=0||i.slice(-3)[0]===o.slice(-3)[0])},Util.makeSet=function(e){var t,n={};for(t=0;t<e.length;t+=1)n[e[t]]=1;return n},Util.buildQueryStr=function(e){var t,n="";if(e)for(t in e)e.hasOwnProperty(t)&&(n+="&"+t+"="+e[t]);return n};var PREFIX="sv_tab_id:";function Poller(e){var t=this,n=null;if(!e.cond_func)throw new Error("Must specify condition function");if(!e.max_nr_polls)throw new Error("Must specify max number of polls");if(!e.poll_interval_ms)throw new Error("Must specify poll interval");function r(t){void 0===t&&(t=0),t+=1,e.cond_func()?e.success_cb():t>e.max_nr_polls?e.timeout_cb&&e.timeout_cb():n=setTimeout((function(){n=null,r(t)}),e.poll_interval_ms)}t.stop=function(){n&&(clearTimeout(n),n=null)},t.start=function(){t.stop(),r()}}function calculateMovement(e,t){var n;return void 0!==e.movementX?{x:e.movementX,y:e.movementY}:(n=safeview[t]?{x:e.screenX-safeview[t].screenX,y:e.screenY-safeview[t].screenY}:{x:0,y:0},safeview[t]={screenX:e.screenX,screenY:e.screenY},n)}function EventListenerModule(){var e=new Logger("event-listener",{level:"info"}),t=this,n=0;function r(e,t,n,r,i){var o;"function"==typeof e.removeEventListener?(o=BrowserDetect.supportsPassiveEventListeners()?{capture:!!r,passive:!!i}:!!r,e.removeEventListener(t,n,o)):"function"==typeof e.detachEvent?e.detachEvent("on"+t,n):assert(!1,"Cannot remove listener.")}function i(e,t,n,r){function i(e){return e?e.toString():null}try{var o={stacktrace:printStackTrace(e),callback:t,"type-of-arguments":i(n),"value-of-arguments":r.join(", "),exception:i(e)};DEBUG&&safeview.ui_frame.call("showModal","Crash"),reportErrorClientEvent("tc-uncaught-exception",o)}catch(t){try{reportErrorClientEvent("double-fault",{"first-exception":i(e),"second-exception":i(t)})}catch(n){window.triple_fault={"first-exception":i(e),"second-exception":i(t),"third-exception":i(n)}}}}t.addListener=function(e,t,o,a,s){var l,c;void 0===e.sv_evt_reg_map&&(e.sv_evt_reg_map={}),void 0===o.sv_evt_reg_id&&(o.sv_evt_reg_id=n,n+=1),l=t+"-"+o.sv_evt_reg_id.toString(),e.sv_evt_reg_map[l]&&r(e,t,c=e.sv_evt_reg_map[l],a,s),c=function(e){var t,n,r,o=e.toString(),a=[],s=[];function l(e){-1===s.indexOf(e)&&s.push(e)}return function(){try{e.apply(this,arguments)}catch(e){if(!safeview.resync_in_progress){for(o=(o=o.substr("function ".length)).substr(0,o.indexOf("{")),t=Array.prototype.slice.call(arguments),n=t[0];n;)Object.getOwnPropertyNames(n).forEach(l),n=Object.getPrototypeOf(n);for(r=0;r<s.length;r++){n=s[r];try{a.push(n+":"+t[0][n])}catch(e){a.push(n+": "+(e.message||"<inaccessible>"))}}i(e,o,t,a)}}}}(o),e.sv_evt_reg_map[l]=c,function(e,t,n,r,i){var o;"function"==typeof e.addEventListener?(o=BrowserDetect.supportsPassiveEventListeners()?{capture:!!r,passive:!!i}:!!r,e.addEventListener(t,n,o)):"function"==typeof e.attachEvent?e.attachEvent("on"+t,n):assert(!1,"Cannot add listener.")}(e,t,c,a,s)},t.removeListener=function(t,n,i,o,a){var s,l;void 0!==t.sv_evt_reg_map&&void 0!==i.sv_evt_reg_id?(s=n+"-"+i.sv_evt_reg_id.toString(),(l=t.sv_evt_reg_map[s])?(r(t,n,l,o,a),delete t.sv_evt_reg_map[s]):e.error("Callback not found in removeListener")):e.error("Registration id not found in removeListener")},t.setListenersEnabled=function(e,n,r,i){var o=e?t.addListener:t.removeListener;assert(n),assert(i),r.forEach((function(e){o(n,e,i)}))}}Util.getOrSetTabID=function(){var e;return assert(window.localStorage),assert("string"==typeof window.name),__startswith(window.name,PREFIX)?window.name.substr(PREFIX.length):(e=__randstr(16),window.name=PREFIX+e,window.history.replaceState&&window.history.replaceState(window.history.state,document.title,window.location.href),e)},Util.safeCreateWebSocket=function(e,t){var n=null;e=new ParsedURL(e).withTrackingLabel();try{window.WebSocket?n=new window.WebSocket(e):window.MozWebSocket&&(n=new window.MozWebSocket(e))}catch(n){if(t)throw n;reportClientEvent("tc-websocket-create-failed",{request_url:e})}return n},Util.wsCloseDiags=function(e){return{wasClean:e.wasClean,code:e.code,reason:e.reason}},Util.get_node_tag=function(e){soft_assert(e);var t=e.localName||e.nodeName;return t=t?t.toLowerCase():t},Util.getDoctypeDecl=function(e){var t,n=e.document.doctype;return n?(t="<!DOCTYPE "+n.name,n.publicId?(t+=' PUBLIC "'+n.publicId+'"',n.systemId&&(t+=' "'+n.systemId+'"')):n.systemId&&(t+=' SYSTEM "'+n.systemId+'"'),t+=">"):t="",t},Util.is_element_input_text=function(e){var t=Util.get_node_tag(e);return"textarea"===t||"input"===t&&Util.input_text_types.hasOwnProperty(e.type)},Util.is_frame_node_name=function(e){return"iframe"===e||"frame"===e},Util.is_frame_node=function(e){return Util.is_frame_node_name(e.localName)},Util.is_frame_owner=function(e){return Util.is_frame_node(e)||e.__sv_frame_owner},Util.is_autofill_target=function(e){return"input"===Util.get_node_tag(e)&&Util.is_element_input_text(e)},Util.handle_autofill_event=function(e,t){return Util.is_autofill_target(e)&&("keypress"===t.type||"keydown"===t.type||"keyup"===t.type)&&!("keyCode"in t||"metaKey"in t||"shiftKey"in t||"ctrlKey"in t||"altKey"in t)&&(t.keyCode=0,t.charCode=0,t.key="",t.code="",t.shiftKey=!1,t.ctrlKey=!1,t.metaKey=!1),t},Util.can_element_use_lecho=function(e){var t;return!("input"!==Util.get_node_tag(e)||!e.ownerDocument)&&("number"!==e.__sv_original_input_type&&(!(e.ownerDocument.defaultView||e.ownerDocument.parentWindow).__sv_surrogate_is_readonly&&((t=e.getAttribute("type"))||(t="text"),t=t.toLowerCase(),Util.input_text_types_strict.indexOf(t)>-1)))},Util.is_content_editable=function(e){var t=Util.get_node_tag(e);return(!e.ownerDocument||!(e.ownerDocument.defaultView||e.ownerDocument.parentWindow).__sv_surrogate_is_readonly)&&("textarea"===t||e.isContentEditable||3===e.nodeType&&e.parentNode&&e.parentNode.isContentEditable)},Util.is_node_likely_anchor_tag=function(e){return!!e.getAttribute&&!!e.getAttribute("href")},Util.is_media_node=function(e){var t=Util.get_node_tag(e);return"audio"===t||"video"===t},Util.compute_iframe_src=function(e,t,n){var r,i="/safeview-redirect/sub_frame.html";return r=window.TPROXY_ENABLED?new ParsedURL(e).origin+i+"?tpe=1":i+"?tpe=0",r+="&fid="+t,n&&(r+="&dt="+encodeURIComponent(Util.b64Encode(n))),r},Util.is_elem_editable=function(e){var t=Util.get_node_tag(e);return(e.isContentEditable||e.ownerDocument&&"on"===e.ownerDocument.designMode)&&"textarea"!==t&&"input"!==t},Util.findPredicateOnBranch=function(e,t){for(var n=e;n;){if(t(n))return n;n=n.parentNode}return null},Util.now=function(){return window.performance?Number(window.performance.now()).toFixed():Date.now()},Util.rewriteRawHref=function(e){return window.TPROXY_ENABLED?e:(safeview.pairing_dict.mpa_id&&!e.startsWith("mpa/")&&(e="mpa/"+(safeview.pairing_dict.mpa_id||"1")+"/"+e),"/"+e)},Util.getCookie=function(e){var t={};if(e)return document.cookie.split(";").forEach((function(e){e=e.trim().split("="),t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])})),t[e]},Util.setCookie=function(e,t,n,r,i,o,a){var s=[encodeURIComponent(e)+"="+encodeURIComponent(t)];return!!e&&(n&&s.push("expires="+n.toUTCString()),r&&s.push("path="+r),i&&s.push("domain="+i),o&&s.push("secure"),a&&!safeview.xbrowser.isBrokenSameSite()&&s.push("samesite="+a),document.cookie=s.join("; "),!0)},Util.forEachItem=function(e,t){var n;for(n in assert("object"==typeof e),assert("function"==typeof t),e)if(e.hasOwnProperty(n)&&t(n,e[n]))return},Util.isDictEmpty=function(e){var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0},Util.dictValues=function(e){var t=[];return Object.values?Object.values(e):(Util.forEachItem(e,(function(e,n){t.push(n)})),t)},Util.copyDict=function(e,t){var n=t||{};return Util.forEachItem(e,(function(e,t){n[e]=t})),n},Util.getImageFromU8Array=function(e,t){var n=new window.Blob([e]),r=new Image;function i(e){assert(r.src),window.URL.revokeObjectURL(r.src),r.onload=r.onerror=null,t(r,e)}assert(t),r.onload=i.curry(!0),r.onerror=i.curry(!1),r.src=window.URL.createObjectURL(n)},Util.getImageFromURL=function(e,t){var n=new Image;function r(e){assert(n.src),n.onload=n.onerror=null,t(n,e)}assert(t),n.onload=r.curry(!0),n.onerror=r.curry(!1),n.src=e},Util.Uint8ArrayToBase64=function(e){var t,n,r=[];for(t=0;t<e.length;t+=1)r.push(String.fromCharCode(e[t]));return n=r.join(""),window.btoa(n)},Util.elementIntersectsViewport=function(e){var t=e.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight,r=window.innerWidth||document.documentElement.clientWidth;return!(t.left>=r||t.right<=0||t.top>=n||t.bottom<=0)},Util.elementIsInsideViewport=function(e){var t,n=window.innerHeight||document.documentElement.clientHeight,r=window.innerWidth||document.documentElement.clientWidth;return!e.getBoundingClientRect||(t=e.getBoundingClientRect()).top>=0&&t.left>=0&&t.bottom<=n&&t.right<=r},Util.isIframeReady=function(e,t){var n=e.contentWindow;return n&&n.document&&"complete"===n.document.readyState&&(!t||n.document.documentElement&&n.document.documentElement.getAttribute("tc-nonce")===t)},Util.IsEventTargetForeign=function(e,t){return assert(e),(!t||"resize"!==t.type&&"copy"!==t.type)&&!getUidByNode(e)},Util.calculateMouseMovement=function(e){return calculateMovement(e,"last_mouse_pos")},Util.calculateDragMovement=function(e){return calculateMovement(e,"last_drag_pos")},Util.makePasteDataList=function(e,t,n,r){var i,o,a,s,l,c,d,u=[],_=[],f=0,p=0,m=!1,g=function(){safeview.allow_backend_dragdrop&&_.length&&(u.push(_),u.push("file_obj_list"))};if(e.clipboardData&&e.clipboardData.getData)for(i=e.clipboardData,a=0;a<i.types.length;a+=1)if("text/plain"===(o=i.types[a])||"text/html"===o||"text/rtf"===o&&!safeview.pairing_dict.mpa_id)u.push(i.getData(o)),u.push(o);else if("Files"===o)for(s=0;s<i.files.length;++s)0===(c=i.files.item(s)).type.indexOf("image")?(f+=1,m=!0,(d=new FileReader).onload=function(){var e=d.result;e&&(u.push(e),u.push(c.type)),++p===f&&(g(),u.length?n(u):r&&r())},d.onerror=function(e){++p===f&&(g(),u.length?n(u):r&&r()),reportWarnClientEvent("tc-image-paste-error",{name:e.name||"none",mime:e.type||"none"})}.curry(c),d.readAsDataURL(c)):_.push(c);else reportWarnClientEvent("tc-paste-error",{reason:"Unsupported type",type:o});else t.clipboardData&&t.clipboardData.getData&&(l=t.clipboardData.getData("Text"))&&(u.push(l),u.push("text/plain"));m||(g(),u.length?n(u):r&&r())},Util.filterPasteDataList=function(e){var t,n=[];for(t=0;t<e.length;t+=2){if("text/plain"===e[t+1]){n[0]=e[t],n[1]=e[t+1];break}"text/html"===e[t+1]&&(n[0]=e[t],n[1]=e[t+1])}for(;e.length>0;)e.pop();2===n.length&&(e.push(n[0]),e.push(n[1]))},Util.copyToClipboardInEventHandler=function(e,t,n){BrowserDetect.isEdge()?e.clipboardData.setData("text",t):e.clipboardData?(e.clipboardData.setData("text/plain",t),n&&e.clipboardData.setData("text/html",n)):window.clipboardData.setData("text",t),e.preventDefault()},Util.getButtonModifiers=function(e,t){if(void 0!==e.buttons)return e.buttons;switch(e.which){case 0:return 0;case 1:return 1;case 2:return 4;case 3:return 2;default:return t.error({event:"tc-unknown-button",which:e.which}),0}},Util.getMouseAndKeyboardModifiers=function(e,t){var n=Util.getButtonModifiers(e,t);return assert(void 0!==e.shiftKey),assert(void 0!==e.ctrlKey),assert(void 0!==e.altKey),assert(void 0!==e.metaKey),e.shiftKey&&(n|=32),e.ctrlKey&&(n|=64),e.altKey&&(n|=128),e.metaKey&&(n|=256),n},Util.getRelativeMouseCoords=function(e,t){var n;return(n=(e=3===e.nodeType?e.parentNode:e).getBoundingClientRect()).left>0&&n.top>0?{x:t.clientX-n.left,y:t.clientY-n.top,relative_to_target:!0}:{x:t.clientX,y:t.clientY,relative_to_target:!1}},Util.gen_dragdrop_file_list=function(e){var t,n,r,i=[];function o(e){return{name:e.name,type:e.type}}if(e.items&&e.items.length>0)for(t=0;t<e.items.length;t++)"file"===(r=e.items[t]).kind&&(n=r.getAsFile(),i.push(n?o(n):{type:r.type}));else{for(t=0;t<e.files.length;t++)i.push(o(e.files[t]));0===i.length&&(e.types.contains&&e.types.contains("Files")||(e.types.indexOf&&e.types.indexOf("Files"))>=0)&&(i=[{type:"text/plain"}])}return i},Util.debug_print_selection=function(e,t){var n,r,i,o;function a(e){return 1===e.nodeType?"node_type:element_node, node_name:"+e.nodeName+", text_content:"+e.textContent:3===e.nodeType?"node_type:text_node, node_value:"+e.nodeValue:"Unexpected node type in selection, node_type:"+e.nodeType}if(!e.anchorNode||!e.focusNode)return e.anchorNode,void e.focusNode;if("anchorNode={"+a(e.anchorNode)+"}, focusNode={"+a(e.focusNode)+"}, anchorOffset="+e.anchorOffset+", focusOffset="+e.focusOffset+", isCollapsed="+e.isCollapsed+", rangeCount="+e.rangeCount,"startContainer={"+a((n=e.getRangeAt(0)).startContainer)+"}, endContainer={"+a(n.endContainer)+"}, startOffset="+n.startOffset+", endOffset="+n.endOffset,1===(i=e.focusNode).nodeType)for(i.nodeName,r=0;r<i.childNodes.length;r+=1)1===(o=i.childNodes[r]).nodeType?(o.nodeType,o.nodeName,o.textContent):3===o.nodeType&&(o.nodeType,o.nodeValue)},Util.ensureElementPresent=function(e){var t,n=document[e];n||((t=document.getElementsByTagName("html")[0])||(t=document.createElement("html"),document.appendChild(t)),n=document.createElement(e),t.appendChild(n),assert(document[e]))},Util.splunkify=function(e){return JSON.stringify(e).replace(/\"/g,"'")},Util.buildLoginForm=function(e,t){var n,r,i;function o(e,t){var r=document.createElement("input");r.type="hidden",r.name=e,r.value=t,n.appendChild(r)}for((n=document.createElement("form")).action=e.login_url,o("url",t),i=["through","entry_mode","redirect_list","prepend","doc_headers","xheaders","inspect_host"],r=0;r<i.length;r++)e[i[r]]&&o(i[r],e[i[r]]);return n},Util.submitLoginForm=function(e,t){t&&(e.target=t),e.method="POST",document.body.appendChild(e),e.submit()},Util.b64Encode=function(e,t){var n,r,i,o,a,s,l,c="",d=0;for(t||(e=Util.utf8Encode(e));d<e.length;)o=(n=e.charCodeAt(d++))>>2,a=(3&n)<<4|(r=e.charCodeAt(d++))>>4,s=(15&r)<<2|(i=e.charCodeAt(d++))>>6,l=63&i,isNaN(r)?s=l=64:isNaN(i)&&(l=64),c=c+Util.b64_chars.charAt(o)+Util.b64_chars.charAt(a)+Util.b64_chars.charAt(s)+Util.b64_chars.charAt(l);return c},Util.utf8Encode=function(e){var t,n,r="";for(e=e.replace(/\r\n/g,"\n"),t=0;t<e.length;t++)(n=e.charCodeAt(t))<128?r+=String.fromCharCode(n):n>127&&n<2048?(r+=String.fromCharCode(n>>6|192),r+=String.fromCharCode(63&n|128)):(r+=String.fromCharCode(n>>12|224),r+=String.fromCharCode(n>>6&63|128),r+=String.fromCharCode(63&n|128));return r},Util.is_korean_char=function(e){var t=e.charCodeAt(0);return t>=44032&&t<=55203||t>=4352&&t<=4607||t>=12592&&t<=12687||t>=43360&&t<=43391||t>=55216&&t<=55295},Util.isTabVisible=function(){return"hidden"!==document.visibilityState},Util.showEmbeddedError=function(e,t,n,r){document.getElementsByTagName("sv_error_page").length||(document.body.innerHTML=r.get("error-template")),document.getElementById("error-title").textContent=e,document.getElementById("error-description").textContent=t,document.getElementById("spinner").style.display="none"},Util.showError=function(e,t,n,r){reportWarnClientEvent("tc-main-show-error-page",{title:e,body:t,extra:n}),safeview&&safeview.event_reporter&&safeview.event_reporter.flush(),Util.showEmbeddedError(e,t,n,r)},Util.getDocIdIfSafedocs=function(){return window.location.href.indexOf("/doc/docview/viewer")>-1||window.location.href.indexOf("/cloudview/viewer")>-1||window.location.href.indexOf("viewer.documentisolation:8081")>-1?window.location.href.substring(window.location.href.lastIndexOf("/")+1):null},Util.getQueryValue=function(e,t){var n,r;if(BrowserDetect.isIE()){for("?"===e.charAt(0)&&(e=e.substring(1)),n=decodeURIComponent(e).split("&"),r=0;r<n.length;r+=1){if(n[r]===t)return"";if(n[r].startsWith(t+"="))return n[r].substring(t.length+1)}return null}return(n=new URLSearchParams(e)).get(t)},Util.addQueryValue=function(e,t,n){var r,i,o,a;if(BrowserDetect.isIE()){for(r=e.substring(1).split("&"),o=encodeURIComponent(t)+"="+encodeURIComponent(n),a=0;a<r.length;a+=1)if(""===(i=decodeURIComponent(r[a])))r.splice(a,1);else{if(i===t){r[a]=o;break}if(i.startsWith(t+"=")){r[a]=o;break}}return a>=r.length&&(r[r.length]=o),"?"+r.join("&")}return(r=new URLSearchParams(e)).set(t,n),"?"+r.toString()},Util.addQueryValueToLocation=function(e,t,n){var r=e.href,i=e.search;return!i&&r.endsWith("?")&&(i="?"),i&&(r=r.slice(0,-i.length)),r+(i=Util.addQueryValue(i,t,n))},Util.getIframeHelperURL=function(e,t,n,r){var i=window.location.protocol+"//"+window.location.host+"/safeview-redirect/tc_frame.html?dt="+encodeURIComponent(Util.b64Encode(e))+"&n="+t;return n&&(i+="&furl="+encodeURIComponent(Util.b64Encode(n))),r&&(i+="&turl="+encodeURIComponent(Util.b64Encode(new ParsedURL(r).defrag()))),window.TPROXY_ENABLED&&safeview.qs_hinting&&(i+="&from_isolation=true"),window.TPROXY_ENABLED&&Util.persistentPolicy().hint_key&&Util.persistentPolicy().hint&&(i+="&"+Util.persistentPolicy().hint_key+"="+Util.persistentPolicy().hint),i},Util.formDecode=function(e){return decodeURIComponent(e.replace(/\+/g," "))},Util.startsWithAnyOf=function(e,t){var n;for(n=0;n<t.length;n+=1)if(__startswith(e,t[n]))return!0;return!1},Util.getBrowserScrollOffset=function(e,t){var n,r,i=Util.getVisualViewport();return e!==window?(assert(void 0!==e.scrollLeft),{x:e.scrollLeft,y:e.scrollTop}):i?(assert(void 0!==i.pageLeft&&void 0!==i.pageTop),{x:i.pageLeft-i.offsetLeft,y:i.pageTop-i.offsetTop}):BrowserDetect.isMobileSafari()?(n=e.scrollX,r=e.scrollY,{x:(n+=t.x)||0,y:(r+=t.y)||0}):(void 0!==e.pageYOffset?(n=e.pageXOffset,r=e.pageYOffset):(n=e.scrollLeft||e.scrollX,r=e.scrollTop||e.scrollY),{x:n||0,y:r||0})},Util.is_element_date_time_input=function(e){return"input"===Util.get_node_tag(e)&&!!Util.date_time_input_types[e.getAttribute("type")]},Util.is_supported_element_date_time_input=function(e){return Util.is_element_date_time_input(e)&&!!Util.date_time_input_types[e.type]},Util.is_unsupported_element_date_time_input=function(e){return Util.is_element_date_time_input(e)&&"text"===e.type},Util.is_element_color_input=function(e){return"input"===Util.get_node_tag(e)&&"color"===e.getAttribute("type")},Util.is_supported_element_color_input=function(e){return Util.is_element_color_input(e)&&"color"===e.type},Util.is_unsupported_element_color_input=function(e){return Util.is_element_color_input(e)&&"text"===e.type},Util.get_corresponding_chrome_keycode=function(e,t){if("keypress"!==e.type&&BrowserDetect.isFirefox())switch(t){case 59:return 186;case 61:return 187;case 173:return 189}return t},Util.isPdfViewerDisabled=function(){return!1===navigator.pdfViewerEnabled||navigator.plugins&&0===navigator.plugins.length},Util.array_buffer_to_base64=function(e){return null===e?null:window.btoa(String.fromCharCode.apply(null,new Uint8Array(e)))},Util.base64_to_array_buffer=function(e){const t=window.atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n.buffer},Util.replaceAll=function(e,t,n){return e.replace(new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),n)};var EventListener=new EventListenerModule;function ExitHandler(e){var t=!1;this.openingLocalApp=function(){t=!0},this.isLocalAppOpening=function(){return t},EventListener.addListener(window,"beforeunload",(function n(){t?setTimeout((function(){t=!1}),100):(e.callback.fire("safeview-exit"),EventListener.removeListener(window,"beforeunload",n,!1))}),!1)}function Selection(e){function t(t,n,r,i,o,a,s){var l,c=getWindowByFid(t),d=c.document,u=c.getSelection();if(!e.ui_frame.active()){if(local_echo_enabled&&local_echo_config.extended&&e.lecho_regulator_ext.defer_range_sel_if_needed(t,n,r,i,o,a))return!0;if(!e.local_input.defer_range_sel_if_needed(t,n,r,i,o,a,s)&&!e.local_events.defer_range_sel_if_file_chooser(t,n,r,i,o,a,s))try{s&&d.activeElement!==s&&(d.activeElement&&d.activeElement.blur(),s.focus()),u.removeAllRanges(),(l=d.createRange()).setStart(r,i),l.setEnd(o,a),u.addRange(l),e.clipboard.set_last_selection_fid(t)}catch(e){reportWarnClientEvent("tc-sel-range-error",{error:e.toString()})}}}this.getSelection=function(t){var n=Util.is_element_input_text(t)?function(e){var t={start:e.selectionStart,end:e.selectionEnd};return{mode:"input",collapsed:t.start===t.end,uid:getUidByNode(e),selection:t}}(t):function(t){var n,r,i,o,a,s,l;if((n=getWindowByFid(getFidByNode(t)))||(n=t.ownerDocument.defaultView),!(r=n.getSelection()).rangeCount)return{mode:"clear",collapsed:!0,uid_start:0,uid_end:0,selection_start:0,selection_end:0};i=r.getRangeAt(0);try{o=getUidByNode(i.startContainer),a=getUidByNode(i.endContainer),s=i.startOffset,l=i.endOffset}catch(e){o=getUidByNode(r.anchorNode),a=getUidByNode(r.focusNode),s=r.anchorOffset,l=r.focusOffset}return o&&a||(e.local_input.is_node_attached(i.endContainer),3===i.endContainer.nodeType?i.endContainer.data:i.endContainer.nodeName,3===i.startContainer.nodeType?i.startContainer.data:i.startContainer.nodeName),{mode:"range",collapsed:r.isCollapsed,start_container:o,end_container:a,start_offset:s,end_offset:l}}(t),r=getWindowByFid(getFidByNode(t)),i=r&&r.document.activeElement;return i&&(n.active_element=getUidByNode(i)),JSON.stringify(n),n},this.set_range_selection=t,e.interp.registerOpcodeHandler(e.interp.OPCODES.SET_SELECTIONS,(function(n,r){var i,o,a,s=JSON.parse(r),l=null,c=getWindowByFid(n);if(s.mode&&c)if("clearselection"===s.mode)!function(e){var t=getWindowByFid(e).getSelection();if(!t.isCollapsed)try{t.removeAllRanges()}catch(e){throw reportErrorClientEvent("tc-sel-clear-selection-fail",{error:e.toString()}),e}}(n);else if("input"===s.mode){if(!(a=getNodeByUid(n,s.uid)))return void reportErrorClientEvent("tc-sel-input-selection-fail",{detail:"Cannot set input selection: node",uid:s.uid});if(e.local_input.in_ime_mode(a))return;!function(t,n,r,i){var o;if(soft_assert(n,"null element passed to setInputSelection"),t.document.activeElement!==n&&n.focus(),o="textarea"===Util.get_node_tag(n)&&local_echo_enabled&&local_echo_config.extended,n.selectionStart!==r||n.selectionEnd!==i||i!==r||o){if(local_echo_enabled&&Util.can_element_use_lecho(n))e.lecho_regulator.set_remote_caret(getFidByNode(n),getUidByNode(n),r,i);else if(o)e.lecho_regulator_ext.set_remote_caret(getFidByNode(n),getUidByNode(n),r,i);else try{n.selectionStart=r,n.selectionEnd=i}catch(e){}n.selectionStart,n.selectionEnd}}(c,a,s.selection.start,s.selection.end)}else if("range"===s.mode){if(s.active_element&&(l=getNodeByUid(n,s.active_element)),i=getNodeByUid(n,s.start_container),o=getNodeByUid(n,s.end_container),soft_assert(i,"selection data.start_container unknown"),soft_assert(o,"selection data.end_container unknown"),i.textContent&&o.textContent&&(s.start_offset>i.textContent.length||s.end_offset>o.textContent.length))return i.textContent.length,void o.textContent.length;t(n,s.mode,i,s.start_offset,o,s.end_offset,l)}}))}var browser={name:BrowserDetect.browser,version:BrowserDetect.version,os:BrowserDetect.OS},uidToNode={},fidToWindow={},fidToIframeNode={},fidToSvgRootUids={},frameNodeUidToFid={},fidToFrameNodeUid={};function setFidToIframe(e,t){fidToIframeNode[t]=e}function removeFidToIframe(e){delete fidToIframeNode[e]}function getIframeByFid(e){return fidToIframeNode[e]}function setFrameFidForNode(e,t,n){var r=getNodeKey(e,t);frameNodeUidToFid[r]=n,fidToFrameNodeUid[n]=r}var main_frame_fid=null;function setFidToWindow(e,t){assert(e),fidToWindow[t]=e,e.__sv_fid=t}function __init_id_state(e){main_frame_fid=e,uidToNode={},fidToWindow={},fidToIframeNode={},fidToSvgRootUids={},setFidToWindow(mf.window,e),setFidToIframe(mf.window,e)}function isTopFrameFid(e){return e===main_frame_fid}function getTopFrameFid(){return main_frame_fid}function getNodeKey(e,t){return e+"_"+t}function splitNodeKey(e){var t=e.split("_");return{fid:Number(t[0]),uid:Number(t[1])}}function setNodeIds(e,t,n){assert(e);var r=uidToNode[n];r||(r=uidToNode[n]={}),r[t]=e,e.__sv_uid=t,e.__sv_fid=n}function __re_init_id_state(){uidToNode={},fidToWindow={},fidToIframeNode={},fidToSvgRootUids={},setFidToWindow(mf.window,main_frame_fid),setFidToIframe(mf.window,main_frame_fid),setNodeIds(document,document.__sv_uid,document.__sv_fid)}function setNodeInMap(e,t,n,r){e[n]=t,t.__sv_uid=n,t.__sv_fid=r}function getNodeMapForFrame(e){return uidToNode[e]}function setNodeMapForFrame(e,t){uidToNode[e]=t}function getUidByNode(e){return assert(e),e.__sv_uid}function getNodeByUid(e,t){var n=uidToNode[e];if(n)return n[t]}function getNodeByUidOnly(e){var t,n;for(t in uidToNode)if(uidToNode.hasOwnProperty(t)&&(n=uidToNode[t])&&n.hasOwnProperty(e))return n[e]}function removeUidNodeEntry(e,t){var n=uidToNode[e];n&&delete n[t]}function removeUidNodeEntriesForFid(e){delete uidToNode[e]}function getFidByNode(e){return e.__sv_fid}function getWindowByFid(e){if(fidToWindow.hasOwnProperty(e))return fidToWindow[e]}function removeFidWindowEntry(e){delete fidToWindow[e]}function getFrameFidByNode(e){var t=getFidByNode(e);return safeview.frameset_wrapper&&(t=safeview.frameset_wrapper.get_original_fid(t)),frameNodeUidToFid[t+"_"+getUidByNode(e)]||null}function getNodeByFrameFid(e){return fidToFrameNodeUid[e]?splitNodeKey(fidToFrameNodeUid[e]):null}function addSvgRootUidForFid(e,t,n){var r=fidToSvgRootUids[e];r||(fidToSvgRootUids[e]={},r=fidToSvgRootUids[e]),r[t]=n}function getSvgRootUidForFid(e,t){var n=fidToSvgRootUids[e];if(n)return n[t]}function removeSvgRootUidsForFid(e){delete fidToSvgRootUids[e]}function CallbackSupport(){var e=this,t=new Logger("callback",{level:"info"}),n={},r={},i=0;function o(t,n,i){var o=r[t];assert(o),o.is_one_shot&&(o.timer_id&&(clearTimeout(o.timer_id),o.timer_id=null),e.deregister(o.id)),o.call_count+=1;try{o.callbacks[n].apply(this,i)}catch(e){throw reportErrorClientEvent("tc-cb-generated-exception",{cb_id:t,cb_event:o.event_name,cb_info:o,cb_ex:e}),e}}function a(e,t,a,s){var l={};return assert("string"==typeof e),assert("object"==typeof s),l.id=i+1,l.callbacks=s,l.event_name=e,l.is_one_shot=t,l.call_count=0,t&&a&&(assert(l.callbacks.on_timeout),l.timer_id=setTimeout((function(){o(l.id,"on_timeout",[])}),a)),assert(l.callbacks.on_success),i+=1,n[e]||(n[e]={}),assert(!n[e].hasOwnProperty(l.id)),n[e][l.id]=!0,r[l.id]=l,l.id,l.id}e.register=function(e,t){return a(e,!1,0,{on_success:t})},e.registerOneShot=function(e,t,n){return a(e,!0,t,n)},e.deregister=function(e){var t=r[e];return!!t&&(t.event_name,assert(n.hasOwnProperty(t.event_name)),delete n[t.event_name][t.id],delete r[e],!0)},e.fire=function(e){var t,r=n[e]||{};for(t in assert("string"==typeof e),r)r.hasOwnProperty(t)&&o(t,"on_success",argumentsToArray(arguments).slice(1))},e.dumpStats=function(){var e,n;if(DEBUG)for(e in r)r.hasOwnProperty(e)&&(n=r[e],t.info("Callback: id="+e+" event="+n.event_name+" one_shot="+n.is_one_shot+" call_count="+n.call_count))}}function XFrameCallbackSupport(e){var t=this,n={},r=new CallbackSupport;function i(t,n,r){var i={kind:"cb_reg",event_name:t,cb_id:n,one_shot:r};"top"===e.role?e.postToCommFrame(i):"comm"===e.role?e.postToTopFrame(i):assert(0)}function o(t){var r,i,o=n[t];if(o)for(i={kind:"cb_fired",event_name:t,args:argumentsToArray(arguments)},"top"===e.role?e.postToCommFrame(i):"comm"===e.role?e.postToTopFrame(i):assert(0),r=o.length-1;r>=0;r-=1)o[r].one_shot&&o.splice(r,1)}t.on_cb_msg=function(e){switch(e.kind){case"cb_reg":n[e.event_name]||(n[e.event_name]=[]),n[e.event_name].push({cb_id:e.cb_id,one_shot:e.one_shot});break;case"cb_dereg":!function(e){var t,r,i;for(t in n)if(n.hasOwnProperty(t))for(i=(r=n[t]).length-1;i>=0;i-=1)r[i].cb_id===e&&r.splice(i,1)}(e.cb_id);break;case"cb_fired":r.fire.apply(r,e.args)}},t.register=function(e,t,n){var o=r.register(e,t);return n&&i(e,o,!1),o},t.registerOneShot=function(e,t,n,o){var a=r.registerOneShot(e,t,n);o&&i(e,a,!0)},t.deregister=function(t){var n=r.deregister(t);return function(t){var n={kind:"cb_dereg",cb_id:t};"top"===e.role?e.postToCommFrame(n):"comm"===e.role?e.postToTopFrame(n):assert(0)}(t),n},t.fire=function(e){r.fire.apply(r,arguments),o(e)}}var ScrollControl={initialMode:"TC",tuneScrollMargin:6};function haveIntermediateSurrControllers(e){var t,n=e.length-2;for(t=1;t<=n;t+=1)if("SURR"===e[t].__sv_scroll)return!0;return!1}function isScrollable(e){var t=ScrollControl.tuneScrollMargin;return e&&(e.scrollHeight>e.clientHeight+t||e.scrollWidth>e.clientWidth+t)}function findScrollControllers(e){for(var t=e,n=[];t;)!isScrollable(t)&&void 0===t.__sv_scroll&&t.parentElement&&t.parentElement.parentElement||n.push(t),t=t.parentElement;return n}function WheelCtrl(e){var t=this,n={};e.callback.register("frame-node-removed",(function(e){var t;for(t in n)n.hasOwnProperty(t)&&t.startsWith(e+"_")&&delete n[t]})),t.should_prevent_default=function(e){var t=getFidByNode(e),r=getUidByNode(e);return!(!t||!r)&&"SURR"===n[getNodeKey(t,r)]},t.on_elem_wheel_ctrl_msg=function(e,t,r){var i;(Object.keys(n).length||"TC"!==r)&&(i=getNodeKey(e,t),"SURR"===r?n[i]=r:"TC"===r&&delete n[i])},t.on_remove_node=function(e,t){var r;r=getNodeKey(e,t),delete n[r]}}function KeyCtrl(e){var t=this,n=new KeyMap,r={},i={};function o(e,t,n,r,i){return[e,t,n,r,i].join("-")}e.callback.register("frame-node-removed",(function(e){var t;for(t in i)i.hasOwnProperty(t)&&t.startsWith(e+"_")&&delete i[t]})),t.set_wait_for_key_ctrl=function(e){var t,n,i;for(r={},t=0;t<e.length;t++)i=o((n=e[t]).keycode,!!n.ctrl,!!n.shift,!!n.alt,!!n.meta),r[i]=!0},t.should_prevent_default=function(e,t,a,s,l,c){var d,u,_=getFidByNode(e),f=getUidByNode(e);return!(!_||!f)&&(!!function(e,t){return 80===e&&t||n.SCROLLING_KEYS_WITH_KEY_CTRL.hasOwnProperty(e)}(t,a)&&(d=getNodeKey(_,f),u=o(t,a,s,l,c),i[d]&&i[d].hasOwnProperty(u)?i[d][u]:r.hasOwnProperty(u)))},t.on_elem_key_ctrl_msg=function(e,t,n,r,a,s,l,c){var d=getNodeKey(e,t),u=o(n,r,a,s,l);i[d]||(i[d]={}),i[d][u]=c},t.on_remove_node=function(e,t){delete i[getNodeKey(e,t)]}}function ShortcutKeyHandler(e,t){var n;function r(e){var t=0;return e.shiftKey&&(t+=1),e.ctrlKey&&(t+=2),e.altKey&&(t+=4),e.metaKey&&(t+=8),t}n="Mac"===browser.os||"iPhone/iPod"===browser.os?{65:{8:"selectAll"},66:{8:"bold"},67:{8:"copy"},70:{8:"inPageSearch"},71:{8:"inPageSearchNext",9:"inPageSearchPrev"},73:{8:"italic"},80:{8:"print"},85:{8:"underline"},86:{8:"paste"},88:{8:"cut"},90:{8:"undo",9:"redo"}}:{45:{1:"paste",2:"copy"},65:{2:"selectAll"},66:{2:"bold"},67:{2:"copy"},70:{2:"inPageSearch"},71:{2:"inPageSearchNext",3:"inPageSearchPrev"},73:{2:"italic"},80:{2:"print"},85:{2:"underline"},86:{2:"paste",3:"specialPaste"},88:{2:"cut"},89:{2:"redo"},90:{2:"undo"}},this.get_operation=function(e){var t;return"keydown"!==e.type?null:(t=n[e.keyCode])?t[r(e)]:null},this.tryProcess=function(e){var i,o=e.keyCode,a=e.target,s=e.type,l=r(e),c=!1;if("keydown"!==s&&"keypress"!==s)return!1;if("keypress"===e.type&&(e.altKey||e.metaKey||e.ctrlKey))return!0;if("Firefox"===browser.name&&browser.version<=24&&"keypress"===e.type&&!e.charCode)return!0;if(!n.hasOwnProperty(o))return!1;if(!(i=n[o][l]))return!1;switch(i){case"selectAll":case"bold":case"italic":case"underline":case"redo":case"undo":t&&(c=t(a,e,i))}return c}}function KeyMap(){var e=this,t={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",46:"Delete"},n={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Down:"ArrowDown",Right:"ArrowRight",Del:"Delete"};e.SPECIAL_KEYS={8:1,9:1,13:1,27:1,33:1,34:1,35:1,36:1,37:1,38:1,39:1,40:1,46:1},e.SCROLLING_KEYS={32:1,33:1,34:1,35:1,36:1,37:1,38:1,39:1,40:1},e.SCROLLING_KEYS_WITH_KEY_CTRL={32:1},e.LECHO_SPECIAL_KEYS={8:1,35:1,36:1,37:1,39:1,46:1},e.getKeyCode=function(e){var r;return r=e.key||t[e.keyCode]||"","Unidentified"===(r=n[r]||r)&&(r=t[e.keyCode]||""),r},e.getCode=function(t){return BrowserDetect.isIE()?e.getKeyCode(t):t.code}}function PointerEventQueue(e,t){var n,r=[],i=this,o=!1,a=-1;function s(){clearTimeout(n),n=setTimeout((function(){i.flush()}),30)}i.flush=function(){r.length&&e.surrogate_channel.send("multiple-mouse",t,{flg:BrowserDetect.isIE(),cnt:a,evts:r}),clearTimeout(n),e.local_events.pointer_queue_flushed()},i.push_mouse_event=function(e,n,o,l){var c;return a+1>=r.length?(i.flush(),!1):(c=r[a+1],getFidByNode(e)!==t||n.substr(-3)!==c[1].substr(-3)||getUidByNode(e)!==c[0]||c[11]!==(o?getUidByNode(o):null)?(i.flush(),!1):(a+=1,c.push({m_btn:l}),s(),!0))},i.push_pointer_event=function(e,n,a,l,c,d,u,_,f,p,m,g,h,v,w,y,b,E,A,U,S,C,N,k,O,T,x,D){return getFidByNode(e)!==t?(i.flush(),!1):("pointerover"===n&&(o=!0),r.push([getUidByNode(e),n,v.x,v.y,v.relative_to_target,u,d,_,A,m,g,w?getUidByNode(w):null,h,a,l,c,f,p,y,b,E,U,S,C,N,k,O,T,x,D]),s(),!0)},i.flush_if_necessary=function(e){return!(!o||"pointerout"!==e)&&(i.flush(),!0)}}function LocalEvents(e){var t,n,r,i,o=this,a=new Logger("local-events",{level:"info"}),s=new KeyMap,l=new ShortcutKeyHandler(e,(function(t,n,r){var i,o=getFidByNode(n.target),a=getUidByNode(n.target),l=!1;switch(r){case"bold":case"italic":case"underline":case"selectAll":case"undo":case"redo":i=["kbd",o,a,n.type,n.keyCode,n.charCode,s.getKeyCode(n),s.getCode(n),n.shiftKey,n.ctrlKey,n.altKey,n.metaKey,0],e.surrogate_channel.send.apply(e.surrogate_channel,i),l=!0}return l&&n.preventDefault(),l})),c=null,d=[0,0],u=null,_=[0,0],f={x:0,y:0},p=null,m=null,g=!1,h=0,v=null,w=!1,y=!1,b=!1,E=!1,A=!1,U={in_progress:!1,pending_end_msg:!1};function S(t,n){var r,i;if(local_echo_enabled&&local_echo_config.extended&&(r=getFidByNode(t),void 0!==(i=getUidByNode(t))))switch(n.type){case"compositionstart":U.in_progress||(U.pending_end_msg||e.surrogate_channel.send("ime_state",r,i,!0),U.in_progress=!0,U.pending_end_msg=!1,U.fid=r,U.uid=i);break;case"compositionupdate":break;case"compositionend":U.in_progress&&(U.in_progress=!1,U.pending_end_msg=!0);break;case"keyup":!U.in_progress&&U.pending_end_msg&&(e.surrogate_channel.send("ime_state",U.fid,U.uid,!1),U.pending_end_msg=!1);break;default:assert(0)}}function C(t,n){S(t,n),e.local_input.handle_local_input_events(t,n)}function N(t,n){if(local_echo_enabled&&t.__keypress_just_happened)return Util.can_element_use_lecho(t)?e.lecho_regulator.update_local_value(getFidByNode(t),getUidByNode(t),t.value,h):e.lecho_regulator_ext.update_local_value(t,"input_evt"),void delete t.__keypress_just_happened;Util.is_element_date_time_input(t)||Util.is_element_color_input(t)?(Util.is_supported_element_date_time_input(t)||Util.is_supported_element_color_input(t))&&e.surrogate_channel.send("input",getFidByNode(t),getUidByNode(t),t.value):(e.local_input.handle_local_input_events(t,n),e.http_alert.update())}function k(t,n){local_echo_enabled&&t.__keypress_just_happened||e.local_input.handle_local_input_events(t,n)}function O(t,n){local_echo_enabled&&t.__keypress_just_happened||e.local_input.handle_local_input_events(t,n)}function T(t,n){var r,i,o,a,s,l,c=!1;if(!e.copy_paste_ctrl.enforce_on_user_action(t,n)){if(a=e.copy_paste_ctrl.has_paste_restriction(),i=getFidByNode(t),o=getUidByNode(t),r=getWindowByFid(i),n=n||r.event,v&&(clearTimeout(v),v=null),local_echo_enabled&&Util.can_element_use_lecho(t)&&e.lecho_regulator.lecho_enabled(i,o))return e.local_input.handle_local_input_events(t,n),w=!1,void(y=!1);y&&e.surrogate_channel.send("pre-paste"),s=function(t,n,r){var s;for(a&&Util.filterPasteDataList(r),s=0;s<r.length;s+=2)"file_obj_list"===r[s+1]&&(e.upload.setupDroppedUpload(r[s]),r[s]="placeholder");e.surrogate_channel.send("paste",i,o,r,t,n),c=!0}.curry(w,y),l=function(t){t&&e.surrogate_channel.send("empty-paste")}.curry(y),Util.makePasteDataList(n,r,s,l),w=!1,y=!1,c||!BrowserDetect.isIE()||a?n.preventDefault():e.local_input.handle_local_input_events(t,n)}}function x(e,t){return!(!s.SCROLLING_KEYS.hasOwnProperty(t)||!function(e){return!!("body"===Util.get_node_tag(e)||"html"===Util.get_node_tag(e)||e.scrollTo||e.scrollBy||e.scrollByLines||e.scrollByPages)}(e)||Util.is_element_input_text(e)||Util.is_elem_editable(e))}function D(t,n){n=Util.handle_autofill_event(t,n);var r,i,a,c,d,u=Util.get_node_tag(t),_=n.keyCode,f=n.ctrlKey,p=n.shiftKey,m=n.metaKey,g=n.altKey,E=!1,A=0,U=!1,C=l.get_operation(n);if(e.detached)e.prevent_reattach||(e.detached=!1,Util.xframe_reload());else if(b=!1,"keydown"===n.type&&(e.clipboard.piggyback(n),e.callback.fire("interaction",n)),"keyup"===n.type&&S(t,n),e.callback.fire("key-event",t,n),!e.print_handler.handlePrintKeyEventIfNeeded(n,C)){if(Util.getDocIdIfSafedocs()&&"inPageSearch"===C&&n.preventDefault(),local_echo_enabled&&"keyup"===n.type&&delete n.target.__keypress_just_happened,"keydown"===n.type&&e.context_menu.dismiss_if_necessary(n),"select"===u){if(!local_echo_enabled)return;if("keydown"!==n.type||9!==_)return}if(!o.local_text_input_in_date_time_field(t,u)&&!Util.is_unsupported_element_color_input(t)&&(_=Util.get_corresponding_chrome_keycode(n,_),"keypress"===n.type&&n.altKey&&(BrowserDetect.isIE()||RegExp("^.$","u").test(n.key))&&(f=!1,m=!1,g=!1,E=!0),(E||!l.tryProcess(n))&&!(BrowserDetect.isFirefox()&&BrowserDetect.version<=65&&"keypress"===n.type&&_>=112&&_<=123))){if(c="keypress"===n.type&&0===_&&32===n.charCode?32:_,BrowserDetect.isFirefox()&&BrowserDetect.version>=37&&"checkbox"===n.target.type&&32===c&&(n.target.__sv_ignore_click_event=!0),r=s.getKeyCode(n),local_echo_enabled){if(i=getFidByNode(t),a=getUidByNode(t),Util.can_element_use_lecho(t)){if(e.lecho_regulator.is_input_locked())return void n.preventDefault();("keypress"===n.type||"keydown"===n.type&&8===n.keyCode||"keydown"===n.type&&46===n.keyCode)&&e.lecho_regulator.lecho_enabled(i,a)&&(A=h+=1)}"keydown"!==n.type||13!==n.keyCode&&9!==n.keyCode||e.lecho_regulator.send_precheck(i,13===n.keyCode?"enter":"tab")}if("specialPaste"===l.get_operation(n)&&(w=!0),"paste"!==l.get_operation(n)&&"specialPaste"!==l.get_operation(n)||(y=!0,function(e,t){BrowserDetect.isIE()&&(v=setTimeout((function(){T(e,t)}),200))}(t,n)),"cut"===l.get_operation(n)&&(b=!0),function(t,n){return!(!(local_echo_enabled&&Util.can_element_use_lecho(n)&&e.local_input.has_pending_diff())||local_echo_config.extended&&"Enter"===t.key)}(n,t)||(d=["kbd",getFidByNode(t),getUidByNode(t),n.type,_,n.charCode,r,s.getCode(n),p,f,g,m,A],e.surrogate_channel.send.apply(e.surrogate_channel,d),U=!0),local_echo_enabled&&Util.can_element_use_lecho(t)){if(i=getFidByNode(t),a=getUidByNode(t),"keydown"===n.type&&(e.lecho_regulator.set_last_keypress(i,a,_),s.LECHO_SPECIAL_KEYS.hasOwnProperty(_)&&e.lecho_regulator.lecho_enabled(i,a)))return void(t.__keypress_just_happened=!0);if("keypress"===n.type&&e.lecho_regulator.lecho_enabled(i,a))return void(n.target.__keypress_just_happened=!0)}if(!(local_echo_enabled&&local_echo_config.extended&&Util.is_content_editable(t)&&e.lecho_regulator_ext.process_keyevent_locally(n,U)))if(function(e,t,n){return e||t||n}(m,f,g))e.key_ctrl.should_prevent_default(t,c,f,p,g,m)&&n.preventDefault();else{if(x(t,c)){if(!e.key_ctrl.should_prevent_default(t,c,f,p,g,m))return;"keydown"===n.type&&U&&e.surrogate_channel.send("require-surr-scroll-echo",getFidByNode(t))}("keydown"!==n.type||s.SPECIAL_KEYS.hasOwnProperty(_))&&n.preventDefault()}}}}function L(e,t){var n=Util.calculateMouseMovement(e);c||u||setTimeout((function(){var e;u&&(e={pt_x:_[0],pt_y:_[1]},c&&c[0]===u[0]&&(e.m_x=d[0],e.m_y=d[1],e.m_btn=c[7],c=null),u.push(e),o.send_pointer_event.apply(null,u)),c&&(c.push(d[0]),c.push(d[1]),o.send_mouse_event.apply(null,c)),c=null,u=null,d=[0,0],_=[0,0]}),100),"pointermove"===e.type?(_[0]+=n.x,_[1]+=n.y,u=t):"mousemove"===e.type&&(d[0]+=n.x,d[1]+=n.y,c=t)}function I(e){return e.ctrlKey||e.shiftKey||e.metaKey}function B(e){return Util.findPredicateOnBranch(e,Util.is_node_likely_anchor_tag)}function P(t){var n;return!!e.pairing_dict.mpa_id&&(n=Util.findPredicateOnBranch(t,(function(e){return(e.className||"").toLowerCase().indexOf("sign-in-again")>=0})),Util.findPredicateOnBranch(n,(function(e){return(e.id||"").toLowerCase().indexOf("menlo_mpa")>=0})))}function R(e){var t=Util.get_node_tag(e);return!!("a"===t&&e.href||("input"===t||"button"===t)&&"submit"===e.type.toLowerCase()||"input"===t&&"image"===e.type.toLowerCase()||"input"===t&&"checkbox"===e.type.toLowerCase()||"img"===t||"map"===t)}function F(t){!TPROXY_ENABLED&&e.pairing_dict.prepend_client_navs&&(setTimeout((function(e){t.href=e}),0,t.href),t.href=window.location.origin+"/"+t.href)}function M(e){return e.getAttribute&&"true"===e.getAttribute("draggable")}function V(t,r,i){var o,a=Util.get_node_tag(i);if(r===n)return e.wheel_ctrl.should_prevent_default(i);if("click"===r&&"input"===a&&"file"===i.type)return!i.getAttribute("__sv_open");if("click"===r&&Util.is_supported_element_color_input(i))return!i.hasAttribute("data-sv-color-chooser-open");if(A)return!1;if("mousedown"===r&&Util.findPredicateOnBranch(i,M))return A=!0,!1;if(function(e){return 1===e.button&&("mousedown"===e.type||"mouseup"===e.type)}(t)&&e.readonly.allow_tab_creation()&&(o=B(i)))return F(o),!1;if(function(e,t,r){var i=Util.get_node_tag(r),o="click"===t||"mousedown"===t||"mouseup"===t;return t===n||"mouseenter"===t||"mouseleave"===t||1===e.button||2===e.button||o&&("select"===i||("audio"===i||"video"===i)&&r.controls||"input"===i&&Util.date_time_input_types[r.type])||"input"===i&&"password"===r.type&&"click"===t&&BrowserDetect.isChromiumEdge()}(t,r,i))return!1;if("click"===r&&(o=B(i))){if(e.readonly.allow_tab_creation()&&I(t))return F(o),!1;if(Util.isMPAPortalUrl()&&"_blank"===o.target)return!1;if(P(o))return!1;if("_blank"===o.target&&!o.hasAttribute("download")&&e.tab.tabPreOpen(Util.getRawPageUrl(o.href)))return!0}if(function(e){return!!Util.findPredicateOnBranch(e,R)}(i)){if("mousedown"===r)try{Util.findPredicateOnBranch(i,(function(e){return e===e.ownerDocument.body?(e.ownerDocument.activeElement.blur(),!0):(1===e.nodeType&&e.focus(),e===e.ownerDocument.activeElement)}))}catch(e){if(!BrowserDetect.isEdge()&&!BrowserDetect.isIE()||"typeerror"!==e.name.toLowerCase())throw e}return!0}return"click"===r}function H(t,n){var r=n.type,i=n.pointerId,a=n.pointerType,s=n.bubbles,l=n.altKey,c=n.ctrlKey,d=n.shiftKey,u=n.cancelBubble,_=n.cancelable,f=n.button,m=n.buttons||0,g=n.detail||1,h=Util.getRelativeMouseCoords(t,n),v=o.get_mouse_event_reltarget(r,n),w=n.tiltX,y=n.tiltY,b=n.twist,E=n.metaKey,A=n.altitudeAngle,U=n.azimuthAngle,S=n.tangentialPressure,C=n.pressure,N=n.composed,k=n.defaultPrevented,O=n.eventPhase,T=n.isPrimary,x=n.isTrusted;switch(r){case"pointermove":L(n,[t,r,i,a,s,l,c,d,u,_,f,m,g,h,v,w,y,b,E,A,U,S,C,N,k,O,T,x]);break;case"pointerleave":case"pointerout":case"pointerover":case"pointerenter":p&&p.flush_if_necessary(r)&&(p=new PointerEventQueue(e,getFidByNode(t))),p||"pointerout"!==r&&"pointerleave"!==r||(p=new PointerEventQueue(e,getFidByNode(t))),p&&p.push_pointer_event(t,r,i,a,s,l,c,d,u,_,f,m,g,h,v,w,y,b,E,A,U,S,C,N,k,O,T,x)||(p=null,setTimeout((function(){o.send_pointer_event(t,r,i,a,s,l,c,d,u,_,f,m,g,h,v,w,y,b,E,A,U,S,C,N,k,O,T,x)}),0));break;default:setTimeout((function(){o.send_pointer_event(t,r,i,a,s,l,c,d,u,_,f,m,g,h,v,w,y,b,E,A,U,S,C,N,k,O,T,x)}),0)}}function W(a,s){var l,c,d,u,_,m,h,v,w,y=s.type,b=!0;if(e.detached)e.prevent_reattach||(e.detached=!1,Util.xframe_reload());else if("mousedown"===s.type&&(e.clipboard.piggyback(s),e.callback.fire("interaction",s)),"click"===y&&s.target.__sv_ignore_click_event)delete s.target.__sv_ignore_click_event;else if(assert(getFidByNode(a)),assert(getUidByNode(a)),l=s.detail||1,c=Util.getRelativeMouseCoords(a,s),function(e,t){var n,r,i=getFidByNode(e);for(f={x:t.clientX,y:t.clientY};i&&!isTopFrameFid(i);)(r=getWindowByFid(i).frameElement)?((n=r.getBoundingClientRect())&&(f.x+=n.left,f.y+=n.top),i=getFidByNode(r)):i=null}(a,s),d=o.get_mouse_event_reltarget(y,s),u=s.ctrlKey,_=s.altKey,m=s.shiftKey,h=s.metaKey,v=s.button,w=s.buttons||0,void 0!==s.composed&&(b=s.composed),0===w&&(A=!1),"mousedown"===y&&e.context_menu.dismiss_if_necessary(s),"mousedown"===y&&2===w&&"img"===a.nodeName.toLowerCase()&&e.imgreq_mgr.request_image(a,s),"mousedown"===y&&0===v&&"input"===a.nodeName.toLowerCase()&&"file"===a.getAttribute("type")&&BrowserDetect.isIE()&&(g=!0),V(s,y,a)&&s.preventDefault(),!function(n,r,i){var o,a=Util.get_node_tag(i);if(t&&"mouseup"===r)return!1;if(1===n.button)return!0;if("click"===r){if("input"===a&&"file"===i.type)return!!i.getAttribute("__sv_open")&&(i.removeAttribute("__sv_open"),!0);if(Util.is_supported_element_color_input(i))return!!i.hasAttribute("data-sv-color-chooser-open")&&(i.removeAttribute("data-sv-color-chooser-open"),!0);if(o=B(i)){if(Util.isMPAPortalUrl()&&"_blank"===o.target)return!0;if(P(o))return!0}return e.readonly.allow_tab_creation()&&I(n)&&!!o}return"mousedown"===r&&"option"===a||"dblclick"===r}(s,y,a))switch(!p||y!==n&&"click"!==y&&"dblclick"!==y||p.flush(),y){case"mousedown":if(2===v){o.send_mouse_button_and_selection(a,y,c,u,_,m,h,v,w,d,l,b,null);break}t=a,local_echo_enabled&&Util.can_element_use_lecho(a)&&e.lecho_regulator.lock_input(),setTimeout((function(){o.send_mouse_event(a,y,c,u,_,m,h,v,w,d,l,b)}),0);break;case"mouseup":g=!1,o.send_mouse_button_and_selection(a,y,c,u,_,m,h,v,w,d,l,b,t),local_echo_enabled&&setTimeout((function(){e.lecho_regulator.unlock_input()}),0),t=null;break;case n:!function(t,n,o){var a,s,l,c,d,u;switch(o){case"mousewheel":void 0===r?(s=t.wheelDelta?-t.wheelDelta:0,a=0):(s=i,a=r,r=void 0),l=0,c=0,d=t.wheelDelta,u=t.wheelDelta;break;case"wheel":s=t.deltaY,a=t.deltaX,l=t.deltaMode,c=t.wheelDeltaX,d=t.wheelDeltaY,u=t.wheelDelta;break;default:assert(!1)}(a||s)&&(assert(0===l||1===l),1===l&&(s*=40,a*=40,l=0),e.surrogate_channel.send("wheel",getFidByNode(n),getUidByNode(n),{deltaMode:l,deltaX:a,deltaY:s,cancelable:!0,bubbles:t.bubbles,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY,pageX:t.pageX,pageY:t.pageY,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,wheelDeltaX:c,wheelDeltaY:d,wheelDelta:u,composed:void 0===t.composed||t.composed}))}(s,a,y);break;case"mousemove":L(s,[a,y,c,u,_,m,h,v,w,d,l,!1]);break;case"mouseover":case"mouseout":case"mouseenter":case"mouseleave":local_echo_enabled&&e.lecho_regulator.set_mouse_moved(),"mouseenter"===y&&"html"===Util.get_node_tag(a)&&isTopFrameFid(getFidByNode(a))&&delete e.last_mouse_pos,p&&p.push_mouse_event(a,y,d,v)||(p=null,setTimeout((function(){o.send_mouse_event(a,y,c,u,_,m,h,v,w,d,l,b)}),0));break;default:setTimeout((function(){o.send_mouse_event(a,y,c,u,_,m,h,v,w,d,l,b)}),0)}}function X(t,n){"touchend"===n.type&&e.callback.fire("interaction",n)}function j(t,n){assert(t),e.copy_paste_ctrl.enforce_on_user_action(t,n)||("dragstart"===n.type&&"div"===t.nodeName.toLowerCase()&&(t.className.toLowerCase().indexOf("ytp-volume-slider")>=0||t.className.toLowerCase().indexOf("ytp-progress-bar")>=0)?n.preventDefault():e.allow_backend_dragdrop&&"#text"!==t.nodeName&&("drop"===n.type&&n.dataTransfer.files.length>0&&e.upload.setupDroppedUpload(n.dataTransfer.files),"dragstart"===n.type?n.dataTransfer.items&&n.dataTransfer.items.clear():n.preventDefault(),e.surrogate_channel.send("drag",getFidByNode(t),{t:getUidByNode(t),y:n.type,p:Util.getRelativeMouseCoords(t,n),m:Util.calculateDragMovement(n),d:Util.getMouseAndKeyboardModifiers(n,a),f:Util.gen_dragdrop_file_list(n.dataTransfer),i:n.dataTransfer.items})))}function Y(t,n){var r=getWindowByFid(getFidByNode(t)),i=t,o=r&&r.__sv_surrogate_is_readonly,a=Util.findPredicateOnBranch(t,Util.is_node_likely_anchor_tag),s=Util.getTopWindowMousePosition(n);if(!e.copy_paste_ctrl.enforce_on_user_action(t,n))if("img"===t.nodeName.toLowerCase()&&e.imgreq_mgr.request_image(t,n),e.context_menu.set_last_pos(s),a&&o)n.preventDefault();else if(e.ctx_menu_mode&&e.ctx_menu_mode.backend_driven){if(e.ctx_menu_mode.native_menu_for_input&&(3===i.nodeType&&(i=i.parentNode),Util.is_element_input_text(i)||Util.is_elem_editable(i)))return;W(t,n),n.preventDefault()}else e.ctx_menu_mode&&e.ctx_menu_mode.hasOwnProperty("backend_driven")||W(t,n)}function q(t,n){var r=Util.get_node_tag(t);if("select"!==r){if("input"!==r||"file"!==t.type)return Util.is_element_date_time_input(t)||Util.is_element_color_input(t)?((Util.is_unsupported_element_date_time_input(t)||Util.is_unsupported_element_color_input(t))&&e.surrogate_channel.send("input",getFidByNode(t),getUidByNode(t),t.value),void e.surrogate_channel.send("change",getFidByNode(t),getUidByNode(t),t.value)):void("input"===r&&t.list&&e.surrogate_channel.send("change",getFidByNode(t),getUidByNode(t),t.value));e.upload.setupUploads(t,n)}else e.surrogate_channel.send("change",getFidByNode(t),getUidByNode(t),t.value,t.selectedIndex)}function z(t,n){var r,i,a,s,l,c=0,d=0,u=0,_=0;t=n.target,e.http_alert.update(),s=getFidByNode(t),l=getUidByNode(t),o.ignored_events.scroll[s+"_"+l]?delete o.ignored_events.scroll[s+"_"+l]:"marquee"!==Util.get_node_tag(t)&&("#document"===t.nodeName?(r=getWindowByFid(getFidByNode(t=t.documentElement)))&&void 0!==r.pageXOffset&&(d=r.pageXOffset,c=r.pageYOffset,u=r.innerWidth,_=r.innerHeight):(d=t.scrollLeft,c=t.scrollTop,u=t.clientWidth,_=t.clientHeight),a=t.scrollHeight,(i=t.scrollWidth)&&a?(d=i>u?d/(i-u):0,c=a>_?c/(a-_):0,e.surrogate_channel.send("scroll-new",s,l,d,c)):reportWarnClientEvent("tc-scroll-ignored-bad-dim",{target_uid:l,x:d,y:c}))}function K(e,t){t.preventDefault(),t.stopImmediatePropagation()}function G(e,t){}function J(t,n){var r;e.copy_paste_ctrl.enforce_on_user_action(t,n)||(Util.is_element_input_text(t)||n.preventDefault(),e.clipboard.cut_event_handler(n),t.__sv_cut_happened=!0,!TPROXY_ENABLED&&Util.is_autofill_target(t)&&setTimeout((function(){delete t.__sv_cut_happened}),100),b||(r=getFidByNode(t),e.surrogate_channel.send("execcmd",r,"cut")),b=!1)}function Q(t,n){e.copy_paste_ctrl.enforce_on_user_action(t,n)||e.clipboard.copy_event_handler(n)}function Z(e,t){}function $(t,n){var r=e.xbrowser.getEventTarget(n);r&&!Util.IsEventTargetForeign(r,n)&&(function(e,t){return t.currentTarget&&11===t.currentTarget.nodeType&&e.getRootNode&&e.getRootNode()!==t.currentTarget?(t.type,t.currentTarget,t.currentTarget.__sv_uid,!0):!(!e.shadowRoot||!e.shadowRoot.__sv_uid||(t.type,e.__sv_uid,0))}(r,n)||(o.ignored_events[n]?o.ignored_events[n]=!1:t(r,n)))}function ee(e,t,n){var r,i;for(r=0;r<o.window_params.length;r+=1)i=o.window_params[r],e?EventListener.addListener(t,i[0],i[1],i[2]):EventListener.removeListener(t,i[0],i[1],i[2]);for(r=0;r<o.document_params.length;r+=1)i=o.document_params[r],e?EventListener.addListener(n,i[0],i[1],i[2]):EventListener.removeListener(n,i[0],i[1],i[2])}BrowserDetect.isIE()?(n="mousewheel",document.addEventListener("wheel",(function(e){r=e.deltaX,i=e.deltaY}))):n="wheel",o.ignored_events={},o.ignored_events.scroll={},o.get_last_mouse_pos=function(){return f},o.local_text_input_in_date_time_field=function(e,t){return void 0===t&&(t=Util.get_node_tag(e)),!!Util.is_element_date_time_input(e)&&("text"===e.type||!!BrowserDetect.isChrome())},o.get_mouse_event_reltarget=function(e,t){var n=null;return"pointerover"===e||"mouseover"===e?n=t.relatedTarget||t.fromElement:"pointerout"===e||"mouseout"===e?n=t.relatedTarget||t.toElement:"pointerenter"!==e&&"mouseenter"!==e&&"pointerleave"!==e&&"mouseleave"!==e||(n=t.relatedTarget),n},o.send_mouse_event=function(t,n,r,i,o,a,s,l,c,d,u,_,f,p){var m,g=getFidByNode(t);"mousedown"===n&&getUidByNode(t),!E&&local_echo_enabled&&"mousedown"===n&&e.lecho_regulator.send_precheck(g,"mousedown"),"mousedown"!==n&&"click"!==n||(E=!1),m=["mouse",g,getUidByNode(t),n,r.x,r.y,r.relative_to_target,i,o,a,s,l,c,d?getUidByNode(d):null,u,_],void 0!==f&&(m.push(f),m.push(p)),e.surrogate_channel.send.apply(e.surrogate_channel,m)},o.send_pointer_event=function(t,n,r,i,o,a,s,l,c,d,u,_,f,p,m,g,h,v,w,y,b,A,U,S,C,N,k,O,T){var x,D=getFidByNode(t);local_echo_enabled&&"pointerdown"===n&&(e.lecho_regulator.send_precheck(D,"pointerdown"),E=!0),x=["pointer",D,getUidByNode(t),n,p.x,p.y,p.relative_to_target,s,a,l,w,u,_,m?getUidByNode(m):null,f,r,i,o,c,d,g,h,v,y,b,A,U,S,C,N,k,O],void 0!==T&&x.push(T),e.surrogate_channel.send.apply(e.surrogate_channel,x)},o.send_mouse_button_and_selection=function(t,n,r,i,a,s,l,c,d,u,_,f,p){setTimeout((function(){for(var g=getWindowByFid(getFidByNode(p||t)).document.activeElement;g&&g.shadowRoot&&g.shadowRoot.__sv_uid;)g=g.shadowRoot.activeElement;"mouseup"===n&&0===c&&m&&(e.selection.set_range_selection(m[0],m[1],m[2],m[3],m[4],m[5],m[6]),m=null),g&&!Util.IsEventTargetForeign(g)&&(e.surrogate_channel.send("selection",getFidByNode(g),e.selection.getSelection(g)),e.clipboard.set_last_selection_fid(getFidByNode(g))),o.send_mouse_event(t,n,r,i,a,s,l,c,d,u,_,f)}),0)},this.pointer_queue_flushed=function(){p=null},o.resize_event=function(t,n){var r=MetricsUtils.getVisualViewportMetrics();r.width,r.height,e.surrogate_channel.send("resize",Math.round(r.width),Math.round(r.height),Util.getDeviceScaleFactor()),e.http_alert.update()},o.install_event_listeners_for_shadowroot=function(e,t){ee(e,t,t)},o.install_event_listeners=function(t,n,r){t.__handlers_installed&&!r||(ee(!0,t,n),e.print_handler.attachKeyEventHandler(!0),t.__handlers_installed=!0)},o.uninstall_event_listeners=function(t,n){t.__handlers_installed&&(ee(!1,t,n),e.print_handler.attachKeyEventHandler(!1),t.__handlers_installed=!1)},o.defer_range_sel_if_file_chooser=function(e,t,n,r,i,o,a){return!!g&&(m=[e,t,n,r,i,o,a],!0)},o.has_deferred_range_sel=function(){return!!m},o.key_event=D,o.window_params=[["scroll",function(e){$(z,e)},!0],["dblclick",function(e){$(W,e)},!1],["resize",function(e){$(o.resize_event,e)},!1],["input",function(e){$(N,e)},!1],["textInput",function(e){$(k,e)},!1],["beforeinput",function(e){$(O,e)},!1],["compositionstart",function(e){$(C,e)},!1],["compositionend",function(e){$(C,e)},!1],["compositionupdate",function(e){$(C,e)},!1]],o.document_params=[["keydown",function(e){$(D,e)},!0],["keypress",function(e){$(D,e)},!0],["keyup",function(e){$(D,e)},!0],["mousedown",function(e){$(W,e)},!1],["mouseenter",function(e){$(W,e)},!0],["mouseleave",function(e){$(W,e)},!0],["mouseup",function(e){$(W,e)},!1],["mousemove",function(e){$(W,e)},!1],["mouseover",function(e){$(W,e)},!1],["mouseout",function(e){$(W,e)},!1],["dragstart",function(e){$(j,e)},!1],["dragend",function(e){$(j,e)},!1],["dragover",function(e){$(j,e)},!1],["drop",function(e){$(j,e)},!1],["dragenter",function(e){$(j,e)},!1],["dragleave",function(e){$(j,e)},!1],[n,function(e){$(W,e)},!0],["contextmenu",function(e){$(Y,e)},!1],["submit",function(e){$(K,e)},!1],["reset",function(e){$(G,e)},!1],["cut",function(e){$(J,e)},!1],["copy",function(e){$(Q,e)},!1],["paste",function(e){$(T,e)},!1],["select",function(e){$(Z,e)},!1],["change",function(e){$(q,e)},!1],["click",function(e){$(W,e)},!1],["touchend",function(e){$(X,e)},!1],["pointerup",function(e){$(H,e)},!1],["pointerdown",function(e){$(H,e)},!1],["pointerenter",function(e){$(H,e)},!0],["pointerover",function(e){$(H,e)},!1],["pointerout",function(e){$(H,e)},!1],["pointerleave",function(e){$(H,e)},!0],["pointercancel",function(e){$(H,e)},!1],["pointermove",function(e){$(H,e)},!1]]}function LocalInput(){var e,t,n=this,r=new Logger("localinput",{level:"info"}),i=null,o=null,a=[],s=null,l=null,c={},d={},u=null,_=null,f=null,p=null,m=-1,g=1,h=new diff_match_patch;function v(e){var t;return Util.is_element_input_text(e)?t=e.value:3===e.nodeType&&(t=e.data),t}function w(n){return n===e||n===t}function y(n){if(!e)return!1;for(;null!==n;){if(Util.is_elem_editable(n)&&(n===e||n===t))return!0;if(n===n.parentNode||!Util.is_elem_editable(n)&&1===n.nodeType)break;n=n.parentNode}return!1}function b(e,t){void 0===t&&(t=3!==e.nodeType||getUidByNode(e)||e.__sv_client_id?v(e):""),Util.is_element_input_text(e)||3===e.nodeType||reportErrorClientEvent("tc-local-input-error",{detail:"Unexpected node type in preserve value call"}),e.prev_text=t}function E(e,t){var n,r;if(!e.parentNode)return!1;if(t&&e.parentNode!==t)return!1;for(r=e.parentNode.childNodes,n=0;n<r.length;n+=1)if(r[n]===e)return!0;return!1}function A(){var e,t,n;for(a.length&&a.length;a.length;)"add"===(e=a.shift())[0]?(e[4].data,safeview.dom_updater.add_text_node(e[1],e[2],e[3],e[4])):"remove"===e[0]?(3===(n=e[3]).nodeType?(n.__sv_uid,n.data):(n.__sv_uid,n.childNodes.length),E(e[3],e[4])&&safeview.dom_updater.remove_node(e[1],e[2],e[3],e[4])):"update"===e[0]?(t=e[1],Util.is_element_input_text(t)?t.value:t.data,Util.is_element_input_text(t)?t.value=e[2]:local_echo_enabled&&local_echo_config.extended?t.data!==e[2]&&safeview.dom_updater.apply_text_node_patch(t,t.data,e[2]):safeview.dom_updater.apply_text_node_patch(t,t.data,e[2]),b(t,e[2])):assert(!1,"IME Unknown deferred operation.");s&&(s[2],s[2].__sv_uid,s[3],s[4],s[4].__sv_uid,s[5],safeview.selection.set_range_selection(s[0],s[1],s[2],s[3],s[4],s[5],s[6]),s=null)}function U(n,r){i&&(clearTimeout(i),i=null),e=n,t=r}function S(){if(BrowserDetect.isIE()){if(p){var e=p.data;p.data=e}var t,n,r;p&&(t=p.parentNode)&&t.hasChildNodes()&&(n=t.childNodes,-1===m||m>=n.length||(r=n[m])!==p&&r.data===p.data&&(r.__sv_uid||r.__sv_client_id||(setNodeIds(r,getUidByNode(p),getFidByNode(p)),r.__sv_client_id=p.__sv_client_id,delete p.__sv_client_id,delete p.__sv_uid,delete p.__sv_fid,r.__sv_client_id,r.__sv_uid))),p=null,m=-1}}function C(n){"compositionend"===n&&(i=setTimeout((function(){e=null,t=null,S(),A(),i=null}),0))}function N(e,t){var r=function(e){var t,n,r,i,o;if(t=v(e),(n=function(e){var t=e.prev_text;return void 0===t&&(t=""),t}(e))===t)return[];for(i=0,o=(r=h.diff_main(n,t)).length;i<o;i+=1)1!==r[i][0]&&(r[i][1]=r[i][1].length);return r}(e),i=Util.hashCode(v(e)),o=n.EDIT_REASON_COMPOSITION,a=!0,s=!1;if(C(t),"paste"===t&&(o=n.EDIT_REASON_PASTE),l=(new Date).getTime(),!E(e))return e.__sv_client_id,void getUidByNode(e);if(getUidByNode(e)){if(!r.length&&function(e){var t=safeview.selection.getSelection(e);return(t.mode===c.mode||t.mode===d.mode)&&("range"===t.mode?t.start_container===c.start_container&&t.end_container===c.end_container&&t.start_offset===c.start_offset&&t.end_offset===c.end_offset||t.start_container===d.start_container&&t.end_container===d.end_container&&t.start_offset===d.start_offset&&t.end_offset===d.end_offset:"input"===t.mode&&(t.uid===c.uid&&t.selection.start===c.selection.start&&t.selection.end===c.selection.end||t.uid===d.uid&&t.selection.start===d.selection.start&&t.selection.end===d.selection.end))}(e))return;c=safeview.selection.getSelection(e),d=function(e,t){var n,r,i,o,a,s,l,c=0,d=-1;if(l=JSON.parse(JSON.stringify(e)),BrowserDetect.isFirefox())return l;if(0===(r=t.length))return l;if(1!==t[i=r-1][0]){if(r<2)return l;i=r-2}if(1!==t[i][0])return l;if(1!==(o=t[i][1]).length&&2!==o.length||!Util.is_korean_char(o))return l;for(n=0;n<=i;n+=1)switch(t[n][0]){case-1:break;case 0:c+=t[n][1];break;case 1:c+=t[n][1].length}if("input"===e.mode)a=e.selection.start,s=e.selection.end;else{if("range"!==e.mode)return reportErrorClientEvent("tc-local-input-error",{detail:"Unexpected selection mode",mode:e.mode}),l;a=e.start_offset,s=e.end_offset}return s===a+1?d=s:s===a&&s+1===c&&(d=c),-1!==d&&("input"===e.mode?(l.selection.start=d,l.selection.end=d):"range"===e.mode&&(l.start_offset=d,l.end_offset=d),l.collapsed=!0),l}(c,r),getUidByNode(e),JSON.stringify(r),JSON.stringify(c),JSON.stringify(d),Util.is_element_input_text(e)&&(a=function(e,t){var n,r=0,i=0;for(n=0;n<e.length;n+=1)switch(e[n][0]){case-1:break;case 0:r+=e[n][1];break;case 1:i=r+e[n][1].length,r+=e[n][1].length;break;default:assert(!1)}return!t.selection||t.selection.start!==t.selection.end||t.selection.start!==i}(r,d)),local_echo_enabled&&local_echo_config.extended&&Util.is_content_editable(e)&&(safeview.lecho_regulator_ext.update_local_value(e,"txtdiff"),s=!0),safeview.surrogate_channel.send("edtx",getFidByNode(e),getUidByNode(e),r,d,a,i,o,s)}else!function(e,t,n,r){var i,o,a,s,l,c,d,u=[],_=0,f=-1,h=!1,v=!1;for(void 0===e.__sv_client_id&&(e.__sv_client_id="l"+g,e.__sv_client_id,g+=1),c=e.parentNode.childNodes,i=0;i<c.length;i+=1)if((d=c[i])===e){if(!e.__sv_client_id)return void reportErrorClientEvent("tc-local-input-error",{detail:"Missing a local node with client id."});u.push(e.__sv_client_id),p=e,m=i,v=!0}else void 0!==(o=getUidByNode(d))?u.push(o):reportErrorClientEvent("tc-local-input-error",{detail:"Unexpected local node among siblings"});if(v)if(u.length){for(a=e.parentNode;a&&!(_=getFidByNode(a));)a=a.parentNode;_?((s=e.ownerDocument.defaultView.getSelection()).rangeCount?(l=s.getRangeAt(0)).endContainer===e?f=l.endOffset:reportErrorClientEvent("tc-local-input-error",{detail:"Incorrect selection for ime node"}):reportErrorClientEvent("tc-local-input-error",{detail:"Selection missing for ime node"}),local_echo_enabled&&local_echo_config.extended&&Util.is_content_editable(e)&&(h=!0,safeview.lecho_regulator_ext.update_local_value(e,"txtdiff_local")),getUidByNode(e.parentNode),JSON.stringify(u),JSON.stringify(t),safeview.surrogate_channel.send("ednt",_,getUidByNode(e.parentNode),u,t,f,n,r,h)):reportErrorClientEvent("tc-local-input-error",{detail:"fid missing for the ime node"})}else reportErrorClientEvent("tc-local-input-error",{detail:"Empty sibling list is unexpected."});else reportErrorClientEvent("tc-local-input-error",{detail:"Inconsistent state about whether there is local node."})}(e,r,i,o);b(e),!TPROXY_ENABLED&&Util.is_autofill_target(e)&&(e.sv_prev_value=e.value)}n.EDIT_REASON_COMPOSITION=1,n.EDIT_REASON_BROWSER=2,n.EDIT_REASON_PASTE=3,n.clear_local_text=function(e,t){var n,r,i=getNodeByUid(e,t),o=[];if(i&&Util.is_elem_editable(i)&&i.hasChildNodes()){for(n=0;n<i.childNodes.length;n+=1)(r=i.childNodes[n]).__sv_client_id||r.__sv_uid||o.push(r);for(o.length;o.length;)r=o.shift(),i.removeChild(r)}},n.defer_update_if_needed=function(n,r){var i,o=!1;if(n!==e&&n!==t)return!1;if(local_echo_enabled&&local_echo_config.extended){for(i=0;i<a.length;i+=1)a[i][1]===n&&(a[i][2]=r,o=!0);o||a.push(["update",n,r])}else a.push(["update",n,r]);return Util.is_element_input_text(n),!0},n.defer_add_if_needed=function(e,t,n,r){return!!y(getNodeByUid(e,t))&&(a.push(["add",e,t,n,r]),r.data,!0)},n.defer_remove_if_needed=function(e,t,n){return y(n)?(a.push(["remove",e,getWindowByFid(e).document,t,n]),1===t.nodeType?(t.__sv_uid,n.__sv_uid):3===t.nodeType&&(t.data,t.__sv_uid,n.__sv_uid),!0):(getUidByNode(t),!1)},n.defer_range_sel_if_needed=function(e,t,n,r,i,o,a){return!(!w(i)&&!y(i)&&i.parentNode)&&(s=[e,t,n,r,i,o,a],!0)},n.in_ime_mode=w,n.is_editable_in_ime_mode=function(n){var r,i,o,a=[e,t];if(o=(new Date).getTime(),l&&o-l<500)return!0;for(r=0;r<a.length;r+=1)for(i=a[r];i&&(1===i.nodeType||3===i.nodeType);){if(i===n)return!0;i=i.parentNode}return!1},n.handle_local_input_events=function(e,t){var n,i,a,s;if(t.type,t.data,!safeview.local_events.local_text_input_in_date_time_field(e)&&!Util.is_unsupported_element_color_input(e)){if("input"===t.type)return function(e,t){if(_)return t.type,clearTimeout(_),N(f,u),_=null,u=null,void(f=null);if(!w(e)&&Util.is_element_input_text(e)){if(e.__sv_ignore_input_event)return e.__sv_ignore_input_event=!1,e.tagName,void e.__sv_uid;if((!BrowserDetect.isIE()||document.activeElement===e||!e.placeholder||e.value)&&e.sv_prev_value!==e.value){if(e.__sv_cut_happened)return delete e.__sv_cut_happened,void(e.sv_prev_value=e.value);if(!TPROXY_ENABLED&&Util.is_autofill_target(e))return e.value="password"===e.type?"":e.sv_prev_value,e.sv_prev_value=e.value,void safeview.surrogate_channel.send("input",getFidByNode(e),getUidByNode(e),e.value);e.value,safeview.surrogate_channel.send("input",getFidByNode(e),getUidByNode(e),e.value),e.sv_prev_value=e.value}}}(e,t),void(local_echo_enabled&&Util.can_element_use_lecho(e)&&(a=getFidByNode(e),s=getUidByNode(e),safeview.lecho_regulator.lecho_enabled(a,s)&&safeview.lecho_regulator.update_local_value(a,s,e.value,-1)));if(Util.is_element_input_text(e)||Util.is_elem_editable(e)){if(a=getFidByNode(e),Util.is_element_input_text(e))n=e;else{if(i=getWindowByFid(a).getSelection(),DEBUG&&Util.debug_print_selection(i,r),!(n=i.focusNode))return reportErrorClientEvent("tc-local-input-error",{detail:"No focus node found for local input event",event_type:t.type}),t.type,void C(t.type);getUidByNode(n),getUidByNode(e)}if(local_echo_enabled&&local_echo_config.extended&&"compositionstart"===t.type&&function(e){var t=safeview.selection.getSelection(e);"range"!==t.mode||t.collapsed||(e.ownerDocument.execCommand("delete"),safeview.surrogate_channel.send("execcmd",getFidByNode(e),"delete"),e.parentNode&&safeview.lecho_regulator_ext.update_local_value(e,"exec_del"))}(n),"compositionstart"===t.type&&(local_echo_enabled&&local_echo_config.extended&&_&&"compositionend"===u?o=setTimeout((function(){U(e,n),o=null}),0):U(e,n)),3===n.nodeType||Util.is_element_input_text(n))if(E(n)){if("paste"!==t.type||Util.is_element_input_text(n)){if("compositionstart"===t.type||"beforeinput"===t.type||"paste"===t.type){if(_&&function(e){return void 0!==e.prev_text}(n))return;b(n)}"compositionupdate"!==t.type&&"compositionend"!==t.type&&"textInput"!==t.type&&"paste"!==t.type||function(e,t){u=t,f=e,_=setTimeout((function(){N(e,t),_=null}),0)}(n,t.type)}}else C(t.type);else C(t.type)}else C(t.type)}},n.is_node_attached=E,n.has_pending_diff=function(){return null!==_},n.preserve_value=b,n.force_reset_ime_state=function(){o&&(clearTimeout(o),o=null),A(),e=null,t=null}}function LEchoRegulator(e){var t=this,n=!1,r={},i=!1,o=!1,a=new KeyMap,s=!1,l=null;function c(e,t){return e+"_"+t}function d(e){var t=e.split("_");return{fid:t[0],uid:t[1]}}function u(e){var t=local_echo_config.tolerance,n=local_echo_config.tolerance_time,r=e.local_value_list.length;return!r||r<=t+1&&Date.now()-e.local_value_list[r-1].ts<n}function _(t,o,a,s,l,d){var _=a.remote_value,f=function(e){return assert(e,"Input state not found."),38===e.last_keypress||40===e.last_keypress||!!n}(a)||function(e,t,n){var i=c(e,t),o=getNodeByUid(e,t);return assert(r[i],"Input state not found."),assert(o,"Input element is missing when checking auto completion."),0===n.indexOf(o.value)&&(o.value,!0)}(t,o,_)||function(e,t,n){var r,i=n.replace(/[\-, \,, \., \/, \:, \(, \)]/g,"");if(t.value.length>n.length&&0===t.value.indexOf(n))return!1;for(r=0;r<e.local_value_list.length;r+=1)if(e.local_value_list[r].val===i)return e.local_value_list[r].val,!0;return!1}(a,s,_);if(a.mode=2,i=!0,s.value=_,!d){if(f||!l)return;if(u(a))return}a.require_attention=!0,e.lecho_error_alert.add_alert_for_input(t,o,(function(){delete a.require_attention}))}function f(t,n){var r=e.localization.get("ID_MODAL_LECHO_ALERT_TEXT"),i=e.localization.get("ID_MODAL_LECHO_ALERT_TITLE");reportClientEvent("tc-lecho-modal-alert",{},!0,!1),e.ui_frame.call("showAlert",r,i)}function p(e,t){var n=getNodeByUid(e,t);return n?!(!Util.can_element_use_lecho(n)||!function(e,t){var n=c(e,t);return!!r.hasOwnProperty(n)}(e,t)):(reportErrorClientEvent("tc-lecho-error-missing-element",{detail:"The precheck failure message contains an input field that does not exist."}),!1)}function m(e){return!!local_echo_config.need_confirmation&&(!!function(){var e;for(e in r)if(r.hasOwnProperty(e)&&r[e].require_attention)return!0;return!1}()&&(local_echo_config.show_alert?f():reportClientEvent("tc-lecho-modal-alert",{skipped:!0},!0,!1),function(){var e;for(e in r)r.hasOwnProperty(e)&&delete r[e].require_attention}(),!0))}t.create_input_state=function(e){var t;DEBUG&&((t=getNodeByUid(d(e).fid,d(e).uid).getAttribute("type"))||(t="text"),t=t.toLowerCase(),assert(Util.input_text_types_strict.indexOf(t)>-1)),r[e]={mode:local_echo_enabled?1:2,local_value_list:[],remote_value:null,remote_care_pos:[0,0],last_keypress:null}},t.set_mouse_moved=function(){n=!0},t.set_last_keypress=function(e,i,o){var s,l=c(e,i);n=!1,r[l]||t.create_input_state(l),(s=r[l]).last_keypress=o,s.require_attention&&!a.LECHO_SPECIAL_KEYS.hasOwnProperty(o)&&delete s.require_attention},t.update_remote_value=function(e,n,o,a,s){var l,d,u,f=c(e,n),p=!1;if(assert(l=getNodeByUid(e,n),"Input element is missing when in update_remote_value."),r[f]||(t.create_input_state(f),l.value=o,r[f].local_value_list.push({ts:Date.now(),val:o})),(d=r[f]).remote_value=o,i||2===d.mode)l.value=o;else{if(!d.had_local_input)return l.value=o,void(d.local_value_list=[{ts:Date.now(),val:o}]);if(o||l.value){if(!o&&l.value)return d.mode=2,void(l.value=o);if(a)return _(e,n,d,l,s,!1),void reportWarnClientEvent("tc-lecho-mode-switched",{reason:"backend mismatch detected"});for(function(e){var t,n=[];for(t=0;t<e.local_value_list.length;t+=1)n.push(e.local_value_list[t].val);JSON.stringify(n)}(d),u=0;u<d.local_value_list.length;u+=1)if(d.local_value_list[u].val===o){p=!0,u===d.local_value_list.length-1&&(d.remote_has_caught_up=!0,l.value!==o&&reportErrorClientEvent("tc-lecho-error-wrong-local-value",{detail:"The last reconciled value on the local value list is inconsistent with the input value."}));break}p?(d.local_value_list.splice(0,u),1===d.local_value_list.length&&3===d.mode&&(d.mode=2)):(_(e,n,d,l,s,!1),reportWarnClientEvent("tc-lecho-mode-switched",{reason:"local match not found"}))}else d.local_value_list=[{ts:Date.now(),val:""}]}},t.update_local_value=function(i,o,a,s){var d,u,_,f=c(i,o);r[f]||t.create_input_state(f),u=(d=r[f]).local_value_list.length,n=!1,d.had_local_input=!0,l=Date.now(),_=-1===s,u>=1&&d.local_value_list[u-1].non_keypress&&_?(d.local_value_list[u-1].val=a,d.local_value_list[u-1].ts=Date.now()):d.local_value_list.push({ts:Date.now(),val:a,non_keypress:_}),d.remote_has_caught_up=!1,e.surrogate_channel.send("lecho-hash",i,o,Util.hashCode(a),s,DEBUG?a:void 0),d.local_value_list.length>local_echo_config.max_typeahead+1&&(d.mode=3,reportWarnClientEvent("tc-lecho-mode-switched",{reason:"typeahead buffer limit reached"}))},t.set_remote_caret=function(e,n,o,a){var s,l,d=c(e,n);if(r[d]||t.create_input_state(d),s=r[d],assert(l=getNodeByUid(e,n),"Input element is missing when setting remote caret."),i||2===s.mode)try{l.selectionStart=o,l.selectionEnd=a}catch(e){}else{if(o!==a&&(l.selectionStart!==o||l.selectionEnd!==a)){try{l.selectionStart=o,l.selectionEnd=a}catch(e){}s.remote_has_caught_up||(s.mode=2,l.value=s.remote_value)}s.remote_caret_pos=[o,a]}},t.lecho_enabled=function(e,n){var o=c(e,n);return r[o]||t.create_input_state(o),!i&&1===r[o].mode},t.send_precheck=function(t,n){var i,o=200;s||m()||(i=function(){var e,t,n,i,o,a=[];for(o in r)r.hasOwnProperty(o)&&r[o].had_local_input&&2!==r[o].mode&&(e=d(o).fid,e=parseInt(e,10),t=d(o).uid,(n=getNodeByUid(e,t=parseInt(t,10)))?(i=n.value,a.push([e,t,i||""])):reportErrorClientEvent("tc-lecho-error-clean-up",{detail:"Lecho state was not cleaned up properly"}));return a}()).length&&(l&&(o=Date.now()-l),o>=0&&o<200&&e.surrogate_channel.delay_once(200-o),e.surrogate_channel.send("precheck",t,n,i))},t.on_remove_node=function(e,t){var n=c(e,t);delete r[n]},t.lock_input=function(){o=!0},t.unlock_input=function(){o=!1},t.is_input_locked=function(){return o},t.reset=function(){r={}},e.interp.registerOpcodeHandler("precheck-failure",(function(e){var t,n,i,o,a=!1;if(local_echo_enabled){for(e.length||reportErrorClientEvent("tc-lecho-error-mismatch-list-empty",{detail:"The precheck failure message contains an empty mismatch list."}),t=e.length-1;t>=0;t-=1)p(i=e[0][0],n=e[0][1])||e.splice(t,1);if(e.length){for(e.length>1?a=!0:(i=e[0][0],n=e[0][1],u(r[c(i,n)])||(a=!0)),t=0;t<e.length;t+=1)o=getNodeByUid(i=e[t][0],n=e[t][1]),_(i,n,r[c(i,n)],o,!1,!a),reportWarnClientEvent("tc-lecho-mode-switched",{reason:"precheck failed"});a&&(f(),s=!0)}}else reportErrorClientEvent("tc-lecho-error-flag-mismatch",{detail:"The precheck failure message should not be sent from the backend because the lecho mode is not enabled."})}))}function LEchoRegulatorExt(e){var t=this,n=(new KeyMap,{}),r=0,i=!0,o={End:1,Home:1,ArrowLeft:1,ArrowUp:1,ArrowRight:1,ArrowDown:1},a={Backspace:1,Tab:1,Enter:1,Delete:1};function s(e){reportWarnClientEvent("tc-lecho-ext-warn",{reason:e})}function l(e,t){return e+"_"+t}function c(e){var t=e.split("_");return assert(void 0!==t[0]&&void 0!==t[1]),[parseInt(t[0]),parseInt(t[1])]}function d(e){return 3===e.nodeType?e.data:e.value}function u(n,r,i){e.local_input.force_reset_ime_state(),3===n.nodeType?(i&&(e.text_monitor.pause_all(),t.disable_ie_textinput_evt()),n.data=r,i&&(e.text_monitor.resume_all(),t.enable_ie_textinput_evt())):n.value=r}function _(e){return 3===e.nodeType||"textarea"===Util.get_node_tag(e)}function f(t,n){assert(_(n));var r=n;if(BrowserDetect.isIE()){for(;r;){if(r.parentNode===t)return!0;r=r.parentNode}return!1}return e.xbrowser.contains(t,n)}function p(e){assert(!n[e]),n[e]={restricted:!1,typeahead_overrun:!1,node_states:{},mismatch_count:{},exclusion_list:{}}}function m(e){assert(n[e]),n[e].scan_timer&&clearTimeout(n[e].scan_timer),delete n[e]}function g(e){var t,n;if("textarea"===Util.get_node_tag(e))return e;for(3===e.nodeType&&(e=e.parentNode),assert(e.isContentEditable),t=e,n=e;t.isContentEditable;)n=t,t=t.parentNode;return n}function h(e,t){var n;return"textarea"===Util.get_node_tag(t)?t:(n=getWindowByFid(e).getSelection().focusNode)?(3!==n.nodeType&&n.childNodes.length>=1&&(n=n.childNodes[0]),3!==n.nodeType?null:n):(s("Focus node not found."),null)}function v(e){var t,r=getFidByNode(e),i=getUidByNode(e);for(t in assert(_(e)),assert(void 0!==r&&void 0!==i),n)if(n.hasOwnProperty(t)&&c(t)[0]===r&&n[t].node_states[i])return n[t].node_states[i];return null}function w(t){var r,i;for(r in n)if(n.hasOwnProperty(r)){if(!(i=getNodeByUid(c(r)[0],c(r)[1])))return s("Editor root node is removed."),null;if(e.xbrowser.contains(i,t))return r}return null}function y(e){var t,r=n[e];for(t in assert(r),r.node_states)if(r.node_states.hasOwnProperty(t)&&!r.node_states[t].remote_has_caught_up)return!1;return!0}function b(e){var t=n[e];assert(t),t.scan_timer||(t.scan_timer=setTimeout((function(){t.scan_timer=0,function(e){var t,r,i,o,a,l,d,_=[];for(r in o=c(e)[0],assert(i=n[e]),assert(void 0!==i.active_local_uid),soft_assert(0!==i.node_states.length,"Editor state contains 0 length node states"),i.node_states)i.node_states.hasOwnProperty(r)&&(__startswith(r,"l")||(r=parseInt(r),l=i.node_states[r],d=void 0,d=local_echo_config.tolerance_time,!l.remote_has_caught_up&&l.local_value_list.length&&Date.now()-l.local_value_list[0].ts>d&&(l.local_value_list[0].ts,1)&&((a=getNodeByUid(o,r))?(u(a,i.node_states[r].remote_value,!0),E(e),a.data,i.node_states[r].remote_value,r===i.active_local_uid&&(i.restricted=!0),_.push(r)):(s("node_states contain outdated node id"),_.push(r)))));for(t=0;t<_.length;t+=1)_[t],delete i.node_states[_[t]];y(e)||b(e)}(e)}),local_echo_config.tolerance_time))}function E(e){var t,r,i,o=n[e];assert(o),JSON.stringify(o.remote_caret_pos),o.remote_caret_pos&&(6===o.remote_caret_pos.length?function(e,t,n,r,i){var o,a,l,c;if(t&&r)try{a=(o=getWindowByFid(e)).document,(l=o.getSelection()).removeAllRanges(),(c=a.createRange()).setStart(t,n),c.setEnd(r,i),l.addRange(c)}catch(e){s("Failed to apply caret pos, range data error.")}else s("Failed to apply caret pos, node in range is removed.")}(t=o.remote_caret_pos[0],getNodeByUid(t,o.remote_caret_pos[2]),o.remote_caret_pos[3],getNodeByUid(t,o.remote_caret_pos[4]),o.remote_caret_pos[5]):2===o.remote_caret_pos.length?((r=getNodeByUid((i=c(e))[0],i[1])).selectionStart=o.remote_caret_pos[0],r.selectionEnd=o.remote_caret_pos[1]):assert(!1))}function A(t){var i,o,a,s,c,d=local_echo_config.tolerance_time;i=getFidByNode(t),(a=w(t))||(o=getUidByNode(c=g(t)),a=l(i=getFidByNode(c),o),assert(!n[a]),p(a)),assert(a),(s=n[a]).restricted=!0,r+=1,s.pending_ack=r,s.ack_deadline=Date.now()+d,e.surrogate_channel.delay_once(100),e.surrogate_channel.send("editor-seq",i,a,r)}function U(e,t){var r,i,o,a,s=!1,l=v(e);for(assert(_(e)),assert(l),getUidByNode(e),l.remote_value=t,r=0;r<l.local_value_list.length;r+=1)if(l.local_value_list[r].val===t){s=!0,r===l.local_value_list.length-1&&(getUidByNode(e),l.remote_has_caught_up=!0,d(e)!==t&&reportErrorClientEvent("tc-lecho-error-wrong-local-value",{detail:"The last reconciled value on the local value list is inconsistent with the input value."}));break}o=w(e),assert(i=n[o]),a=getUidByNode(e),s?(l.local_value_list.splice(0,r),function(e){var t,n,r=0;if(!1!==e.typeahead_overrun){for(n in e.node_states)e.node_states.hasOwnProperty(n)&&((t=e.node_states[n]).remote_has_caught_up||(r+=t.local_value_list.length));r<local_echo_config.tolerance&&(e.typeahead_overrun=!1)}}(i),i.mismatch_count[a]&&(i.mismatch_count[a]=0)):i.restricted?(u(e,t,!1),E(o),l.local_value_list.length=0,l.remote_has_caught_up=!0,l.local_value_list.push({ts:Date.now(),val:t})):(l.remote_has_caught_up||(void 0===i.mismatch_count[a]?i.mismatch_count[a]=0:i.mismatch_count[a]+=1,i.mismatch_count[a]>3&&(i.exclusion_list[a]=!0)),u(e,t,!1),E(o),delete i.node_states[a])}function S(e){var n;i&&local_echo_enabled&&local_echo_config.extended&&(n=e.target,Util.is_content_editable(n)&&(t.update_local_value(n,"ie_input_evt"),delete n.__keypress_just_happened))}function C(e){return!!v(e)}t.match_last_local_echo=function(e,t){var n,r=v(e);return!!r&&(n=r.local_value_list.length-1,r.local_value_list[n].val===t)},t.on_textnode_connect=function(e,t,r){var i,o,a;for(i in n)if(n.hasOwnProperty(i))for(o in(a=n[i]).node_states)a.node_states.hasOwnProperty(o)&&o===r&&(a.node_states[t]=a.node_states[o],delete a.node_states[o])},t.update_local_value=function(t,r){var i,o,a,c,u,_,m,v=getFidByNode(t),w=getUidByNode(t),y=t,E=!0;if(void 0===v){if(!t.__sv_client_id||3!==t.nodeType)return s("Event node is not mapped: "+!!t.__sv_client_id+", "+t.nodeType===3),!1;assert("txtdiff_local"===r),E=!1,v=getFidByNode(t.parentNode),w="<local>"}return w=getUidByNode(m=g(t)),!!(i=E?h(v,m):t)&&(o=d(i),assert(f(m,i)),(a=getUidByNode(i))||(a=i.__sv_client_id),a?(c=l(v,w),n[c]||p(c),!n[c].exclusion_list[a]&&(n[c].node_states[a]||function(e,t,r){assert(n[e]);var i={local_value_list:[],remote_value:r};n[e].node_states[t]=i}(c,a,o),(_=(u=n[c].node_states[a].local_value_list).length)>=1&&u[_-1].val===o?u[_-1].ts=Date.now():(u.push({ts:Date.now(),val:o}),n[c].node_states[a].remote_has_caught_up=!1,y.__keypress_just_happened&&e.local_input.preserve_value(i)),n[c].active_local_uid=a,b(c),!0)):(s("Focus node is not mapped."),!1))},t.try_handle_remote_update=function(e,t){return!(!local_echo_enabled||!local_echo_config.extended)&&(!(3!==e.nodeType&&"textarea"!==Util.get_node_tag(e)||!C(e))&&(U(e,t),!0))},t.defer_range_sel_if_needed=function(e,t,r,i,o,a){var s,l;return!("range"!==t||3!==r.nodeType||!C(r)||r!==o||i!==a)&&(assert(l=w(o)),(s=n[l]).remote_caret_pos=[e,t,getUidByNode(r),i,getUidByNode(o),a],JSON.stringify(s.remote_caret_pos),!s.restricted)},t.set_remote_caret=function(e,t,r,i){var o,a,s,c=!1;a=l(e,t),n[a]||(p(a),c=!0),(o=n[a]).remote_caret_pos=[r,i],o.node_states[t]||(c=!0),o.node_states[t]&&o.node_states[t].remote_has_caught_up&&(c=!0),c&&(assert(s=getNodeByUid(e,t)),s.selectionStart===r&&s.selectionEnd===i||(s.selectionStart=r,s.selectionEnd=i)),JSON.stringify(o.remote_caret_pos)},t.on_remove_node=function(e,t){var r,i,o=getNodeByUid(e,t);if(o){if(_(o)){if(!C(o))return;assert(r=w(o)),(i=n[r]).node_states[t]&&delete i.node_states[t]}else if(1===o.nodeType){if(!o.isContentEditable)return;if(!(r=function(e){var t;for(t in n)if(n.hasOwnProperty(t)&&getNodeByUid(c(t)[0],c(t)[1])===e)return t;return null}(o)))return;m(r)}}else s("missing node in cleanup for removal")},t.process_keyevent_locally=function(r,i){var l,c,d,u,_=!1;return c=("keydown"===r.type||"keypress"===r.type)&&a.hasOwnProperty(r.key),r.type,r.key,r.target,d="keypress"===r.type&&!c,u=o.hasOwnProperty(r.key),assert(r.target),!function(e){var t,r,i=getFidByNode(e),o=w(e);return void 0===i?(s("Input event node is not mapped yet."),!1):!(!o||!(t=h(i,e=g(e)))||(f(e,t)?void 0===(r=getUidByNode(t))||!n[o].exclusion_list[r]:(s("Focused text node is not a child of the editor"),1)))}(r.target)&&(!function(e){var t,r,i,o,a=0;if(!(t=w(e)))return!1;if((r=n[t]).typeahead_overrun)return!0;for(o in r.node_states)r.node_states.hasOwnProperty(o)&&((i=r.node_states[o]).remote_has_caught_up||(a+=i.local_value_list.length));return a>local_echo_config.max_typeahead&&(r.typeahead_overrun=!0),r.typeahead_overrun}(r.target)&&((l=w(r.target))&&n[l].restricted?(r.type,i&&(c||d)&&A(r.target),!1):i&&c?(A(r.target),!1):(u?_=!0:d&&(t.update_local_value(r.target,"key_evt")?(r.target.__keypress_just_happened=!0,e.text_monitor.pause_all(),setTimeout((function(){e.text_monitor.resume_all()}),0),r.type,_=!0):i&&A(r.target)),_)))},t.apply_config=function(){local_echo_config.extended&&"Explorer"===browser.name&&EventListener.addListener(window,"textinput",S,!1)},t.cleanup=function(){local_echo_config.extended&&"Explorer"===browser.name&&EventListener.removeListener(window,"textinput",S,!1)},t.enable_ie_textinput_evt=function(){i=!0},t.disable_ie_textinput_evt=function(){i=!1},e.interp.registerOpcodeHandler(e.interp.OPCODES.EDITOR_SEQ_ACK,(function(e,t,r){var i=n[t];i?r===i.pending_ack&&Date.now()<=i.ack_deadline&&y(t)&&(i.restricted=!1,function(e){var t=n[e];assert(t),!1===t.restricted&&0===Object.keys(t.node_states).length&&0===Object.keys(t.mismatch_count).length&&0===Object.keys(t.exclusion_list).length&&m(e)}(t)):s("missing editor for the sequence ack")}))}function TextMonitor(e){var t=this,n={attributes:!1,childList:!0,characterData:!0,subtree:!0,characterDataOldValue:!0},r={},i=!0,o=0,a=null,s={},l=new diff_match_patch;function c(t,n,r,i){var o,a,s,c;if(null===r&&(r=""),null===i&&(i=""),r!==i){for(o=l.diff_main(r,i),JSON.stringify(o),s=0,c=o.length;s<c;s+=1)1!==o[s][0]&&(o[s][1]=o[s][1].length);a=Util.hashCode(i),e.surrogate_channel.send("edtx",t,n,o,e.selection.getSelection(getNodeByUid(t,n)),!0,a,e.local_input.EDIT_REASON_BROWSER)}}function d(e,t){for(var n=[];t&&t!==t.parentNode&&(1===t.nodeType||3===t.nodeType||8===t.nodeType)&&t!==e;)n.unshift(t),t=t.parentNode;return n.unshift(e),n}function u(e){var t,n={};for(assert(e),t=0;t<e.attributes.length;t+=1)n[e.attributes[t].name]=e.attributes[t].value;return n}function _(e,t){var n,r,i,o=[];for(n=0;n<e.childNodes.length;n+=1)3===(r=e.childNodes[n]).nodeType||1===r.nodeType?(o.push(r.nodeName),3===r.nodeType?o.push(r.nodeValue):1===r.nodeType?o.push(u(r)):assert(!1),i={},t&&t.startContainer===r&&(i.startOffset=t.startOffset),t&&t.endContainer===r&&(i.endOffset=t.endOffset),o.push(i),o.push(_(r,t))):reportWarnClientEvent("tc-text-monitoring-error",{node_type:r.nodeType,error:"Unexpected node type"});return o}function f(e,t){var n,r;for(n=0;n<e.childNodes.length;n+=1)getUidByNode(r=e.childNodes[n])?f(r,t):t.push(r)}function p(n,r,i){var o,a,s=getNodeByUid(n,r);if(i.length){for(o=function(e,t){var n,r,i,o=[],a=-1;for(assert(!!t&&t.length>=1),n=0;n<t.length;n+=1)o.push(d(e,t[n]));for(;;){for(r=a+1,i=o[0][r],n=0;n<t.length;n+=1)if(o[n].length<=r||o[n][r]!==i)return-1===a?null:o[0][a];a+=1}}(s,i);o&&!getUidByNode(o);)o=o.parentNode;if(o){for(o.nodeName,getUidByNode(o),a=function(e){var t=e.ownerDocument.defaultView.getSelection();return t.rangeCount?t.getRangeAt(0):null}(o),e.surrogate_channel.send("graft",n,getUidByNode(o),_(o,a)),t.pause_all();o.firstChild;)o.removeChild(o.firstChild);t.resume_all()}else reportErrorClientEvent("tc-text-monitoring-error",{error:"No common ancestor",root_editable:getNodeByUid(n,r).nodeName})}else reportErrorClientEvent("tc-text-monitoring-error",{error:"No DOM node add/remove detected",root_editable:getNodeByUid(n,r).nodeName})}function m(t){return t?!e.local_input.is_editable_in_ime_mode(t):(reportErrorClientEvent("tc-text-monitoring-error",{error:"Root editable no longer exists"}),!1)}function g(t,n,r){var i=!1,o=[],a=getNodeByUid(t,n);m(a)&&(!function(e){var t;for(t=0;t<e.length;t+=1)e[t].type,"childList"===e[t].type&&(e[t].addedNodes.length,e[t].removedNodes.length)}(r),function(e){var t;for(t=0;t<e.length;t+=1)if("characterData"!==e[t].type)return!1;return!0}(r)&&(i=function(t,n,r){var i,o,a={};for(i=0;i<r.length;i+=1)if(assert("characterData"===r[i].type),!(local_echo_enabled&&local_echo_config.extended&&e.lecho_regulator_ext.match_last_local_echo(r[i].target,r[i].target.data))){if(!(o=getUidByNode(r[i].target)))return!1;a[o]||(a[o]=r[i])}for(o in Object.keys(a).length,a)a.hasOwnProperty(o)&&c(t,parseInt(o,10),a[o].oldValue,a[o].target.nodeValue);return!0}(t,0,r)),i||(f(a,o),p(t,n,o)))}function h(e,t,n){var r,i;if(m(getNodeByUid(e,t))){if(r=getUidByNode(n.target),"DOMCharacterDataModified"===n.type&&r){if(s[i=e+"_"+r])return;s[i]={text_node_id:r,old_text:n.prevValue}}else;a||(a=setTimeout((function(){!function(e,t){var n,r,i,o=[];if(f(getNodeByUid(e,t),o),o.length)p(e,t,o);else for(r in s)s.hasOwnProperty(r)&&(i=getNodeByUid(e,n=s[r].text_node_id).nodeValue,c(e,n,s[r].old_text,i));s={}}(e,t),a=null}),100))}}function v(e,t){EventListener.addListener(e,"DOMCharacterDataModified",t),EventListener.addListener(e,"DOMNodeInserted",t),EventListener.addListener(e,"DOMNodeRemoved",t)}function w(e,t){EventListener.removeListener(e,"DOMCharacterDataModified",t),EventListener.removeListener(e,"DOMNodeInserted",t),EventListener.removeListener(e,"DOMNodeRemoved",t)}t.monitor_text_change=function(e,a){var s,l=a;for(assert(Util.is_elem_editable(a));l.parentNode&&1===l.parentNode.nodeType&&Util.is_elem_editable(l.parentNode);)l=l.parentNode;(s=getUidByNode(l))?function(e,a){var s,l;if(t.in_effect=!0,s=getNodeByUid(e,a),r[e+"_"+a])return s.nodeName,void s.textContent;s.nodeName,s.textContent,i?(l=new MutationObserver((function(t){g(e,a,t)})),o||l.observe(s,n)):(l=function(t){h(e,a,t)},o||v(s,l)),r[e+"_"+a]={node:s,observer:l}}(e,s):reportErrorClientEvent("tc-text-monitoring-error",{error:"Root editable node is not a mapped node",root_editable:l.nodeName})},t.on_remove_node=function(e,n){var o;t.in_effect&&(o=r[e+"_"+n])&&(i?o.observer.disconnect():w(o.node,o.observer),delete r[e+"_"+n],Object.keys(r).length||(t.in_effect=!1))},t.pause_all=function(){var e,n;if(assert((o+=1)>0),t.in_effect)for(n in r)r.hasOwnProperty(n)&&(e=r[n],i?e.observer.disconnect():w(e.node,e.observer))},t.resume_all=function(){var e,a;if(0===o)return reportErrorClientEvent("tc-text-monitoring-error",{error:"Pause/resume count does not match"}),void soft_assert(!1);if(!(o-=1)&&t.in_effect)for(a in r)r.hasOwnProperty(a)&&(e=r[a],i?e.observer.observe(e.node,n):v(e.node,e.observer))},i=!!window.MutationObserver&&"Explorer"!==browser.name,t.in_effect=!1}function CSSManager(e){var t=[],n=[],r=1,i=2,o=3,a=0,s=!1,l={},c={};function d(e){var n,r=[];for(e&&a&&clearTimeout(a),a=0,n=0;n<t.length;n+=1)u(t[n],r);t=r}function u(t,n){var s,l,c,u=getNodeByUid(t[1],t[2]);return u?(BrowserDetect.isIE()||"link"!==Util.get_node_tag(u)||__startswith(u.href,"data:")||(t[0]===o?(l=(s=u).parentNode,(c=s.cloneNode(!0)).setAttribute("crossorigin","anonymous"),c.href="data:text/css;base64,",setNodeIds(c,getUidByNode(s),getFidByNode(s)),l.insertBefore(c,s),c.removeAttribute("crossorigin"),s.remove(),u=c):reportErrorClientEvent("tc-css-unexpected-cmd",{cmd:t[0]})),u.sheet?(t[0]===r?function(e,t,n){try{e.sheet.insertRule(t,n)}catch(r){reportClientEvent("tc-css-insert-rule-exception",{rule:t},!0);try{e.sheet.insertRule("#_sv_dummy {}",n)}catch(e){}}}(u,t[3],t[4]):t[0]===i?function(e,t){try{e.sheet.deleteRule(t)}catch(e){reportClientEvent("tc-css-delete-rule-exception",{},!0)}}(u,t[3]):t[0]===o&&function(e,t){var n;t.length;try{for(;e.sheet.cssRules.length;)e.sheet.deleteRule(0);for(n=0;n<t.length;n+=1)e.sheet.insertRule(t[n],e.sheet.cssRules.length)}catch(e){reportClientEvent("tc-css-overwrite-rules-exception",{},!0)}}(u,t[3],t[4]),void e.dom_updater.adjustShadowDom(t[1],t[2])):(t[2],n.push(t),void(u.__sv_onload_installed||(u.addEventListener("load",d),u.__sv_onload_installed=!0)))):(t[2],n.push(t),void(a||(a=setTimeout(d,100))))}function _(e){var t,n;if(e)for(t=0;t<e.children.length;t+=1)(n=e.children[t]).__sv_css_constr&&e.removeChild(n)}function f(e,t,n){var r,i="",o=getWindowByFid(e);o?(n.forEach((function(t){var n=e+"_"+t;l[n]&&(i+=l[n])})),(r=o.document.createElement("style")).setAttribute("type","text/css"),r.setAttribute("class","__safly_css_constr"),r.textContent=i,r.__sv_css_constr=!0,9===t.nodeType?(t.head||t.body).appendChild(r):t.appendChild(r)):reportErrorClientEvent("tc-css-invalid-fid",{op:"adopt"})}function p(e,t,n){var r=getNodeByUid(e,t);return!!r&&(s?function(e,t,n){var r=[];n.forEach((function(t){var n=e+"_"+t;l[n]&&r.push(l[n])})),t.adoptedStyleSheets=r}(e,r,n):(f(e,r,n),function(e,t,n){c[e+"_"+t]=n}(e,t,n)),!0)}function m(e,t){Util.forEachItem(c,(function(n,r){var i,o=function(e){var t=e.split("_");return assert(2===t.length),{fid:parseInt(t[0],10),uid:parseInt(t[1],10)}}(n),a=o.fid,s=o.uid;return a===e&&(-1!==r.indexOf(t)&&(!!(i=getNodeByUid(e,s))&&(9===i.nodeType?(_(i.head),_(i.body)):_(i),f(e,i,r),!1)))}))}function g(){var e,t=n;for(n=[];t.length;)p((e=t.shift())[0],e[1],e[2])||(n.push(e),e[0],e[1])}this.reset=function(){l={}},this.apply_adoption_cmds=g,e.interp.registerOpcodeHandler(e.interp.OPCODES.CSS_INSERT_RULE,(function(e,n,i,o){d(!0),u([r,e,n,i,o],t)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.CSS_DELETE_RULE,(function(e,n,r){d(!0),u([i,e,n,r],t)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.CSS_OVERWRITE_RULES,(function(e,n,r){d(!0),u([o,e,n,r],t)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.CONSTR_CSS_CREATE,(function(e,t){var n=e+"_"+t,r=getWindowByFid(e);if(r){if(l[n]&&reportErrorClientEvent("tc-css-sheet-id-duplicated",{}),r.CSSStyleSheet)try{l[n]=new r.CSSStyleSheet,s=!0}catch(e){}s||(l[n]="")}else reportErrorClientEvent("tc-css-invalid-fid",{op:"create"})})),e.interp.registerOpcodeHandler(e.interp.OPCODES.CONSTR_CSS_DISPOSE,(function(e,t){var n=e+"_"+t;void 0===l[n]&&reportErrorClientEvent("tc-css-sheet-id-missing",{op:"dispose"}),delete l[n]})),e.interp.registerOpcodeHandler(e.interp.OPCODES.CONSTR_CSS_REPLACE_TEXT,(function(e,t,n,r){var i=e+"_"+t;void 0!==l[i]?s?r?l[i].replaceSync(n):l[i].replace(n):(l[i]=n,m(e,t)):reportErrorClientEvent("tc-css-sheet-id-missing",{op:"replace"})})),e.interp.registerOpcodeHandler(e.interp.OPCODES.CONSTR_CSS_ADOPT_STYLE_SHEETS,(function(e,t,r){n.push([e,t,r]),g()}))}function AnimationManager(e){var t=0,n=[],r=1,i=2,o=3,a=4,s=5,l={},c={};function d(){var e,r=[];for(t&&(clearTimeout(t),t=0),e=0;e<n.length;e+=1)u(n[e],r);n=r}function u(e,n){var u=getNodeByUid(e[1],e[2]),_=e[1]+"_"+e[3],f=l[_];if(e[0]===i){if(!u)return e[2],n.push(e),void(t||(t=setTimeout(d,100)));!function(e,t,n,r,i){var o,a=getNodeByUid(e,t),s=e+"_"+t,d=e+"_"+n;if(!r||!i)return;if(BrowserDetect.isIE())return;i.iterations=parseFloat(i.iterations),o=a.animate(r,i),c[s]||(c[s]=new Array);c[s].push(n),l[d]=o}(e[1],e[2],e[3],e[4],e[5])}else{if(!f)return e[3],n.push(e),void(t||(t=setTimeout(d,100)));switch(e[0]){case r:f.cancel();break;case o:f.finish();break;case a:f.pause();break;case s:f.play()}}}this.cleanAnimationDict=function(e,t){c[e+"_"+t]&&(c[e+"_"+t].forEach((function(t){delete l[e+"_"+t]})),delete c[e+"_"+t])},e.interp.registerOpcodeHandler(e.interp.OPCODES.ANIMATION_CREATE,(function(e,t,r,o,a){d(),u([i,e,t,r,o,a],n)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.ANIMATION_CANCEL,(function(e,t,i){d(),u([r,e,t,i],n)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.ANIMATION_FINISH,(function(e,t,r){d(),u([o,e,t,r],n)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.ANIMATION_PAUSE,(function(e,t,r){d(),u([a,e,t,r],n)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.ANIMATION_PLAY,(function(e,t,r){d(),u([s,e,t,r],n)}))}function ShadowDomSupport(e,t){var n=this,r=!BrowserDetect.isIE(),i={},o={};function a(e){var t,n;for(t=0;t<e.childNodes.length;t+=1)!(n=e.childNodes[t]).__sv_shadow_root&&n.style&&"none"!==n.style.display&&(n.style.display="none")}function s(e,t,n){var r,i,o,s,l,c,d,u,_=getNodeByUid(e,n),f=["width","height","max-width","max-height"],p=!1,m=!1;if(_){for(assert((r=getNodeByUid(e,t))===_.parentNode),a(r),o=(i=_.contentWindow.document).body.scrollWidth,s=i.body.scrollHeight,l=0;l<f.length;l+=1)c=f[l],(d=r.style.getPropertyValue(c))&&_.style.getPropertyValue(c)!==d&&(u=r.style.getPropertyPriority(c),_.style.setProperty(c,d,u?"important":""),"width"===c&&(m=!0),"height"===c&&(p=!0));m||_.getAttribute("width")===o.toString()||_.setAttribute("width",o),p||_.getAttribute("height")===s.toString()||_.setAttribute("height",s)}else reportWarnClientEvent("tc-shadow-root-missing",{fid:e,shadow_root_id:n})}function l(t,r,l){var d,u=getWindowByFid(t),_=getNodeByUid(t,r);(d=u.document.createElement("iframe")).setAttribute("name","sv-shadow-root"),d.setAttribute("src","about:blank"),d.setAttribute("style","border:none; margin: 0px; padding: 0px"),d.setAttribute("scrolling","no"),d.setAttribute("sv_frame_id",l),d.__sv_shadow_root=!0,d.onload=function(){!function(t,r,o,a){var l=t.contentWindow;assert(Util.isIframeReady(t)),assert(i[r]),assert(i[r][a]),i[r][a].is_ready=!0,setFidToWindow(l,a),e.local_events.install_event_listeners(l,l.document,!1),l.onbeforeunload=function(){},n.loading_shadow_root(r)||e.update_queue.deliver(r,e.interpretQueued),i[r][a].timer=setInterval((function(){s(r,o,a)}),1e3)}(d,t,r,l)},c(t,r,_),setNodeIds(d,l,t),i[t]||(i[t]={}),i[t][l]={},i[t][l].is_ready=!1,o[t+"_"+r]=l,a(_),_.insertBefore(d,_.firstChild)}function c(e,t,n){var r,a;i[e]&&(r=o[e+"_"+t])&&i[e][r]&&((a=getNodeByUid(e,r))&&(a.remove?a.remove():a.removeNode(!0)),clearInterval(i[e][r].timer),delete i[e][r],delete o[e+"_"+t],Object.keys(i[e]).length||delete i[e])}n.loading_shadow_root=function(e){var t,n=i[e];if(!n)return!1;for(t in n)if(n.hasOwnProperty(t)&&!n[t].is_ready)return!0;return!1},n.adjust_parent_fragment_size=function(e,t){var n,i,o=getNodeByUid(e,t),a=getWindowByFid(e),l=o.ownerDocument.defaultView;r||l&&l!==a&&(i=l.frameElement)&&i.__sv_shadow_root&&(n=getUidByNode(i),s(e,getUidByNode(i.parentNode),n))},n.on_node_remove=function(t,n,i){r?function(t,n,r){r&&r.shadowRoot&&e.local_events.install_event_listeners_for_shadowroot(!1,r.shadowRoot)}(0,0,i):c(t,n)},n.add_shadow_root=function(n,i,o){var a=getNodeByUid(n,i);a?(a.attachShadow||(r=!1),r?function(n,r,i){var o,a=getNodeByUid(n,r);a.shadowRoot?reportErrorClientEvent("tc-shadow-root-already-exists",{fid:n,host_uid:r,shadow_root_uid:i}):(setNodeIds(o=a.attachShadow({mode:"open"}),i,n),e.local_events.install_event_listeners_for_shadowroot(!0,o),t.apply_adoption_cmds())}(n,i,o):l(n,i,o)):reportErrorClientEvent("tc-shadow-host-missing",{fid:n,host_uid:i,shadow_root_uid:o})},n.reset=function(){var e,t,n;for(e in i)if(i.hasOwnProperty(e)){for(t in n=i[e])n.hasOwnProperty(t)&&(clearInterval(n[t].timer),delete n[t]);delete i[e]}}}function DOMUpdater(e){var t,n=this,r=new CSSManager(e),i=new AnimationManager(e),o=null,a={script:1,embed:1,applet:1},s=new diff_match_patch,l={},c=null,d={},u=null,_=!0,f=1,p=2,m=3,g=[],h=null;function v(t,n,r,i){var o,a=[];if("Explorer"!==browser.name||!e.xbrowser.processIECharacterData(r,i,"remove",void 0))try{r===n.head||r===n.body?((o=e.feedback_bar.feedbackElementIDs()).push(DOM_LOADED_ELEM_ID),o.push("__safly_default_style"),o.push("__safly_ro_css_id"),o.push("__safly_bw_css_id"),a.push("__safly_css_constr"),a.push("__safly_external_svg"),function(e,t,n){var r,i;if(e)for(r=e.childNodes.length-1;r>=0;r-=1)(i=e.childNodes[r]).id&&t.indexOf(i.id)>-1||i.className&&n.indexOf(i.className)>-1?(i.id,i.className):e.removeChild(i)}(r,o,a),r.firstChild?(!function(e){for(var t=0,n=e.attributes.length;e.attributes.length-t;)e.removeAttribute(e.attributes[t].name),n===e.attributes.length&&("Explorer"!==browser.name&&reportWarnClientEvent("tc-dom-attribute-remove-failure",{node:e.nodeName,attribute:e.attributes[t].name}),t+=1),n=e.attributes.length}(r),r.__sv_saved_for_feedback=!0):i.removeChild(r)):i.removeChild(r)}catch(e){if(i.isContentEditable)return;soft_assert(!1,"parent_node.removeChild() raised exception : "+e)}}function w(t){var n,r,o,a;if(!t.__sv_unmapped_frame){if(o=getFidByNode(t),a=getUidByNode(t),void 0!==o&&void 0!==a&&(Util.is_media_node(t)&&l.hasOwnProperty(o+"_"+a)&&e.media_objects.remove_listeners(t),local_echo_enabled&&local_echo_config.extended&&Util.is_content_editable(t)&&e.lecho_regulator_ext.on_remove_node(o,a),removeUidNodeEntry(o,a),local_echo_enabled&&Util.can_element_use_lecho(t)&&e.lecho_regulator.on_remove_node(o,a),e.wheel_ctrl.on_remove_node(o,a),e.key_ctrl.on_remove_node(o,a),i.cleanAnimationDict(o,a)),Util.is_frame_owner(t)){if(!(r=getFrameFidByNode(t)))return void reportWarnClientEvent("tc-dom-unexpected-iframe",{node_detail:t.outerHTML});removeFidWindowEntry(r),removeFidToIframe(r),removeUidNodeEntriesForFid(r),removeSvgRootUidsForFid(r),e.callback.fire("frame-node-removed",r,t)}for(n=0;n<t.childNodes.length;n+=1)w(t.childNodes[n])}}function y(e){return e&&(__startswith(e,"cof-server:")||__startswith(e,"safeview")||__startswith(e,"__safly_")||__startswith(e,"safemail"))}function b(e){var t,n,r,i=mf.document;for(assert(e===i.documentElement||e===i.body),t=(r=e.querySelectorAll("iframe, frame")).length-1;t>=0;t-=1)y(r[t].id)||w(r[t]);for(t=e.childNodes.length-1;t>=0;t-=1)y((n=e.childNodes[t]).id)||(n===i.body?b(n):v(mf.window.__sv_fid,i,n,e))}function E(e){var t=e.target.window.feedback_bar;t&&t.updateReadonlyUI()}function A(t,n,r){return"href"===t?r=function(t,n){var r,i,o=n;return TPROXY_ENABLED?(r=t.localName.toLowerCase(),i=n[0],"link"!==r&&"/"===i&&(o=n.substr(1))):e.pairing_dict.mpa_id&&(i=n[0],"link"!==r&&"/"===i&&(o="/mpa/"+(e.pairing_dict.mpa_id||"1")+n)),o}(n,r):"action"===t&&(-1!==r.toLowerCase().indexOf("javascript")&&(r=""),"form"===n.localName.toLowerCase()&&(r="about:blank")),r}function U(e,t,n,r,i){var o,a;for(o=0;o<r.length;o+=1)if("sv_frame_id"===r[o][0]){a=r[o][1];break}return a?Util.compute_iframe_src(i,a,null):(reportErrorClientEvent("tc-dom-frame-fid-missing"),"about:blank")}function S(e,t,n,r){if(soft_assert(t,"Node is null for insertion."),soft_assert(n,"Parent is null for insertion."),n.hasChildNodes()){if(r){var i=getNodeByUid(e,r);t.previousSibling!==i&&n.insertBefore(t,i.nextSibling)}else n.firstChild!==t&&n.insertBefore(t,n.firstChild);return!0}return!1}function C(e,t){return 0===t.length||Util.makeSet(["id","class","style","width","height","name","hspace","vspace","align","title","tabindex","data-sv-src"]).hasOwnProperty(e)}function N(t,n,r,i){var o,a,s,l,c,d=e.url_builder.buildServiceURL(n),u=t.createElement("iframe");if(i)for(o=0;o<i.length;o+=1)"style"===i[o][0]?s=i[o][1]:"height"===i[o][0]?l=i[o][1]:"width"===i[o][0]&&(c=i[o][1]);u.setAttribute("width",c||"100%"),u.setAttribute("height",l||"100%"),s&&u.setAttribute("style",s),u.style.margin="0",u.setAttribute("src",d),u.__sv_unmapped_frame=!0,u.onload=function(e,t){for(a=e.target.parentElement.childNodes,o=0;o<a.length;o+=1)a[o]!==e.target&&a[o].style&&(a[o].style.display="none")},r.appendChild(u)}function k(e,t,n){return"meta"===Util.get_node_tag(e)&&"name"===t&&"referrer"===n||"referrerpolicy"===t}function O(t,n,r,i,o){var a,s,l,c,d=[];for(a=0;a<o.length;a+=1)if(l=o[a][0],s=o[a][1],c=o[a][2],("src"!==l||"audio"!==i&&"video"!==i||!e.media_source_extensions.get_media_source_or_falsy(getFidByNode(n),r))&&(!e.resync_in_progress||void 0===n.__sv_paused||"src"!==l||"audio"!==i&&"video"!==i)&&(window.TPROXY_ENABLED||!k(n,l,s))&&("Explorer"===browser.name&&"input"===i&&"value"===l&&d.push([l,s]),"safely_embed"!==i||C(l,s)))if("safely_embed"!==i||"data-sv-src"!==l){"value"===l&&"textarea"===i&&(DEBUG&&n.value,n.value=s),s=A(l,n,s),Util.is_frame_node_name(i)&&"src"===l&&(s="main"===e.role?"about:blank":U(0,0,0,o,s)),"Explorer"===browser.name&&browser.version>=10&&"textarea"===i&&"placeholder"===l&&(n.__sv_ignore_input_event=!0);try{"xmlns"===l&&(c=null),e.xbrowser.setAttribute(t,n,c,l,s)}catch(e){reportClientEvent("tc-set-attribute-exception",{node_name:n.nodeName,attribute_name:l},!0)}}else N(t.document,s,n,o);return d}function T(t,n,r,i,o,a,s,l){var c,d,u=!1,_=!1,f=!1;if("object"===Util.get_node_tag(r)&&r.backend_object_created&&1===i.nodeType&&i.style&&(i.style.display="none"),Util.is_frame_node_name(a)||"safely_embed"===a)!function(e,t){var n;Util.is_frame_node_name(e)&&(n=getFrameFidByNode(t))&&setFidToIframe(t,n)}(a,i),e.callback.fire("frame-node-inserted",i,o);else if(("img"===a||"input"===a)&&e.xbrowser.hasAttribute(i,null,"height")&&e.xbrowser.hasAttribute(i,null,"width")){for(d=0;d<s.length;d+=1)"height"===s[d][0]?u=!0:"width"===s[d][0]?_=!0:"type"===s[d][0]&&"image"===s[d][1]&&(f=!0);("img"===a||"input"===a&&f)&&(!u&&e.xbrowser.hasAttribute(i,null,"height")&&i.removeAttribute("height"),!_&&e.xbrowser.hasAttribute(i,null,"width")&&i.removeAttribute("width"))}else"animate"===a&&"Explorer"===browser.name?"path"===Util.get_node_tag(r)&&e.xbrowser.hasAttribute(i,null,"to")&&e.xbrowser.hasAttribute(i,null,"attributeName")&&"d"===i.getAttribute("attributeName")&&e.xbrowser.hasAttribute(r,null,"d")&&e.xbrowser.setAttribute(n,r,"","d",i.getAttribute("to")):Util.is_element_date_time_input(i)&&"text"===i.type?e.xbrowser.hasAttribute(i,null,"placeholder")||e.xbrowser.setAttribute(n,i,"","placeholder",Util.date_time_input_types[i.getAttribute("type")]):Util.is_unsupported_element_color_input(i)?i.hasAttribute("placeholder")||i.setAttribute("placeholder","#000000"):"form"===a?(e.xbrowser.setAttribute(n,i,"","action","about:blank"),i.addEventListener("submit",(function(e){e.preventDefault()}))):"head"!==Util.get_node_tag(r)||"link"!==a&&"style"!==a||(c=n.document.getElementById("__safly_default_style"))&&c.parentNode===r&&"style"===Util.get_node_tag(c)&&c!==r.firstChild&&r.insertBefore(c,r.firstChild);"input"!==a||"text"!==i.type&&"search"!==i.type||(i.classList.add("__safly_input_chrome"),i.classList.add("__safly_input_ms")),O(n,i,o,a,l),function(e){e.hasOwnProperty||(e.hasOwnProperty=Object.prototype.hasOwnProperty)}(i),r.__sv_svg_container&&(i.getAttribute("width")||i.setAttribute("width","100%"),i.getAttribute("height")||i.setAttribute("height","100%"))}function x(t,n,r,i,o,s,d){var u,_,f,p,m,g=getWindowByFid(t),h=getIframeByFid(t),w=r.toLowerCase(),y=l[t+"_"+n],b=[],E=!1;if(soft_assert(_=getNodeByUid(t,o),"Unknown parent "+o),c&&_.__sv_shadow_root&&(_=(m=_.contentDocument).body,g=m.defaultView),h&&Util.is_frame_owner(h)&&("svg"===w||__startswith(w,"svg:"))&&"#document"===_.nodeName&&function(e){e&&e.document&&e.document.documentElement&&e.document.removeChild(e.document.documentElement)}(g),"html"===w&&"#document"===_.nodeName)u=function(t,n){var r,i=t.document;return assert(i),(r=i.getElementsByTagName("html")[0])||(r=e.xbrowser.createElement(t,n,"html"),i.appendChild(r)),i.head&&v(t.__sv_fid,i,i.head,i.head.parentNode),i.body&&v(t.__sv_fid,i,i.body,i.body.parentNode),assert(r),r}(g,d),!0,e.local_events.install_event_listeners(g,g.document,true),b=O(g,u,n,w,i);else{if(y)u=y;else if(!(u=function(t,n,r,i,o){var s,l;if("safely_embed"===n?s=t.document.createElement("object"):(s=function(e){var n=null;return t.document?("head"===e&&t.document.head&&t.document.head.__sv_saved_for_feedback?n=t.document.head:"body"===e&&t.document.body&&t.document.body.__sv_saved_for_feedback&&(n=t.document.body),n&&delete n.__sv_saved_for_feedback,n):null}(n))||(s=e.xbrowser.createElement(t,o,r)),assert(s),l=s.localName.toLowerCase().trim(),!a.hasOwnProperty(l))return s;reportClientEvent("tc-blocked-element",{name:n})}(g,w,r,0,d)))return;if("body"===w&&document.body&&(document.body===u?E=!0:getUidByNode(document.body)||g!==window||(document.body.parentNode.removeChild(document.body),E=!0)),b=O(g,u,n,w,i),f=!1,-1!==s)try{f=S(t,u,_,s)}catch(e){reportWarnClientEvent("tc-dom-insert-sibling-error",{node:u.nodeName,error:e.toString()})}if(!f)try{_.appendChild(u)}catch(t){(p=e.xbrowser.appendChildThatHandlesIE8CornerCase(g,w,n,i,_))?u=p:reportWarnClientEvent("tc-dom-alternate-append-child-failed",{child:w,parent:Util.get_node_tag(_)})}}setNodeIds(u,n,t),T(0,g,_,u,n,w,i,b),c&&c.adjust_parent_fragment_size(t,n),Util.is_elem_editable(u)&&e.text_monitor.monitor_text_change(t,u),e.callback.fire("add-element",g,u,w,d),"video"!==w&&"audio"!==w||e.callback.fire("new-media-node",t,n),u===y&&(e.media_objects.install_listeners(u),function(e){void 0!==e.__sv_paused&&(e.paused&&!1===e.__sv_paused?e.play():e.paused||!0!==e.__sv_paused||e.pause(),delete e.__sv_paused)}(u)),E&&e.ui_frame.reload()}function D(e,t,n,r,i,o){x(e,t,n,r,i,o,"http://www.w3.org/2000/svg")}function L(t,n,r,i){var o=getNodeByUid(t,n);e.local_input.clear_local_text(t,n);try{S(t,i,o,r)||o.appendChild(i)}catch(e){reportWarnClientEvent("tc-dom-char-data-add-error",{error:e.toString()}),soft_assert(0,"Exception adding characterData element")}}function I(e,t,n){var r,i,o,a,l=s.diff_main(t,n),c=0;for(r=0,i=l.length;r<i;r+=1)o=l[r][0],a=l[r][1],-1===o?e.deleteData(c,a.length):(0===o||e.insertData(c,a),c+=a.length);e.parentNode&&e.parentNode.isContentEditable&&e.data!==n&&(reportErrorClientEvent("tc-local-input-error",{detail:"Value not consistent after text node update."}),e.data,e.data=n)}function B(){var e,t,n=d;for(e in d={},u=null,n)n.hasOwnProperty(e)&&((t=getNodeByUid(n[e].fid,n[e].uid)).sheet?t.sheet.disabled=n[e].disabled:(n[e].tried+=1,100===n[e].tried?reportErrorClientEvent("tc-dom-node-sheet-missing",{fid:n[e].fid,uid:n[e].uid}):P(n[e].fid,n[e].uid,n[e].disabled,n[e].tried)))}function P(e,t,n,r){d[e+"_"+t]={fid:e,uid:t,disabled:n,tried:r},u||(u=setTimeout(B,200))}function R(){var e,t=[];for(h&&(clearTimeout(h),h=null);g.length;)F((e=g.shift())[0],e[1],e[2])||t.push(e);(g=t).length&&(h=setTimeout(R,100))}function F(e,t,n){var r=getNodeByUid(t,n);if(!r)return!1;switch(e){case f:r.show();break;case p:r.showModal();break;case m:r.close();break;default:assert(0)}return!0}function M(e,t,n){g.push([e,t,n]),R()}n.addRetainedNode=function(e,t,n){l[e+"_"+t]=n},n.removeRetainedNode=function(e,t){delete l[e+"_"+t]},n.adjustShadowDom=function(e,t){c&&c.adjust_parent_fragment_size(e,t)},n.apply_text_node_patch=I,n.add_text_node=L,n.remove_node=v,n.clear_dom=b,n.has_pending_shadow_root=function(e){return c&&c.loading_shadow_root(e)},e.media_objects.setClient({new_media_node:function(t,r,i){var o=getNodeByUid(r,i);return o||(setNodeIds(o=document.createElement(t),i,r),e.media_objects.install_listeners(o)),n.addRetainedNode(r,i,o),o},did_remove_media_node:function(e,t){n.removeRetainedNode(e,t)}}),e.interp.registerOpcodeHandler(e.interp.OPCODES.ADD_ELEMENT,(function(e,t,n,r,i,o){x(e,t,n,r,i,o,"http://www.w3.org/1999/xhtml")})),e.interp.registerOpcodeHandler(e.interp.OPCODES.ADD_CHARACTER_DATA,(function(t,n,r,i,o,a,s){var l,d,u,_,f=getWindowByFid(t),p=!1;if(f)if("#text"===(r=r.toLowerCase())){if(soft_assert(u=getNodeByUid(t,o),"Unknown parent"),l=f.document,c&&u.__sv_shadow_root&&(u=(l=u.contentDocument).body),s)!function(t,n,r,i){var o,a,s=getNodeByUid(t,r);if(s.hasChildNodes)for(a=s.childNodes,o=0;o<a.length;o+=1)if(a[o].__sv_client_id===i)return getUidByNode(a[o].parentNode),a[o].data,setNodeIds(a[o],n,t),local_echo_enabled&&local_echo_config.extended&&e.lecho_regulator_ext.on_textnode_connect(t,n,i),!0}(t,n,o,s);else if(d=l.createTextNode(i),"TEXTAREA"!==u.nodeName){if("Explorer"===browser.name&&(p=e.xbrowser.processIECharacterData(d,u,"add",i)),!p){if(e.local_input.defer_add_if_needed(t,o,a,d))return void setNodeIds(d,n,t);L(t,o,a,d)}setNodeIds(d,n,t),"option"===Util.get_node_tag(u)&&(_=u.parentNode,"select"===Util.get_node_tag(_)&&_.hasOwnProperty("__safely_select_value")&&_.__safely_select_value===u.value&&e.xbrowser.setSelectValue(_,_.__safely_select_value)),c&&c.adjust_parent_fragment_size(t,n)}}else e.fatalError("tc-unsupported_character-data",{name:r})})),e.interp.registerOpcodeHandler(e.interp.OPCODES.MODIFY_PROP_VALUE,(function(t,n,r,i,o,a,s,l){var u,_,f,p=getNodeByUid(t,n),m=!1;soft_assert(p,"Unknown node"),f=Util.get_node_tag(p),i=i.toLowerCase(),"select"===f?"value"===i?e.xbrowser.setSelectValue(p,o):"selectedindex"===i&&(p.selectedIndex=o):"input"===f&&"checked"===i?p.checked=o:"value"===i&&Util.is_element_color_input(p)||"value"===i&&Util.is_element_date_time_input(p)?p.value=o:"value"===i&&Util.is_element_input_text(p)?(u=s,_=l,DEBUG&&p.value,(m=e.lecho_regulator_ext.try_handle_remote_update(p,o))||(m=e.local_input.defer_update_if_needed(p,o)),m||(local_echo_enabled&&Util.can_element_use_lecho(p)?e.lecho_regulator.update_remote_value(t,n,o,u,_):p.value=o),!TPROXY_ENABLED&&Util.is_autofill_target(p)&&(p.sv_prev_value=o)):"input"===f&&"file"===p.type?o?reportErrorClientEvent("tc-dom-unexpected-property-update",{op:r,name:i,value:o,node_value:p.value,value_on_TC:p.value||"(unset)"}):(p.value="",p.removeAttribute("__sv_open")):"__sv_ss_disabled"===i?"link"===f?p.sheet?(p.sheet.disabled=o,function(e,t){var n=e+"_"+t;d.hasOwnProperty(n)&&delete d[n]}(t,n)):P(t,n,o,1):"style"===f&&(p.disabled=o):"img"===f&&"currentsrc"===i?p.src=o:soft_assert(0,"modify-prop: unknown property: op="+r+" tag="+f+" name="+i+" value="+o),Util.is_elem_editable(p)&&e.text_monitor.monitor_text_change(t,p),c&&c.adjust_parent_fragment_size(t,n)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.MODIFY_ATTR_VALUE,(function(t,n,r,i,o,a){var s,l,d,u,_=getNodeByUid(t,n),f=getWindowByFid(t),p=i.toLowerCase();if(soft_assert(_,"Unknown node"),"object"!==(s=Util.get_node_tag(_))||"remove"===r||C(p,o)){if("object"===s&&"data-sv-src"===p&&N(f.document,o,_),"img"===s&&"src"===p&&e.imgreq_mgr.reset(_),"add"===r){if(("xmlns"===p||__startswith(p,"xmlns:"))&&(a=null),o=A(p,_,o),!window.TPROXY_ENABLED&&k(_,p,o))return;f=getWindowByFid(getFidByNode(_)),e.xbrowser.setAttribute(f,_,a,i,o)}else"remove"===r&&_.removeAttribute(i);if("input"!==s||"text"!==_.type&&"search"!==_.type||"class"!==p||(_.classList.add("__safly_input_chrome"),_.classList.add("__safly_input_ms")),"link"===s&&"disabled"===p)for(l=document.getElementsByTagName("link"),u=0;u<l.length;u+=1)(d=l[u]).hasAttribute("disabled")?d.disabled=!0:d.getAttribute("rel")&&-1!==d.getAttribute("rel").indexOf("style")&&d.getAttribute("title")&&(d.disabled=!0,d.disabled=!1);Util.is_elem_editable(_)&&e.text_monitor.monitor_text_change(t,_),c&&c.adjust_parent_fragment_size(t,n)}})),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOVE_ELEMENT,(function(t,n,r){var i,o=getNodeByUid(t,n);if(e.text_monitor.on_remove_node(t,n),o!==mf.document.documentElement&&o!==mf.document.body){if(o||!(i=getNodeByUid(t,r))||"TEXTAREA"!==i.nodeName){if(soft_assert(o,"Unknown node"),w(o),r){if(i=getNodeByUid(t,r),e.local_input.defer_remove_if_needed(t,o,i))return;soft_assert(i,"Unknown parent"),v(0,getWindowByFid(t).document,o,i)}c&&c.on_node_remove(t,n,o)}}else b(o)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.MODIFY_CHARACTER_DATA,(function(t,n,r,i){var o,a=getNodeByUid(t,n),s=getNodeByUid(t,i),l=!1;if(soft_assert(a,"Unknown node"),soft_assert(s,"Unknown parent"),"Explorer"!==browser.name||!e.xbrowser.processIECharacterData(a,s,"modify",r)){if((o=a.data)===r&&!(local_echo_enabled&&local_echo_config.extended&&Util.is_content_editable(a)))return;(l=e.lecho_regulator_ext.try_handle_remote_update(a,r))||(l=e.local_input.defer_update_if_needed(a,r)),l||I(a,o,r)}c&&c.adjust_parent_fragment_size(t,n)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.ADD_SVG_ELEMENT,D),e.interp.registerOpcodeHandler(e.interp.OPCODES.ADD_NS_ELEMENT,(function(e,t,n,r,i,o,a){x(e,t,n,r,i,o,a)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.FOCUS_ELEMENT,(function(e,t,n){var r,i=!1;if(soft_assert(r=null===t?getWindowByFid(e):getNodeByUid(e,t),"Unknown node"),r.focus){if(document.body&&document.activeElement===r)return;_&&n&&!Util.elementIsInsideViewport(r)&&isTopFrameFid(e)&&0===getWindowByFid(e).pageYOffset&&(i=!0),i&&(void 0===document.body.__sv_original_pos_style&&(document.body.__sv_original_pos_style=document.body.style.position),document.body.style.position="fixed"),r.focus(),i&&setTimeout((function(){void 0!==document.body.__sv_original_pos_style&&(document.body.style.position=document.body.__sv_original_pos_style,delete document.body.__sv_original_pos_style)}),0)}})),e.interp.registerOpcodeHandler(e.interp.OPCODES.BLUR_ELEMENT,(function(e,t){var n;if(soft_assert(n=null===t?getWindowByFid(e):getNodeByUid(e,t),"Unknown node"),n.blur){if(document.body&&document.activeElement!==n)return;n.blur()}else reportWarnClientEvent("tc-dom-unable-to-blur",{node:n.nodeName})})),e.interp.registerOpcodeHandler(e.interp.OPCODES.SCROLL_ELEMENT,(function(t,n,r,i){var o=getWindowByFid(t),a=getNodeByUid(t,n);soft_assert(a,"Unknown node"),e.local_events.ignored_events.scroll[t+"_"+n]=!0,"#document"===a.nodeName?(r=Math.floor(a.documentElement.scrollWidth*r),i=Math.floor(a.documentElement.scrollHeight*i),BrowserDetect.isIE()?o.scrollTo(r,i):o.scrollTo({left:r,top:i,behavior:"smooth"})):(r=Math.floor(a.scrollWidth*r),i=Math.floor(a.scrollHeight*i),a.scrollTop=i,a.scrollLeft=r)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.ADD_DOCUMENT,(function(t,n,i,o){var a,s=getWindowByFid(t);s&&(a=s.document,i&&a.documentElement&&(b(a.documentElement),e.callback.fire("dom-reset",t),"image/svg+xml"===o&&((a=a.body).setAttribute("style","border: none; margin: 0px; padding: 0px"),a.__sv_svg_container=!0)),setNodeIds(a,n,t),r.apply_adoption_cmds())})),e.interp.registerOpcodeHandler("DOM_init",(function(t,n,r,i,o,a,s){e.preload_indicator.dismiss(),e.callback.fire("dom-init",n,i,o,a,s)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.LOADED,(function(t,n){e.stats.stop("t_tdl"),e.stats.stop("t_tnl"),(n=n||{}).mode="r1",n.fs=Util.getFramingStatus(),n.pxy=window.TPROXY_ENABLED?1:0,e.callback.fire("dom-loaded",n)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.SCROLL_CONTROL,(function(t,n,r){e.wheel_ctrl.on_elem_wheel_ctrl_msg(t,n,r)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.DESIGN_MODE,(function(e,t){var n=getWindowByFid(e).document;"Explorer"===browser.name||browser.version<=10?"on"===t?n.body.setAttribute("contenteditable"):"off"===t&&n.body.removeAttribute("contenteditable"):n.designMode=t})),e.interp.registerOpcodeHandler(e.interp.OPCODES.READONLY_STATUS_CHANGED,(function(t,n,r,i){var o,a=getWindowByFid(t);a&&(reportClientEvent("readonly-status-update",{is_readonly:r,is_parent_readonly:i,is_top_isolated_frame:n,fid:t,tclevel:"tc-local-stats"},!1,!0),n?o=e.feedback_bar:a.feedback_bar?o=a.feedback_bar:(EventListener.addListener(a,"resize",E,!1),o=new FeedbackBar(e,a,!1),a.feedback_bar=o),o.setReadonlyUI(r,i),a.__sv_surrogate_is_readonly=r)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.RESYNC_PREPARE,(function(t){e.resync_in_progress=!0,e.frameset_wrapper&&(t=e.frameset_wrapper.get_original_fid(t),delete e.frameset_wrapper),isTopFrameFid(t)&&(__re_init_id_state(),e.sheet_loader.reset(),c&&c.reset(),r.reset(),o&&o.reset(),e.lecho_regulator.reset(),function(e){var t;for(t in e)e.hasOwnProperty(t)&&(e[t].__sv_paused=e[t].paused,window.document.body.appendChild(e[t]))}(l))})),e.interp.registerOpcodeHandler(e.interp.OPCODES.RESYNC_COMPLETE,(function(t){var n,r=document.getElementById(DOM_LOADED_ELEM_ID);r&&((n=JSON.parse(r.value)).resync=!0,r.value=JSON.stringify(n),e.sheet_loader.set_dom_resync_completed(),delete e.resync_in_progress)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.DIALOG_SHOW,M.curry(f)),e.interp.registerOpcodeHandler(e.interp.OPCODES.DIALOG_SHOW_MODAL,M.curry(p)),e.interp.registerOpcodeHandler(e.interp.OPCODES.DIALOG_CLOSE,M.curry(m)),e.interp.registerOpcodeHandler("favicon",(function(e){var t="__sv_favicon",n=document.getElementById(t);document.head&&(n||((n=document.createElement("link")).type="image/x-icon",n.rel="shortcut icon",n.id=t,document.head.appendChild(n)),(__startswith(e,"data:image/")||__startswith(e,"https://"))&&(n.href=e))})),e.interp.registerOpcodeHandler("using_frameset",(function(t){isTopFrameFid(t)?e.frameset_wrapper=new FramesetWrapper(mf.window,t,(function(){e.update_queue.deliver(t,e.interpretQueued)})):soft_assert(!1,"using_frameset command sent to a wrong frame.")})),e.interp.registerOpcodeHandler("add_shadow_root",(function(t,n,i){c||(c=new ShadowDomSupport(e,r)),c.add_shadow_root(t,n,i)})),e.interp.registerOpcodeHandler("add_external_svg",(function(e,t,n,r,i){var o,a,s,l=getWindowByFid(e);l.document.body&&((a=getSvgRootUidForFid(e,r))&&(assert(a!==n),(o=getNodeByUid(e,a))&&o.parentElement&&o.parentElement.removeChild(o)),(s=getNodeByUid(e,t))&&s!==l.document||(t=getUidByNode(l.document.body)),D(e,n,"svg",i,t,-1),soft_assert(o=getNodeByUid(e,n),"Unknown node"),addSvgRootUidForFid(e,r,n),o.setAttribute("class","__safly_external_svg"),o.setAttribute("width","0px"),o.setAttribute("height","0px"),o.style.display="none")})),e.interp.registerOpcodeHandler("display_copy_paste_modal",(function(){e.ui_frame.call("showCopyPasteModal",BrowserDetect.isMac())})),e.interp.registerOpcodeHandler("validate_form",(function(e,t,n,r){var i=getNodeByUid(e,t);i&&(i.setCustomValidity&&i.validationMessage!==n&&i.setCustomValidity(n),i.reportValidity&&r&&i.reportValidity())})),e.interp.registerOpcodeHandler("key_ctrl",(function(t,n,r,i,o,a,s,l){e.key_ctrl.on_elem_key_ctrl_msg(t,n,r,i,o,a,s,l)})),e.interp.registerOpcodeHandler("color_chooser",(function(e,t,n){var r=getNodeByUid(e,t);r&&Util.is_element_color_input(r)&&(Util.is_supported_element_color_input(r)?r.hasAttribute("data-sv-color-chooser-open")||(r.setAttribute("data-sv-color-chooser-open",""),r.click()):r.value!==n&&(r.value=n))})),e.callback.registerOneShot("dom-loaded",1e4,{on_success:function(){setTimeout((function(){_=!1}),1e4)},on_timeout:function(){_=!1}}),t=window.SvCustomElemReg?(o=new SvCustomElemReg).handle_define_elem:function(){},e.interp.registerOpcodeHandler(e.interp.OPCODES.DEFINE_CUSTOM_ELEM,t),e.interp.registerOpcodeHandler(e.interp.OPCODES.CONTENT_LOADED,(function(t){!function(t){var n=getIframeByFid(t),r=null;function i(){return!(!n||!n.__sv_is_ready_for_updates||n.__sv_frame_owner&&(setTimeout((function(){""===n.width&&""===n.height&&(n.setAttribute("width","0"),n.setAttribute("height","0"),setTimeout((function(){n.setAttribute("width",""),n.setAttribute("height","")}),0))}),50),r&&e.callback.deregister(r),0))}i()||(r=e.callback.register("frame-ready-for-updates",i))}(t)}))}function DownloadSupport(e){var t=this,n=new Logger("download",{level:"info"}),r=BrowserDetect.isIE(),i={},o=Object.freeze({NOT_START:0,STARTING:1,STARTED:2}),a={1:"download was cancelled by the user",2:"max download file size exceeded"};function s(){e.ui_frame.call("renderDownloadProgressMessageText",e.localization.get("ID_MODAL_DOWNLOAD_PROGRESS_ANALYZING"))}function l(t){(function(t){return e.serverCall({op_name:"get_download_action",url:e.url_builder.buildFileServerUrl("/safeview-fileserv/tc_status",!1,{file_id:t.key}),data:JSON.stringify({file_id:t.key})})})(t).done((function(n){var r,o,a=i[t.id];a?"preq"===n.action?(a.preq||(e.ui_frame.call("showDownloadPassword",n.file_id,t.filename),a.preq=!0,n.is_arch_subfile&&(a.is_arch_subfile=!0)),setTimeout(l.curry(t),500)):"pending"===n.action||"processing"===n.action?("pending"===n.action?s():(a.processing_status_calls%10==0&&(0===a.processing_status_calls&&a.preq&&e.ui_frame.call("hideDownloadPassword"),a.processing_status_calls/10%2==0?s():e.ui_frame.call("renderDownloadProgressMessageText",e.localization.get("ID_MODAL_DOWNLOAD_PROGRESS_PLEASE_WAIT"))),a.processing_status_calls+=1),o=.5,n.plugins&&(o+=.5*function(e){var t=0,n=0;for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t++,"FINISHED"===e[r].status&&n++);return 0===t?1:n/t}(n.plugins)),o!==t.progress&&(t.progress=o,e.ui_frame.call("renderDownloadProgressBar",t.progress)),n.file_size&&!t.total&&(t.total=n.file_size,r=m(t.total),e.ui_frame.call("renderFileSize",r)),a.errors=0,setTimeout(l.curry(t),500)):("block"===n.action&&"error"===n.action||a.is_arch_subfile&&"allow"!==n.action&&window.close(),f(t,n)):f(t,{action:"cancel"})})).fail((function(){var e=i[t.id],n=15;reportErrorClientEvent("tc-download-failed-to-get-policy",{download:JSON.stringify(t)}),e&&(n=e.errors,e.errors=n+1),n<15?setTimeout(l.curry(t),500):f(t,{error:"connection_lost"})}))}function c(t,r){var i;return-1!==t.fid&&(!t.is_main_frame&&((i=e.useRemotingV2()?function(t,n){var r,i;if(assert(e.compositor),assert(e.compositor.getIframeDelegate()),r=e.compositor.getIframeDelegate(),d(t)){if(!(i=r.getIframeNodeForFrame(t.fid,t.frame_token)))return!1;i.setAttribute("src",n)}else Util.windowOpen(n,t.filename);return!0}(t,r):function(e,t){var n,r,i;if(d(e)){if(!(n=getNodeByFrameFid(e.fid)))return!1;if(!(r=getNodeByUid(n.fid,n.uid)))return!1;if("iframe"!==(i=Util.get_node_tag(r))&&"object"!==i)return!1;if("object"===i&&!(r=function(e){var t,n,r,i,o;for(t=e.children,o=0;o<t.length;o++)if((n=t[o]).__sv_unmapped_frame)return n;if(!(r=getWindowByFid(getFidByNode(e))))return null;for(o=0;o<t.length;o++)(n=t[o]).style&&(n.style.display="none");return(i=r.document.createElement("iframe")).style.width="100%",i.style.height="100%",i.style.border="0px",i.style.margin="0px",i.__sv_unmapped_frame=!0,e.appendChild(i),i}(r)))return!1;r.setAttribute("src",t)}else Util.windowOpen(t,e.filename);return!0}(t,r))?(e.ui_frame.call("hideDownloadModal"),e.ui_frame.hide()):n.error({event:"tc-failed-to-handle-iframe-download",remoting_v2:e.useRemotingV2(),inline_pdf:d(t),fid:t.fid,frame_token:t.frame_token}),i))}function d(e){return"application/pdf"===e.mime_type&&!e.content_disposition.startsWith("attachment")}function u(t,n){var r,i,o={},a="/safeview-fileserv/tc_download/"+t.key+"/";"Explorer"!==browser.name&&"Firefox"!==browser.name||(a+=encodeURIComponent(t.filename)),INSPECT_DOMAIN!==CLUSTER_DOMAIN&&(n.file_url?(o.file_url=encodeURIComponent(n.file_url),o.type="pdf"===n.type?"pdf":"original"):(o.file_url=encodeURIComponent(t.uri),o.type="original")),i=e.url_builder.buildFileServerUrl(a,!0,o),e.ui_frame.call("setDownloadHref",i),e.ui_frame.call("hideDownloadModal"),e.ui_frame.call("hideScanProgress"),e.ui_frame.hide(),setTimeout((function(){c(t,i)||("Firefox"!==browser.name?Util.locationSet(window,i):((r=document.getElementById("safeview-file-download-container"))||((r=document.createElement("iframe")).style="visibility:hidden;display:none",r.id="safeview-file-download-container",r=document.body.appendChild(r)),r.onload=function(){r.onload=null,Util.locationSet(window,i)},r.src=i))}),200)}function _(t,n){e.ui_frame.call("renderDownloadProgress",1,e.localization.get("ID_MODAL_DOWNLOAD_PROGRESS_SUCCESS"),void 0,void 0,e.url_builder.buildAssetURL("/safeview-static/img/icon-check.png")),setTimeout(u.curry(t,n),1500)}function f(t,n){var r,o=!1;"cancel"!==n.action&&(i.hasOwnProperty(t.id)&&(o=i[t.id].preq,delete i[t.id]),n.error?e.ui_frame.call("showDownloadError"):"safedoc"===n.action?e.serverCall({op_name:"tc_isolate_document",type:"GET",url:e.url_builder.buildFileServerUrl("/safeview-fileserv/tc_isolate_document/"+t.key+"/",!0,{file_url:encodeURIComponent(t.uri),type:"isolate"}),data:{}}).always((function(i){if(e.ui_frame.call("hideScanProgress"),o)e.ui_frame.hide();else if("full"!==n.viewer&&(e.pairing_dict.client_caps.docview_modal||"modal"===n.viewer)){if(r=e.url_builder.buildFileServerUrl(n.url,!0),c(t,r))return;e.ui_frame.call("showDocviewModal",r,t.filename)}else{if(r=TPROXY_ENABLED?e.url_builder.buildLoginURL(n.url):n.url,c(t,r))return;e.ui_frame.call("hideDownloadModal"),e.ui_frame.hide(),Util.locationAssign(window,r)}})):"allow"===n.action?1!==t.progress&&(t.progress=1,_(t,n)):"block"===n.action?function(t){e.pairing_dict.client_caps.custom_file_block_page?Util.locationSet(window,e.url_builder.buildVanityFileTransferURL("/file_transfer/block/"+t.uri)):e.ui_frame.call("showDownloadBlocked",e.localization.get("ID_DOWNLOAD_POLICY_BLOCK"))}(t):"error"!==n.action&&"expired"!==n.action||e.ui_frame.call("showDownloadError"))}function p(t){var r="",a=null;t.nav_session_id&&(a=t.nav_session_id),t.uri.length<4096&&(__startswith(t.uri,"http:")||__startswith(t.uri,"https:"))&&(r=t.uri),i.hasOwnProperty(t.id)&&(i[t.id].scan_status=o.STARTING),e.serverCall({url:e.url_builder.buildFileServerUrl("/safeview-fileserv/tc_processing"),data:JSON.stringify({download_id:t.id,file_id:t.key,rid:e.pairing_dict.rid,src_uri:r,referrer:t.document_url,nav_session_id:a,is_prepend:!TPROXY_ENABLED,read_only:t.readonly_tab,category:t.category,is_mobile:BrowserDetect.isMobile()})}).done((function(e){i.hasOwnProperty(t.id)?(i[t.id].scan_status=o.STARTED,l(t)):f(t,{action:"cancel"})})).fail((function(){n.error({event:"tc-download-failed-to-start-processing",download:t}),f(t,{error:"connection_lost"})}))}function m(e){var t,n=[" B"," KB"," MB"];for(e=parseFloat(e),t=0;t<n.length;t+=1){if(e<1024)return e.toFixed(1)+n[t];e/=1024}return e.toFixed(1)+" GB"}function g(t){var n,i,o,a=e.localization.get("ID_MODAL_DOWNLOAD_PROGRESS_PREPARING"),s=m(t.received);t.total&&(s+=" / "+(n=m(t.total))),r?o=e.url_builder.buildAssetURL("/safeview-static/img/spinner.gif"):i="download-modal-spinner download-modal-spinner-18",e.ui_frame.call("updateDownloadProgress",t.id,t.filename,n,t.progress,a,s,i,o)}function h(t){TPROXY_ENABLED&&t.cat_check_enabled?function(t,n,r){if(!t||t.length<1)return r("error");var i=e.pairing_dict.s_nid_with_underscore,o=new XMLHttpRequest;o.open("GET",t,!0),o.setRequestHeader("Cache-Control","no-cache"),o.timeout=1e4,o.withCredentials=!0,o.setRequestHeader("Accept","msip/category,cid/"+i+",key/"+n+",*/*"),o.onreadystatechange=function(){4===o.readyState&&(200===o.status?r(null,!0):r("error"))},o.send()}(t.xhr_url,t.key,(function(e,n){p(t),e&&reportWarnClientEvent("tc-downstream-cat-check-failed",{xhr_uri:t.xhr_url})})):p(t)}t.saveDownloadProgress=function(){e.surrogate_channel.send("dl-save-prog",i)},t.cancelDownload=function(t){var n=i[t];n&&("finished"!==n.status?e.surrogate_channel.send("cancel-download",t,1):delete i[t],n.is_arch_subfile&&window.close())},e.interp.registerOpcodeHandler("download_requested",(function(r){if(r.frame_token=r.frame_token?r.frame_token.toLowerCase():"",n.info({event:"tc-download-requested",uri:r.uri,id:r.id,filename:r.filename,key:r.key,fid:r.fid,frame_token:r.frame_token}),function(t){assert(!i.hasOwnProperty(t.id)),t.document_url=document.URL,t.readonly_tab=e.readonly.isShowingBanner(),i[t.id]={download:t,status:"not-started",scan_status:o.NOT_START,errors:0,preq:!1,is_arch_subfile:!1,processing_status_calls:0}}(r),"pubmatic"===r.filename)return reportWarnClientEvent("tc-spurious-download-requested"),t.cancelDownload(r.id),void delete i[r.id]})),e.interp.registerOpcodeHandler("download_ignored",(function(t){e.ui_frame.call("showModal","DownloadDisabled",t)})),e.interp.registerOpcodeHandler("download_status_updated",(function(e,t,n){var r,o=i[e];o&&(o.status=t,"started"===t?(o.download.received=n.received,o.download.progress=.5*((r=o.download).received?r.total?r.received/r.total:.5:0),g(o.download)):"finished"===t&&(o.download.mime_type=n.mime_type,h(o.download)))})),e.interp.registerOpcodeHandler("download_cancelled",(function(t){var n=i[t.id];n&&(delete i[t.id],assert(a.hasOwnProperty(t.reason_code)),a[t.reason_code],n.download.filename,2===t.reason_code&&e.ui_frame.call("showDownloadBlocked",e.localization.get("ID_DOWNLOAD_FILE_SIZE_EXCEEDED")))})),e.interp.registerOpcodeHandler("download_restore_prog",(function(t){Util.forEachItem(t,(function(t,n){return assert(!i.hasOwnProperty(t)),i[t]=n,"started"===n.status?g(n.download):"finished"===n.status&&(g(n.download),n.preq&&e.ui_frame.call("showDownloadPassword",n.download.key,n.download.filename),n.scan_status===o.NOT_START?setTimeout(h.curry(n.download),0):setTimeout(l.curry(n.download),0)),!1}))})),e.callback.register("dom-init",(function(){assert(e.surrogate_channel),e.surrogate_channel.send("dl-resume")}))}var COF_MPFD_MAX_SIZE=209715200,fileChooserTargetFid=null,fileChooserTargetUid=null,fileChooserTargetNode=null;function UploadSupport(e){var t,n=this,r=new Logger("upload",{level:"info"}),i=0,o=0,a=-1,s=!1,l=null,c=null,d=[],u={},_=!1,f=0,p=0,m=0,g="n/a",h=-1,v=!1;function w(){_&&(e.ui_frame.call("hideUploadProgress"),_=!1)}function y(){var t=100,n=l?l.file.name:c?c.file.name:"-";p<o&&((t=Math.ceil(100*p/o))>h||n!==g)&&(!function(t,n){_=!0,e.ui_frame.call("updateUploadProgress",a,t,n)}(n,t),h=t,g=n)}function b(){if(l&&(c=l,l=null),d.length){(l=d.shift()).id,l.file.name,l.file.size;var t=l.file.lastModified||(l.file.lastModifiedDate?l.file.lastModifiedDate.getTime():(new Date).getTime());e.surrogate_channel.send("upload",a,l.id,l.file.size,l.file.name,l.file.type||"n/a",t)}}function E(t,n,r){var i,o=e.pairing_dict&&e.pairing_dict.client_caps||{};n=n||"DLPOrNetworkUploadBlocked",fileChooserTargetNode&&(fileChooserTargetNode.value=""),w(),i="DLPBlocked"!==n||!r||!r.length||o.dlp_do_not_show_block_payload_uploads,e.surrogate_channel.send("abort-upload",a,"DLPBlocked"===n,!i,t||0,r||""),reportErrorClientEvent("tc-upload-error",{file_id:l.id,size:l.file&&l.file.size,name:l.file&&l.file.name,status:t,upload_id:a,dialog:n}),a=-1,i&&e.ui_frame.call("showModal",n)}function A(e){p+=e-f,f=e,y()}function U(t,n){var r=e.pairing_dict&&e.pairing_dict.client_caps||{},i="DLPBlocked";if(200!==t||"MSIP_OK"!==n)return l.xhr=null,r.dlp_block_codes&&r.dlp_block_codes.length&&-1===r.dlp_block_codes.indexOf(t)&&(i="DLPOrNetworkUploadBlocked"),void E(t,i,n);y(),b()}function S(t){assert(t===a),-1!==a&&(e.surrogate_channel.send("file-chooser-cancelled",a,!1,!1,0,""),a=-1)}function C(e,t){fileChooserTargetFid=e,a=t}function N(e){n.setupUploads(fileChooserTargetNode,e)}function k(e){e.stopPropagation()}function O(n,r,i){var o,a,s,l=e.pairing_dict&&e.pairing_dict.client_caps||{};r=r||0,!(!l.dlp_retry_input||l.dlp_retry_codes_input&&l.dlp_retry_codes_input.length&&-1===l.dlp_retry_codes_input.indexOf(r))&&u.hasOwnProperty(n)&&((o=u[n]).attempts+=1,o.attempts<=l.dlp_retry_input)?window.setTimeout(t,40*Math.pow(2,o.attempts),n,o.target_url,o.data,o.content_type):(delete u[n],!l.dlp_ignore_error_input||l.dlp_ignore_error_codes_input&&l.dlp_ignore_error_codes_input.length&&-1===l.dlp_ignore_error_codes_input.indexOf(r)?(s=(a=!i||!i.length||l.dlp_do_not_show_block_payload||l.dlp_show_block_payload_codes&&l.dlp_show_block_payload_codes.length&&-1===l.dlp_show_block_payload_codes.indexOf(r))&&l.dlp_soft_error_input&&!(l.dlp_soft_error_codes_input&&l.dlp_soft_error_codes_input.length&&-1===l.dlp_soft_error_codes_input.indexOf(r)),e.surrogate_channel.send("inspect-failed",n,r,i||"",!a),reportErrorClientEvent("tc-inspect-failed",{status:r,input_count:n,show_error:a,soft_error:s}),a&&e.ui_frame.call("showModal",s?"DLPSoftBlocked":"DLPBlocked")):e.surrogate_channel.send("inspect-ignore-failed",n,r))}function T(e){delete u[e]}return n.abortUpload=function(t){w(),l&&l.xhr&&l.xhr.abort&&l.xhr.abort(),v&&e.cof.call(["doUploadAbort"],null),e.surrogate_channel.send("abort-upload",a,!1,!1,0,""),-1!==a&&(a!==t&&reportWarnClientEvent("tc-upload-user-abort",{upload_id:t,cur_upload:a}),a=-1),fileChooserTargetNode&&(fileChooserTargetNode.value="")},n.setupUploads=function(t,n){assert("input"===Util.get_node_tag(t)),assert("file"===t.type.toLowerCase());var r,s,l=t.files;if(fileChooserTargetUid||(document.body.removeChild(t),EventListener.removeListener(fileChooserTargetNode,"change",N)),d=[],i=0,o=0,p=0,h=-1,!l||!l.length)return reportErrorClientEvent("tc-upload-no-files-specified",{}),void S(a);for(l.length,r=0;r<l.length;r+=1)s=l[r],i+=1,o+=s.size,d.push({file:s,id:i,upload:a}),l.length;assert(d.length===i),e.surrogate_channel.send("upload",a,0,i),b()},n.setupDroppedUpload=function(e){var t,n;if(d=[],i=0,o=0,p=0,h=-1,e&&e.length){for(e.length,t=0;t<e.length;t+=1)n=e[t],i+=1,o+=n.size,d.push({file:n,id:i,upload:a}),r.info("Queued upload ID# "+i+" (of "+e.length+")");assert(d.length===i)}else reportErrorClientEvent("tc-drop-upload-no-files-specified",{})},n.dismissConfirmUpload=function(e){var t,n;e?(n=!1,assert(a===a),fileChooserTargetNode=null,fileChooserTargetUid&&((t=getNodeByUid(fileChooserTargetFid,fileChooserTargetUid))?(n=!0,(fileChooserTargetNode=t).setAttribute("__sv_open","true")):reportErrorClientEvent("tc-upload-show-file-chooser-error",{uid:fileChooserTargetUid,fid:fileChooserTargetFid})),fileChooserTargetNode||((fileChooserTargetNode=document.createElement("input")).setAttribute("type","file"),document.body.appendChild(fileChooserTargetNode),EventListener.addListener(fileChooserTargetNode,"change",N),n=!0),fileChooserTargetNode.multiple=s,n&&BrowserDetect.isIE()?(EventListener.addListener(fileChooserTargetNode,"click",k),fileChooserTargetNode.click()):n&&fileChooserTargetNode.dispatchEvent(new MouseEvent("click"),{bubbles:!1})):S(a)},t=function(t,n,r,i){var o,a,s;if(!(e.pairing_dict&&e.pairing_dict.client_caps||{}).dlp_disable_cof)return o={cid:e.pairing_dict.cid,tab_id:e.pairing_dict.tab_id,safe_rid:e.pairing_dict.safe_rid,mpa_id:e.pairing_dict.mpa_id,ic:t,page_url:encodeURIComponent(Util.getPageUrl())},e.pairing_dict.cluster_id&&(o.cl=e.pairing_dict.cluster_id),void e.cof.call(["doInspect",o,t,r,i]);(s=new XMLHttpRequest).input_count=t,a=e.url_builder.buildInspectURL("/r/user_input?cid="+e.pairing_dict.cid+"&tab_id="+e.pairing_dict.tab_id+"&mpa_id="+e.pairing_dict.mpa_id+"&safe_rid="+e.pairing_dict.safe_rid+"&ic="+t+"&page_url="+encodeURIComponent(Util.getPageUrl())),e.pairing_dict.cluster_id&&(a+="&cl="+e.pairing_dict.cluster_id),s.open("POST",a),s.withCredentials=!0,s.onload=function(e){200!==s.status||"MSIP_OK"!==s.responseText?O(s.input_count,s.status,s.responseText):T(s.input_count)},s.onerror=function(){O(s.input_count,s.status)},s.setRequestHeader("Content-Type",i||"application/x-www-form-urlencoded"),s.setRequestHeader("Accept","text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"),s.send(r)},e.interp.registerOpcodeHandler("inspect",(function(e,n,r,i){u[e]={attempts:0,target_url:n,data:r,content_type:i},t(e,n,r,i)})),e.interp.registerOpcodeHandler("upload_dropped_files",(function(t,n){e.copy_paste_ctrl.enforce_on_file_upload()||(C(t,n),assert(d.length===i),e.surrogate_channel.send("upload",a,0,i),b())})),e.interp.registerOpcodeHandler("run_file_chooser",(function(t,n,r,i){e.copy_paste_ctrl.enforce_on_file_upload()||(C(t,r),s=i,fileChooserTargetUid=n,e.ui_frame.call("showModal","ConfirmUpload"))})),e.interp.registerOpcodeHandler("uploads_disabled",(function(t){a=t,fileChooserTargetNode&&(fileChooserTargetNode.value=""),e.ui_frame.call("showModal","UploadDisabled")})),e.interp.registerOpcodeHandler("upload_blocked",(function(t,n){a=t,w(),fileChooserTargetNode&&(fileChooserTargetNode.value=""),d=[],l&&l.xhr&&l.xhr.abort&&l.xhr.abort(),v&&e.cof.call(["doUploadAbort"],null),(!Array.isArray(n)||n.indexOf("dlp")<0)&&e.ui_frame.call("showModal","UploadBlocked")})),e.interp.registerOpcodeHandler("upload_complete",(function(e){a=e,w(),fileChooserTargetNode&&(fileChooserTargetNode.removeAttribute("__sv_open"),BrowserDetect.isIE()&&EventListener.removeListener(fileChooserTargetNode,"click",k))})),e.interp.registerOpcodeHandler("upload_ack",(function(t,r){a!==t||r<=0||(m=p,(v=e.pairing_dict.client_caps.mpfd_cof_uploads&&!BrowserDetect.isIE10()&&l.file.size<COF_MPFD_MAX_SIZE)?function(t){var r,i;i={cid:e.pairing_dict.cid,mpa_id:e.pairing_dict.mpa_id,tab_id:e.pairing_dict.tab_id,upload_id:a,file_id:t.id,page_url:encodeURIComponent(Util.getPageUrl())},e.pairing_dict.cluster_id&&(i.cl=e.pairing_dict.cluster_id),(r=new FileReader).filename=t.file.name,r.onloadend=function(){r.result&&e.cof.call(["doUpload",i,r.filename,r.result],null,[r.result])},r.onerror=function(){reportErrorClientEvent("tc-upload-read-failed",{name:t.file.name,size:t.file.size,error:r.error&&r.error.name,message:r.error&&r.error.message}),n.abortUpload(a)};try{r.readAsArrayBuffer(t.file)}catch(e){reportErrorClientEvent("tc-upload-read-failed",{name:t.file.name,size:t.file.size,error:e.toString()}),n.abortUpload(a)}}(l):function(t){var n,r=new FormData,i=new XMLHttpRequest;f=0,r.append("file",t.file),n=e.url_builder.buildInspectURL("/r/upload?cid="+e.pairing_dict.cid+"&mpa_id="+e.pairing_dict.mpa_id+"&tab_id="+e.pairing_dict.tab_id+"&upload_id="+a+"&file_id="+t.id+"&page_url="+encodeURIComponent(Util.getPageUrl())),e.pairing_dict.cluster_id&&(n+="&cl="+e.pairing_dict.cluster_id),i.open("POST",n),i.withCredentials=!0,i.onload=function(e){U(i.status,i.responseText)},i.upload.onprogress=function(e){A(e.loaded)},i.onerror=function(){t.xhr=null,E(i.status)},i.onabort=function(){t.xhr=null,fileChooserTargetNode&&(fileChooserTargetNode.value="")},t.xhr=i,i.send(r)}(l),y())})),e.interp.registerOpcodeHandler("upload_aborted",(function(e){w(),a===e?a=-1:-1!==a&&reportErrorClientEvent("tc-upload-mismatch",{upload_id:e,cur_upload:a})})),e.interp.registerOpcodeHandler("upload_progress",(function(e,t,n){var r=m+n;a===e&&l&&t===l.id&&r>p&&(p=r,y())})),e.interp.registerOpcodeHandler("upload_password",(function(t,n,r){var i=t?"showUploadPassword":"hideUploadPassword";e.ui_frame.call(i,n,r)})),n.onerror=E,n.onload=U,n.onprogress=A,n.oninspecterror=O,n.oninspectsuccess=T,n}function XBrowserHelpers(){var e,t=["tel","email","number"],n=(e=0,function(){return"invalid_name_replaced_"+(e+=1)}),r=new Logger("xbrowser",{level:"info"}),i=this;function o(e,t,n){return"http://www.w3.org/1999/xhtml"===t?e.createElement(n):e.createElementNS(t,n)}this.isInputTypeAttr=function(e,t,n){return("Chrome"===browser.name||"ChromiumEdge"===browser.name||"Firefox"===browser.name)&&"input"===Util.get_node_tag(e)&&"type"===t},this.isIEQuirksMode=function(){return"Explorer"===browser.name&&null===document.doctype},this.supportsWebSockets=function(){return window.WebSocket||window.MozWebSocket},this.hasAttribute=function(e,t,n){return e.hasAttributeNS&&t?e.hasAttributeNS(t,n):e.hasAttribute?e.hasAttribute(n):e[n]},this.createElement=function(e,t,i){var a,s=null,l=e.document;if(l.createElementNS&&t)try{s=o(l,t,i)}catch(c){if(!(c instanceof e.DOMException)||c.code!==c.INVALID_CHARACTER_ERR&&c.code!==c.NAMESPACE_ERR)throw r.info("ex.code="+c.code+" ICE="+c.INVALID_CHARACTER_ERR),c;s=o(l,t,a=n()),reportWarnClientEvent("tc-xbrowser-invalid-attribute",{name:i,sanitized:a})}else try{s=l.createElement(i)}catch(t){if(!(t instanceof e.DOMException&&t.code===t.INVALID_CHARACTER_ERR))throw r.info("ex.code="+t.code+" ICE="+t.INVALID_CHARACTER_ERR),t;a=n(),s=l.createElement(a),reportWarnClientEvent("tc-xbrowser-invalid-attribute",{name:i,sanitized:a})}return s},this.doSetAttributeWork=function(e,n,r,i){var o,a,s=!1;if("type"===r.toLowerCase()&&"submit"===i.toLowerCase()&&(a=e.value,s=!0),this.isInputTypeAttr(e,r,i)&&(t.indexOf(i)>-1?(e.__sv_original_input_type=i.toLowerCase(),i="text"):delete e.__sv_original_input_type),e.setAttributeNS&&n)e.setAttributeNS(n,r,i);else if(this.isIEQuirksMode())switch(r.toLowerCase()){case"style":e.style.cssText=i;break;case"class":e.className=i;break;case"for":e.htmlFor=i;break;case"scrolling":case"frameborder":case"type":case"method":case"rowspan":case"colspan":e.setAttribute(r,i);break;default:(o=document.createAttribute(r)).value=i,e.setAttributeNode(o)}else e.setAttribute(r,i);s&&e.value!==a&&(e.value=a)},this.setAttribute=function(e,t,i,o,a){var s;try{this.doSetAttributeWork(t,i,o,a)}catch(l){if(l instanceof e.DOMException&&l.code===l.INVALID_CHARACTER_ERR)s=n(),this.doSetAttributeWork(t,i,s,a),reportWarnClientEvent("tc-xbrowser-invalid-attribute",{name:o,sanitized:s});else{if(-1===l.toString().toLowerCase().indexOf("not implemented"))throw l;r.info("Ignoring setAttribute exception: "+l.toString())}}},this.processIECharacterData=function(e,t,n,r){var i=!0;switch(t.nodeName){case"STYLE":browser.version<9||9===browser.version&&safeview.xbrowser.isIEQuirksMode()?t.cssText="remove"===n?" ":r:i=!1;break;case"TITLE":t.text="remove"===n?"":r;break;default:i=!1}return i},this.appendChildThatHandlesIE8CornerCase=function(e,t,n,r,i){var o=Util.get_node_tag(i);if("Explorer"===browser.name&&8===browser.version){if("embed"===t&&"object"===o)return function(e,t,n,r,i){var o=function(e,t){var n;for(e=e.toLowerCase(),n=0;n<t.length;n+=1)if(t[n][0].toLowerCase()===e)return t[n][1]}("id",r);return o||(o=n,r.push(["id",o])),i.altHtml=function(e,t,n){var r,i="<"+e+" ";for(r=0;r<t.length;r+=1)i+=t[r][0].toLowerCase()+'="'+t[r][1]+'" ';return(i+='__uid="'+n+'"')+">"}(t,r,n),e.document.getElementById(o)}(e,t,n,r,i);reportWarnClientEvent("tc-xbrowser-IE8-append-fail",{child:t,parent:o})}else reportWarnClientEvent("tc-xbrowser-general-append-fail",{name:t})},this.setSelectValue=function(e,t){var n,r=e.options.length;if(e.__safely_select_value=t,"Explorer"===browser.name){for(n=0;n<r;n+=1)if(e.options[n].value===t)return void(e.selectedIndex=n)}else e.value=t},this.getControlNode=function(e){var t;return e.hasOwnProperty("control")?e.control:e.htmlFor?document.getElementById(e.htmlFor):(t=e.getElementsByTagName("input")).length?t[0]:null},this.isDocumentInstance=function(e){if(!e)return!1;if("#document"===Util.get_node_tag(e))return!0;try{return e instanceof Document||e instanceof HTMLDocument}catch(e){return!1}},this.getEventTarget=function(e){var t,n=e.target||e.srcElement;return i.isDocumentInstance(n)&&(t=getWindowByFid(getFidByNode(n)))&&(n=t.document.body),"Edge"===browser.name&&n&&n.correspondingUseElement&&(n=n.correspondingUseElement),n},this.exitFullscreen=document.exitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitExitFullscreen,this.requestFullscreen=function(e){var t=e.requestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.webkitRequestFullscreen;t?t.apply(e):reportErrorClientEvent("tc-xbrowser-full-screen-fail")},this.fullscreenchange=[],void 0!==document.onwebkitfullscreenchange&&(this.fullscreenchange.push("webkitfullscreenchange"),this.fullscreenElement="webkitFullscreenElement"),void 0!==document.onmozfullscreenchange&&(this.fullscreenchange.push("mozfullscreenchange"),this.fullscreenElement="mozFullScreenElement"),void 0!==document.onmsfullscreenchange&&(this.fullscreenchange.push("MSFullscreenChange"),this.fullscreenElement="msFullscreenElement"),void 0!==document.onfullscreenchange&&(this.fullscreenchange.push("fullscreenchange"),this.fullscreenElement="fullscreenElement"),this.isBrokenSameSite=function(){return BrowserDetect.isChrome()&&BrowserDetect.version<67||BrowserDetect.isIOS()&&BrowserDetect.OSVersion[0]<13||BrowserDetect.isMac()&&BrowserDetect.isSafari()&&10===BrowserDetect.OSVersion[0]&&BrowserDetect.OSVersion[1]<15},this.contains=function(e,t){if("Explorer"===browser.name){for(;t&&t!==e;)t=t.parentNode;return t===e}return e.contains(t)}}function CrossOriginHistory(e){var t=this,n=new Logger("location",{level:"info"}),r=!1,i=location.href,o=null,a=null,s=!1;function l(e,t){return new ParsedURL(e).origin===new ParsedURL(t).origin}function c(e,t,n){r=!0,o=e,n?window.history.pushState(t,"",e):window.history.replaceState(t,"",e)}function d(t,n,r,i){var o=!1,a=new ParsedURL(location.href).origin===new ParsedURL(t).origin;if(i&&a)c(t,n,r),e.on_soft_update_for_html4_op(t);else{if(BrowserDetect.isIE()||BrowserDetect.isEdge())try{o=decodeURIComponent(location.href)===decodeURIComponent(t)}catch(e){}r&&t!==location.href&&!o||window.history.replaceState({},"",location.href),function(t,n){setTimeout((function(){var e=new ParsedURL(location.href).isCrossDocumentNav(new ParsedURL(t));n?Util.locationAssign(window,t):Util.locationReplace(window,t),e||window.location.reload()}),10),t.match(/^(http|https):\/\//)?e.on_hard_update(t):safeview.exit_handler.openingLocalApp()}(t,r)}}function u(){o=location.href,a?(a(),a=null):!r&&location.href===i?n.info("dropped spurious popstate event"):e.on_soft_traversal(s),r=!0}function _(){new ParsedURL(location.href).hasHash()||new ParsedURL(o).hasHash()||u()}function f(e){var t=window.history.state;assert(!t||t.url),t&&t.url!==location.href&&(s=!0),u(),s=!1}t.assign=function(e,t,n){d(e,t,!0,n)},t.replace=function(e,t,n){d(e,t,!1,n)},t.pushState=function(e,t){assert(l(location.href,e)),c(e,t,!0)},t.replaceState=function(e,t){assert(l(location.href,e)),c(e,t,!1)},t.updateState=function(e,t){window.history.replaceState(t,document.title,e)},t.setPopstateAction=function(e){a=e},assert(e.on_soft_traversal),assert(e.on_soft_update_for_html4_op),assert(e.on_hard_update),"Explorer"===browser.name?(EventListener.addListener(window,"hashchange",f,!1),EventListener.addListener(window,"popstate",_,!1)):EventListener.addListener(window,"popstate",u,!1)}function HistorySupport(e){var t,n=this,r=[];function i(t,n){if(assert(t),JSON.stringify({url:t,hid:n}),!e.surrogate_channel)return JSON.stringify({url:t,hid:n}),void r.push({url:t,hid:n});e.surrogate_channel.send("navigate",t,n)}function o(e){window.history.go(e)}function a(){var t;for(assert(e.surrogate_channel),JSON.stringify(r),t=0;t<r.length;t+=1)i(r[t].url,r[t].hid);r=[]}function s(r,i,a,l,c,d,u,_,f,p){var m=new ParsedURL(n.getSafeUrl(r,l,_[0])).href,g={hid:a,persistent_policy:c||{}};if("Explorer"===browser.name&&(g.url=m),u)return assert(d),t.setPopstateAction((function(){setTimeout((function(){s(r,i,a,l,c,d,0,_,f,p)}),0)})),void o(u);if(JSON.stringify({target_raw_page_url:r,turl:m,state:g,is_same_page:d,kind:i,mpa_tag:_,prepend:l,hid:a}),assert(m),!__startswith(Util.getRawPageUrl(),"http://doc/"))if(f)!function(e,t){var n,r,i=t.split("&"),o=document.createElement("form"),a=0;if(o.setAttribute("method","post"),o.setAttribute("action",e),""!==t)for(a=0;a<i.length;a+=1)r=i[a].split("="),(n=document.createElement("input")).setAttribute("type","hidden"),n.setAttribute("name",Util.formDecode(r[0])),n.setAttribute("value",Util.formDecode(r[1])),o.appendChild(n);document.body.appendChild(o),o.submit()}(m,p);else{switch(i){case"add":e.download.saveDownloadProgress(),function(e){var t;(e=e||{}).hint_key&&e.hint&&(t=Util.addQueryValueToLocation(window.location,e.hint_key,e.hint),window.history.replaceState(window.history.state||{},document.title,t))}(Util.persistentPolicy()),t.assign(m,g,d);break;case"replace":e.download.saveDownloadProgress(),t.replace(m,g,d);break;case"pushstate":t.pushState(m,g);break;case"replacestate":t.replaceState(m,g);break;case"stateupdate":Util.getRawPageUrl();try{t.updateState(m,g)}catch(e){reportWarnClientEvent("tc-history-invalid-stateupdate"),t.replace(m,g)}break;default:assert(0)}e.readonly.configBanners()}}function l(t){"top"!==e.role?e.surrogate_channel.send("resume_client_update"):e.surrogate_channel.resume_client_update()}function c(e){var t=new Error(JSON.stringify({target_url:e}));throw t.name="shutdown-tc",t}function d(e){var t=Util.getRawPageUrl(),r=e?null:n.getHID();JSON.stringify({turl:t,thid:r}),i(t,r)}function u(r,i,o){o=o||{},n.getHID()===i&&Util.persistentPolicy()===o||(t.updateState(window.location.href,{hid:i,url:window.location.href,persistent_policy:o}),o.hint_key&&o.hint&&Util.removeParam(o.hint_key,o.hint),e.readonly.configBanners())}function _(r){r=r||{},t.updateState(window.location.href,{hid:n.getHID(),url:window.location.href,persistent_policy:r}),r.hint_key&&r.hint&&Util.removeParam(r.hint_key,r.hint),e.readonly.configBanners()}n.getHID=function(){var e=window.history.state;return e?e.hid:null},n.getSafeUrl=function(t,n,r){var i="/";return"about:blank"===t&&(t="__about_~_blank__"),r&&(i="/mpa/"+r+"/",TPROXY_ENABLED&&(t=e.url_builder.buildLoginURL(i+t))),TPROXY_ENABLED||!n?t:i+t},e.interp.registerOpcodeHandler("update_navbar",s),e.interp.registerOpcodeHandler("history_jump",o),e.interp.registerOpcodeHandler("persistent-policy",_),e.callback.register("surrogate-channel-connected",a,!0),e.callback.register("dom-init",u),t=new CrossOriginHistory({on_soft_traversal:d,on_soft_update_for_html4_op:l,on_hard_update:c})}function TabSupport(e){var t=new Logger("tab",{level:"info"}),n=this,r=["width","height","left","top","menubar","toolbar","location","status","fullscreen","scrollbars","resizable"],i=[],o=[],a={},s=!1,l=[],c=!1;function d(e){var t=e.split("?")[0];return a.hasOwnProperty(t)}function u(){var n=o.shift();return n&&(s?(o.unshift(n),n=void 0):d(n.uri)&&(t.info("Denying repeated popup request for "+n.uri),e.surrogate_channel.send("allow-tab-open",!1,!1,n.pairing_dict.tab_id),n=u())),n}function _(t){var r=window.navigator.userActivation&&window.navigator.userActivation.isActive,o=!0;t.user_initiated&&(0!==i.length||r)&&(o=!n.tabOpenAction(t,"allow",!1)),o&&(s=!0,e.ui_frame.call("showPopupOpenModal",t))}function f(){var e=u();e&&(o.length,i.length,_(e))}function p(){var e=i.shift();if(e)try{e.close()}catch(e){}}function m(n,r,o){if(assert(window===window.top),!e.detached){for(;0!==i.length;)p();n?(t.info("Detached"),e.restore_on_reattach.save_state(),e.detached=!0,e.prevent_reattach=o,r||e.surrogate_channel.close("client-detach"),clearPairingState(e)):window.close()}}n.safeview=e,n.detachAfterChannelClose=function(){t.info("Detaching from channel failure"),m(!0,!0,!1)},n.tabPreOpen=function(t){var n;return!(!(e.pairing_dict&&e.pairing_dict.client_caps||{}).preopen_tab||d(t)||window.navigator.userActivation)&&((n=Util.windowOpen())&&i.push(n),!!n)},n.tabOpenAction=function(n,r,o){var c,d=n.uri.split("?")[0];if(e.ui_frame.hide(),!n.pairing_dict)return"allow"===r&&((c=i.shift())?Util.locationReplace(c,n.target_uri):c=n.feature_str?Util.windowOpen(n.target_uri,"",n.feature_str):Util.windowOpen(n.target_uri)),s=!1,!0;if("allow"===r)if(n.user_initiated&&(c=i.shift()),c||(c=Util.windowOpen("","",n.feature_str)),c)c.name=function(t){return e.tab_store.format(t.pairing_dict)}(n),Util.locationReplace(c,n.target_uri),l.push({window:c,tab_id:n.pairing_dict.tab_id});else{if(!o)return t.info("Falling-back to open new tab with modal."),!1;t.warn("Failed to open new tab"),r="blocked"}else"deny"===r&&(a[d]=!0);return e.surrogate_channel.send("allow-tab-open","allow"===r,o,n.pairing_dict.tab_id),s=!1,setTimeout(f,0),!0},n.openTabWithInfo=_,e.interp.registerOpcodeHandler("TAB_open",(function(t,a,s,l,d){var u,_,m,g={},h="",v="__about_~_blank__",w=new ParsedURL(a),y=w.origin,b={new_popup:!0,tab_id:t,cid:n.safeview.pairing_dict.cid,safe_rid:n.safeview.pairing_dict.safe_rid};if(n.safeview.pairing_dict.cluster_id&&(b.cluster_id=n.safeview.pairing_dict.cluster_id),l)try{g=JSON.parse(l)}catch(e){reportErrorClientEvent("tc-tab-invalid-features-json",{features_json:l})}for(_=0;_<r.length;_+=1)void 0!==g[u=r[_]]&&(h&&(h+=","),h+=u+"="+g[u]);"about:blank"!==a&&"about:blank#blocked"!==a||(e.pairing_dict.mpa_id&&(v="mpa/"+e.pairing_dict.mpa_id+"/"+v),a=TPROXY_ENABLED?window.location.origin+"/"+v:v,y="about:blank"),"doc"!==w.hostname&&"viewer.documentisolation"!==w.hostname||(y="safedocs",a=w.href.split(w.host).join("doc")),m={user_initiated:!s,uri:a,uri_origin:y,target_uri:d?a:Util.rewriteRawHref(a),feature_str:h,pairing_dict:b},i.length,""!==h&&m.user_initiated&&0!==i.length&&p(),m.user_initiated?o.unshift(m):o.push(m),c&&f()})),e.interp.registerOpcodeHandler("TAB_init",(function(t){var n,r="__about_~_blank__",i=new ParsedURL(t),a=i.origin;"about:blank"!==t&&"about:blank#blocked"!==t||(e.pairing_dict.mpa_id&&(r="mpa/"+e.pairing_dict.mpa_id+"/"+r),t=TPROXY_ENABLED?window.location.origin+"/"+r:r,a="about:blank"),"doc"!==i.hostname&&"viewer.documentisolation"!==i.hostname||(a="safedocs",t=i.href.split(i.host).join("doc")),(n={user_initiated:!0,uri:t,uri_origin:a,target_uri:Util.rewriteRawHref(t)}).user_initiated?o.unshift(n):o.push(n),c&&f()})),e.interp.registerOpcodeHandler("TAB_close",(function(e,t,n){m(t,!1,n)})),e.interp.registerOpcodeHandler("TAB_denied",p),e.interp.registerOpcodeHandler("WINDOW_new",(function(e){reportErrorClientEvent("tc-interp-unknown-opcode",{opcode:"WINDOW_new",url:e})})),e.callback.register("dom-reset",(function(){c=!0,f()})),e.callback.register("remoting-v2-activated",(function(){c=!0})),setInterval((function(){var t;for(t=0;t<l.length;t+=1)try{l[t].window.closed&&(e.surrogate_channel.send("tab_close",l[t].tab_id),l.splice(t,1),t-=1)}catch(e){l.splice(t,1),t-=1}}),400)}function WebSocketTester(e,t,n,r){var i,o,a,s,l=new Logger("ws-tester",{level:"info"}),c=__randstr(16),d=!1,u=!1;function _(r,i,a){var l=(new Date).getTime()-s;u||(r||n&&n("websock-test",{subtype:"failure",request_url:e,reason:i,detail:a,elapsed_ms:l}),o&&(clearTimeout(o),o=null),u=!0,t(r))}this.start=function(){o=setTimeout((function(){try{a&&(a.close(),a=null)}catch(e){l.info({event:"tc-websock-tester-timeout-exception"})}_(!1,"test timed out")}),r),function(){s=(new Date).getTime(),a=null;try{a=Util.safeCreateWebSocket(e,!0)}catch(e){_(!1,"open exception",e.name+": "+e.message)}a?(a.onopen=function(){a.send(c)},a.onmessage=function(e){d=!0,i=e.data===c,a.close()},a.onclose=function(e){e.code,d?i?_(!0):_(!1,"bad response"):_(!1,"close before response",Util.wsCloseDiags(e))},a.onerror=function(e){l.info({event:"tc-websock-tester-connect-error",details:"Is server reachable via WebSockets?"}),_(!1,"websocket error",Util.wsCloseDiags(e))}):_(!1,"open failed")}()}}function ChannelException(e){this.message=e}function LatencyDetector(e,t){var n=0,r=null,i=[];function o(){var r,o;assert(t),o=Date.now(),r=i.length?o-i[0][1]>e+5e3?2:o-i[0][1]>e?1:0:0,n!==r&&t(r),n=r}this.update_msg_seq=function(e){var t=[e,Date.now()];i.push(t)},this.shutdown=function(){clearInterval(r),r=null,safeview.interp.deregisterOpcodeHandler(safeview.interp.OPCODES.CHANNEL_ACK)},safeview.interp.registerOpcodeHandler(safeview.interp.OPCODES.CHANNEL_ACK,(function(e,t){!function(e){if(i.length)if(i[0][0]>e)reportWarnClientEvent("tc-channel-ack-error",{reason:"ack on old seq number",ack_seq:e,expected_ack_seq:i[0][0],pending_ack_length:i.length});else{if(i[0][0]<e)for(;i.length&&i[0][0]<e;)i.shift();i.shift(),o()}else reportWarnClientEvent("tc-channel-ack-error",{reason:"No pending ack",ack_seq:e})}(t)})),r=setInterval((function(){o()}),1e3)}function Channel(e,t){var n,r,i=this,o=safeview.perf.pull_timeout_ms,a=safeview.perf.push_timeout_ms,s=safeview.perf.pong_timeout_ms,l=safeview.perf.high_rtt_threshold_ms,c=0,d=12e3,u=safeview.perf.latency_notif_threshold_ms,_=null,f=null,p=[],m=[],g=null,h=null,v=null,w=null,y=!1,b=!0,E="pending",A="connected",U="dead",S=E,C=!1,N=!1,k=!1,O=!1,T=!1,x=null,D=null,L=__randstr(16),I=!1,B=0,P=0,R=0,F=void 0===t.max_retries?3:t.max_retries,M=0,V=null,H=null,W=new Logger("channel",{level:"info",header:function(){return{name:e,id:L,status:S,websockets_active:!!h}}});if(void 0===o||void 0===a||void 0===s||void 0===l||o<=d)throw new Error("Invalid parameters for Channel object.");function X(e,t,n){var r="";return assert(e),(n=n||{}).chid=L,n.msg_nr=B,t&&(r+=t),r+="/"+e+"?"+Util.buildQueryStr(n)}function j(e,n,r){var i=X(e,n,r);return t.url_builder?t.url_builder(i):"https://"+location.hostname+i}function Y(e,n,r){var i=X(e,n,r);return t.url_builder?t.url_builder(i,!0):"wss://"+location.hostname+i}function q(e){var t=e.slice(0);return t.unshift((assert((g+=1)>=0),g)),t}function z(e){var t;t=safeview.stats.agg_get("t_tc_ping"),Object.keys(t).length>0&&(t.mode=e,reportClientEvent("tc-ping-stats",{ping:t,tclevel:"tc-ping-stats"},!1,!0))}function K(){c=0,d=12e3}function G(){c=3e3,d=0}function J(e,n){if(S!==U)switch(S=e,t.silent_reconnect||Util.hide_message_bar(),e){case E:break;case A:t.on_connect&&t.on_connect(i,b),b=!1,fe();break;case U:t.on_disconnect&&t.on_disconnect(n);break;default:assert(0,"invalid status "+e)}else assert(!1,"cannot move from STATUS.DEAD")}function Q(){return S===A}function Z(){return S===U}function $(e){e&&e.abort()}function ee(){$(f),$(_),_=f=null}function te(){I=!0}function ne(){h&&h.pong_deadline_timer&&(clearTimeout(h.pong_deadline_timer),h.pong_deadline_timer=null)}function re(){v&&(clearTimeout(v),v=null)}function ie(){h&&(h&&h.ping_timer&&(clearTimeout(h.ping_timer),h.ping_timer=null),ne(),re(),w&&(clearTimeout(w),w=null),h.close(),h=null)}function oe(){x&&(safeview&&safeview.callback.deregister(x),x=null),D&&(safeview&&safeview.callback.deregister(D),D=null),ee(),ie(),safeview.callback.register("safeview-exit",te)}function ae(n,r){var i=r||{};S!==U&&(i.reason=n,function(n,r){t.on_report&&(r.chname=e,r.chid=L,r.chstat=S,r.ws=!!h,t.on_report(n,r))}("tc-channel-died",i),J(U,n),oe(),V&&V.shutdown())}function se(e){safeview.cof.call(["setWSSupportState",e])}function le(e,t){var r=(new Date).getTime()-n;reportWarnClientEvent(safeview.perf.allow_xhr_polling?"tc-channel-fallback":"tc-channel-no-fallback",{reason:e,elapsed_ms:r,detail:t,chid:L,chstat:S,nr_msgs_received:B,ws_retry_count:P}),se("ERR"),O=!0,safeview.perf.allow_xhr_polling?(ie(),Z()||(J(E),pe())):ae("no-fallback-to-xhr")}function ce(e){h.ping_timer=setTimeout((function(){var e=s;N?(N=!1,e=0):(M=Util.now(),h.send(JSON.stringify({ping:{ping_time:M}}))),h.pong_deadline_timer||(h.pong_deadline_timer=setTimeout((function(){le("ping timeout")}),e)),ce(12e3)}),e)}function de(n,r,i){var o=Y("websocket",t.service_prefix,t.query_params);if(n)return!1;if(!(h=Util.safeCreateWebSocket(o,!1)))return!1;return h.binaryType="arraybuffer",h.onopen=function(){h&&ce(0)},EventListener.addListener(h,"message",(function(n){var a=n.data,s="string"==typeof a&&a.startsWith("pong");safeview.stats.add("c_tc"+(e?e.charAt(0):"")+"db",a.length),i&&(a="session_not_found",se("OK")),a&&"session_not_found"!==a?"session_found"===a?(J(A),r||(re(),safeview.perf.ws_reconnect_timeout_ms&&(w=setTimeout((function(){W.info({event:"tc-channel-websock-reconnect",timeout_secs:safeview.perf.ws_reconnect_timeout_ms/1e3}),w=null,y=!0,h.close()}),safeview.perf.ws_reconnect_timeout_ms)))):(!function(e,t){var n,r;ne(),e&&(n=t.length>4?Number(t.substr(4)):M,(r=Util.now()-n)>=0&&(safeview.stats.agg("t_tc_ping",r),z("websockets")),r>l&&reportWarnClientEvent("tc-channel-ws-high-rtt",{rtt_ms:r,threshold_ms:l}))}(s,a),t.on_recv&&!s&&(B+=1,t.on_recv(a))):ae("session-not-found",{subtype:"session-not-found",context:"ws.onmessage",request_url:o})}),!1),h.onclose=function(e){if(!O){var t=1001===e.code||I,n=-1===[1e3,1001,1005].indexOf(e.code)&&!Z()||y||safeview.exit_handler.isLocalAppOpening();e.code,n?y||P<F?(reportClientEvent("tc-channel-websock-retry",{c_code:e.code,reason:y?"reconnect":"error",retry_count:P,tclevel:y?"tc-info":"tc-warn",max_retries:F},!0,!0),y?y=!1:P+=1,ie(),J(E),de()):le("too many retries",Util.wsCloseDiags(e)):ae(t?"client-close":"websocket-close",{subtype:"websocket_closed",close_event_code:e.code,request_url:o})}},h.onerror=function(e){reportWarnClientEvent("tc-channel-websock-error",{})},v=setTimeout((function(){v=null,le("session_found timeout")}),safeview.perf.ws_session_found_timeout_ms),!0}function ue(t,n,r,i,o){var a={subtype:"push_pull_failure",service_prefix:r,status:n,xhr_status:t.status,request_url:i};if(Z())return t.status,void t.statusText;switch(n){case"parsererror":case"timeout":case"abort":case"error":R<F&&!I&&!Z()?(reportWarnClientEvent("tc-channel-long-poll-retry",{is_pull:o,retry_count:R,report_dict:a}),R+=1,o?_e(e):fe()):ae(I?"client-close":"network-error",a);break;default:ae("server-error",a)}}function _e(e){var n,r,i=null;Z()||(safeview.stats.inc("c_tc"+(e?e.charAt(0):"")+"p"),(i=t.query_params||{}).tms=Q()?d:0,n=j("p",t.service_prefix,i),safeview.stats.start("t_tc"+(e?e.charAt(0):"")+"pw"),(_=new XMLHttpRequest).open("POST",n),_.responseType="arraybuffer",_.timeout=o,_.withCredentials=!0,_.onload=function(n){var i,o;200===_.status?(null!==(o=_.getResponseHeader("X-Backend-Delay"))&&(i=Util.now()-r-Number(o))>=0&&(safeview.stats.agg("t_tc_ping",i),z("polling")),safeview.stats.stop("t_tc"+(e?e.charAt(0):"")+"pw"),R=0,Z()||(Q()||(assert(S===E),J(A)),_.response&&safeview.stats.add("c_tc"+(e?e.charAt(0):"")+"db",_.response.byteLength),B+=1,setTimeout((function(){_e(e)}),c),setTimeout((function(e){t.on_recv(e.response)}),0,_))):_.onerror(n)},_.onerror=function(r){var i={};safeview.stats.stop("t_tc"+(e?e.charAt(0):"")+"pw"),!_.aborted||k?(k=!1,i.status=_.status,i.textStatus=_.timedout?"timeout":_.aborted?"abort":"error",ue(i,i.textStatus,t.service_prefix,n,!0)):_e(e)},_.ontimeout=function(e){_.timedout=!0,_.onerror(e)},_.onabort=function(e){_.aborted=!0,_.onerror(e)},r=Util.now(),_.send())}function fe(){var e,n;Q()&&0!==p.length&&(T||(h?(n=q(p),e=JSON.stringify(n),h.send(e),V&&V.update_msg_seq(n[0]),p=[]):function(){var e,n=j("push",t.service_prefix,t.query_params);m.length?(W.warn({event:"tc-channel-push-xhr-retry",payload_size:JSON.stringify(m).length}),e=m):(e=q(p),p=[]),assert(e.length),C&&(C=!1,k=!0,n="BROKEN"),T=!0,f=t.ajax({url:n,dataType:"json",data:JSON.stringify(e),timeout:a,success:function(){T=!1,m=[],fe()},error:function(e,r){T=!1,ue(e,r||"error",t.service_prefix,n,!1)}}),V&&V.update_msg_seq(e[0]),m=e}()))}function pe(){ee(),_e(e)}i.delay_once=function(e){H&&clearTimeout(H),H=setTimeout((function(){Q()&&fe(),H=null}),e)},i.send=function(e){var t=Q(),n=Z(),r=argumentsToArray(arguments);JSON.stringify(r),n||(p.push([e].concat(r.slice(1))),t&&!H&&fe())},i.injectError=function(e){if(reportWarnClientEvent("tc-channel-inject-error",{kind:e}),h)"websock-close"===e?h.close(4999):"network-unplugged-1"===e&&(N=!0);else if("pull-error"===e){var t=_;t&&(reportWarnClientEvent("tc-channel-abort"),k=!0,t.abort())}else"push-error"===e&&(C=!0)},i.setRetryCount=function(e){P=e,R=e},i.close=function(e){ae(e||"client-close")},i.isPolling=function(){return null===h},i.getWSExtensions=function(){return null===h?void 0:h.extensions},i.isMixedMode=function(){return!(!(!!window.WebSocket||!!window.MozWebSocket)||!t.use_websockets)},i.isLongPolling=function(){return i.isPolling()&&0===c},safeview.callback.register("safeview-exit",te),function(){if(!t.ajax)throw new ChannelException("must specify a jQuery-like AJAX implementation")}(),x=safeview.callback.register("window-became-active",K,!0),D=safeview.callback.register("window-became-passive",G,!0),g=-1,u&&(V=new LatencyDetector(u,t.on_latency_change)),safeview.perf.allow_xhr_polling?t.use_websockets?(r=function(e){e?("OK"===e.state?(n=(new Date).getTime(),de(e.inject_open_error,e.inject_response_error,e.inject_session_not_found_error)||se("ERR")):(new Date).getTime()-e.time>safeview.perf.ws_backoff_period_ms&&new WebSocketTester(Y("wsecho",t.service_prefix,t.query_params),(function(e){e?se("OK"):(se("ERR"),W.info({event:"tc-channel-websock-test-failed",detail:"WebSockets background test failed."}))}),t.on_report,safeview.perf.ws_test_timeout_ms).start(),h||pe()):pe()},safeview.cof.call(["getWSSupportState",safeview.perf.ws_assume_working],r)):pe():de()||(se("ERR"),ae("websock-startup-failed-and-no-xhr"))}function Interpreter(e){this.OPCODES={ADD_ELEMENT:1,ADD_CHARACTER_DATA:2,MODIFY_PROP_VALUE:3,MODIFY_ATTR_VALUE:4,REMOVE_ELEMENT:5,MODIFY_CHARACTER_DATA:6,ADD_SVG_ELEMENT:7,ADD_NS_ELEMENT:8,CHANNEL_ACK:9,FOCUS_ELEMENT:10,BLUR_ELEMENT:11,SCROLL_ELEMENT:12,FULLSCREEN_CHANGE:13,MEDIA_BLOB:14,MEDIA_UPDATE:15,MEDIA_NEW_NODE:16,ADD_DOCUMENT:17,SET_SELECTIONS:18,LOADED:19,SCROLL_CONTROL:21,DESIGN_MODE:22,READONLY_STATUS_CHANGED:23,MEDIA_REMOVE_NODE:24,REMOTING_V2_SET_SELECTIONS:25,REMOTING_V2_FOCUS_ELEMENT:26,REMOTING_V2_FOCUS_OUT:27,REMOTING_V2_CARET_POS:28,REMOTING_V2_INPUT_VALUE:29,REMOTING_V2_INPUTS_UPDATE:30,RESYNC_PREPARE:31,RESYNC_COMPLETE:32,EDITOR_SEQ_ACK:33,ADD_CUES:34,TEXT_TRACK_MODE:35,MEDIA_ATTEMPT_PLAY:36,CONTENT_LOADED:37,REMOTING_V2_SET_READONLY_EXCEPTION:101,WEB_AUDIO_SOURCE_NODE:501,WEB_AUDIO_DATA:502,WEB_AUDIO_STATE_CHANGE:503,WEB_AUDIO_HTTP_STREAM:504,CSS_INSERT_RULE:511,CSS_DELETE_RULE:512,CSS_OVERWRITE_RULES:513,CONSTR_CSS_CREATE:514,CONSTR_CSS_DISPOSE:515,CONSTR_CSS_REPLACE_TEXT:516,CONSTR_CSS_ADOPT_STYLE_SHEETS:517,DEFINE_CUSTOM_ELEM:521,ANIMATION_CREATE:531,ANIMATION_PLAY:532,ANIMATION_PAUSE:533,ANIMATION_FINISH:534,ANIMATION_CANCEL:535,DIALOG_SHOW:551,DIALOG_SHOW_MODAL:552,DIALOG_CLOSE:553};var t,n=new Logger("interpreter",{level:"info"}),r={},i=this,o=!1;function a(e,t){assert(e),r[e]&&n.error({event:"tc-opcode-already-registered",opcode:e}),r[e]=t}function s(e,t){var n,r=Util.getFramingStatus();if(e&&r&&(2!==e||2!==r))throw reportWarnClientEvent("tc-blocked-framing",{restriction:e,fs:r}),window.setTimeout(Util.show_message_bar,0,"Disallowed framing"),(n=new Error("Disallowed framing")).name="shutdown-tc",n}function l(t){var i=t[0],o=r[i];if(e.stats.inc("c_tic"),!o)return n.warn({e:"unknown-opcode",opcode:i}),!0;try{o.apply(this,t.slice(1))}catch(t){if("shutdown-tc"===t.name)return e.finish(),!1;if("notfounderror"===t.toString().toLowerCase().trim())return n.info({event:"tc-interp-element-not-found-error",error:t.toString(),stacktrace:printStackTrace(t)}),!0;if(!(t instanceof SoftAssertException))throw t}return!0}t=function(e,t){return reportWarnClientEvent("tc-unhandled-binary-message"),!0},a("screenshot",(function(t,n){i.surrogate_screenshot=t,e.callback.fire("got-screenshot",t,n)})),a("bounding_rect",(function(e,t){i.bounding_rect=t})),a("site_caps",(function(t){t.disable_local_echo&&(local_echo_enabled=!1),t.disable_local_echo_ext&&local_echo_config&&(local_echo_config.extended=!1),t.disable_preopen_tab&&(e.pairing_dict.client_caps.preopen_tab=!1),t.hasOwnProperty("print_enabled")&&e.print_handler.setPrintEnabled(t.print_enabled),t.hasOwnProperty("framing_restriction")&&s.apply(this,t.framing_restirction),t.hasOwnProperty("key_ctrl_wait")&&e.key_ctrl.set_wait_for_key_ctrl(t.key_ctrl_wait)})),a("window_print",(function t(n,r,i,a){var s=getWindowByFid(n),l=Util.getDocIdIfSafedocs();e.print_handler.setPrintEnabled(r),i&&e.callback.fire("print-block-running"),l?e.print_handler.handlePrint():r?(e.print_handler.setPrintFid(n),e.ui_frame.call("showPrintOptions",i)):a>0?setTimeout((function(){s.print(),i&&e.surrogate_channel.send("unblock-print",e.fid)}),1e3*a):o?i?(s.print(),e.surrogate_channel.send("unblock-print",e.fid)):s.print():setTimeout((function(){t(n,r,i,a)}),50)})),e.callback.register("dom-loaded",(function(){o=!0})),a("visible_tree",(function(e){i.surrogate_visible_tree=e,console.log("Received surrogate tree.")})),a("disconnect",(function(t){e.finish(),Util.show_message_bar(t)})),a("clear_media_nodes",(function(t){e.media_objects.deleteMediaNodes(t)})),i.registerOpcodeHandler=a,i.deregisterOpcodeHandler=function(e){delete r[e]},i.hasOpcodeHandler=function(e){return!!r[e]},i.processOneCommand=function(n,i){var o,a,s,c,d=!0;if(n!==MSG_KIND_DATA&&n!==MSG_KIND_CONTROL)return t(n,i);if("rfc"===(c=i[0]))return setFrameFidForNode(o=i[1],i[2],i[3]),e.useRemotingV2()||e.callback.fire("frame-attached"),!0;if(!r.hasOwnProperty(c)&&"fupd"!==c)return reportWarnClientEvent("tc-interp-unknown-opcode",{opcode:c}),!0;if("set_doctype"===c){o=i[1];try{d=getWindowByFid(o)!==mf.window}catch(e){e.toString()}d&&e.update_queue.discard(o)}if("fupd"===c){for(e.text_monitor.pause_all(),e.lecho_regulator_ext.disable_ie_textinput_evt(),o=i[1],a=2;a<i.length;a+=1)if(s=i[a],e.frameset_wrapper&&(o=e.frameset_wrapper.map_fid_if_necessary(o)),s.splice(1,0,o),!l(s))return e.text_monitor.resume_all(),e.lecho_regulator_ext.enable_ie_textinput_evt(),!1;return e.text_monitor.resume_all(),e.lecho_regulator_ext.enable_ie_textinput_evt(),!0}return l(i)},i.registerBinaryHandler=function(e){t=e},this.surrogate_screenshot=null,this.surrogate_visible_tree=null,this.bounding_rect=null}function FeedbackBar(e,t,n){var r,i=this,o=t.document,a=100,s=new Logger("feedback-bar",{level:"info"}),l={enable_feedback:!1,enable_bypass:!1,enable_logo:!1,enable_flash:!1,indicate_readonly:!1},c=0,d="__safly_actions",u="__safly_icon",_="__safly_icon_container",f="__safly_web_readonly_mode",p="__safly_feedback_css_link",m="__safly_bypass",g="__safly_feedback_arrow_down",h="__safly_custom_link",v="__safly_isolation_text",w=!1,y=!1,b=!1,E="",A="",U="notification_customization",S=e.url_builder.buildAssetURL("/safeview-static/css/feedback.css"),C=e.url_builder.buildAssetURL("/safeview-static/images/menlo-icon.png");function N(e){if(e&&e.token&&e.domain){var t="https:"===new ParsedURL(Util.getRawPageUrl()).protocol,n=new Date(Date.now()+12e5);e.token,e.domain,Util.setCookie("_sc_bypass",e.token,n,"/",e.domain,t),Util.xframe_reload()}else s.info({event:"tc-feedback-no-bypass",details:"No bypass token or domain found in server response."})}function k(e,n){o.body?e():n>=4e3?(o.documentElement.insertBefore(o.createElement("body"),null),o.body.__sv_saved_for_feedback=!0,e()):(n+=200,t.setTimeout((function(){k(e,n)}),200))}function O(){assert(!o.head);var e=o.createElement("head");assert(o.body),assert(o.documentElement),e.__sv_saved_for_feedback=!0,o.documentElement.insertBefore(e,o.body)}function T(){var r,a,s,w,y,E,A,U,N=o.getElementById(d),k=o.getElementById(p);e.text_monitor.pause_all(),b=!0,o.head||O(),E=new UX(e,o),BrowserDetect.isMobile()&&"wide"===E.getIndicatorType(e.feedback_bar_customizations)&&(e.feedback_bar_customizations.content.indicator_type="regular"),a=(e.feedback_bar_customizations.isolate_indicator||{}).display_text||!1,s=(e.feedback_bar_customizations.custom_link||{}).show_link||!1,w=E.getIndicatorType(e.feedback_bar_customizations),y=a&&!l.indicate_readonly&&"wide"===w,k||(assert(o.head),(k=o.head.querySelector("[href='"+S+"']"))||((k=o.createElement("link")).type="text/css",k.rel="stylesheet",k.href=S,o.head.appendChild(k)),k.id||k.setAttribute("id",p)),N||((N=o.createElement("div")).setAttribute("id",d),N.classList.add(d),""!==(U=e.localization.get("ID_LOCALIZATION_CLASS"))&&N.classList.add(U),N.setAttribute("style","display:none"),o.body.appendChild(N),(r=o.createElement("div")).setAttribute("id",_),r.classList.add(_),N.appendChild(r),(A=o.createElement("img")).setAttribute("id",u),A.setAttribute("src",C),A.classList.add(u),r.appendChild(A),(A=o.createElement("div")).setAttribute("id",g),A.classList.add("__safly_arrow_down"),N.appendChild(A),A.addEventListener("click",(function(){N.style.setProperty("bottom","-40px","important"),e.pairing_dict.client_caps&&!e.pairing_dict.client_caps.no_feedback_bar_springback?t.setTimeout((function(){N.style.setProperty("bottom","0px","important")}),5e3):N.addEventListener("transitionend",(function e(){N.style.setProperty("display","none"),N.removeEventListener("transitionend",e)}))}))),l.indicate_readonly&&!o.getElementById(f)?((A=o.createElement("div")).setAttribute("id",f),A.classList.add(f),A.textContent=n&&!BrowserDetect.isMobile()?e.localization.get("ID_TC_WEB_READONLY"):e.localization.get("ID_TC_WEB_READONLY_SHORT"),A.setAttribute("data-tooltip",e.localization.get("ID_TC_WEB_READONLY_TOOLTIP")),N.insertBefore(A,o.getElementById(_).nextSibling),c+=1):!l.indicate_readonly&&o.getElementById(f)&&(N.removeChild(o.getElementById(f)),c-=1),l.enable_bypass&&!o.getElementById(m)?((A=o.createElement("a")).setAttribute("id",m),A.setAttribute("href","#"),A.classList.add(m),A.textContent=e.localization.get("ID_TC_BYPASS"),A.setAttribute("data-tooltip",e.localization.get("ID_TC_BYPASS_TOOLTIP")),A.addEventListener("click",i.onBypassClick),N.insertBefore(A,o.getElementById(g)),c+=1):!l.enable_bypass&&o.getElementById(m)&&(N.removeChild(o.getElementById(m)),c-=1),s&&!o.getElementById(h)?((A=o.createElement("a")).setAttribute("id",h),A.setAttribute("href","#"),A.setAttribute("target","_blank"),N.insertBefore(A,o.getElementById(g)),c+=1):!s&&o.getElementById(h)&&(N.removeChild(o.getElementById(h)),c-=1),y&&!o.getElementById(v)?((A=o.createElement("div")).setAttribute("id",v),N.insertBefore(A,o.getElementById(_).nextSibling),c+=1):!y&&o.getElementById(v)&&(N.removeChild(o.getEdddlementById(v)),c-=1),c<=1?N.classList.add("__safly_single_action"):N.classList.remove("__safly_single_action"),A=o.getElementById(_),l.enable_feedback||l.enable_bypass||!l.enable_logo?A.classList.remove("__safly_isolation_logo"):(A.classList.add("__safly_isolation_logo"),A.setAttribute("data-tooltip",e.localization.get("ID_TC_ISOLATE_TOOLTIP"))),E.customizeFeedbackBar(e.feedback_bar_customizations,d,f,m,u,h,v,_,n),BrowserDetect.isMobile()&&!l.indicate_readonly||e.template.has("custom-indicator-template")||(N.style.display="block",N.style.setProperty("bottom","0px","important")),e.text_monitor.resume_all()}function x(){o.head||O(),b?T():head.load([S],T),l.enable_bypass&&e.readonly&&e.readonly.showBypassSecurity()}function D(){var e=o.getElementById(d);e&&e.parentNode.removeChild(e)}function L(){var e=Util.getRawPageUrl(),t=new ParsedURL(e);!(l.enable_feedback||l.enable_bypass||l.enable_logo||l.indicate_readonly)||e&&"docs.menlosecurity.com"===t.hostname?D():!Util.is_in_iframe()||l.indicate_readonly?k(x,0):D()}function I(){void 0!==e.feedback_bar_policy&&void 0!==r&&(Object.keys(e.feedback_bar_policy).forEach((function(t){l.hasOwnProperty(t)&&(e.feedback_bar_policy[t],l[t]=e.feedback_bar_policy[t])})),l.indicate_readonly=r,r||!n?(l.enable_feedback=!1,l.enable_bypass=!1,l.enable_logo=!1):E&&TPROXY_ENABLED&&(l.enable_bypass=!0),L())}function B(t){e.feedback_bar_policy=t,e.feedback_bar_customizations=(t.notification_customization||{}).default||{},delete e.feedback_bar_policy.notification_customization,I()}function P(){e.feedback_bar_policy?I():--a>0&&t.setTimeout(P,100)}i.onBypassClick=function(){return E?TPROXY_ENABLED&&N({token:E,domain:A}):e.policy.setAction("bypass",null,null,{},N),!1},i.removeFeedbackBar=D,i.getBypassPolicy=function(){return l.enable_bypass},i.updateReadonlyUI=function(){r=!e.readonly.isShowingReadonlyBanner()&&w&&(n||!y&&t.innerWidth>=200&&t.innerHeight>=200),t.innerWidth<200&&t.innerHeight<200?D():I()},i.setReadonlyUI=function(e,t){w=e,y=t,i.updateReadonlyUI()},i.feedbackElementIDs=function(){return[d,p]},n&&(e.interp.registerOpcodeHandler("bypass_token",(function(e,t){E=e,A=t,I()})),e.callback.register("enable_readonly_bar",i.setReadonlyUI)),t.setTimeout((function(){var t;n?(t=["enable_feedback","enable_bypass","enable_logo",U],e.policy.getValues(t,B)):P()}),2e3)}function AlertSupport(e){function t(){return new ParsedURL(Util.getRawPageUrl()).hostname}this.dismissAlert=function(){e.surrogate_channel.send("alert-dismiss")},this.dismissConfirm=function(t){e.surrogate_channel.send("confirm-dismiss",t)},this.dismissPrompt=function(t,n){e.surrogate_channel.send("prompt-dismiss",t,n)},this.dismissHttpAuthChallenge=function(t,n,r){e.surrogate_channel.send("httpauth-challenge-dismiss",t,n,r)},this.dismissInvalidCert=function(t,n,r){t?e.surrogate_channel.send("accept-cert",n,r):window.history.back()},e.interp.registerOpcodeHandler("alert_show",(function(n){e.ui_frame.call("showAlert",n,t())})),e.interp.registerOpcodeHandler("confirm_show",(function(n){e.ui_frame.call("showConfirm",n,t())})),e.interp.registerOpcodeHandler("prompt_show",(function(n,r,i){e.ui_frame.call("showPrompt",n,t(),r,i)})),e.interp.registerOpcodeHandler("httpauth_challenge_show",(function(t,n,r,i){var o=__startswith(n.toLowerCase(),"https://")?"":e.localization.get("ID_TC_HTTPAUTH_WARNING_MSG",t);e.ui_frame.call("showHttpAuthChallenge",e.localization.get("ID_TC_HTTPAUTH_CHALLENGE_MSG",n,r),o,i)})),e.interp.registerOpcodeHandler("invalid_certificate",(function(t,n,r,i,o,a){a?Util.locationSet(window,a):e.ui_frame.call("showInvalidCert",t,n,r,i,o)})),e.interp.registerOpcodeHandler("tab_limit",(function(t){e.ui_frame.call("showTabLimit",!0)})),e.interp.registerOpcodeHandler("password_input_on_http",(function(){}))}function UIFrame(e){var t=this,n=null,r="safeview-ui-frame",i=0,o=[];function a(){return document.getElementById(r)}function s(t,n){var r;if("none"===window.getComputedStyle(document.body).display)switch(t){case"showAlert":return window.alert(n[0]),e.surrogate_channel.send("alert-dismiss"),!0;case"showConfirm":return r=window.confirm(n[0]),e.surrogate_channel.send("confirm-dismiss",r),!0;case"showPrompt":return(r=window.prompt(n[0],n[2]))?e.surrogate_channel.send("prompt-dismiss",!0,r):e.surrogate_channel.send("prompt-dismiss",!1,""),!0}return!1}this.load=function(i){var o;!function(t){var r=e.url_builder.buildProtocolUrl("/safeview-template/ui.html?o="+window.location.origin+"&h="+e.pairing_dict.ui_frame_hash);assert(t),n?t(n):e.serverCall({op_name:"ui_html",type:"GET",url:r,no_tracking_label:!0,success:function(e,n){t(e)},error:function(){reportErrorClientEvent("tc-ui-frame-fetch-failed")}})}((function(n){o=function(n){assert(t);var i,o,s=a();return s||((s=document.createElement("iframe")).id=r,s.frameborder="0",s.border="0",s.src="about:blank",s.style.position="fixed",s.scrolling="no",s.allowtransparency="true",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.overflow="visible !important",s.style.border="0",s.style.display="none",s.style.visibility="visible",s.style.zIndex="2147483647",s.style.pointerEvents="auto",(i=document.getElementsByTagName("html")[0])||(document.write("<!DOCTYPE html><html></html>"),document.close(),assert(i=document.getElementsByTagName("html")[0])),(o=document.body)||(o=document.createElement("body"),i.appendChild(o)),e.text_monitor.pause_all(),o.appendChild(s),e.text_monitor.resume_all(),s.contentDocument.write(n),s.contentDocument.close()),s.onload=function(){var e,t=s.contentDocument,n=t.getElementById("custom-logo-data-url").getAttribute("content"),r=t.getElementsByClassName("custom-logo");for(e=0;e<r.length;++e)r[e].setAttribute("src",n)},s}(n),assert(o),i&&(o&&o.contentWindow&&o.contentWindow.is_frame_loaded?i(o):setTimeout((function(){t.load(i)}),100))}))},this.callInFrame=function(e){var n=a(),r=e.toString(),i=n.contentWindow[r];assert(i),s(r,argumentsToArray(arguments).slice(1))||(n.style.display="block",t.savedFocus=document.activeElement,i.apply(n.contentWindow,argumentsToArray(arguments).slice(1)))},this.call=function(){var e=this,n=arguments,r={};2!==i?(o.push({saved_this:e,saved_args:n}),0===i&&(i=1,t.load((function(){for(i=2;o.length;)r=o.shift(),t.callInFrame.apply(r.saved_this,r.saved_args)})))):t.callInFrame.apply(e,n)},this.hide=function(){var e=a();t.isMultiDialogOpened()||(e&&(e.style.display="none",e.blur(),t.savedFocus?(t.savedFocus.id,document.activeElement&&document.activeElement!==t.savedFocus&&document.activeElement.blur(),BrowserDetect.isEdge()&&window.focus(),t.savedFocus.focus()):document.body.focus()),document.activeElement.id)},this.active=function(){var e=a();return e&&"none"!==e.style.display},this.findParentDialogModal=function(e){for(;e;)if((e=e.parentElement)&&"dialog"===e.tagName)return e;return e},this.isMultiDialogOpened=function(){var e,t,n=0;if(2!==i)return!1;for(e=a().contentDocument.getElementsByTagName("dialog"),t=0;t<e.length;t++)if(e[t].open&&(n+=1),n>1)return!0;return!1},t.reload=function(){var e=a();e&&e.parentNode.removeChild(e),n=null,i=0,t.load()}}function ContextMenu(e){var t,n,r,i,o,a,s=this,l=[],c=e.url_builder.buildAssetURL("/safeview-static/css/context-menu.css"),d="__safly_contextmenu_css_link",u=null,_=["click","mousedown","contextmenu","keydown"],f="menlo-context-disabled",p="menlo-context-menu",m="data-menlo-menu-item-index";function g(t){var n,r,i;if(t){for(e.copy_paste_ctrl.has_paste_restriction()&&Util.filterPasteDataList(t),i=0;i<t.length;i+=2)if(n=t[i],r=t[i+1],n&&r&&e.copy_paste_ctrl.enforce_on_cb_api_data("paste",n,r))return;e.surrogate_channel.send("paste",0,0,t,!1,!1)}else e.ui_frame.call("showCopyPasteModal",BrowserDetect.isMac())}function h(t,n){switch(t){case"undo":case"redo":return function(){e.surrogate_channel.send("execcmd",n.fid,t)};case"select_all":return function(){e.surrogate_channel.send("execcmd",n.fid,"selectAll")};case"copy":case"cut":return function(){e.copy_paste_ctrl.enforce_on_cb_api_data(t)||e.surrogate_channel.send("execcmd",n.fid,t)};case"paste":return function(){a?a.requestData(g):e.ui_frame.call("showCopyPasteModal",BrowserDetect.isMac())};case"back":case"forward":case"reload":return function(){"forward"===t?window.history.forward():"back"===t?window.history.back():"reload"===t&&e.reload(0)};case"link_open_new_tab":case"link_open_new_window":case"link_copy_address":return function(){var r,i,o=n.link_url;!TPROXY_ENABLED&&e.pairing_dict.mpa_id&&(o="mpa/"+e.pairing_dict.mpa_id+"/"+o),TPROXY_ENABLED||e.pairing_dict.prepend_client_navs||(o=e.url_builder.getServiceDomain()+"/"+o),"link_copy_address"===t?e.ui_frame.call("showCopyLinkModal",{link:o}):"link_open_new_tab"===t?Util.windowOpen(o,"_blank"):"link_open_new_window"===t&&(BrowserDetect.isIE()?Util.windowOpen(o,"_blank"):(r=new window.MouseEvent("click",{bubbles:!0,shiftKey:!0,button:0}),(i=document.createElement("a")).setAttribute("href",o),i.setAttribute("target","_blank"),i.dispatchEvent(r)))};case"image_open_new_window":case"image_copy_address":return function(){var r=n.src_url;!TPROXY_ENABLED&&e.pairing_dict.mpa_id&&(r="mpa/"+e.pairing_dict.mpa_id+"/"+r),TPROXY_ENABLED||(r=e.url_builder.getServiceDomain()+"/"+r),"image_open_new_window"===t?Util.windowOpen(r,"_blank"):e.ui_frame.call("showCopyLinkModal",{link:r})};case"image_save":return function(){!function(t){"image"!==t.media_type&&"canvas"!==t.media_type||e.surrogate_channel.send("cmcb","dl",t.fid,t.media_type,t.x,t.y,t.src_url,t.frame_url,t.referrer_policy)}(n)};case"divider":return function(){};default:assert(!1)}}function v(e,t){var n=t.src_url;switch(e){case"copy":case"cut":case"paste":case"redo":case"undo":case"select_all":return-1!==t.edit_enum.indexOf(e);case"image_copy_address":case"image_open_new_window":return n&&(0===n.indexOf("http:")||0===n.indexOf("https:"));case"link_open_new_tab":case"link_open_new_window":case"link_copy_address":return!!t.link_url;case"back":case"forward":default:return!0}}function w(n,r){var i,o;for(i=0;i<n.length;i+=1)o="divider"===n[i]?"divider":e.localization.get(t[n[i]]),l.push({token:n[i],text:o,enabled:v(n[i],r),cb:h(n[i],r)})}function y(e){return!!Util.findPredicateOnBranch(e,(function(e){return e.className&&e.className.indexOf&&-1!==e.className.indexOf(p)}))}function b(e){var t,n;switch(e.type,e.target,t=e.target,e.type){case"click":if(!y(t))break;for(;-1===["DIV","UL","LI"].indexOf(t.nodeName);)t=t.parentNode;if(!(n=t.getAttribute(m)))break;(n=parseInt(n,10))>=0&&n<l.length&&-1===t.className.indexOf(f)&&(s.dismiss(),l[n].cb());break;case"mousedown":y(t)||s.dismiss(),e.preventDefault();break;case"contextmenu":e.preventDefault();break;case"keydown":27===e.keyCode&&s.dismiss()}}function E(e,t,r){var i,o,a,s=t.token;"divider"===s?e.classList.add("menlo-context-divider"):(n[s]?((i=document.createElement("span")).classList.add("menlo-key-command"),i.textContent=t.text,(o=document.createElement("span")).classList.add("menlo-shortcut"),(a=document.createElement("span")).classList.add("menlo-key"),a.textContent=function(e){return BrowserDetect.isMac()?"redo"===e?"⇧⌘":"⌘":"redo"===e?"Shift+Ctrl+":"Ctrl+"}(s),o.appendChild(a),o.appendChild(document.createTextNode(n[s])),e.appendChild(i),e.appendChild(o)):e.textContent=t.text,e.setAttribute(m,r)),t.enabled||e.classList.add(f)}function A(e,t){!function(){var e;for(e=0;e<_.length;e+=1)EventListener.addListener(document,_[e],b,!1)}(),i=function(){var e,t,n=document.createElement("div"),r=document.createElement("ul");for(n.classList.add(p),o&&n.classList.add(p+"-"+o),t=0;t<l.length;t+=1)E(e=document.createElement("li"),l[t],t),r.appendChild(e);return n.appendChild(r),n.setAttribute("sv-prevent-push",!0),n}(),document.body.appendChild(i),function(e,t,n){var r=e.getBoundingClientRect(),i=r.width,o=r.height,a=Util.getScreenWidth(),s=Util.getScreenHeight(),l=window.scrollX||window.pageXOffset,c=window.scrollY||window.pageYOffset;a-t<i&&(t=a-i-1),s-n<o&&(n=s-o-1),e.style.top=Math.round(n.toString())+c+"px",e.style.left=Math.round(t.toString())+l+"px",e.style.visibility="visible"}(i,e,t)}s.set_last_pos=function(e){u=e},s.dismiss_if_necessary=function(e){"mousedown"!==e.type||y(e.target)?"keydown"===e.type&&27===e.keyCode&&s.dismiss():s.dismiss()},s.dismiss=function(){i&&(document.body.removeChild(i),function(){var e;for(e=0;e<_.length;e+=1)EventListener.removeListener(document,_[e],b,!1)}(),e.useRemotingV2()&&e.compositor.selection.enable(),i=null)},s.display=function(t,n,i,o,a,_,f,p,m,g,h,v,y){var b,E,U,S={fid:t,frame_url:n,referrer_policy:i,media_type:o,suggested_filename:a,link_url:_,src_url:f,has_selection:p,is_editable:m,edit_enum:g.split(","),can_nav_flag:h,x:v,y:y};e.ctx_menu_mode&&e.ctx_menu_mode.backend_driven&&(!e.useRemotingV2()&&u&&(S.x=u.x,S.y=u.y,u=null),S.x,S.y,l=[],s.dismiss(),m?((b=r.edit.slice()).push("divider"),w(b=b.concat(r.cut_copy_paste),S)):"image"===o&&_?((b=r.image.slice()).push("divider"),w(b=b.concat(r.link),S)):w("image"===o||"canvas"===o?r.image:_?r.link:p?r.copy_only:r.regular,S),l.length&&(E=function(){e.useRemotingV2()&&e.compositor.selection.disable(),A(S.x,S.y)},document.getElementById(d)?E():((U=document.createElement("link")).type="text/css",U.rel="stylesheet",U.href=c,U.setAttribute("id",d),U.onload=function(){U.onload=null,E()},document.head.appendChild(U))))},t={undo:"ID_MENU_UNDO",redo:"ID_MENU_REDO",copy:"ID_MENU_COPY",cut:"ID_MENU_CUT",paste:"ID_MENU_PASTE",back:"ID_MENU_BACK",forward:"ID_MENU_FORWARD",reload:"ID_MENU_RELOAD",select_all:"ID_MENU_SELECT_ALL",link_open_new_tab:"ID_MENU_LINK_OPEN_NEW_TAB",link_open_new_window:"ID_MENU_LINK_OPEN_NEW_WINDOW",link_copy_address:"ID_MENU_LINK_COPY_ADDRESS",image_open_new_window:"ID_MENU_IMAGE_OPEN_NEW_WINDOW",image_copy_address:"ID_MENU_IMAGE_COPY_ADDRESS",image_save:"ID_MENU_IMAGE_SAVE"},n={copy:"C",cut:"X",paste:"V",select_all:"A",undo:"Z",redo:"Z"},r={edit:["undo","redo"],copy_only:["copy"],cut_copy_paste:["cut","copy","paste","select_all"],regular:["back","forward","reload","select_all"],link:["link_open_new_tab","link_open_new_window","link_copy_address"],image:["image_open_new_window","image_copy_address","image_save"]},"Windows"===browser.os&&(o="Explorer"===browser.name&&browser.version<=10?"windows8":"windows10"),"Explorer"!==browser.name&&window.ClipboardApi&&(a=new ClipboardApi)}function ActiveTab(e){var t,n,r=["focus","focusin","keydown","mousemove","scroll"],i=__randstr(16),o=this;function a(s){var l;if(e.detached)e.prevent_reattach||(e.detached=!1,Util.xframe_reload());else if(!o.is_active){for(o.is_active=!0,e.cof.call(["setActiveCookie",i],(function(e){assert(e)})),s.type,l=0;l<r.length;l+=1)EventListener.removeListener(window,r[l],a,!1);n=setTimeout(t,200),e.callback.fire("window-became-active")}}function s(){e.surrogate_channel&&(document.visibilityState,"hidden"===document.visibilityState&&e.context_menu.dismiss(),e.surrogate_channel.send("hidden"===document.visibilityState?"hide-tab":"show-tab"))}function l(){e.surrogate_channel&&e.surrogate_channel.send("acquire-focus")}t=function(){n=null,e.cof.call(["getActiveCookie"],(function(s){s!==i?function(){var t;if(o.is_active){for(o.is_active=!1,n&&(clearTimeout(n),n=null),t=0;t<r.length;t+=1)EventListener.addListener(window,r[t],a,!1);e.callback.fire("window-became-passive")}}():n=setTimeout(t,200)}))},assert(e.cof),EventListener.addListener(document,"visibilitychange",s,!0),EventListener.addListener(window,"focus",l,!0),e.callback.register("surrogate-channel-connected",(function(e){e&&(s(),l())}),!0),e.cof.call(["setActiveCookie",i],(function(e){assert(e)})),o.is_active=!0,n=setTimeout(t,200)}function TabStorageException(e){this.message=e}function tabstore_is_reliable(){return!window.TPROXY_ENABLED||-1!==navigator.userAgent.indexOf("Chrome")||!(-1!==navigator.userAgent.indexOf("Firefox")||-1!==navigator.userAgent.indexOf("Safari"))}function TabStorage(){this.format=function(e){return"JSON:"+JSON.stringify(e)},this.save=function(e){window.name=this.format(e)},this.load=function(){var e;if(-1===window.name.indexOf("JSON:",0))throw new TabStorageException("storage is empty or invalid");return e=window.name.substr(5),JSON.parse(e)},this.clear=function(){window.name="",assert(0===window.name.length)}}function TabStorageBackedByLocalStorage(e){var t=this;function n(){var e;try{e=t.load()}catch(t){e=null}t.save(e)}this.save=function(t){localStorage.setItem(e,JSON.stringify({timestamp:Date.now(),value:t}))},this.load=function(){var t,n=localStorage.getItem(e);if(!n)throw new TabStorageException("storage is empty or invalid");if(assert("string"==typeof n),null===(t=JSON.parse(n)).value||void 0===t.value)throw new TabStorageException("storage is empty or invalid");return t.value},this.clear=function(){localStorage.removeItem(e)},setInterval((function(){n(),function(){var e,t,n,r;for(e=0;e<localStorage.length;e+=1){n=localStorage.key(e);try{t=JSON.parse(localStorage.getItem(n)),r=Date.now()-t.timestamp,(void 0===t.timestamp||r>1e5)&&localStorage.removeItem(n)}catch(e){}}}()}),1e4),n()}function Pairing(e,t){var n,r,i,o={},a=this,s={},l=0,c=t&&t.max_timeout_ms||3e3;function d(e){var t=Util.parseURL(e);return t.protocol+"//"+t.hostname}function u(e){return e.hasOwnProperty("safe_rid")?e.safe_rid:""}function _(e,t,n){a.safeview.reset("repair XHR failed")}function f(e,t,r,i,o,u){var _,m=c,g=function(t){reportWarnClientEvent(t,{target_url:e,xhr_url:u,textStatus:i.response,statusCode:i.status,retry_count:l,timeout_ms:m})};!i.status&&(navigator.userAgent.indexOf("Trident")>=0||navigator.userAgent.indexOf("MSIE 10.0")>=0||navigator.userAgent.indexOf("Edge")>=0)&&(_=d(n),s[_]||(s[_]=1,document.createElement("img").src=_+"/safeview-static/img/indicator.png?fie="+__randstr(10))),a.safeview.preload_indicator.showPreloadIndicator(),"pairing_retry"===i.response?(m=Math.min(c,50*Math.pow(2,l)),g("tc-pairing-retry")):"global_pool_depleted"===i.response?g("tc-global-pool-depleted"):l<3?g("tc-pairing-slow-retry"):Util.showError(a.safeview.localization.get("ID_TC_NETWORK_ISSUE",Math.abs(Util.hashCode(i.response))),a.safeview.localization.get("ID_TC_NETWORK_RETRY"),{statusCode:i.status,responseText:i.response,status:i.status,retry_count:l,timeout_ms:m},a.safeview.template),l+=1,setTimeout((function(){Util.xhrRequest(u,t,p.curry(e,t,r),f.curry(e,t,r),a.safeview.perf.xhr_timeout_ms)}),m)}function p(e,t,r,i){if(i.retry_nid){var o=n+"?cid="+i.retry_nid+"_any";return i.cluster_id&&(o+="&cl="+i.cluster_id),void Util.xhrRequest(o,t,p.curry(e,t,r),f.curry(e,t,r),a.safeview.perf.xhr_timeout_ms+a.safeview.perf.pre_pair_xhr_ms)}i.origin=d(e),r(i)}function m(t,r,i,o,s,l,c,d){var m,g,h,v,w,b,E,A,U,S,C,N,k,O,T,x,D,L,I,B=!u(c),P=(U=B,O=new ParsedURL(A=t),T=!1,x="",D="readonly",I="mpa/",__startswith(A,L="readonly/")?(T=!0,A=A.substr(L.length)):__startswith(A,I)?(S=(A=A.substr(I.length)).indexOf("/"))>0&&(x=A.substr(0,S),A=A.substr(S+1)):O.hostname===D?(T=!0,A=O.protocol+"/"+O.pathname+O.search):"mpa"===O.hostname&&((S=O.pathname.indexOf("/",1))>0&&(x=O.pathname.substr(1,S-1),O.pathname=O.pathname.substr(S)),A=O.protocol+"/"+O.pathname+O.search),U&&__startswith(O.search,"?__SV_SURROGATE_NODE=")&&2===(N=(C=(O=new ParsedURL(A)).search.substr(1).split("&"))[0].split("=")).length&&(k=N[1],A=O.protocol+"//"+O.hostname+O.pathname+(C.length>=2?"?"+C.slice(1).join("&"):"")+O.hash),{mpa_id:x,ro:T,url:A,pair_node:k}),R=y.curry(u(c),function(e){return e.hasOwnProperty("mpa_id")?e.mpa_id:""}(c),s);return m=function(e,t,n,r){var i,o,a;return i=window.IS_POST||!1,a=navigator.userAgent.indexOf("MSIE 10.0")>=0||navigator.userAgent.indexOf("Trident")>=0?jstz.determine().name():Intl.DateTimeFormat().resolvedOptions().timeZone,o={url:e,transparent_mode:TPROXY_ENABLED,read_only_entry:n.ro||window.XEMAIL_ENTRY,mpa_id:n.mpa_id,pair_node:n.pair_node,persistent_policy:Util.persistentPolicy(),timezone:a,build_id:BUILD_ID,top_frame_doctype:t,language:Util.getLanguage(),languages:Util.getLanguages(),platform:window.navigator.platform,referrer:document.referrer,framing_status:r,viewport_bounds:MetricsUtils.getVisualViewportMetrics(),render_params:MetricsUtils.getAllMetrics(),supports_mse:Util.isMseSupported(),unsupported_media_formats:Util.getUnsupportedMediaFormats(),force_isolate:window.FORCE_ISOLATE||!1,is_post:i,host:window.HOST},window.DOC_HEADERS&&(o.doc_headers=window.DOC_HEADERS),window.XHEADERS&&(o.xheaders=window.XHEADERS),i&&(o.body=window.BODY||"",o.content_type=window.CONTENT_TYPE||""),o}(t=P.url,r,P,l),n=e.url_builder.buildProtocolUrl("/r/pair"),B?(g=n,v=f.curry(t,m,R),E=a.safeview.perf.xhr_timeout_ms+a.safeview.perf.pre_pair_xhr_ms):(assert(c.cid&&c.safe_rid&&c.tab_id,"bad pairing state"),g=e.url_builder.buildProtocolUrl("/r/repair")+"?cid="+c.cid,c.cluster_id&&(g+="&cl="+c.cluster_id),m.tab_id=c.tab_id,m.hid=d,m.safe_rid=c.safe_rid,m.dnt=!tabstore_is_reliable(),m.popup_initial_pair=c.hasOwnProperty("new_popup"),m.doctype_correction=c.is_pending_doctype_correction,v=_,E=a.safeview.perf.xhr_timeout_ms),h=p.curry(t,m,R),i?(w=i,b=o):(w=h,b=v),{on_load:h,on_error:v,xhr:Util.xhrRequest.curry(g,m,w,b,E)}}function g(e){return e&&e.safe_rid&&e.cid}function h(e){function t(e){return e.split(".").slice(-2).join(".")}return Util.isIpAddress(window.location.hostname)||assert(!Util.isIpAddress(CLUSTER_DOMAIN)),!e||t(e)===t(CLUSTER_DOMAIN)}function v(e){assert(g(e)),e.protocol_domain=o.protocol_domain||PROTOCOL_DOMAIN,e.cluster_domain=o.cluster_domain||CLUSTER_DOMAIN,e.inspect_domain=o.inspect_domain||INSPECT_DOMAIN,a.safeview.tab_store.save({safe_rid:e.safe_rid,mpa_id:e.mpa_id,cid:e.cid,cluster_id:e.cluster_id,tab_id:e.tab_id,protocol_domain:e.protocol_domain,cluster_domain:e.cluster_domain,inspect_domain:e.inspect_domain,surrogate_view_active:e.surrogate_view_active}),a.safeview.cof&&a.safeview.cof.call(["setSurrogateInfo",e.mpa_id,JSON.stringify({protocol_domain:e.protocol_domain,cluster_domain:e.cluster_domain,inspect_domain:e.inspect_domain,safe_rid:e.safe_rid,cid:e.cid,nid:e.s_nid,cluster_id:e.cluster_id,surrogate_view_active:e.surrogate_view_active})])}function w(e){e.protocol_domain=e.protocol_domain||PROTOCOL_DOMAIN,e.cluster_domain=e.cluster_domain||CLUSTER_DOMAIN,e.inspect_domain=e.inspect_domain||INSPECT_DOMAIN,h(e.protocol_domain)&&h(e.cluster_domain)&&h(e.inspect_domain)||(console.error("tc-pairing-tab-storage-invalid"),e.protocol_domain=PROTOCOL_DOMAIN,e.cluster_domain=CLUSTER_DOMAIN,e.inspect_domain=INSPECT_DOMAIN)}function y(e,t,n,r){var i,s;if(r.login_url)return a.safeview.itok?void a.safeview.cof.call(["doITok",a.safeview.itok,r.integrity_hosts,r.inspect_host,window.location.href],(function(e){var t;e||((t=document.createElement("button")).innerText="Try again!",document.body.appendChild(t),t.addEventListener("click",(function(){Util.windowOpen(window.location.href,"_blank")})))})):r.use_integrity_token&&navigator.userAgent.indexOf("Trident")>=0?void a.safeview.cof.call(["doToksAuth",r,location.href],(function(e){})):(s=Util.buildLoginForm(r,location.href),void Util.submitLoginForm(s,"_self"));if(r.direct_access)Util.locationReplace(window,r.direct_access);else{if(r.server_build_id)return reportErrorClientEvent("tc-pairing-unexpected-tc-build-id",{expected_build_id:r.server_build_id,client_build_id:BUILD_ID}),void a.safeview.reset("unexpected tc build id");if(r.error||r.block)n(r);else{if(!g(r))return reportErrorClientEvent("tc-pairing-unexpected-response",{pairing_dict:JSON.stringify(r)}),void a.safeview.reset("invalid pairing state");e&&r.safe_rid!==e&&r.mpa_id===t&&reportWarnClientEvent("tc-pairing-repaired-to-new-surrogate",{old_safe_rid:e,safe_rid:r.safe_rid}),r.s_nid_with_underscore=r.s_nid+"_",o&&(r.surrogate_view_active=o.surrogate_view_active),r.client_caps&&r.client_caps.dlp_show_block_payload_codes&&(-1!==(i=r.client_caps.dlp_show_block_payload_codes).indexOf(12345)&&(r.client_caps.dlp_retry_input=3,r.client_caps.dlp_soft_error_input=!0),-1!==i.indexOf(12346)&&(r.client_caps.dlp_ignore_error_input=!0)),v(r),o=r,a.safeview.cof.call(["setNidCookie",r.s_nid,r.cluster_id],(function(){n(r)}))}}}function b(){var t;(t=new ClientEventReporterCore(e)).send_events({items:[t.make_event_dict("tc-blocked-tiny-iframe")]})}function E(e){return!!i&&(o=e,i(),i=null,!0)}a.setSafeview=function(e){a.safeview=e},a.withSurrogateDo=function(e,t,n,s,l){var c,d,_,f,p,g;if(s=s||Util.getRawPageUrl(),void 0===l)try{l=window.history.state?window.history.state.hid:null}catch(e){l=null}return c=m(s,t,e.on_load,e.on_error,e.on_complete,n,o,l),r&&(window.removeEventListener("resize",r),window.removeEventListener("beforeunload",b)),g=1,window.TPROXY_ENABLED&&0!==Util.getFramingStatus()&&window.IGNORE_TINY_IFRAME&&window.IGNORE_TINY_IFRAME.enabled&&!Util.isFrameBuster()&&(d=parseInt(window.IGNORE_TINY_IFRAME.dimension,10),isNaN(d)||(g=d),navigator.userAgent.indexOf("Trident")>=0||navigator.userAgent.indexOf("Edge")>=0?(_=document.body.style.msOverflowStyle,document.body.style.msOverflowStyle="none",f=window.innerWidth,p=window.innerHeight,document.body.style.msOverflowStyle=_):(f=window.innerWidth,p=window.innerHeight),p<=g&&f<=g||0===p||0===f)?(r=a.withSurrogateDo.curry(e,t,n,s,l),window.addEventListener("resize",r),window.addEventListener("beforeunload",b),c):u(o)||i?(c.xhr(),c):(i=a.withSurrogateDo.curry(e,t,n,s,l),c)},a.safeview=e,a.loadPairingState=function(){var e;assert(a.safeview.tab_store);try{g(o=a.safeview.tab_store.load())||(a.safeview.tab_store.clear(),o={})}catch(e){e instanceof TabStorageException&&(o={})}return o.is_pending_doctype_correction&&(e=o.is_pending_doctype_correction,o.is_pending_doctype_correction=!1,v(o),o.is_pending_doctype_correction=e),w(o),o},a.savePairingState=v,a.initPairingState=function(e){g(o=e)||(o={})},a.doCheckRequest=function(t){var n,r,i;(a.safeview.active_tab||{}).is_active&&a.safeview.pairing_dict.sb&&(i=e.url_builder.getDomain("cluster"),n=(r=e.url_builder.getDomain("inspect"))!==i?[i,r]:[i],a.safeview.cof.call(["doAuthCheck",{check_hosts:n,sb:a.safeview.pairing_dict.sb,timeout:a.safeview.perf.xhr_timeout_ms,transparent_mode:window.TPROXY_ENABLED},t,a.safeview.itok],(function(e){})))},a.doRecookie=function(e){var t;t=Util.buildLoginForm(e,e.url),Util.submitLoginForm(t,"_self")},a.surrogateInfoRecovery=function(e){g(e)||(e={}),w(e),e.tab_id=-1,(E(e)||tc_kernel.defered_pairing(e))&&(o=e)},a.doDeferedPairing=E}function clearPairingState(e){var t;try{delete(t=e.tab_store.load()).safe_rid,delete t.cid,delete t.cluster_id,delete t.tab_id,delete t.protocol_domain,delete t.cluster_domain,delete t.inspect_domain,e.tab_store.save(t)}catch(e){}}function Stats(e,t){var n={},r={},i={},o={},a=this;function s(e,t,n){e.hasOwnProperty(t)||(e[t]=0),e[t]+=n}assert("main"===e.role||"comm"===e.role),e.callback.register("dom-loaded",(function(e){o={},Util.simpleExtend(o,e),Util.simpleExtend(o,n),reportClientEvent("tc-dom-loaded",o)})),this.inc=function(e){s(n,e,1)},this.add=function(e,t){s(n,e,t)},this.agg=function(e,t){var n,r;i.hasOwnProperty(e)?((n=i[e]).last=t,n.sum+=t,n.count+=1,r=n.avg,n.avg=n.sum/n.count,n.min=Math.min(n.min,t),n.max=Math.max(n.max,t),n.var=((n.count-1)*n.var+(t-n.avg)*(t-r))/n.count):n={last:t,min:t,avg:t,max:t,sum:t,count:1,var:0},i[e]=n},this.agg_get=function(e){if(!i.hasOwnProperty(e))return{};var t=i[e];return{last:t.last,min:t.min,avg:t.avg,max:t.max,count:t.count,stdev:Math.sqrt(t.var)}},this.start=function(e){r[e]=Date.now()},this.stop=function(e){var t=Date.now()-r[e];s(n,e,t),delete r[e]},this.on_xframe_stats_msg=function(e){switch(e.op){case"inc":a.inc(e.counter_name);break;case"add":a.add(e.counter_name,e.val);break;case"agg":a.agg(e.counter_name,e.val);break;case"start":a.start(e.timer_name);break;case"stop":a.stop(e.timer_name);break;default:assert(0)}},this.getRawStatsAsJSON=function(){return JSON.stringify(o)},this.setNavStartTime=function(e){r.time_tnl=e},r.time_tdl=load_time,r.time_tnl=load_time}function XFrameStats(e){function t(t){var n,r={kind:"stats"};for(n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);e.postToCommFrame(r)}assert("top"===e.role||"sub"===e.role),this.inc=function(e){t({op:"inc",counter_name:e})},this.add=function(e,n){t({op:"add",counter_name:e,val:n})},this.agg=function(e,n){t({op:"agg",counter_name:e,val:n})},this.start=function(e){t({op:"start",timer_name:e})},this.stop=function(e){t({op:"stop",timer_name:e})}}function MediaObjects(e){var t,n={},r={},i={},o=["canplay","canplaythrough","error","pause","play","ratechange","seeking","volumechange","loadedmetadata","durationchange","resize"],a=["playsinline","webkit-playsinline"],s=["touchend","click"],l={},c=this,d={},u=!1,_=Object.freeze({HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4});function f(e){var t,n,r;if(!e)return e;if(e.startsWith("data:"))return Util.string_shorten(e,120,"...").replace(/,.*$/,"...");for(n=(t=(e=e.replace(/~+$/,"")).split("/"))[t.length-1].split("_"),r=0;r<n.length;r+=1)try{n[r]=atob(n[r])}catch(t){return n[r],e}return n.join("?")}function p(e,t,n,i,o,a,s,l){var c,d,u=window.VTTCue?window.VTTCue:window.TextTrackCue,_=r[getNodeKey(e,n)];return _?(reportWarnClientEvent("tc-media-error",{detail:"create new text track on mirrored uid",media_uid:t,track_uid:n}),_):(c=getNodeByUid(e,t))?((_=c.addTextTrack(i,o,a)).mode=s,l.forEach((function(e){(d=new u(e[0],e[1],e[2])).align=e[3],d.line=e[4],d.pauseOnExit=e[5],d.position=e[6],d.size=e[7],d.snapToLines=e[8],d.vertical=e[9],_.addCue(d)})),r[getNodeKey(e,n)]=_,_):null}function m(e,t){e.surrogate_current_time=[t,Util.now(),0]}function g(t){var r=e.xbrowser.getEventTarget(t),i=getFidByNode(r),o=getUidByNode(r),a=getNodeKey(i,o),s=n[a],c=0;void 0===l[a]&&(s&&s.surrogate_current_time&&(c=Math.abs(r.currentTime-s.surrogate_current_time[0]-(Util.now()-s.surrogate_current_time[1])*r.playbackRate/1e3)),c>1&&(s.surrogate_current_time[2]++,s.surrogate_current_time[2]>2&&(e.surrogate_channel.send("client-media-drift",i,o,r.currentTime),m(s,r.currentTime))))}function h(t){var r,i,o,a,s,d,u,p=e.xbrowser.getEventTarget(t),m={};if(assert(p,"No target"),d=getNodeKey(a=getFidByNode(p),s=getUidByNode(p)),r=n[d])if("play"===t.type&&r.pending_play_callback&&r.pending_play_callback(""),assert(o=r.state,"No state"),assert(t.type,"No event type"),i=!0===r.ignore[t.type],t.type,p.currentTime,p.readyState,delete r.ignore[t.type],"error"!==t.type){switch((u=function(e){return e.src&&-1!==e.src.indexOf("m3u8=true")}(p))&&r.readyState!==p.readyState&&(r.readyState=p.readyState,e.surrogate_channel.send("client-media-hls",a,s,"state",p.readyState)),t.type){case"canplay":r.pending_play_callback?c.callPlay(p,a,s,r.pending_play_callback):!o.paused&&p.paused&&c.callPlay(p,a,s),l[d]&&0===p.currentTime&&v(p,a,s,l[d],r),delete l[d];break;case"canplaythrough":break;case"loadedmetadata":l[d]&&v(p,a,s,l[d],r);break;case"durationchange":u&&r.duration!==p.duration&&(r.duration=p.duration,p.duration,e.surrogate_channel.send("client-media-hls",a,s,"duration",p.duration!==1/0?p.duration:-1,p.currentTime)),l[d]&&v(p,a,s,l[d],r);break;case"resize":!u||r.videoWidth===p.videoWidth&&r.videoHeight===p.videoHeight||(p.videoWidth,p.videoHeight,r.videoWidth=p.videoWidth,r.videoHeight=p.videoHeight,e.surrogate_channel.send("client-media-hls",a,s,"size",p.videoWidth,p.videoHeight));break;default:if(e.wa_manager.mute_if_wa_src_node(a,s)&&(i=!0),"seeking"!==t.type&&"play"!==t.type||delete l[d],!i&&(p.controls||p.autoplay&&"play"===t.type)){switch(m.type=t.type,t.type){case"pause":if(p.ended)return;break;case"ratechange":m.playbackRate=p.playbackRate;break;case"seeking":m.currentTime=p.currentTime;break;case"volumechange":m.muted=p.muted,m.volume=p.volume}t.type,JSON.stringify(m),e.surrogate_channel.send("client-media",getFidByNode(p),JSON.stringify([s,m]))}}"pause"===t.type&&i&&r.pending_play_callback&&p.readyState>=_.HAVE_CURRENT_DATA&&(c.callPlay(p,a,s,!1,r.pending_play_callback),delete r.pending_play_callback)}else p.readyState>_.HAVE_NOTHING&&function(e){var t=getUidByNode(e);e.currentSrc&&reportWarnClientEvent("tc-media-error",{error_code:e.error?e.error.code:"unknown",detail:e.error?e.error.message:"unknown",uid:t,src:f(e.currentSrc)})}(p)}function v(e,t,n,r,i){var o=getNodeKey(t,n);e.currentTime,e.readyState<_.HAVE_METADATA?l[o]=r:(e.currentTime=r,i.ignore.seeking=!0,e.paused||(i.ignore.pause=!0,i.ignore.play=!0))}function w(e){d.hasOwnProperty(e)&&(clearTimeout(d[e]),delete d[e])}function y(e,t){var r,i=!1,o=(getWindowByFid(e)||window).document,a=function(){var r,l,c,d=n[getNodeKey(e,t)];if(!i){for(i=!0,c=0;c<s.length;c++)EventListener.removeListener(o,s[c],a,!0,!0);(r=getNodeByUid(e,t))&&d&&(r.paused?l=r.play():r.muted||(d.flags.has_unmuted_gesture=!0)),l&&l.then((function(){d.state.paused&&r.pause(),r.muted||(d.flags.has_unmuted_gesture=!0)})).catch((function(){}))}};for(r=0;r<s.length;r++)EventListener.addListener(o,s[r],a,!0,!0)}function b(t,r,i,o,s){var u,f,p,g=getNodeKey(r,i),h=n[g];for(u in c.last_updated_node=t,s&&s.hasOwnProperty("currentTime")?m(h,s.currentTime):o.hasOwnProperty("currentTime")&&m(h,o.currentTime),o.muted&&!1===o.paused&&(t.muted=!0),o)if(o.hasOwnProperty(u))if(-1===a.indexOf(u))if(u in t)if(o[u],h.state[u]=o[u],o[u]!==t[u])switch(u){case"paused":o.paused?s.currentTime&&s.currentTime>t.currentTime?((p=s.currentTime-t.currentTime).toFixed(2),w(g),d[g]=setTimeout((function(){t.pause(),w(g),h.ignore.pause=!0}),1e3*p)):(t.pause(),h.ignore.pause=!0):(w(g),s.currentTime&&s.currentTime>t.currentTime&&(l[g]=s.currentTime),t.readyState>=_.HAVE_METADATA?c.callPlay(t,r,i):"none"!==t.preload||h.flags.manual_loaded_once||(t.load(),h.flags.manual_loaded_once=!0));break;case"currentSrc":if(o.currentSrc=o.currentSrc||"",f=t.src||"",!o.currentSrc)break;f!==o.currentSrc&&(!s.forceCurrentSrc&&e.media_source_extensions.get_media_source_or_falsy(r,i)||(t.src,o.currentSrc,"#"===o.currentSrc?t.src=Resource.videoDataUri:t.src=o.currentSrc,h.flags.has_unmuted_gesture=!1,t.load()));break;case"currentTime":v(t,r,i,o.currentTime,h);break;case"controls":if(e.useRemotingV2())break;default:switch(t[u],o[u],t[u]=o[u],u){case"volume":case"muted":h.ignore.volumechange=!0,!BrowserDetect.isSafari()||t[u]||h.has_unmuted_gesture||y(r,i);break;case"playbackRate":h.ignore.ratechange=!0}}else"paused"===u&&(w(g),o[u]&&delete h.pending_play_callback);else reportWarnClientEvent("tc-media-state-update-missing-property",{node:i,missing_property:u});else t.setAttribute(u,o[u])}function E(e,r){var i=getNodeKey(e,r);delete n[i],t.did_remove_media_node(e,r)}c.install_listeners=function(t){var n,r;for(n=0;n<o.length;n+=1)r=o[n],EventListener.addListener(t,r,h,!1);EventListener.addListener(t,"timeupdate",g,!1),e.fullscreen.installListeners(t)},c.remove_listeners=function(t){var n,r;for(n=0;n<o.length;n++)r=o[n],EventListener.removeListener(t,r,h,!1);EventListener.removeListener(t,"timeupdate",g,!1),e.fullscreen.removeListeners(t)},c.callPlay=function(t,r,i,o){var a,s=getNodeKey(r,i),l=n[s];if(u)return e.surrogate_channel.send("client-media",r,JSON.stringify([i,{type:"pause"}])),void(o&&o("NotAllowedError"));a=t.play(),l&&(l.ignore.play=!0),a?a.then((function(){o&&o("")})).catch((function(n){"NotAllowedError"!==n.name||!BrowserDetect.isSafari()||l.state.muted||l.has_unmuted_gesture||(y(r,i),!o)?(o?o(n.name?n.name:"NotAllowedError"):t.paused&&e.surrogate_channel.send("client-media",getFidByNode(t),JSON.stringify([getUidByNode(t),{type:"pause"}])),l&&delete l.ignore.play):o("")})):o&&o("")},c.setClient=function(e){t=e},c.backendValuesForNode=function(e,t){var r=n[getNodeKey(e,t)];return r?r.state:void 0},c.stopAllMedia=function(){u=!0,Util.forEachItem(n,(function(t,n){var r,i=splitNodeKey(t);(r=getNodeByUid(i.fid,i.uid))&&(r.pause(),e.surrogate_channel.send("client-media",i.fid,JSON.stringify([i.uid,{type:"pause"}])))}))},c.deleteMediaNodes=function(e){var t,r=e+"_";for(t in n)n.hasOwnProperty(t)&&__startswith(t,r)&&E(e,splitNodeKey(t).uid)},c.mark_manually_loaded=function(e,t){var r=n[getNodeKey(e,t)];r&&r.flags&&(r.flags.manual_loaded_once=!0)},c.getNodesCount=function(){return Object.keys(n).length},e.interp.registerOpcodeHandler(e.interp.OPCODES.MEDIA_NEW_NODE,(function(r,o,a,s){var l=t.new_media_node(s,r,o),d=getNodeKey(r,o),u=i[getNodeKey(r,o)];l?(JSON.stringify(a),n[d]={state:{},ignore:{},flags:{manual_loaded_once:!1,has_unmuted_gesture:!1}},BrowserDetect.isIOS()&&a.autoplay&&l.setAttribute("playsinline","1"),b(l,r,o,a,{}),c.install_listeners(l),e.callback.fire("new-media-node",r,o),u&&(p(r,o,u.uid,u.kind,u.label,u.language,u.mode,u.cues)||reportWarnClientEvent("tc-media-error",{detail:"unable to create new text track, media node is ready",media_uid:o,track_uid:u.uid}),delete i[getNodeKey(r,o)])):reportWarnClientEvent("tc-media-unknown-node",{uid:o,tag_name:s})})),e.interp.registerOpcodeHandler(e.interp.OPCODES.MEDIA_UPDATE,(function(e,t,n,r){var i=getNodeByUid(e,t);i?b(i,e,t,n,r):reportWarnClientEvent("tc-media-unknown-node",{uid:t})})),e.interp.registerOpcodeHandler(e.interp.OPCODES.MEDIA_BLOB,(function(e,t,n){var r=getNodeByUid(e,t);r?r.src=n:reportWarnClientEvent("tc-media-unknown-node",{fid:e,uid:t})})),e.interp.registerOpcodeHandler(e.interp.OPCODES.MEDIA_REMOVE_NODE,E),e.interp.registerOpcodeHandler(e.interp.OPCODES.ADD_CUES,(function(e,t,n,r,o,a,s){var l="showing";p(e,t,n,r,o,a,l,s)||(i[getNodeKey(e,t)]={uid:n,kind:r,label:o,language:a,mode:l,cues:s})})),e.interp.registerOpcodeHandler(e.interp.OPCODES.TEXT_TRACK_MODE,(function(e,t,n,o){var a,s=r[getNodeKey(e,n)];s?s.mode=o:(a=i[getNodeKey(e,t)])&&(a.mode=o)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.MEDIA_ATTEMPT_PLAY,(function(t,r,i){var o=getNodeByUid(t,r),a=getNodeKey(t,r),s=n[a],l=!1,d=function(n){l||(s&&delete s.pending_play_callback,l=!0,o&&o.currentSrc.substring(0,512),!!o&&o.muted,o&&o.parentElement,e.surrogate_channel.send("client-media-play",t,r,n,i))};if(o)if(o.paused){if(s&&(s.pending_play_callback=d,s.ignore.pause||o.readyState<_.HAVE_CURRENT_DATA))return;if(BrowserDetect.isSafari()&&o.readyState===_.HAVE_NOTHING)return;c.callPlay(o,t,r,d)}else d("");else d("AbortError")}))}function MediaSourceExtensions(e){var t={},n=0,r=["mode","timestampOffset","appendWindowStart","appendWindowEnd"],i=this;function o(t,n){return e.useRemotingV2()?"1_"+n:t+"_"+n}function a(e,t){var n,r=e.source_buffers;for(n in r)if(r.hasOwnProperty(n)&&!t(r[n]))return!1;return!0}function s(e,t){var n=i.get_media_source_or_falsy(e,t);return n||reportErrorClientEvent("tc-mse-no-media-source-found-error",{fid:e,uid:t}),n}function l(e){clearInterval(e.advance_poller),e.so_callback&&(EventListener.removeListener(e.ms_object,"sourceopen",e.so_callback),delete e.so_callback),e.sc_callback&&(EventListener.removeListener(e.ms_object,"sourceclose",e.sc_callback),delete e.sc_callback),a(e,(function(e){return e.ue_callback&&(e.sb_object&&EventListener.removeListener(e.sb_object,"updateend",e.ue_callback),delete e.ue_callback),e.error_callback&&(e.sb_object&&EventListener.removeListener(e.sb_object,"error",e.error_callback),delete e.error_callback),!0})),e.object_url&&(URL.revokeObjectURL(e.object_url),delete e.object_url)}function c(e){l(e),e.error=!0,delete e.ms_object,delete e.source_buffers,delete e.queue}function d(t,r,i){var o,a,l,u={cid:e.pairing_dict.cid,rid:e.pairing_dict.rid,mpa_id:e.pairing_dict.mpa_id,tab_id:e.pairing_dict.tab_id};e.pairing_dict.cluster_id&&(u.cl=e.pairing_dict.cluster_id),o={safe_rid:e.pairing_dict.safe_rid,tab_id:e.pairing_dict.tab_id,fid:t,uid:r,src_buf_id:i.src_bfr_id,seq_id:i.seq_id},i.aborted&&(o.ack_only=!0),a="/r/mse?"+Util.buildQueryStr(u),a=e.url_builder.buildProtocolUrl(a),(l=new XMLHttpRequest).withCredentials=!0,l.open("POST",a,!0),l.onload=function(e){delete i.fetch_req,n=0,function(e,t,n,r){var i;n.src_bfr_id,r&&r.byteLength,n.data=r,(i=s(e,t))&&!i.error&&(i.source_buffers[n.src_bfr_id]?v(i):reportWarnClientEvent("tc-mse-no-source-buffer-found-segment-fetch-error",{src_buf_id:n.src_bfr_id}))}(t,r,i,l.response)},l.onerror=function(e){if(delete i.fetch_req,n<10)return n+=1,void setTimeout((function(){d(t,r,i)}),1e3);!function(e,t,n){var r;reportWarnClientEvent("tc-mse-segment-fetch-error",{evt:n}),(r=s(e,t))&&c(r)}(t,r,e)},l.onabort=function(e){var n=s(t,r);delete i.fetch_req,i.src_bfr_id,n&&c(n)},i.fetch_req=l,JSON.stringify(o),l.send(JSON.stringify(o)),l.responseType="arraybuffer"}function u(n,r){var i,s,d=n.ms_object;return!(!d||(i=d.readyState,"remove_src_bfr"===(s=r.cmd)||"src_close"===s?"open"!==i&&"ended"!==i:"open"!==i))&&(r.cmd,"add_src_bfr"===r.cmd?function(t,n,r){var i,o=t.ms_object,a={id:n,media_type:r,seq_id:0},s=r;t.source_buffers[n]=a,a.ue_callback=function(e){v(t)},a.error_callback=function(r){e.stats.inc("mse_src_exception"),e.surrogate_channel.send("mse-src-exception",t.fid,t.uid,n,r.name)},-1!==s.indexOf("avc3")&&"Explorer"===browser.name&&(s=s.replace("avc3","avc1"));try{i=o.addSourceBuffer(s),a.sb_object=i,EventListener.addListener(i,"updateend",a.ue_callback),EventListener.addListener(i,"error",a.error_callback)}catch(e){reportErrorClientEvent("tc-mse-sourcebuffer-init-error",{error:e.toString(),type:r}),c(t)}return!0}(n,r.id,r.media_type):"remove_src_bfr"===r.cmd?function(e,t){var n=e.source_buffers[t];if(n&&n.sb_object){n.ue_callback&&EventListener.removeListener(n.sb_object,"updateend",n.ue_callback),n.error_callback&&EventListener.removeListener(n.sb_object,"error",n.error_callback);try{e.ms_object.removeSourceBuffer(n.sb_object)}catch(t){reportErrorClientEvent("tc-mse-sourcebuffer-remove-error",{error:t.toString()}),c(e)}delete e.source_buffers[t]}else reportWarnClientEvent("tc-mse-no-source-buffer-found-to-remove-error",{src_buf_id:t});return!0}(n,r.id):"set_duration"===r.cmd?function(e,t){var n=e.ms_object;if(!a(e,(function(e){var t=e.sb_object;return!(t&&t.updating)})))return!1;try{n.duration=t}catch(t){reportErrorClientEvent("tc-mse-set-duration-error",{error:t.toString()}),c(e)}return!0}(n,r.duration):"src_close"===r.cmd?function(e){var n,r=!0;return a(e,(function(e){var t=e.sb_object;return!(t&&t.updating)}))||(r=!1),l(e),e.fid&&e.uid&&(void 0!==(n=getNodeByUid(e.fid,e.uid))&&(n.src=""),delete t[o(e.fid,e.uid)]),r}(n):"end_of_stream"===r.cmd?function(e,t){var n=!0;if(a(e,(function(e){var t=e.sb_object;return!(t&&t.updating)}))||(n=!1),!n)return!1;try{t?e.ms_object.endOfStream(t):e.ms_object.endOfStream()}catch(t){reportErrorClientEvent("tc-mse-end-of-stream-error",{error:t.toString()}),c(e)}return!0}(n,r.error):(reportErrorClientEvent("tc-mse-unrecognized-media-source-command-error",{item:r}),c(n),!0))}function _(e,t,n){e.error||(e.queue.push(t),n||v(e))}function f(e){var t,n=e.buffered,r=[];for(t=0;t<n.length;t++)r.push(n.start(t),n.end(t));return r}function p(e,t){var n,r,i,o=t.buffered,a=getNodeByUid(e.fid,e.uid).currentTime-.2,s=a+60.2,l=[];for(n=0;n<o.length;n++)r=o.start(n),i=o.end(n),r>s||i<a?l.push([r,i]):(r<a&&l.push([r,a]),i>s&&l.push([s,i]));for(n=0;n<l.length;n++)r=l[n][0],(i=l[n][1])-r<.5?(l.splice(n,1),n--):i-r>30.6&&(r+=30,l.push([r,i]),l[n][1]=r);return l.sort((function(e,t){return e[0]<a||t[0]<a?e[0]-t[0]:t[0]-e[0]})),l}function m(e,t){var n,r,i=e.queue,o="report-buffered",a=i.length-1;for(r=0;r<i.length;r++)if((n=i[r]).src_bfr_id===t)if("append"===n.cmd||"remove"===n.cmd)a=r;else if(i[r].cmd===o)return;i.splice(a+1,0,{cmd:o,src_bfr_id:t})}function g(e,t){var n,r,i=e.queue;if(i)for(r=0;r<i.length;r++)if("report-buffered"===(n=i[r]).cmd&&n.src_bfr_id===t)return void i.splice(r,1)}function h(t,n){var i,o,a,s=t.source_buffers[n.src_bfr_id];if(!s)return reportWarnClientEvent("tc-mse-no-source-buffer-found-run-command-error",{src_buf_id:n.src_bfr_id}),!0;if("append"===n.cmd&&void 0===n.seq_id)return n.seq_id=s.seq_id++,d(t.fid,t.uid,n),!1;if(i=t.ms_object,o=s.sb_object,!i||!o||o.updating||"closed"===i.readyState)return!1;n.cmd,s.media_type,n.src_bfr_id;try{if("append"===n.cmd){if(!n.data)return n.src_bfr_id,assert(n.fetch_req),!1;if(!n.aborted){if(!function(t,n,r){for(var i,o=!1;!n.updating;)try{return n.appendBuffer(r.data),!0}catch(a){if("QuotaExceededError"!==a.name)throw a;if(!1===o&&(e.stats.inc("mse_quota_exceeded"),o=!0),void 0===i&&(i=p(t,n)),0===i.length)throw e.stats.inc("mse_quota_exceeded_unrecoverable"),a;i[0][0],i[0][1],r.src_bfr_id,n.remove(i[0][0],i[0][1]),e.stats.add("mse_removed_range",Math.ceil(i[0][1]-i[0][0])),i.splice(0,1)}return!1}(t,o,n))return!1;m(t,n.src_bfr_id)}}else if("report-buffered"===n.cmd)o.buffered.length>0&&(a=f(o),JSON.stringify(a),e.surrogate_channel.send("mse-report-buffered",t.fid,t.uid,n.src_bfr_id,a));else if("abort"===n.cmd)"open"===i.readyState&&(o.abort(),m(t,n.src_bfr_id));else if("remove"===n.cmd){try{o.remove(n.start,n.end)}catch(e){if("TypeError"!==e.name)throw e;o.remove(Math.floor(1e5*n.start)/1e5,Math.ceil(1e5*n.end)/1e5)}m(t,n.src_bfr_id)}else"attr"===n.cmd&&-1!==r.indexOf(n.attr_name)?(a="inf"===n.attr_value?1/0:n.attr_value,o[n.attr_name]=a):(reportErrorClientEvent("tc-mse-unrecognized-source-buffer-command-error",{item:n}),c(t))}catch(e){reportErrorClientEvent("tc-mse-source-buffer-action-error",{cmd:n.cmd,error:e.toString(),type:s.media_type}),c(t)}return!0}function v(t){var n,r=t.queue;if(r.length,!t.error&&void 0===t.ms_object&&r.length&&getNodeByUid(t.fid,t.uid))!function(t){var n,r=t.fid,i=t.uid,o=getNodeByUid(r,i),a=function(){v(t)},d=function(){l(t),t.error=!0,delete t.queue};try{n=new MediaSource,t.ms_object=n,t.object_url=URL.createObjectURL(n),o.src=t.object_url,EventListener.addListener(n,"sourceopen",a),t.so_callback=a,EventListener.addListener(n,"sourceclose",d),t.sc_callback=d,e.media_objects.mark_manually_loaded(r,i)}catch(e){reportErrorClientEvent("tc-mse-mediasource-init-error",{error:e.toString()}),c(t)}t.advance_poller=setInterval((function(){!function(t,n){var r,i,o,a,l,c,d=getNodeByUid(t,n),u=s(t,n),_="Explorer"===browser.name||"Edge"===browser.name?2:.2;if(!d&&u)return void clearInterval(u.advance_poller);if(!d)return;if(d.paused)return void(!1===(e.media_objects.backendValuesForNode(t,n)||{}).paused&&e.media_objects.callPlay(d,t,n));i=d.currentTime,l=d.prev_currentTime,d.prev_currentTime=i,l&&l===i?u.same_currentTime_count++:u.same_currentTime_count=0;if(u.same_currentTime_count<2)return;for(r=d.buffered,a=0,c=0;c<r.length&&i>=a;c++){if((o=r.start(c))>i&&o-i<_&&r.end(c)-o>5){d.currentTime=r.start(c)+.01;break}a=r.end(c)}}(r,i)}),200)}(t);else for(;!t.error&&r.length;){if(!((n=r[0]).src_bfr_id?h:u)(t,n))return;r.shift()}}function w(e,n){var r=i.get_media_source_or_falsy(e,n);r&&(r.queue&&r.queue.length&&r.queue[0].fetch_req&&r.queue[0].fetch_req.abort(),l(r)),function(e,n){var r=o(e,n),i={key:r,source_buffers:{},queue:[],fid:e,uid:n};t[r]=i}(e,n)}i.get_media_source_or_falsy=function(e,n){return t[o(e,n)]},i.get_buffered_ranges=function(){var e,n,r,i,o,a,s={},l=0;for(e in t)if(t.hasOwnProperty(e)){for(i in n={},a=0,r=t[e].source_buffers)r.hasOwnProperty(i)&&(o=f(r[i].sb_object),n[a]=o,a++);s[l]=n,l++}return JSON.stringify(s)},i.remove_range=function(e,n){var r,i,o;1===(r=Object.getOwnPropertyNames(t)).length&&(i=t[r[0]],1===(o=Object.getOwnPropertyNames(i.source_buffers)).length&&_(i,{cmd:"remove",src_bfr_id:o[0],start:e,end:n}))},e.interp.registerOpcodeHandler("mse_end_of_stream",(function(e,t,n){_(s(e,t),{cmd:"end_of_stream",error:n})})),e.interp.registerOpcodeHandler("mse_attach_media_src",(function(e,t){w(e,t)})),e.interp.registerOpcodeHandler("mse_add_src_bfr",(function(e,t,n,r){_(s(e,t),{cmd:"add_src_bfr",id:n,media_type:r})})),e.interp.registerOpcodeHandler("mse_remove_src_bfr",(function(e,t,n){_(s(e,t),{cmd:"remove_src_bfr",id:n})})),e.interp.registerOpcodeHandler("mse_set_duration",(function(e,t,n){_(s(e,t),{cmd:"set_duration",duration:n})})),e.interp.registerOpcodeHandler("mse_add_to_src_bfr",(function(e,t,n){var r,i,o,a,l=s(e,t),c=[];if(!l.error){for(o=(r=l.queue).length;o>1&&(i=r[o-1]).src_bfr_id&&i.src_bfr_id!==n;)"append"===i.cmd&&-1===c.indexOf(i.src_bfr_id)&&c.push(i.src_bfr_id),o--;for(1===o&&"append"===r[0].cmd&&-1!==(a=c.indexOf(r[0].src_bfr_id))&&c.splice(a,1);o<r.length&&c.length>0;)"append"===(i=r[o]).cmd&&-1!==(a=c.indexOf(i.src_bfr_id))&&c.splice(a,1),o++;r.length,r.splice(o,0,{cmd:"append",src_bfr_id:n}),g(l,n),v(l)}})),e.interp.registerOpcodeHandler("mse_abort_src_bfr",(function(e,t,n){var r,i,o=s(e,t);if(void 0!==o&&void 0!==o.source_buffers&&o.source_buffers.hasOwnProperty(n)){if(0!==o.source_buffers[n].sb_object.buffered.length)for(r=0;r<o.queue.length;r++)(i=o.queue[r]).src_bfr_id!==n||i.fetch_req||(i.aborted=!0);_(o,{cmd:"abort",src_bfr_id:n})}})),e.interp.registerOpcodeHandler("mse_remove_from_src_bfr",(function(e,t,n,r,i){var o=s(e,t);_(o,{cmd:"remove",src_bfr_id:n,start:r,end:i}),g(o,n)})),e.interp.registerOpcodeHandler("mse_set_src_bfr_attr",(function(e,t,n,r,i){_(s(e,t),{cmd:"attr",src_bfr_id:n,attr_name:r,attr_value:i})})),e.interp.registerOpcodeHandler("mse_src_close",(function(e,t){var n=s(e,t);n&&!n.error&&_(n,{cmd:"src_close"})})),e.callback.register("new-media-node",(function(t,n){var r=i.get_media_source_or_falsy(t,n);void 0!==r&&(e.media_objects.mark_manually_loaded(t,n),v(r))})),window.EncryptedMediaExtensions||(e.interp.registerOpcodeHandler("eme_request",(function(){})),e.interp.registerOpcodeHandler("eme_set_element",(function(){})))}function Mp3Session(e,t,n,r,i,o,a){var s,l,c,d,u,_,f,p,m=this,g=!1,h=[],v={};a.logger;function w(){s.currentTime;s.buffered.length&&s.buffered.end(s.buffered.length-1),s.seekable.length&&s.seekable.end(s.seekable.length-1),m.session_type()}function y(t){m.session_type(),s&&(u&&clearInterval(u),a.test_mode&&(s.buffered.length&&(v.buffer_time=s.buffered.end(s.buffered.length-1)),v.reason=t,v.current_time=s.currentTime,v.complete=!0),s.parentNode.removeChild(s),s=null,o&&o(e))}function b(){var e;if(h.length&&!c.updating&&(e=h.shift()).byteLength)try{c.appendBuffer(e)}catch(e){reportErrorClientEvent("tc-wa-mse-append-error",{error:e.toString()}),y("append error")}}function E(){(c=l.addSourceBuffer("audio/mpeg")).addEventListener("updateend",b)}function A(e){var t;switch(e.type,a.test_mode&&(v.event_history+=" "+e.type+":"+Math.floor((new Date).getTime()%1e6)),e.type){case"canplay":m.is_primed?s.play():g=!0;break;case"error":case"abort":s.error&&(t=s.error.code),y(e.type+" error="+t),reportWarnClientEvent("tc-wa-mp3-playback-error",{session_type:m.session_type(),event_type:e.type});break;case"ended":y(e.type)}}function U(){var e,t=["canplay","error","abort","ended"];for(s=document.createElement("audio"),document.body.appendChild(s),e=0;e<t.length;e+=1)EventListener.addListener(s,t[e],A);DEBUG&&a.log_detail&&(u=setInterval(w,a.detail_log_interval_ms))}m.append_audio_data=function(n){assert(null===t),s?(l||((l=new MediaSource).addEventListener("sourceopen",E),s.src=URL.createObjectURL(l)),h.push(n),c&&!c.updating&&b()):reportErrorClientEvent("tc-wa-invalid-context",{ctx_id:e,reason:"session has ended"})},m.handle_webaudio_state_change=function(e){var n,r,i=0;assert(null===t),"close"===e&&(s&&s.buffered.length&&(n=s.buffered.end(s.buffered.length-1))>(r=s.currentTime)&&(i=Math.round(1e3*(n-r))),setTimeout((function(){l&&l.endOfStream()}),i+1e3))},m.session_type=function(){return null!==t?"mp3_http":"mp3_mse"},m.get_stats=function(){return v},m.on_audio_primed=function(){m.is_primed=!0,g&&(s.play(),g=!1)},m.manage_latency=function(){var e=0;s&&(s.buffered.length&&(e=s.buffered.end(s.buffered.length-1)),e-s.currentTime>(i+d)/1e3&&(s.currentTime,s.currentTime=e-(i-d)/1e3,s.currentTime))},a.test_mode&&(v.buffer_time=0,v.current_time=0,v.event_history="init:"+Math.floor((new Date).getTime()%1e6),v.complete=!1),m.is_primed=n,null!==t?(p={cid:r.pairing_dict.cid,stream_id:t,rand:__randstr(8)},r.pairing_dict.cluster_id&&(p.cl=r.pairing_dict.cluster_id),d=200,_=r.url_builder.buildClusterURL("/c/wa/?"+Util.buildQueryStr(p)),U(),(f=document.createElement("source")).setAttribute("type","audio/mpeg"),f.setAttribute("src",_),s.appendChild(f)):(d=75,U())}function AdpcmSession(e,t,n,r,i){var o,a=this,s=[],l=0,c=0,d=.1,u=!1,_=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8],f=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767],p=[0,0,0,0,0,0],m=[0,0,0,0,0,0],g={},h=0,v=!0;i.logger;function w(e,t,n,r){var i,a,s,l,c,d,u=n.length/e;for(d=o.createBuffer(e,u,t),l=0;l<e;l+=1)if(c=n.subarray(l*u,(l+1)*u),d.copyToChannel)d.copyToChannel(c,l);else for(s=d.getChannelData(l),a=0;a<c.length;a+=1)s[a]=c[a];(i=o.createBufferSource()).onended=function(){y()},i.buffer=d,i.connect(o.destination),i.start(r)}function y(){for(var e,t,r,i,a,l,u;s.length&&(e=s[0][0],t=s[0][1],r=s[0][2],i=s[0][3],u=c,l=o.currentTime,(u+=e/1e3)+d<l&&(o.currentTime,d=l-u+.1),DEBUG&&!v&&o.currentTime,(a=u+d)-l<=n/1e3);)w(t,r,i,a),c=u+i.length/t/r,s.shift()}function b(e,t){var n,r=m[t],i=f[r],o=i>>3;return 4&e&&(o+=i),2&e&&(o+=i>>1),1&e&&(o+=i>>2),n=8&e?p[t]-o:p[t]+o,(r+=_[e])<0?r=0:r>88&&(r=88),n>32767?n=32767:n<-32768&&(n=-32768),p[t]=n,m[t]=r,n/32768}a.handle_webaudio_state_change=function(t){switch(t){case"close":setTimeout((function(){o&&(o.close(),o=null),i.test_mode&&(g.complete=!0),r&&r(e)}),1e3*(d+.5));break;case"suspend":if(l&&reportWarnClientEvent("tc-wa-invalid-transition",{state_change:t}),!o){l=-1;break}l=o.currentTime;break;case"resume":if(-1===l){l=0;break}if(!l){reportWarnClientEvent("tc-wa-invalid-transition",{state_change:t});break}c+=o.currentTime-l,l=0;break;default:assert(!1)}},a.append_audio_data=function(e,t,n,r,a){var l,c,d,_,f,p;switch(l=new Uint8Array(a),r){case"f32le":p=(c=new Float32Array(a)).length/t;break;case"s16le":for(p=(d=new Int16Array(a)).length/t,c=new Float32Array(d.length),f=0;f<d.length;f+=1)_=d[f],c[f]=_<32768?_/32768:-(65535-_)/32768;break;case"adpcm":p=2*l.length/t,c=function(e,t){var n,r,i,o,a=0,s=0,l=2*t.length/e,c=new Float32Array(l*e);for(r=0;r<e;r+=1)for(i=t.subarray(r*l/2,(r+1)*l/2),o=c.subarray(r*l,(r+1)*l),s=0,a=0;a<i.length;a+=1)n=i[a],o[s]=b(n>>4&15,r),o[s+1]=b(15&n,r),s+=2;return c}(t,l);break;default:assert(!1)}if(DEBUG&&(h<=0?(v=!1,h=i.detail_log_interval_ms):v=!0,h-=1e3*p/n),o){if(DEBUG&&!v&&(a.length,l.length,c&&c.length),i.test_mode)for(g.silence_skip_ms+=e,f=0;f<c.length;f+=1)g.energy+=c[f]*c[f];u&&(u=!1,e=0),function(e,t,n,r){s.push([e,t,n,r]),y()}(e,t,n,c)}},a.session_type=function(){return"adpcm"},a.get_audio_context=function(){return o},a.set_audio_context=function(e){assert(!o),o=e,u=!0},a.manage_latency=function(){var e,t,n,r,i=0;if(s.length){for(;s.length;)t=(e=s.shift())[0],n=e[1],r=e[2],i+=t/1e3+e[3].length/n/r;DEBUG&&o.currentTime,c+=i,d-=i,DEBUG&&o.currentTime}},a.get_stats=function(){return g},i.test_mode&&(g.silence_skip_ms=0,g.energy=0,g.complete=!1),o=t}function WebAudioManager(e){var t=this,n={},r={},i=!1,o=BrowserDetect.isSafari(),a=BrowserDetect.isSafari(),s=null,l=window.AudioContext||window.webkitAudioContext,c=5,d=new Logger("webaudio",{level:"info"}),u={test_mode:!1,logger:d,log_detail:!1,detail_log_interval_ms:2e3};function _(e,t){c>0&&(reportErrorClientEvent(e,t),c-=1)}function f(e){u.test_mode||delete n[e]}t.mute_if_wa_src_node=function(e,t){var n,i=e+"_"+t;return void 0!==r[i]&&(!1===r[i]&&(n=getNodeByUid(e,t))&&(n.muted=!0,r[i]=!0),!0)},t.set_delivery_method=function(t){if(-1===["mp3_mse","mp3_http","adpcm"].indexOf(t))return!1;u.test_mode=!0,e.surrogate_channel.send("set_wa_params",t,5,1e3)},t.get_stats=function(){var e,t={};for(e in t.mp3_mse=[],t.mp3_http=[],t.adpcm=[],n)n.hasOwnProperty(e)&&t[n[e].session_type()].push(n[e].get_stats());return JSON.stringify(t)},e.interp.registerOpcodeHandler(e.interp.OPCODES.WEB_AUDIO_DATA,(function(e,t,r,i,o,a,s){var l,c,d,u,f;for(l=window.atob(s),c=new ArrayBuffer(l.length),d=new Uint8Array(c),u=0;u<l.length;u+=1)d[u]=l.charCodeAt(u);switch(f=e+"_"+t,a){case"mp3":if(!n[f]||"mp3_mse"!==n[f].session_type())return void _("tc-wa-invalid-context",{ctx_id:t,type:a,session_found:!!n[f]});n[f].append_audio_data(d);break;case"f32le":case"s16le":case"adpcm":if(!n[f]||"adpcm"!==n[f].session_type())return void _("tc-wa-invalid-context",{ctx_id:t,type:a,session_found:!!n[f]});n[f].append_audio_data(r,i,o,a,c);break;default:_("tc-wa-unknown-type",{ctx_id:t,type:a})}})),e.interp.registerOpcodeHandler(e.interp.OPCODES.WEB_AUDIO_STATE_CHANGE,(function(t,r,c,d,_){var p,m=t+"_"+r;switch(c){case"start":if(n[m])return void reportErrorClientEvent("tc-wa-invalid-context",{ctx_id:r,reason:"session exists"});d?n[m]=new Mp3Session(m,null,!o,e,_,f,u):(i=!0,a?(p=s,s=null):p=new l,n[m]=new AdpcmSession(m,p,_,f,u));break;case"close":case"suspend":case"resume":if(!n[m]||"mp3_http"===n[m].session_type())return void reportErrorClientEvent("tc-wa-invalid-context",{ctx_id:r,state_change:c,session_found:!!n[m]});n[m].handle_webaudio_state_change(c);break;default:reportErrorClientEvent("tc-wa-invalid-state",{ctx_id:r,state:c})}})),e.interp.registerOpcodeHandler(e.interp.OPCODES.WEB_AUDIO_SOURCE_NODE,(function(e,t){var n=e+"_"+t,i=getNodeByUid(e,t);i?(i.muted=!0,r[n]=!0):r[n]=!1})),e.interp.registerOpcodeHandler(e.interp.OPCODES.WEB_AUDIO_HTTP_STREAM,(function(t,r,i){var a=t+"_"+r;n[a]?reportErrorClientEvent("tc-wa-invalid-context",{ctx_id:a,stream_id:r,reason:"stream session exists"}):n[a]=new Mp3Session(a,r,!o,e,i,f,u)})),e.callback.register("interaction",(function(e){var t,r,c,d,u;e.type;try{r=!!o&&((u=new Audio(Resource.dummyAudioUri))?(u.play(),o=!1,!0):(o=!1,reportErrorClientEvent("tc-wa-audio-prepare-error",{error:"Failed to create audio element"}),!1)),function(){var e;if(!s&&i&&a){if(!(s=new l))return a=!1,void reportErrorClientEvent("tc-wa-audio-prepare-error",{error:"Failed to create audio context"});(e=s.createBufferSource()).buffer=s.createBuffer(1,24,24e3),e.connect(s.destination),e.start(),"running"!==s.state&&(e.disconnect(s.destination),e=null,s.close(),s=null,_("tc-wa-audio-prepare-error",{error:"Audio context failed to run"}))}}()}catch(e){a=!1,o=!1,reportErrorClientEvent("tc-wa-audio-prepare-error",{error:e.toString()})}for(t in n)n.hasOwnProperty(t)&&("mp3_mse"!==(d=(c=n[t]).session_type())&&"mp3_http"!==d||!r?"adpcm"===d&&!c.get_audio_context()&&s&&(c.set_audio_context(s),s=null):c.on_audio_primed(),n[t].manage_latency())}))}function RestoreOnReattach(e){var t,n="__SV_SCROLL_POSITION",r=0,i=0;function o(){var e=(t||{}).scroll,n=document.documentElement;!e||(!e.X||e.X<=0)&&(!e.Y||e.Y<=0)||(n?e.X>0&&n.scrollWidth!==n.clientWidth||e.Y>0&&n.scrollHeight!==n.clientHeight?(window.scrollTo(e.X,e.Y),++r<20&&setTimeout(o,100)):i<50&&(i++,setTimeout(o,100)):setTimeout(o,100))}this.save_state=function(){var t=!1;if(e&&e.pairing_dict&&e.pairing_dict.client_caps&&(t=(e.pairing_dict.client_caps.restore_tab||{}).enabled),t){var r,i=document.documentElement;if(i&&(r=Util.getBrowserScrollOffset(i,i.getBoundingClientRect()))&&(r.x>0||r.y>0))try{sessionStorage.setItem(n,JSON.stringify({scroll:{X:r.x,Y:r.y}}))}catch(e){}}},function(){try{(t=JSON.parse(sessionStorage.getItem(n)))&&setTimeout(o,100),sessionStorage.removeItem(n)}catch(e){}}()}function CanvasSupport(e){var t,n={},r={},i=this;function o(){var e,n=r;for(e in r={},t=null,n)n.hasOwnProperty(e)&&a.apply(i,n[e])}function a(e,i,a,s){var l,c=i+"_"+a,d=getNodeByUid(i,a);if(!d)return r[c]=[e,i,a,s],void(t||(t=window.setTimeout(o,1e3)));"canvas"===d.nodeName.toLowerCase()?n[c][0]>s||(n[c][0]=s,(l=d.getContext("2d")).globalCompositeOperation="copy",l.drawImage(e,0,0,d.width,d.height),window.URL.revokeObjectURL(e.src)):reportWarnClientEvent("tc-canvas-mismatch",{fid:i,uid:a,node:d.nodeName})}e.interp.registerBinaryHandler((function(e,t){var r,i,o,s,l,c,d;return i=(o=(s=new window.DataView(t.buffer,t.byteOffset,8)).getUint32(0,!1))+"_"+(c=s.getUint32(4,!1)),r=new window.Blob([new window.Uint8Array(t.buffer,t.byteOffset+8)],{type:"image/png"}),n[i]?n[i][1]+=1:n[i]=[0,1],d=n[i][1],(l=new Image).onload=a.curry(l,o,c,d),l.src=window.URL.createObjectURL(r),!0}))}function URLBuilder(e){var t=this;function n(e){return"/"!==e.substr(0,1)&&(e="/"+e),e}t.getDomain=function(t){if(!TPROXY_ENABLED&&Util.isIpAddress(window.location.hostname))return window.location.hostname;switch(t){case"service":return TPROXY_ENABLED?CLUSTER_DOMAIN:window.location.hostname;case"login":return window.LOGIN_DOMAIN;case"cluster":case"inspect":case"cluster-protocol":return"main"!==e.role?CLUSTER_DOMAIN:"cluster"===t?e.pairing_dict.hasOwnProperty("cluster_domain")&&e.pairing_dict.cluster_domain||CLUSTER_DOMAIN:"cluster-protocol"===t?e.pairing_dict.hasOwnProperty("protocol_domain")&&e.pairing_dict.protocol_domain||PROTOCOL_DOMAIN:e.pairing_dict.hasOwnProperty("inspect_domain")&&e.pairing_dict.inspect_domain||INSPECT_DOMAIN;default:throw new Error("invalid domain kind "+t)}},t.buildProtocolUrl=function(e,r){return assert(e),assert(e),(r?"wss://":"https://")+t.getDomain("cluster-protocol")+n(e)},t.buildFileServerUrl=function(n,r,i){var o,a=r?t.buildInspectURL:t.buildProtocolUrl,s={cid:e.pairing_dict.s_nid_with_underscore,rid:e.pairing_dict.rid};if(e.pairing_dict.cluster_id&&(s.cl=e.pairing_dict.cluster_id),i)for(o in i)i.hasOwnProperty(o)&&(s[o]=i[o]);return a(n+"?"+Util.buildQueryStr(s,!1))},t.buildClusterURL=function(r){return __startswith(r,"/c/")&&(r="/c/"+(e.pairing_dict.mpa_id?"mpa-"+e.pairing_dict.mpa_id:"0")+r.substr(2)),"https://"+t.getDomain("cluster")+n(r)},t.buildInspectURL=function(e){return"https://"+t.getDomain("inspect")+n(e)},t.buildImageURLFromU8Array=function(e){var n,r,i,o;return r=function(e){var t,n="";for(t=0;t<e.byteLength;t+=1)n+=String.fromCharCode(e[t]);return n}(e).split("|sv_tok="),o=r[0],n=window.btoa(o).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"~"),i=r[1]?"?k="+r[1]:"",t.buildClusterURL("/c/i/"+n)+i},t.buildAssetURL=function(e){return t.buildClusterURL(e)+"?v="+BUILD_ID},t.buildServiceURL=function(e){return"https://"+t.getDomain("service")+n(e)},t.buildLoginURL=function(e){return"https://"+t.getDomain("login")+n(e)},t.buildVanityFileTransferURL=function(e){return TPROXY_ENABLED?t.buildLoginURL(e):t.buildServiceURL(e)},t.getServiceDomain=function(){return"https://"+t.getDomain("service")}}function Template(){var e=this,t={};e.get=function(n,r){var i,o;if(!e.has(n))throw new Error('Invalid template "'+n+'"');if(i=t[n],r)for(o in r)r.hasOwnProperty(o)&&(i=i.replace("{{"+o+"}}",r[o]));return i},e.has=function(e){return t.hasOwnProperty(e)},function(){var e,n,r,i,o;for(n=document.getElementsByTagName("sv-template"),e=0;e<n.length;e+=1)assert(r=n[e].id),t[r]=(i=n[e],o=void 0,assert(o=i.getAttribute("content")),Util.b64Decode(o)),assert(t[r]);assert(t)}()}function Localization(e,t){var n={};this.get=function(e){var t,r=n[e];if(void 0===r)return reportErrorClientEvent("tc-localization-no-entry",{id:e}),e;for(t=1;t<arguments.length;t+=1)r=r.replace("$"+t,arguments[t]);return r},this.get_localization_data=function(){return n},function(){if(t)n=t;else{var r=e.template.get("localization-template");r=Util.replaceAll(r,"&#39;","'"),n=JSON.parse(r)}}()}function ServerCall(){this.call=function(e){return function(e){var t=e.type||(e.data?"POST":"GET"),n=new SCContext(0,e),r=new XMLHttpRequest;return r.open(t,e.url),r.withCredentials=!0,e.timeout&&(r.timeout=e.timeout),r.onreadystatechange=function(){var e;if(4===r.readyState){if(r.status>=200&&r.status<300)for(e=0;e<n.done_cbs.length;e+=1)n.done_cbs[e](r.responseText?JSON.parse(r.responseText):r.responseText,r);else for(e=0;e<n.fail_cbs.length;e+=1)n.fail_cbs[e](r,r.statusText);for(e=0;e<n.always_cbs.length;e+=1)n.always_cbs[e](r,r.statusText)}},e.data?r.send(e.data):r.send(),n.abort=function(){r.abort()},n}(function(e){var t;return assert((t=__object_assign({},e)).url),t.no_tracking_label||(t.url=new ParsedURL(t.url).withTrackingLabel()),t.type=t.type||"POST",t.dataType="json",t.timeout||(t.timeout=safeview.perf.xhr_timeout_ms),t.success&&(t.success=t.success.bind(e)),t.complete&&(t.complete=t.complete.bind(e)),assert(!t.orig_error_func),t.orig_error_func=t.error,t.error=function(n,r){t.skip_report||reportClientEvent("tc-server-call-failed",{url:t.url,method:t.type,dataType:t.dataType,timeout:t.timeout,textStatus:r,responseHeaders:n.getAllResponseHeaders(),statusCode:n.status}),t.orig_error_func&&t.orig_error_func.call(e,n,r)},t}(e))}}function SCContext(e,t){var n=this;n.call_id=e,n.done_cbs=[],n.fail_cbs=[],n.always_cbs=[],n.done=function(e){return n.done_cbs.push(e),n},n.fail=function(e){return n.fail_cbs.push(e),n},n.always=function(e){return n.always_cbs.push(e),n},t.success&&n.done_cbs.push(t.success),t.error&&n.fail_cbs.push(t.error),t.complete&&n.always_cbs.push(t.complete)}function ServerCallDelegate(e){var t={},n=0;this.call=function(r){var i=new SCContext(n,r);return t[n]=i,n+=1,function(t,n){e.postToCommFrame({kind:"server_call",fid:e.fid,call_id:t.call_id,op_name:n.op_name,data:n.data,timeout:n.timeout})}(i,r),i},this.on_sc_result=function(e,n,r){assert("server_call_resp"===r.kind);var i,o=r.call_id,a=t[o];if(a){switch(r.ret){case"done":for(i=0;i<a.done_cbs.length;i+=1)a.done_cbs[i](r.result);break;case"fail":for(i=0;i<a.fail_cbs.length;i+=1)a.fail_cbs[i](r.xhr,r.text_status);break;default:assert(!1)}for(i=0;i<a.always_cbs.length;i+=1)a.always_cbs[i](r.xhr,r.text_status);delete t[o]}else reportErrorClientEvent("tc-sc-delegate-context-missing")}}function ServerCallDispatcher(e){this.dispatch=function(t,n){assert("server_call"===n.kind);var r=function(t){var n,r={},i=e.url_builder;switch(t.data&&(r.data=t.data),t.call_timeout&&(r.timeout=t.call_timeout),t.op_name){case"client_event":n=i.buildProtocolUrl("/safeview-client-logger/clientevent");break;case"get_download_action":n=i.buildFileServerUrl("/safeview-fileserv/tc_status");break;case"query_policy":n=i.buildProtocolUrl("/r/policy/query");break;case"policy_action":n="/r/policy/"+t.action+(t.cid?"?cid="+t.cid:""),t.cluster_id&&(n+=(t.cid?"&":"?")+"cl="+t.cluster_id);break;case"ui_html":n=i.buildProtocolUrl("/safeview-template/ui.html");break;case"stop_stream":n=i.buildClusterURL("/RDS/streamcontrol/stop/"+t.plugin_view_id+"?cid="+e.pairing_dict.s_nid_with_underscore+"&rid="+e.pairing_dict.rid),e.pairing_dict.cluster_id&&(n+="&cl="+e.pairing_dict.cluster_id);break;default:assert(!1)}return r.url=n,r}(n);e.server_call.call(r).done((function(r){e.postToFrame(t,{kind:"server_call_resp",call_id:n.call_id,ret:"done",result:r})})).fail((function(r,i){var o={};o.status=r.status,e.postToFrame(t,{kind:"server_call_resp",call_id:n.call_id,ret:"fail",xhr:o,text_status:i})}))}}function CrossOriginFrameCore(e){this.createServerFrame=function(t){var n=document.createElement("iframe");return n.id="cof-server:"+e,n.src=t,n.width="0",n.height="0",n.style.display="none",n.tabindex="-1",n},this.attachServerFrame=function(t){document.getElementById("cof-server:"+e)||(t.parentNode||document.documentElement.appendChild(t),assert(t.parentNode))}}function CrossOriginFrame(e,t,n){var r,i=null,o=0,a={},s=[],l=new ParsedURL(t).origin;this.onReceiveMessage=function(t){var n;if(t.origin===l){try{n=JSON.parse(t.data)}catch(e){return void reportWarnClientEvent("tc-cof-client-unexpected-message",{detail:t.data,error:e.toString()})}switch(n.kind){case"register-server":!function(t){var n;for(assert(i),assert(i.iframe.contentWindow),e.pairing.surrogateInfoRecovery(t.surrogate_info),i.iframe.contentWindow.postMessage({kind:"register-ack"},l),i.is_registered=!0,n=0;n<s.length;n+=1)s[n](i);s=[]}(n);break;case"call-result":!function(e){var t=a[e.call_id];delete a[e.call_id],t&&t(e.result)}(n);break;case"auth-check-reauth":e.pairing.doRecookie(n.result[0]);break;case"inspect-onerror":e.upload.oninspecterror.apply(null,n.result);break;case"inspect-onsuccess":e.upload.oninspectsuccess.apply(null,n.result);break;case"upload-onerror":e.upload.onerror(n.result[0]);break;case"upload-onload":e.upload.onload(n.result[0],n.result[1]);break;case"upload-onprogress":e.upload.onprogress(n.result[0]);break;default:assert(0)}}else reportWarnClientEvent("tc-cof-client-unexpected-origin",{expected_origin:l,actual_origin:t.origin})},this.call=function(e,t,n){var r={kind:"call",call_id:o,call_args:e};a[o]=t,o+=1,function(e){i&&i.iframe.contentWindow&&i.is_registered?e(i):s.push(e)}((function(e){var t=e.iframe.contentWindow;assert(e.is_registered),assert(t),BrowserDetect.isIE10()||BrowserDetect.isChrome()?t.postMessage(r,l):t.postMessage(r,l,n)}))},assert(window.postMessage),assert(/^http(s)?:\/\//.test(l)),n?i={iframe:n,is_registered:!1}:(r=new CrossOriginFrameCore(l),i={iframe:r.createServerFrame(t),is_registered:!1},r.attachServerFrame(i.iframe))}function makeURLParams(e){var t,n="";for(t in e)if(e.hasOwnProperty(t)){if(!/^[a-z_]+$/.test(t))continue;if(!/^[a-zA-Z0-9-_.!~*'()%]+$/.test(e[t]))continue;n&&(n+="&"),n+=t+"="+e[t]}return n}function doLoginXHR(e,t,n){var r=new XMLHttpRequest;r.open("POST",t),r.target_url=t,r.withCredentials=!0,r.onload=function(e){var t;if(200===r.status)try{return t=JSON.parse(r.response),void n(t.use_inspect_host)}catch(e){}n()},r.onerror=function(e){n()},r.send(JSON.stringify(e))}function record_auth_check(){try{window.localStorage.setItem("ac_last",(new Date).getTime())}catch(e){}}function record_auth_check_result(e){var t=0;try{e||(t=(parseInt(window.localStorage.getItem("ac_fail"),10)||0)+1),window.localStorage.setItem("ac_fail",t)}catch(e){}}function should_auth_check(){var e,t;try{return e=parseInt(window.localStorage.getItem("ac_fail"),10)||0,t=parseInt(window.localStorage.getItem("ac_last"),10)||0,e<3||t+3e5<(new Date).getTime()}catch(e){return!0}}function RPCHandlers(e){var t=this,n="ws_support",r=null;function i(e){return"surrogate_info"+(e=e?"~"+e:"")}function o(e,n,r,i,o,a,s,l){var c=new XMLHttpRequest;c.open("POST","https://"+e+"/safeview-auth-server/check"),c.timeout=n,c.withCredentials=!0,c.onerror=function(t){record_auth_check_result(!1),console.error("auth check "+e+" response failure")},c.onload=function(n){var r,d;if(200===c.status)if((r=JSON.parse(c.response)).success){if(record_auth_check_result(!r.reauth),r.reauth){if(s)return void t.doITok(null,s,a,null,o.url);d=i&&r.use_integrity_token&&navigator.userAgent.indexOf("Trident")>=0,reportWarnClientEvent("tc-attempt-recookie",{target_url:o.url,login_url:o.login_url,host:e,do_toks:d,redirect_list:o.redirect_list}),d?t.doToksAuth(null,o,o.url):l.postToController({kind:"auth-check-reauth",result:[o]})}}else c.onerror(n);else c.onerror(n)},c.send(JSON.stringify({sb:r})),record_auth_check()}t.getActiveCookie=function(e){return Util.getCookie("active")},t.setActiveCookie=function(e,t){return Util.setCookie("active",t,null,null,null,!0,"None")},t.setNidCookie=function(e,t,n){return n&&Util.setCookie("cl",n,null,"/",null,!0,"None"),Util.setCookie("nid",t,null,"/",null,!0,"None")},t.setWSSupportState=function(e,t,r){var i;void 0===r&&(r=(new Date).getTime()),i={state:t,time:r};try{localStorage.setItem(n,JSON.stringify(i))}catch(e){throw new Error("tc-localstorage-setitem-error")}return i},t.getWSSupportState=function(e,r){var i;try{i=JSON.parse(localStorage.getItem(n))}catch(e){throw new Error("tc-localstorage-getitem-error")}return i||(i=t.setWSSupportState(e,r?"OK":"ERR",0)),i},t.getFeatureReport=function(e){try{return localStorage.getItem("feature_report")}catch(e){return null}},t.setFeatureReport=function(e,t){localStorage.setItem("feature_report",t)},t.setSurrogateInfo=function(e,t,n){localStorage.setItem(i(t),n)},t.getSurrogateInfo=function(e,t){try{return JSON.parse(localStorage.getItem(i(t)))}catch(e){return{}}},t.doToksAuth=function(e,t,n){var r,i=__randstr(43,!0),o=Util.buildLoginForm(t,n);try{window.localStorage.setItem("tok_s",i),(r=document.createElement("input")).type="hidden",r.name="tok_s",r.value=i,o.appendChild(r)}catch(e){console.error("Failed to use local storage.")}Util.submitLoginForm(o,"_parent")},t.doAuthCheck=function(t,n,r,i){var a;if(n.check_hosts&&should_auth_check())for(a=0;a<n.check_hosts.length;a+=1)o(n.check_hosts[a],n.timeout,n.sb,n.transparent_mode,r,n.check_hosts,i,e)},t.doITok=function(e,t,n,r,i){var o,a,s,l=n.length,c=!1;o=new ParsedURL(i).host;try{s=window.localStorage.getItem("tok_s")}catch(e){console.log("Failed to get tok_s from local storage.")}if(!s)return!1;function d(e){l-=1,e&&!c&&(c=!0,l+=1,doLoginXHR({itok:t,tok_s:s,host:o},"https://"+r+"/safeview-auth-server/do_itok_auth",d)),0===l&&Util.locationSet(window.top,i)}for(a=0;a<n.length;a+=1)doLoginXHR({itok:t,tok_s:s,host:o},"https://"+n[a]+"/safeview-auth-server/do_itok_auth",d);return!0},t.doUpload=function(t,n,i,o){var a=new FormData,s=new XMLHttpRequest,l=new Blob([o],{type:"application/octet-stream"});n.pm_origin=encodeURIComponent(t),a.append("file",l,i),s.open("POST",window.location.origin+"/r/upload?"+makeURLParams(n)),s.withCredentials=!0,s.onload=function(t){r=null,e.postToController({kind:"upload-onload",result:[s.status,s.responseText]})},s.upload.onprogress=function(t){e.postToController({kind:"upload-onprogress",result:[t.loaded]})},s.onerror=function(){e.postToController({kind:"upload-onerror",result:[s.status]}),r=null},s.onabort=function(){r=null},r=s,s.send(a)},t.doUploadAbort=function(e){r&&r.abort&&r.abort()},t.doInspect=function(t,n,r,i,o){var a=new XMLHttpRequest;n.pm_origin=encodeURIComponent(t),a.open("POST",window.location.origin+"/r/user_input?"+makeURLParams(n)),a.input_count=r,a.onload=function(t){200!==a.status||"MSIP_OK"!==a.responseText?e.postToController({kind:"inspect-onerror",result:[a.input_count,a.status,a.responseText]}):e.postToController({kind:"inspect-onsuccess",result:[a.input_count]})},a.onerror=function(){e.postToController({kind:"inspect-onerror",result:[a.input_count,a.status]})},a.setRequestHeader("Content-Type",o||"application/x-www-form-urlencoded"),a.setRequestHeader("Accept","text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"),a.send(i)},t.setDebugFlag=function(e,t){window.DEBUG=t}}function CrossOriginFrameServer(e){var t,n=this,r=new Logger("cof-server",{level:"info"}),i=new RPCHandlers(n),o={getActiveCookie:i.getActiveCookie,setActiveCookie:i.setActiveCookie,setNidCookie:i.setNidCookie,getFeatureReport:i.getFeatureReport,setFeatureReport:i.setFeatureReport,setSurrogateInfo:i.setSurrogateInfo,getWSSupportState:i.getWSSupportState,setWSSupportState:i.setWSSupportState,doToksAuth:i.doToksAuth,doAuthCheck:i.doAuthCheck,doITok:i.doITok,doUpload:i.doUpload,doUploadAbort:i.doUploadAbort,doInspect:i.doInspect,setDebugFlag:i.setDebugFlag};function a(e){window.parent.postMessage(JSON.stringify(e),"*")}function s(){var e=Util.mpa_id_from_url(document.referrer);a({kind:"register-server",domain:location.hostname,surrogate_info:i.getSurrogateInfo(window.origin,e)})}function l(e){var n,s,l,c;if("register-ack"!==(n=e.data).kind){assert("call"===n.kind);try{l=n.call_args[0]}catch(t){return void reportWarnClientEvent("tc-cof-server-unexpected-message",{detail:e.data,error:t.toString()})}if(o.hasOwnProperty(l)){try{(c=n.call_args.slice(1)).unshift(e.origin),s=o[l].apply(i,c)}catch(e){r.error({event:"tc-cof-rpc-exception",e:e.toString()}),s=null}JSON.stringify(n.call_args),a({kind:"call-result",call_id:n.call_id,result:s})}else reportWarnClientEvent("tc-cof-server-unexpected-method",{method_name:l})}else clearInterval(t)}n.init=function(){window.BUILD_ID=Util.getParam("v"),n.event_reporter=new ClientEventReporter(n),n.xbrowser=new XBrowserHelpers,EventListener.addListener(window,"message",l,!1),s(),t=setInterval(s,200)},n.postToController=a}function BrowserVoodoo(e){function t(){setInterval((function(){var e,t;for(e in fidToIframeNode)fidToIframeNode.hasOwnProperty(e)&&(t=fidToIframeNode[e])&&t.contentDocument&&t.contentDocument.close()}),5e3)}"Chrome"===browser.name&&45===browser.version&&e.callback.registerOneShot("dom-loaded",6e3,{on_success:t,on_timeout:t})}function PolicySupport(e){this.getValues=function(t,n){var r={},i="/r/policy/query";r.url=Util.removePrefix(Util.getRawPageUrl()),r.policy_keys=t,r.transparent_mode=TPROXY_ENABLED,r.host=window.HOST,e.serverCall({op_name:"query_policy",url:e.url_builder.buildProtocolUrl(i),data:JSON.stringify(r),timeout:e.perf.xhr_timeout_ms+e.perf.pre_pair_xhr_ms,success:function(e){JSON.stringify(e),n(e)},error:function(e,t){reportClientEvent("tc-policy-query-failed",{status:t,xhr_status:e.status,request_url:i}),n({})}})},this.setAction=function(t,n,r,i,o){var a="/r/policy/"+t+(n?"?cid="+n:"");r&&(a+=(n?"&":"?")+"cl="+r),void 0===i&&(i={}),i.url=Util.removePrefix(Util.getRawPageUrl()),i.host=window.HOST,e.serverCall({op_name:"policy_action",action:t,cid:n,url:e.url_builder.buildProtocolUrl(a),data:JSON.stringify(i),success:function(e){o(e)},error:function(e,n){reportClientEvent("tc-policy-action-failed",{action:t,status:n,xhr_status:e.status,request_url:a}),o({})}})}}function HttpAlertSupport(e){var t,n,r,i=this,o=[],a="menlo-http-alert-css";function s(){var e,r,i=document.documentElement.clientWidth,o=n?n.offsetHeight:0,a=n?n.offsetWidth:0,s=Util.getTopWindowPosition(n),l=0,c=0;t&&"hide"!==t.style.display&&(e=t.offsetHeight,r=t.offsetWidth,s.x+a+r>i&&s.y+o/2-e/2>=1?(t.classList.remove("menlo-http-alert-bottom"),t.classList.add("menlo-http-alert-top"),l=s.x+a/2-r/2,(c=s.y-e-12)<1&&(t.classList.remove("menlo-http-alert-top"),t.classList.add("menlo-http-alert-bottom"),l=s.x+a/2-r/2,c=s.y+o+16)):(t.classList.remove("menlo-http-alert-top"),t.classList.remove("menlo-http-alert-bottom"),l=s.x+a+12,(c=s.y+o/2-e/2)<1&&(t.classList.remove("menlo-http-alert-top"),t.classList.add("menlo-http-alert-bottom"),l=s.x+a/2-r/2,c=s.y+o+16)),t.style.left=l+"px",t.style.top=c+"px")}function l(){n=null,t&&(t.style.display="none")}function c(e){t&&(n=e.target,t.style.display="block",s())}function d(){var i;for(t&&t.parentNode.removeChild(t),r&&e.callback.deregister(r),i=0;i<o.length;i+=1)EventListener.removeListener(o[i],"focus",c),EventListener.removeListener(o[i],"blur",l);n&&n.focus(),t=null,n=null,r=null,o=[]}function u(n,r,i,s){var u,_,f,p;Util.is_element_input_text(r)&&(t||(document.getElementById(a)||document.head.appendChild((_="/safeview-static/css/http-alert.css",f=e.url_builder.buildAssetURL(_),(p=document.createElement("link")).type="text/css",p.id=a,p.rel="stylesheet",p.href=f,p.media="all",p)),document.body.insertAdjacentHTML("beforeend",e.template.get("http-alert-template")),u=document.getElementById("menlo-http-alert-close"),EventListener.addListener(u,"mousedown",d),(t=document.getElementById("menlo-http-alert")).classList.add("menlo-http-alert-hidden"),t.style.display="none"),EventListener.addListener(r,"focus",c),EventListener.addListener(r,"blur",l),o.push(r))}i.configHttpAlert=function(t){!window.TPROXY_ENABLED&&t.client_caps&&t.client_caps.insecure_form_warning&&!t.secure_backend&&(r=e.callback.register("add-element",u))},i.update=function(){t&&s()},i.dismiss=function(){d()}}function LEchoErrorAlert(e){var t,n,r,i,o="menlo-mismatch-alert-css";function a(){var e,r,i=document.documentElement.clientWidth,o=n?n.offsetHeight:0,a=n?n.offsetWidth:0,s=Util.getTopWindowPosition(n),l=0,c=0;t&&"none"!==t.style.display&&(e=t.offsetHeight,r=t.offsetWidth,s.x+a+r>i&&s.y+o/2-e/2>=1?(t.classList.remove("menlo-mismatch-alert-bottom"),t.classList.add("menlo-mismatch-alert-top"),l=s.x+a/2-r/2,(c=s.y-e-12)<1&&(t.classList.remove("menlo-mismatch-alert-top"),t.classList.add("menlo-mismatch-alert-bottom"),l=s.x+a/2-r/2,c=s.y+o+16)):(t.classList.remove("menlo-mismatch-alert-top"),t.classList.remove("menlo-mismatch-alert-bottom"),l=s.x+a+12,(c=s.y+o/2-e/2)<1&&(t.classList.remove("menlo-mismatch-alert-top"),t.classList.add("menlo-mismatch-alert-bottom"),l=s.x+a/2-r/2,c=s.y+o+16)),t.style.left=l+"px",t.style.top=c+"px")}function s(){t&&t.parentNode.removeChild(t),i&&e.callback.deregister(i),r(),r=null,n&&n.focus(),t=null,n=null,i=null}function l(n,r,i,a){var l,c,d,u;Util.can_element_use_lecho(r)&&(t||(document.getElementById(o)||document.head.appendChild((c="/safeview-static/css/mismatch-alert.css",d=e.url_builder.buildAssetURL(c),(u=document.createElement("link")).type="text/css",u.id=o,u.rel="stylesheet",u.href=d,u.media="all",u)),document.body.insertAdjacentHTML("beforeend",e.template.get("mismatch-alert-template")),l=document.getElementById("menlo-mismatch-alert-close"),EventListener.addListener(l,"mousedown",s),(t=document.getElementById("menlo-mismatch-alert")).classList.add("menlo-mismatch-alert-hidden"),t.style.display="none"))}function c(){setTimeout((function(){n&&t&&"none"!==t.style.display&&(n.parentNode?(a(),c()):s())}),500)}this.config_alert=function(t){t&&(i=e.callback.register("add-element",l))},this.add_alert_for_input=function(e,i,o){var s=getNodeByUid(e,i);local_echo_config.show_alert?s&&Util.can_element_use_lecho(s)&&(reportClientEvent("tc-lecho-bubble-alert",{},!0,!1),r=o,function(e,r){(n=getNodeByUid(e,r))&&t&&(t.style.display="block",a())}(e,i),c(),DEBUG&&(s.style.background="aqua",s.style.border="solid",s.style.borderColor="red")):reportClientEvent("tc-lecho-bubble-alert",{skipped:!0},!0,!1)}}function PreloadIndicator(e){var t=this,n=[];function r(){var t,r,i,o;n.length>0||(n.push(document.head.appendChild((r="/safeview-static/css/loader.css",i=e.url_builder.buildAssetURL(r),(o=document.createElement("link")).type="text/css",o.id="menlo-loader-css",o.rel="stylesheet",o.href=i,o.media="all",o))),(t=document.createElement("div")).id="menlo-loader-spinner",t.className="menlo-loader-spinner",n.push(document.body.appendChild(t)),(t=document.createElement("div")).id="menlo-loader-info",t.className="menlo-loader-info",n.push(document.body.appendChild(t)))}t.configPreloadIndicator=function(e){e.client_caps&&e.client_caps.preload_indicator&&r()},t.showPreloadIndicator=function(){r()},t.dismiss=function(){!function(){var e;for(e=n.length-1;e>=0;e-=1)n[e]&&n[e].parentNode&&n[e].parentNode.removeChild(n[e]);n=[]}()}}function ReadonlySupport(e){var t,n=this,r=!1,i=e.url_builder.buildAssetURL("/safeview-static/images/logo.png"),o={ro:{hidden:!1,has_banner:!1,hide_class:" safemail-banner-hidden",div_id:"safemail-readonly-banner",button_id:"safemail-disable-btn",logo_id:"safemail-logo",hide_id:"safemail-hide",div:null,template:"ro-banner-template",css:"/safeview-static/css/readonly.css",css_id:"__safly_ro_css_id",css_link:null},bw:{hidden:!1,has_banner:!1,hide_class:" bandwidth-banner-hidden",div_id:"bandwidth-banner",button_id:"bandwidth-disable-btn",logo_id:"bandwidth-logo",hide_id:"bandwidth-hide",div:null,template:"bw-banner-template",css:"/safeview-static/css/bandwidth.css",css_id:"__safly_bw_css_id",css_link:null},isolation:{hidden:!1,has_banner:!1,hide_class:" isolation-banner-hidden",div_id:"isolation-banner",button_id:"isolation-disable-btn",btn_hide_class:" isolation-hidden",logo_id:null,hide_id:"isolation-hide",div:null,template:"custom-indicator-template",css:"/safeview-static/css/isolation.css",css_id:"__safly_ro_css_id",css_link:null}},a={};function s(){return"read_only"===Util.persistentPolicy().entry_action}function l(t){o[t].div.className.indexOf(o[t].hide_class)<0?(o[t].hidden=!0,o[t].div.className+=o[t].hide_class):(o[t].hidden=!1,o[t].div.className=o[t].div.className.replace(o[t].hide_class,"")),"ro"===t&&e.surrogate_channel.send("banner_hidden",o[t].hidden)}function c(){Util.persistentPolicy().exit_url,e.surrogate_channel.send("readonly-mode-relax")}function d(e){o[e].div&&(o[e].div.parentNode.removeChild(o[e].div),o[e].div=void 0),o[e].css_link&&(document.head.removeChild(o[e].css_link),o[e].css_link=void 0),o[e].has_banner=!1}function u(){var t=Util.persistentPolicy(),n=e.tab_store.load();t.upgrade_action,d("ro"),e.policy.setAction("readonly_exit",n.cid,n.cluster_id,{safe_rid:n.safe_rid,tab_id:n.tab_id,exit_mode:t.upgrade_action,persistent_policy:t},c)}function _(t){if("bw"===t)return d(t),void e.surrogate_channel.send("bandwidth-acknowledge");if("isolation"!==t){var n=Util.persistentPolicy();"coach"===n.user_experience_banner&&n.explain&&n.explain.length>0?e.ui_frame.call("showCoachModeModal",n.explain,e.pairing_dict.customization,n.exit_url?u:null,s(),n.upgrade_action):u()}else e.feedback_bar.onBypassClick()}function f(r){var a,c=e.pairing_dict.customization,d=Util.persistentPolicy();document.body.insertAdjacentHTML("beforeend",e.template.get(o[r].template)),o[r].logo_id&&(document.getElementById(o[r].logo_id).src=i),c&&("ro"===r?e.ux.customizeBanner(function(){var e=Util.persistentPolicy();return{explain:e.explain,experience_mode:e.user_experience_banner}}(),c,s(),d.upgrade_action,d.exit_url):"bw"===r&&(e.ux.customizeBandwidthBanner(c),e.ux.customizeBandwidthBannerText(c,o.bw.exceed))),t=document.getElementById(o[r].button_id),EventListener.addListener(t,"click",_.curry(r)),"isolation"===r&&e.feedback_bar.getBypassPolicy()&&n.showBypassSecurity(),o[r].div=document.getElementById(o[r].div_id),a=document.getElementById(o[r].hide_id),EventListener.addListener(a,"click",l.curry(r)),o[r].hidden&&(o[r].div.className+=o[r].hide_class)}function p(t){o[t].has_banner||document.getElementById(o[t].div_id)?"bw"===t&&e.ux.customizeBandwidthBannerText(e.pairing_dict.customization,o.bw.exceed):(Util.ensureElementPresent("head"),Util.ensureElementPresent("body"),document.head.appendChild(function(t,n,r){var i=e.url_builder.buildAssetURL(t),a=document.createElement("link");return a.type="text/css",a.rel="stylesheet",a.href=i,a.id=o[r].css_id,o[r].css_link=a,EventListener.addListener(a,"load",n),a}(o[t].css,f.curry(t),t)),o[t].has_banner=!0)}function m(){switch(a.action){case"warn":case"exceed":o.bw.exceed="exceed"===a.action,a.acknowledge?d("bw"):p("bw");break;case"allow":d("bw");break;case"block":d("bw"),e.media_objects.stopAllMedia()}}n.showBypassSecurity=function(){var e;document.getElementById(o.isolation.button_id)&&((e=document.getElementById(o.isolation.button_id).parentNode).className=e.className.replace(o.isolation.btn_hide_class,""))},n.configBanners=function(){n.isShowingBanner()&&(o.ro.hidden=e.pairing_dict.banner_hidden,r?p("ro"):e.callback.registerOneShot("dom-loaded",0,{on_success:p.curry("ro")})),e.feedback_bar.updateReadonlyUI(),e.template.has(o.isolation.template)&&(r?p("isolation"):e.callback.registerOneShot("dom-loaded",0,{on_success:p.curry("isolation")}))},n.isShowingBanner=function(){var e=Util.persistentPolicy();return!__startswith(Util.getRawPageUrl(),"http://doc/")&&(("read_only"===e.entry_action||"read_write"===e.entry_action)&&"none"!==e.user_experience_banner)},n.isShowingReadonlyBanner=function(){var e=Util.persistentPolicy();return!__startswith(Util.getRawPageUrl(),"http://doc/")&&("read_only"===e.entry_action&&"none"!==e.user_experience_banner)},n.allow_tab_creation=function(){return!s()},e.callback.register("dom-loaded",(function(){r=!0,n.configBanners()})),e.callback.register("dom-init",(function(t,n,i,o){a=o,r?m():e.callback.registerOneShot("dom-loaded",0,{on_success:m})})),e.interp.registerOpcodeHandler("bandwidth_action",(function(t,n){a={action:t,acknowledge:n},r?m():e.callback.registerOneShot("dom-loaded",0,{on_success:m})}))}function FrameLoader(e){var t=this;function n(e,t){assert(Util.is_frame_owner(t)),t.__timeoutId&&(clearTimeout(t.__timeoutId),t.__timeoutId=null)}function r(i,a,s,l,c){var d=a.contentWindow;if(void 0===c&&(n(0,a),c=0),a.src,c+=1,d&&d.document&&d.document.documentElement&&(o(a)||d.document.documentElement.getAttribute("tc-nonce")===s))l();else{if(void 0===e.perf.max_nr_load_checks)throw new Error("Invalid max_nr_load_checks value.");c>e.perf.max_nr_load_checks?(e.update_queue.discard(i),e.callback.fire("tc-frame-load-timed-out",i,c,s)):a.__timeoutId=setTimeout((function(){a.__timeoutId=null,r(i,a,s,l,c)}),t.FRAME_LOAD_CHECK_INTERVAL_MS)}}function i(e,t){assert(Util.is_frame_owner(e)),e.__sv_is_ready_for_updates=!!t}function o(e){return"object"===e.localName&&BrowserDetect.isSafari()}function a(t,n,a){var s=getFrameFidByNode(t),l=(getUidByNode(t),getFidByNode(t),__randstr(8));assert(s),assert(Util.is_frame_owner(t)),assert("string"==typeof n),function(e,t,n,r){e.__frame_helper_poller&&e.__frame_helper_poller.stop(),e.__frame_helper_poller=new Poller({max_nr_polls:500,poll_interval_ms:100,cond_func:function(){return!!e.contentWindow&&!!e.contentDocument&&"complete"===e.contentDocument.readyState},success_cb:function(){if(assert(e.contentWindow),e.__frame_helper_poller=null,i(e,!1),!o(e)){var a=window.top.location.toString();Util.locationReplace(e.contentWindow,Util.getIframeHelperURL(t,n,r,a))}},timeout_cb:function(){reportErrorClientEvent("tc-frame-helper-load-timed-out",{current_src:e.src,readyState:e.readyState})}}),e.__frame_helper_poller.start()}(t,n,l,a),r(s,t,l,(function(){var r=t.contentWindow;assert(r),o(t)||Util.getDoctypeDecl(r)===n||reportWarnClientEvent("tc-doctype-load-mismatch",{expected:n,actual:Util.getDoctypeDecl(r)}),setFidToWindow(r,s),setFidToIframe(t,s),i(t,!0),e.update_queue.deliver(s,e.interpretQueued),e.callback.fire("frame-ready-for-updates")}))}t.FRAME_LOAD_CHECK_INTERVAL_MS=100,e.callback.register("tc-frame-load-timed-out",(function(e,t,n){reportErrorClientEvent("tc-frame-load-timed-out",{fid:e,nr_polls:t,nonce:n})})),t.isFrameReadyForUpdates=function(e){var t=getIframeByFid(e);return t&&t.__sv_is_ready_for_updates},e.interp.registerOpcodeHandler("set_doctype",(function(t,n,r,s,l,c){var d;l?Util.getDoctypeDecl(window)!==s&&((d=e.tab_store.load()).is_pending_doctype_correction=!0,e.tab_store.save(d),e.finish(),Util.xframe_reload()):function(t,n){var r=null,i=null;function o(){var o,a,s=getNodeByFrameFid(t);return!!s&&(o=s.fid,e.frameset_wrapper&&(o=e.frameset_wrapper.map_fid_if_necessary(o)),!!(a=getNodeByUid(o,s.uid))&&(r&&e.callback.deregister(r),i&&e.callback.deregister(i),n(a),!0))}o()||(r=e.callback.register("frame-attached",o),i=e.callback.register("frame-node-inserted",o))}(t,(function(e){(Util.is_frame_node(e)||"object"===e.localName)&&("object"===e.localName&&(e.data="about:blank",e.type=c,e.__sv_frame_owner=!0,i(e,!1)),o(e)?function(e,t,n){e.addEventListener("load",(function r(){a(e,t,n),e.removeEventListener("load",r)}))}(e,s,n):a(e,s,n))}))})),e.callback.register("frame-node-removed",(function(t,r){n(0,r),e.update_queue.discard(t)}))}function FramesetWrapper(e,t,n){var r,i=e.document,o=__randstr(8),a="pending",s="sv-wrapper-fid",l="sv-wrapper-uid",c=this;function d(e,t,n){var r,i=getFidByNode(t),o=getUidByNode(t);9===t.nodeType?setNodeInMap(n,e.document,o,i):1!==t.nodeType&&3!==t.nodeType||getUidByNode(t)===l?Util.get_node_tag(t):(setNodeInMap(n,r=t.cloneNode(!1),o,i),Util.get_node_tag(r))}function u(e,n){var r,i,o,a={},s=getNodeMapForFrame(t);for(i in s)s.hasOwnProperty(i)&&(d(n,o=s[i],a),9===o.nodeType&&(r=o));return function(e,t){for(var n,r,i,o,a,s,c,d=[e];d.length;)for(c=getUidByNode(r=d.shift()),n=0;n<r.childNodes.length;n+=1)(s=getUidByNode(i=r.childNodes[n]))&&s!==l&&(o=t[s],9===(a=t[c]).nodeType&&a.documentElement&&a.removeChild(a.documentElement),a.appendChild(o)),d.push(i)}(r,a),a}c.is_pending=function(){return"pending"===a},c.map_fid_if_necessary=function(e){return isTopFrameFid(e)&&"ready"===a?s:e},c.get_original_fid=function(e){return e===s?t:e},function(e){var n,o=i.documentElement;if(!o)return reportWarnClientEvent("tc-dom-frameset-error",{error:"Missing html node."}),void(a="error");o.style.setProperty("margin","0","important"),o.style.setProperty("padding","0","important"),o.style.setProperty("height","100%","important"),o.style.setProperty("overflow","hidden","important"),i.body?reportWarnClientEvent("tc-dom-frameset-error",{error:"There should not be a body element in frameset document."}):(n=i.createElement("body"),o.appendChild(n)),(n=i.body).style.setProperty("margin","0","important"),n.style.setProperty("padding","0","important"),n.style.setProperty("height","100%","important"),n.style.setProperty("overflow","hidden","important"),(r=i.createElement("iframe")).setAttribute("width","100%"),r.setAttribute("height","100%"),r.setAttribute("frameborder","0"),r.setAttribute("src",Util.getIframeHelperURL("<!DOCTYPE html>",e)),r.style.setProperty("position","absolute","important"),r.style.setProperty("left","0px","important"),r.style.setProperty("right","0px","important"),r.style.setProperty("bottom","0px","important"),r.style.setProperty("top","0px","important"),setNodeIds(r,l,t),n.appendChild(r)}(o),new Poller({max_nr_polls:100,poll_interval_ms:100,cond_func:Util.isIframeReady.curry(r,o),success_cb:function(){var e,t=r.contentWindow;try{e=u(0,t)}catch(e){return reportWarnClientEvent("tc-dom-frameset-error",{error:"Failed to replicate nodes from top frame.",exception:e.toString()}),a="error",void n()}a="ready",setNodeMapForFrame(s,e),setFidToWindow(t,s),n()},timeout_cb:function(){a="error",reportWarnClientEvent("tc-dom-frameset-error",{error:"Frameset wrapper frame failed to load."})}}).start()}function UX(e,t){var n,r=this,i=new Logger("ux",{level:"info"}),o="safemail-readonly-banner",a="safemail-disable-btn",s="safemail-banner-",l=e.url_builder.buildAssetURL("/safeview-static/images/logo.png"),c={arial:"Arial, Helvetica, sans-serif",georgia:"Georgia, serif",gotham:'Gotham, "Helvetica Neue", Helvetica, Arial, sans-serif',helvetica:'"Helvetica Neue", Helvetica, Arial, sans-serif',lucida:'"Lucida Sans Unicode", "Lucida Grande", sans-serif',tahoma:"Tahoma, Geneva, sans-serif",times:'"Times New Roman", Times, serif',verdana:"Verdana, Geneva, sans-serif"};function d(e,n,r){var o,a,s;function l(e,n){for(var r,i,o=!1,a=e.length;n.firstChild;)n.removeChild(n.firstChild);for(r=0;r<a;r+=1)(i=t.createElement(o?"strong":"span")).textContent=e[r],n.appendChild(i),o=!o}function c(e,n){for(var r;n.firstChild;)n.removeChild(n.firstChild);(r=t.createElement("span")).textContent=e[1],n.appendChild(r)}if(o=t.getElementById("ro-ux-"+e)){for(a in n)n.hasOwnProperty(a)&&((s=t.getElementById("ro-ux-"+e+"-"+a))?n[a].hasOwnProperty("type")?"array"===n[a].type&&n[a].val?s.textContent=n[a].val.join(", "):reportWarnClientEvent("tc-ux-unknown-type",{type:n[a].type}):"phishTarget-short"===e?c(n[a],s):l(n[a],s):i.info({event:"tc-ux-no-placeholder",id:"ro-ux-"+e+"-"+a}));t.getElementById(r).appendChild(o)}else reportWarnClientEvent("tc-ux-no-template",{id:"ro-ux-"+e})}function u(e,t){return function(n,r){var i,o;if(!(r&&t.indexOf(r)<0)){for(o=n.className,i=0;i<t.length;i+=1)o=o.replace(e+t[i],"");o=o.replace(/ {2}/g," "),n.className=o+" "+e+r}}}function _(e,t){e.textContent=t}function f(e){return function(t,n){t.setAttribute(e,n)}}function p(e){return e.replace(/[<>"\/]/gim,"")}function m(e){return e.replace(/[<>"]/gim,"")}function g(e){return __startswith(e,"http://")||__startswith(e,"https://")?encodeURI(e):""}function h(e){return e.match(/^\#[0-9a-fA-F]{3}$/)||e.match(/^\#[0-9a-fA-F]{6}$/)?e:""}function v(e){var t=e.split(";"),n=t[0].split("/");return 2===t.length&&2===n.length&&"data:image"===n[0]&&__startswith(t[1],"base64,")&&["gif","png","jpeg","svg+xml"].indexOf(n[1])>=0?e:""}function w(e){var t,r=e.split("."),i=n;for(t=0;t<r.length;t+=1){if(!i||!i.hasOwnProperty(r[t]))return"";i=i[r[t]]}return i}function y(e,n,r,i){var o=t.getElementById(e),a=w(n);!o||!a&&n||r(o,a=i?i(a):a)}function b(e,n,r){var i;(i=t.getElementById("UX-INLINE-STYLE-SHEET"))||((i=t.createElement("style")).id="UX-INLINE-STYLE-SHEET",t.head.appendChild(i)),i.innerHTML+="."+e+" {"+n+": "+r+" !important;}"}function E(e,t,n,r){var i=w(n);i&&b(e,t,i)}function A(e){return e?"read_only_banner.":"read_write_banner."}function U(e,t){return e&&"read_write"===t?A(e)+"exit_action.read_write.":"direct"===t?A(e)+"exit_action.direct.":A(e)+"exit_action.not_allowed."}r.getIndicatorType=function(e){return(e.content||{}).indicator_type||"regular"},r.customizeBanner=function(e,r,i,l,c){var m,h=A(i),b=U(i,l),S=e&&e.explain&&e.explain.length>0;if(n=r,y(o,"banner_theme",u(s,["white","yellow","red"]),p),y(o,h+"css.banner_type",u(s,["wide","regular"]),p),E("safemail-background","background",h+"css.background_color"),y(o,h+"css.font_family",u("safemail-font-",["arial","georgia","gotham","helvetica","lucida","tahoma","times","verdana"]),p),y("safemail-logo",h+"logo_icon.base64_img",f("src"),v),w(h+"logo_icon.link")&&y("safemail-logo-link",h+"logo_icon.url",f("href"),g),E("safemail-link","color",h+"css.link_color"),y("safemail-main-text",b+"banner_text",_),E("safemail-text","color",h+"css.text_color"),E("safemail-border","border-color",h+"css.border_color"),w(h+"custom_link.show_link")&&w(h+"custom_link.link_url").length>7&&(y("safemail-policy","",u("",["safemail-hidden"]),p),y("safemail-policy-link",h+"custom_link.link_text",_),y("safemail-policy-link",h+"custom_link.link_url",f("href"),g)),c||S&&"coach"===e.experience_mode?(y(o,h+"css.button_type",u("safemail-",["outline","regular"]),p),c?y(a,b+"button_label",_):t.getElementById(a).textContent="Details",E("safemail-button","color",h+"css.button_text_color"),E("safemail-button","background-color",h+"css.button_background_color"),E("safemail-button","border-color",h+"css.button_border_color")):t.getElementById(a).style.display="none",S&&"basic"!==e.experience_mode){for(m=0;m<e.explain.length&&m<3;m+=1)d(e.explain[m].factor_name+"-short",e.explain[m].attributes,"safemail-details-"+m);y("safemail-details","",u("",["safemail-hidden"]))}},r.customizeCoachModeModal=function(e,r,i,o,a){var s;if(n=r,e)for(s=0;s<e.length&&s<3;s+=1)d(e[s].factor_name,e[s].attributes,"coach-mode-modal-body");y("coach-mode-modal","warning_modal_theme",u("",["white","yellow","red"]),p),y("coach-mode-modal-text","warning_modal.modal_text",_),E("coach-mode-text","color","warning_modal.css.text_color"),E("coach-mode-button-1","color","warning_modal.css.button_one_text_color"),E("coach-mode-button-1","background-color","warning_modal.css.button_one_background_color"),E("coach-mode-button-1","border-color","warning_modal.css.button_one_border_color"),y("coach-mode-cancel","warning_modal.css.button_one_type",u("",["outline"]),p),E("coach-mode-button-2","color","warning_modal.css.button_two_text_color"),E("coach-mode-button-2","background-color","warning_modal.css.button_two_background_color"),E("coach-mode-button-2","border-color","warning_modal.css.button_two_border_color"),y("coach-mode-proceed","warning_modal.css.button_two_type",u("",["outline"]),p),w("warning_modal.logo_icon.base64_img")?y("coach-mode-logo","warning_modal.logo_icon.base64_img",f("src"),v):t.getElementById("coach-mode-logo").src=l,w("warning_modal.logo_icon.link")&&y("coach-mode-logo-link","warning_modal.logo_icon.url",f("href"),g),y("coach-mode-modal","warning_modal.css.font_family",u("font-",["arial","georgia","gotham","helvetica","lucida","tahoma","times","verdana"]),p),E("custom-highlight strong","color","warning_modal.css.highlight_color"),i?(t.getElementById("coach-mode-cancel").setAttribute("class","hide"),t.getElementById("coach-mode-proceed").textContent="OK"):y("coach-mode-proceed",U(o,a)+"button_label",_)},r.customizeFeedbackBar=function(e,t,r,i,o,a,s,l,d){var g,A,U;n=e,E(t,"background","css.background_color"),e.css&&e.css.border_color&&(b(t,"border-left",g=h(e.css.border_color)+" 1px solid"),b(t,"border-right",g),b(t,"border-top",g)),E(t,"color","css.text_color"),E(t+" > *","color","css.text_color"),E(t+" > #__safly_feedback_arrow_down.__safly_arrow_down","border-top-color","css.text_color"),(A=w("css.font_family"))&&(U=c[A])&&b(t+" > div","font-family",U),y(o,"logo_icon.base64_img",f("src"),v),y(r,d&&!BrowserDetect.isMobile()?"readonly_indicator.text":"readonly_indicator.iframe_text",_,m),y(r,"readonly_indicator.tooltip",f("data-tooltip"),p),y(i,"bypass_indicator.text",_,p),y(i,"bypass_indicator.tooltip",f("data-tooltip"),p),y(l,"isolate_indicator.tooltip",f("data-tooltip"),p),y(t,"content.indicator_type",u("__safly_",["wide","regular"]),p),y(s,"isolate_indicator.text",_,p),y(a,"custom_link.link_url",f("href"),m),y(a,"custom_link.link_text",_,p)},r.customizeBandwidthBanner=function(e){var t="bandwidth-banner",r="bandwidth-banner-";n=e,y(t,"bandwidth.theme",u(r,["white","yellow","red"]),p),e.bandwidth&&e.bandwidth.content&&!e.bandwidth.content.use_custom_styling||(y(t,"bandwidth.css.banner_type",u(r,["wide","regular"]),p),E("bandwidth-background","background","bandwidth.css.background_color"),y(t,"bandwidth.css.font_family",u("bandwidth-font-",["arial","georgia","gotham","helvetica","lucida","tahoma","times","verdana"]),p),y("bandwidth-logo","bandwidth.logo_icon.base64_img",f("src"),v),E("bandwidth-text","color","bandwidth.css.text_color"),E("bandwidth-border","border-color","bandwidth.css.border_color"),y("bandwidth-banner","bandwidth.css.button_type",u("bandwidth-",["outline"]),p),E("bandwidth-button","color","bandwidth.css.button_text_color"),E("bandwidth-button","background-color","bandwidth.css.button_background_color"),E("bandwidth-button","border-color","bandwidth.css.button_border_color"))},r.customizeBandwidthBannerText=function(e,t){n=e;var r=t?"bandwidth.bandwidth_limit_alert":"bandwidth.bandwidth_usage_alert";y("bandwidth-main-text",r+".text",_),y("bandwidth-disable-btn",r+".label_acknowledgement_text",_)}}function SheetLoader(e){var t,n,r,i={},o=null,a=!1,s=!1;function l(){var e;for(e in i)if(i.hasOwnProperty(e)&&"done"!==i[e].state)return!1;return!(s&&!r)}function c(n){Date.now(),t&&(t.parentNode.removeChild(t),t=null,e.text_monitor.resume_all()),i={},o&&(clearTimeout(o),o=null),a=!0}function d(e,t){var n,r=getUidByNode(e);a||((n=i[r]).state="done",n.success=t,n.elapsed_ms=Date.now()-n.start_time,l()&&e.ownerDocument.body&&c("all-sheets-complete"))}function u(e,t){return"link"===t&&e.rel&&"stylesheet"===e.rel.toLowerCase()&&function(e){var t=e,n=e.ownerDocument;for(assert(n.documentElement);t&&t!==n.documentElement;){if(t===n.head)return!0;t=t.parentNode}return!1}(e)}function _(r,s,_,f){var p=s.ownerDocument;r===window.top&&("body"===_?(assert(p.body),l()?a=!0:function(n){e.text_monitor.pause_all(),Date.now(),(t=n.createElement("style")).innerHTML="body { visibility: hidden !important; }",n.body.appendChild(t),o=setTimeout((function(){o=null,c("timeout")}),3e3)}(p),assert(n),assert(e.callback.deregister(n)),n=null):u(s,_)&&function(e){var t=getUidByNode(e);i[t]={state:"pending",start_time:Date.now()},e.addEventListener("load",(function(){d(e,!0)})),e.addEventListener("error",(function(){d(e,!1)}))}(s))}this.set_dom_resync_completed=function(){r=!0,a||l()&&c("resync-complete")},this.reset=function(){s=!0,r=!1,a=!1,i={},t=null,o&&(clearTimeout(o),o=null),n&&assert(e.callback.deregister(n)),n=e.callback.register("add-element",_)},n=e.callback.register("add-element",_),a=!1}function SurrogateView(e){var t,n=this,r=new Logger("surrogate-view",{level:"info"}),i=new KeyMap,o=!1;function a(){o||(o=!0,e.surrogate_channel.send("get-screenshot",!DEBUG))}function s(e){try{return!e.document||e.closed}catch(e){return!0}}function l(t){e.surrogate_channel&&e.surrogate_channel.send.apply(e.surrogate_channel,t)}function c(t){var n=["CM-mouse",e.fid,t.type,t.clientX,t.clientY,t.clientX,t.clientY,t.button,Util.getMouseAndKeyboardModifiers(t,r),t.detail];t.type,t.clientX,t.clientY,Util.getMouseAndKeyboardModifiers(t,r),t.button,Util.get_node_tag(t.target),l(n),"mousedown"!==t.type&&"mouseup"!==t.type||t.preventDefault()}function d(t){var n=i.getKeyCode(t);t.type,t.keyCode,l(["kbd",e.fid,0,t.type,t.keyCode,t.charCode,n,i.getCode(t),t.shiftKey,t.ctrlKey,t.altKey,t.metaKey])}function u(t){var n=Math.round(t.deltaX),r=Math.round(t.deltaY),i=void 0===t.wheelDeltaX?-3*n:t.wheelDeltaX,o=void 0===t.wheelDeltaY?-3*r:t.wheelDeltaY;l(["CM-wheel",e.fid,t.clientX,t.clientY,t.clientX,t.clientY,n,r,i,o,!0,!1]),t.preventDefault()}function _(){n.stop("child unloaded")}function f(e){var n=e?EventListener.addListener:EventListener.removeListener;t&&(n(t.document,"mousemove",c,!1),n(t.document,"mousedown",c,!1),n(t.document,"mouseup",c,!1),n(t.document,"keydown",d,!1),n(t.document,"keypress",d,!1),n(t.document,"keyup",d,!1),n(t.document,"wheel",u,!1),n(t,"beforeunload",_,!1))}n.stop=function(n){e.pairing_dict.surrogate_view_active=!1,e.pairing.savePairingState(e.pairing_dict),o=!1,t&&(f(!1),s(t)||t.close(),t=null)},n.start=function(n){if(e.pairing_dict.surrogate_view_active=!0,e.pairing.savePairingState(e.pairing_dict),!(t=t&&!s(t)?t:Util.windowOpen("","sv_view_"+e.pairing_dict.tab_id)))return r.error({event:"surrogate-view-start-failed",reason:"cannot get window handle, popup denied?"}),t;try{i=t.document,o=i.createElement("meta"),i.title="Surrogate: "+document.title,o.setAttribute("name","viewport"),o.setAttribute("content","width=device-width"),i.head.appendChild(o),i.body.style.margin="0px",i.body.style.padding="0px"}catch(e){return void r.error({event:"surrogate-view-start-failed",reason:"init child failed, security violation?"})}var i,o;f(!0),e.surrogate_channel.send("disable-hiding"),a()},e.callback.register("got-screenshot",(function(e,i){var l;t&&!s(t)?o?(o=!1,l=function(){var n,r,o,s,l;n=(i?"data:image/jpeg;base64,":"data:image/png;base64,")+e,(o=t?t.document:null)&&o.body&&((r=o.getElementById("view"))||((r=o.createElement("img")).id="view",o.body.appendChild(r)),r.src=n,r.style.width=MetricsUtils.getVisualViewportMetrics().width+"px",r.style.height=MetricsUtils.getVisualViewportMetrics().height+"px"),s=function(){a()},l=40,BrowserDetect.isIE()?setTimeout(s,l):t&&t.setTimeout(s,l)},BrowserDetect.isIE()?l():t.requestAnimationFrame(l)):r.warn({event:"unexpected-frame",action:"drop"}):n.stop("tab connection lost?")})),e.callback.register("surrogate-channel-connected",(function(t){e.pairing_dict.surrogate_view_active&&t&&(o=!1,n.start("resume after navigation"))}))}function PrintHandler(e){var t,n=this,r=0,i=!!document.attachEvent,o=!1,a=BrowserDetect.isMobileSafari(),s=null,l=!1,c=!1,d={},u=!1,_=null;function f(){return a?"print_pdf":n.shouldDownloadPdf()?null:"print-preview-iframe"}function p(e){var t=e||window.event;if(n.isPrintEnabled()&&80===t.keyCode&&t.ctrlKey)return t.keyCode=0,!1}function m(){var t;n.isPrintEnabled()&&(t=BrowserDetect.isMobile()?e.localization.get("ID_PRINT_ALERT_MOBILE_TEXT"):BrowserDetect.isMac()?e.localization.get("ID_PRINT_ALERT_MAC_TEXT"):e.localization.get("ID_PRINT_ALERT_TEXT"),n.isPrintPending()||e.ui_frame.call("showPrintAlert",t,e.localization.get("ID_PRINT_ALERT_TITLE")))}function g(){n.isPrintEnabled()&&(n.isPrintPending()||BrowserDetect.isIE()||BrowserDetect.isEdge()||BrowserDetect.isMobile()||(e.ui_frame.call("dismissPrintAlert"),window.focus(),document.body.focus()))}n.shouldDownloadPdf=function(){return Util.isPdfViewerDisabled()||BrowserDetect.isIE()||BrowserDetect.isEdge()||BrowserDetect.isAndroidChrome()},n.setPrintFid=function(e){r=e},n.setPrintPending=function(e){l=e},n.isPrintPending=function(){return l},n.isPrintEnabled=function(){return c},n.setPrintEnabled=function(e){c=e},n.fetchPdfForPreview=function(t,r,i){var o=new window.XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState===window.XMLHttpRequest.DONE){if(200!==o.status)return e.ui_frame.call("onPreviewError"),void(s&&s.close());var t,n;t=o.response,!!t&&"%PDF-"===(n=window.String.fromCharCode.apply(null,new window.Uint8Array(t.slice(0,128))).split("\n"))[0].slice(0,5)&&"<</Creator (Chromium)"===n[3]&&"/Producer (Skia/PDF "===n[4].slice(0,20)?function(t,n){var r=document.createElement("a"),i=new window.Blob([t],{type:"application/pdf"}),o="["+e.pairing_dict.origin+"]_print_preview.pdf";_&&window.URL.revokeObjectURL(_),_=window.URL.createObjectURL(i),r.setAttribute("href",_),n?r.setAttribute("target",n):r.setAttribute("download",o),(BrowserDetect.isIE()||BrowserDetect.isEdge())&&window.navigator&&window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(i,o):r.click(),!a&&n||e.ui_frame.call("hidePrintPreview")}(o.response,f()):e.ui_frame.call("onPreviewError")}},o.open(t,r),o.responseType="arraybuffer",o.setRequestHeader("Accept","application/pdf"),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.withCredentials=!0,o.send(i),a&&(s&&!s.closed&&(s.close(),_&&(window.URL.revokeObjectURL(_),_=null)),setTimeout((function(){var t,r,i;(s=Util.windowOpen("",f()))&&(s.document.body||s.document.appendChild(s.document.createElement("body")),assert(s.document.body),t=s.document.createElement("p"),r=s.document.createTextNode(e.localization.get("ID_PRINT_PREVIEW_STATUS")),t.appendChild(r),s.document.body.appendChild(t),i=window.setInterval((function(){s.closed&&(window.clearInterval(i),n.cleanUpPrint())}),500))}),0))},n.handlePrint=function(){var t,i=Util.getDocIdIfSafedocs(),o=Util.removePrefix(Util.getRawPageUrl()),a={cid:e.pairing_dict.cid,rid:e.pairing_dict.rid,tab_id:e.pairing_dict.tab_id,mpa_id:e.pairing_dict.mpa_id,page_url:encodeURIComponent(Util.isAboutBlankUrl()?o:new ParsedURL(o).defrag())};e.pairing_dict.cluster_id&&(a.cl=e.pairing_dict.cluster_id),i?setTimeout((function(){!function(t){var n,r,i;e.pairing_dict.client_caps.safedocs_block_print?e.ui_frame.call("showModal","SafedocsPrintBlocked"):(n={cid:e.pairing_dict.cid},i=e.url_builder.buildFileServerUrl("/safeview-fileserv/safepdfprint/"+t,!0),BrowserDetect.isEdge()||BrowserDetect.isSafari()?(r=i+"?cid="+e.pairing_dict.cid,e.pairing_dict.cluster_id&&(r+="&cl="+e.pairing_dict.cluster_id),Util.windowOpen(r,f())):(n.cluster_id=e.pairing_dict.cluster_id||"",e.ui_frame.call("showSafedocsPrintPreview",i,n)))}(i)}),0):(t="/r/print?"+Util.buildQueryStr(a),t=e.url_builder.buildProtocolUrl(t),d.fid=r,d.safe_rid=e.pairing_dict.safe_rid,d.tab_id=e.pairing_dict.tab_id,setTimeout((function(){e.ui_frame.call("showPrintPreview",t,d)}),0),n.setPrintFid(0))},n.cleanUpPrint=function(){a||_&&(window.URL.revokeObjectURL(_),_=null)},n.getPrintOptions=function(){return d},n.setPrintOptions=function(e,t,n,r,i){d.layout=e,d.paper_size=t,d.scale=n,d.header_footer=r,d.background=i},n.handlePrintKeyEventIfNeeded=function(t,r){var i=Util.getDocIdIfSafedocs();return!!n.isPrintEnabled()&&("keydown"===t.type&&"print"===r?!e.key_ctrl.should_prevent_default(t.target,t.keyCode,t.ctrlKey,t.shiftKey,t.altKey,t.metaKey)&&(n.isPrintPending()?(t.preventDefault(),!0):(n.setPrintPending(!0),BrowserDetect.isIE11()&&(window.alert(e.localization.get("ID_PRINT_SHORTCUT_KEY_ALERT")),u=!0),i?e.pairing_dict.client_caps.safedocs_block_print?e.ui_frame.call("showModal","SafedocsPrintBlocked"):e.ui_frame.call("showModal","SafedocsUsePrintButton"):e.ui_frame.call("showPrintOptions",!1),o||(t.preventDefault(),t.stopImmediatePropagation?t.stopImmediatePropagation():t.stopPropagation()),!0)):!(!u||"keypress"!==t.type||112!==t.keyCode&&80!==t.keyCode)&&(t.type,t.keyCode,t.preventDefault(),u=!1,!0))},n.attachKeyEventHandler=function(e){i&&(e?o=document.attachEvent("onkeydown",p):o&&document.detachEvent("onkeydown",p))},n.setPrintOptions("portrait",(t=Util.getLanguage().toLowerCase(),-1!==["en-us","en-ca","en-ph"].indexOf(t)?"letter":"a4"),"100",!0,!1),BrowserDetect.isMobile()?window.matchMedia("print").addListener((function(e){e.matches?m():g()})):(window.onbeforeprint=m,window.onafterprint=g)}function FullscreenVideo(e){var t,n,r=this,i=null,o=!1;function a(t,r){var a=getFidByNode(t.target),s=getUidByNode(t.target);o?o=!1:(r?n=getNodeKey(a,s):(e.surrogate_channel.send("client-media",a,JSON.stringify([s,{type:"pause"}])),s=-1,i=setTimeout((function(){n=void 0,i=null}),2e3)),e.surrogate_channel.send("fullscreen",a,r,s))}function s(e){a(e,!0)}function l(e){a(e,!1)}function c(r){var i=t.fid,a=t.uid,s=getNodeByUid(i,a);s?(r?(o=!0,s.webkitEnterFullscreen(),n=getNodeKey(i,a)):(e.surrogate_channel.send("fullscreen",i,!1,a),n=void 0),t=null):reportClientEvent("tc-fullscreen-no-node-error",{frame_id:i,node_id:a},!0)}r.onSurrogateFullScreenChange=function(r,a,s){var l,c;if(a){if((l=getNodeByUid(r,s))&&"VIDEO"===l.nodeName||(l=null,e.useRemotingV2()&&(l=e.compositor.getMainFrame().getActiveVideoNode())&&(r=getFidByNode(l),s=getUidByNode(l))),!l||!l.webkitSupportsFullscreen)return void e.surrogate_channel.send("fullscreen",r,!1,-1);if(n===getNodeKey(r,s))return;t||e.ui_frame.call("showModal","Fullscreen",r,s),t={fid:r,uid:s}}else if(n){if(c=splitNodeKey(n),n=void 0,!(l=getNodeByUid(c.fid,c.uid)))return;c.fid,c.uid,i?(clearTimeout(i),i=null):(o=!0,l.webkitExitFullscreen())}},r.allowFullscreen=function(){c(!0)},r.blockFullscreen=function(){c(!1)},r.isFullscreen=function(){return void 0!==n},r.exitFSIfNeeded=function(t){var r;n&&t!==n&&(r=splitNodeKey(n),e.surrogate_channel.send("fullscreen",r.fid,!1,r.uid))},r.installListeners=function(e){EventListener.addListener(e,"webkitbeginfullscreen",s,!1),EventListener.addListener(e,"webkitendfullscreen",l,!1)},r.removeListeners=function(e){EventListener.removeListener(e,"webkitbeginfullscreen",s,!1),EventListener.removeListener(e,"webkitendfullscreen",l,!1)}}function FullscreenCustom(e){var t,n,r=this,i=[];function o(t){return e.useRemotingV2()?document:getWindowByFid(t).document}function a(t){var r=e.useRemotingV2()?getTopFrameFid():getFidByNode(t.target),i=o(r)[e.xbrowser.fullscreenElement];if(e.useRemotingV2()){if(i)return;n&&(window.scrollTo(n.x,n.y),n=null)}e.surrogate_channel.send("fullscreen",r,null!==i,i?getUidByNode(i):-1)}r.onSurrogateFullScreenChange=function(n,r,a){var s=getNodeByUid(n,a),l=o(n);if(r)if(e.xbrowser.fullscreenchange.length){if(s&&l[e.xbrowser.fullscreenElement]===s)return;i.length>1&&i[1].fid===n&&i[1].uid===a?(i.shift(),e.xbrowser.exitFullscreen.call(l)):(t||e.ui_frame.call("showModal","Fullscreen",n,a),t={fid:n,uid:a})}else e.surrogate_channel.send("fullscreen",n,!1,-1);else e.xbrowser.exitFullscreen&&l[e.xbrowser.fullscreenElement]&&e.xbrowser.exitFullscreen.call(l),i=[]},r.allowFullscreen=function(){var r;(r=e.useRemotingV2()?document.body:getNodeByUid(t.fid,t.uid))?(e.useRemotingV2()&&(window.scrollX>0||window.scrollY>0)&&(n={x:window.scrollX,y:window.scrollY}),e.xbrowser.requestFullscreen(r),i.unshift({fid:t.fid,uid:t.uid}),t=null):reportClientEvent("tc-fullscreen-no-node-error",{frame_id:t.fid,node_id:t.uid},!0)},r.blockFullscreen=function(){var n,r,i;getNodeByUid(t.fid,t.uid)||e.useRemotingV2()?(i=(r=(n=getWindowByFid(t.fid))?n.document:null)?r[e.xbrowser.fullscreenElement]:null,e.surrogate_channel.send("fullscreen",t.fid,!1,i?getUidByNode(i):-1),t=null):reportClientEvent("tc-fullscreen-no-node-error",{frame_id:t.fid,node_id:t.uid},!0)},e.xbrowser.fullscreenchange.forEach((function(e){EventListener.addListener(document,e,a,!1)}))}function Fullscreen(e){var t,n,r=this,i=!1;function o(t,n){var r,i;t.__sv_frame_owner||BrowserDetect.isFirefox()&&(i=getWindowByFid(getFidByNode(t)),t.allow?-1===t.allow.indexOf("fullscreen *")&&(r=-1===t.allow.indexOf("fullscreen")?t.allow+"; fullscreen *":t.allow.replace("fullscreen","fullscreen *")):r="fullscreen *",e.xbrowser.setAttribute(i,t,"","allow",r))}r.allowFullscreen=function(){t.allowFullscreen()},r.blockFullscreen=function(){t.blockFullscreen()},r.isFullscreen=function(){if(i)return t.isFullscreen()},r.exitFSIfNeeded=function(e){if(i)return t.exitFSIfNeeded(e)},r.installListeners=function(e){i&&t.installListeners(e)},r.removeListeners=function(e){i&&t.removeListeners(e)},t=!e.xbrowser.fullscreenchange.length&&(n=document.createElement("video"),i=void 0!==n.webkitEnterFullscreen,n=null,i)?new FullscreenVideo(e):new FullscreenCustom(e),e.interp.registerOpcodeHandler(e.interp.OPCODES.FULLSCREEN_CHANGE,t.onSurrogateFullScreenChange),e.callback.register("frame-node-inserted",o)}var MetricsUtilsClass=function(){var e,t,n,r=this;function i(){return"portrait"===Util.getScreenOrientationType()}function o(){return BrowserDetect.isMobileSafari()?i()?Util.getPortraitScreenSize().width:Util.getPortraitScreenSize().height:Util.getPortraitScreenSize().width}function a(){var e=0,t=0;return assert(!BrowserDetect.isMobile()),Util.getInnerWidth()?(e=Util.getInnerWidth(),t=Util.getInnerHeight()):document.documentElement&&document.documentElement.clientWidth?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):document.body&&(e=document.body.clientWidth,t=document.body.clientHeight),assert("number"==typeof e&&"number"==typeof t),{x:0,y:0,width:e,height:t,scale:r.getVisualViewportScale()}}function s(e,t){var n,r=document.createElement("div");return assert("fixed"===e||"absolute"===e),r.style.position=e,r.style.left=t.x+"px",r.style.top=t.y+"px",r.style.width="1px",r.style.height="1px",function(){if(!document.body){var e=document.createElement("body");document.documentElement.appendChild(e),assert(document.body)}}(),document.body.appendChild(r),n=r.getBoundingClientRect(),r.parentNode.removeChild(r),{x:n.x,y:n.y}}function l(e){return Math.floor(Math.max(0,e))}r.maybeSplitView=function(){var e,t,r=Util.getVisualViewport();return!(!BrowserDetect.isMobileSafari()||!r||BrowserDetect.isMobileSafariOnIPhone())&&(!(n&&Date.now()-n<3e3)&&((e=r.width*r.scale)>=(t=o())*(1-.8)&&e<=.8*t))},r.getVisualViewportScale=function(){var e,t,n=Util.getVisualViewport();return function(){if(!BrowserDetect.isMobileSafari())return!1;if(!Util.getVisualViewport())return!0;if(BrowserDetect.isMobileSafariOnIPhone()){if(!i())return!1}else if(r.maybeSplitView())return!1;return!0}()?t=(e=Util.getInnerWidth())?o()/e:1:n?(assert(n.scale),BrowserDetect.isMobileSafari()&&(t=Math.round(100*n.scale)/100),t||n.scale):1},r.getScreenHeight=function(){return i()?Util.getPortraitScreenSize().height:Util.getPortraitScreenSize().width},r.getVisualViewportMetrics=function(){var e,t,n,i=Util.getVisualViewport(),o=r.getVisualViewportScale();return i?{x:l(i.offsetLeft),y:l(i.offsetTop),width:Math.ceil(i.width*o),height:Math.ceil(i.height*o),scale:o}:BrowserDetect.isMobileSafari()?(assert(void 0!==window.innerWidth&&void 0!==window.innerHeight),t=s("fixed",{x:0,y:0}),n=s("absolute",{x:window.scrollX,y:window.scrollY}),assert(BrowserDetect.isMobileSafari()),{x:l((e=1===r.getVisualViewportScale()?{x:0,y:0}:{x:n.x-t.x,y:n.y-t.y,scroll_bounds:n,fixed_bounds:t}).x),y:l(e.y),width:Math.ceil(Util.getInnerWidth()*o),height:Math.ceil(Util.getInnerHeight()*o),scale:r.getVisualViewportScale()}):(assert(!BrowserDetect.isMobile()),a())},r.getWebViewSize=function(){var e,t={},n=r.getVisualViewportScale();return BrowserDetect.isMobile()?(t.width=(e=Util.getVisualViewport())?Math.ceil(e.width*r.getVisualViewportScale()):i()?Util.getPortraitScreenSize().width:Util.getPortraitScreenSize().height,assert(n>0&&Number.isFinite(n),{scale:n}),BrowserDetect.isMobileSafari()?(assert(Number.isFinite(window.innerHeight)),t.height=Math.ceil(window.innerHeight*n)):BrowserDetect.isAndroidChrome()?t.height=r.getVisualViewportMetrics().height:assert(0),t):a()},r.getAllMetrics=function(){var t=Util.getDeviceMetrics();return t.view_size=r.getWebViewSize(),t.visual_viewport=r.getVisualViewportMetrics(),t.initial_view_height=e,t},r.clientToScreenPos=function(e,t){var n,i=r.getVisualViewportScale(),o=Util.getVisualViewport();return assert(Number.isFinite(i)),BrowserDetect.isChrome()?(assert(o),assert(Number.isFinite(o.offsetLeft)&&Number.isFinite(o.offsetTop)),n={x:(e-o.offsetLeft)*i,y:(t-o.offsetTop)*i}):n={x:e*i,y:t*i},assert(Number.isFinite(n.x)&&Number.isFinite(n.y)),n},r.onWebViewResize=function(){var i=Util.getScreenOrientationType();i!==t&&(n=Date.now(),t=i,e=r.getWebViewSize().height)},e=r.getWebViewSize().height,t=Util.getScreenOrientationType(),assert(Number.isFinite(e))},MetricsUtils=new MetricsUtilsClass;function MetricsObserver(e){var t,n,r,i=this,o={};function a(){var e,n=window.devicePixelRatio||1,r=Util.getPortraitScreenSize();t&&t.removeListener(i.onMediaQueryStateChanged),e="screen and (resolution: "+n+"dppx) and (min-device-width: "+r.width+"px) and (max-device-width: "+r.width+"px) and (min-device-height: "+r.height+"px) and (max-device-height: "+r.height+"px)",(t=window.matchMedia(e)).addListener(i.onMediaQueryStateChanged)}function s(t){var n,r=o,i=MetricsUtils.getAllMetrics();(t=t||"query-change",o&&JSON.stringify(i)===JSON.stringify(o))||function(t,n){return!!Util.isDictEmpty(t)||!(e.fullscreen.isFullscreen()&&function(e,t){return e.view_size.height>t.view_size.height}(t,n)&&!function(e,t){return e.screen_orientation_type!==t.screen_orientation_type||e.screen_orientation_angle!==t.screen_orientation_angle}(t,n))}(o,i)&&(n=["set-render-params",i],e.surrogate_channel&&(e.surrogate_channel.send.apply(e.surrogate_channel,n),1)&&(o=i,a(),e.callback.fire("metrics-changed",o,r)))}function l(){s("layout-viewport-change")}function c(){BrowserDetect.isMobileSafari()&&MetricsUtils.onWebViewResize(),s("window-resize")}function d(){BrowserDetect.isAndroidChrome()&&MetricsUtils.onWebViewResize(),MetricsUtils.maybeSplitView()?(n&&clearTimeout(n),n=setTimeout((function(){s("visual-viewport-change"),n=null}),300)):s("visual-viewport-change")}i.onMediaQueryStateChanged=function(){s("media-query")},i.checkForMetricsChange=s,i.release=function(){var t=Util.getVisualViewport();EventListener.removeListener(window,"resize",c,!1),t?(EventListener.removeListener(t,"resize",d),EventListener.removeListener(t,"scroll",d)):BrowserDetect.isMobileSafari()&&EventListener.removeListener(window,"scroll",d,!1),e.callback.deregister("layout-viewport-props-changed",l)},r=Util.getVisualViewport(),EventListener.addListener(window,"resize",c,!1),r?(EventListener.addListener(r,"resize",d),EventListener.addListener(r,"scroll",d)):BrowserDetect.isMobileSafari()&&EventListener.addListener(window,"scroll",d,!1),e.callback.register("layout-viewport-props-changed",l),s("init"),setInterval((function(){s("poll")}),3e3),window.matchMedia&&a()}var Resource=Object.freeze({videoDataUri:"data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAwJtZGF0AAACrQYF//+p3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjYzOCA3NTk5MjEwIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNSAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTEgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTIga2V5aW50PTI1MCBrZXlpbnRfbWluPTIgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD00MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIzLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAfZYiEABX//vfJ78Cm69vetb+Tz0j4e8ZQD6wZq+vdsQAAAApBmiNsQS/+tTlYAAAACEGeQniCXwN/AAAACAGeYXRBLwN+AAADQ21vb3YAAABsbXZoZAAAAAAAAAAAAAAAAAAAA+gAAAfQAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAJtdHJhawAAAFx0a2hkAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAfQAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAA4AAAAKgAAAAAAJGVkdHMAAAAcZWxzdAAAAAAAAAABAAAH0AAAQAAAAQAAAAAB5W1kaWEAAAAgbWRoZAAAAAAAAAAAAAAAAAAAQAAAAIAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAZBtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAFQc3RibAAAAJhzdHNkAAAAAAAAAAEAAACIYXZjMQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAA4ACoASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAADJhdmNDAWQACv/hABlnZAAKrNlEflkwEQAAAwABAAADAAQPEiWWAQAGaOvjyyLAAAAAGHN0dHMAAAAAAAAAAQAAAAQAACAAAAAAFHN0c3MAAAAAAAAAAQAAAAEAAAAwY3R0cwAAAAAAAAAEAAAAAQAAQAAAAAABAACAAAAAAAEAAEAAAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAQAAAABAAAAJHN0c3oAAAAAAAAAAAAAAAQAAALUAAAADgAAAAwAAAAMAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjIzLjEwMQ==",dummyAudioUri:"data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU3LjgzLjEwMAAAAAAAAAAAAAAA//tUwAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAACAAABgADAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA//////////////////////////////////////////////////////////////////8AAAAATGF2YzU3LjEwAAAAAAAAAAAAAAAAJAMAAAAAAAAAAYBWbp0FAAAAAAAAAAAAAAAAAAAA//sUxAADwAABpAAAACAAADSAAAAETEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sUxCWDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"});function Clipboard(e){var t,n,r,i,o,a=this,s=!1,l=!1,c=!1,d=null,u=null,_=!1,f=null,p=new ShortcutKeyHandler(e);function m(){o={keydown:!0,mousedown:!0}}function g(){var n,r,i,o=!1;i=!1,BrowserDetect.isIE()&&(document.activeElement&&(Util.is_element_input_text(document.activeElement)||document.activeElement.isContentEditable)||(i=!0)),BrowserDetect.isFirefox()&&e.useRemotingV2()&&(i=!0),BrowserDetect.isSafari()&&(i=!0),i&&(document.activeElement,u=document.activeElement,(d=document.createElement("input")).style.position="fixed",d.style.top="1px",d.style.left="1px",d.style.height="1px !important",d.style.border="none",d.style.background="transparent !important",d.style.textIndent="-300px",document.body.insertBefore(d,document.body.firstChild),d.value=t,BrowserDetect.isSafari()?((n=document.createRange()).selectNodeContents(d),(r=window.getSelection()).removeAllRanges(),r.addRange(n),d.setSelectionRange(0,t?t.length:1)):(d.focus(),d.select()));try{l=!0,c=!1,o=document.execCommand("copy"),BrowserDetect.isIE()&&!c&&(o=!1),l=!1}catch(e){}return d&&(d.parentNode.removeChild(d),d=null,u&&u.focus&&u.focus(),u=null),o&&(s=!1),o}function h(t,n,o){e.useRemotingV2()?n&&"\n"!==n&&(Util.copyToClipboardInEventHandler(t,n,o),i=n):t.defaultPrevented?t.type:i=function(){var e,t,n;if(!r)return null;if(!(e=getWindowByFid(r)))return null;if((t=e.document.activeElement)&&Util.is_element_input_text(t)){if(t.selectionStart!==t.selectionEnd)return t.value.substring(t.selectionStart,t.selectionEnd)}else if(n=e.getSelection())return n.toString();return null}(),i&&(i=i.replace(/\s/g,""))}function v(e){c=!0,s&&(n||t)&&Util.copyToClipboardInEventHandler(e,t,n)}function w(t,n,r){t.type,e.copy_paste_ctrl.enforce_on_user_action(t.target,t)||(l?v(t):h(t,n,r))}function y(r,o,a,l){var c;t=o,n=a,e.copy_paste_ctrl.enforce_on_clipb_data()||t&&(t.replace(/\s/g,"")!==i||function(e){return e&&(-1!==e.indexOf(" src=")||-1!==e.indexOf(" href="))}(a))&&(s=!0,m(),_?_=!1:(c=g(),l&&!c&&reportErrorClientEvent("tc-clipboard-copy-failure",{detail:"Backend clipboard is changed without recent user interaction"})))}a.copy_event_handler=w,a.cut_event_handler=w,a.piggyback=function(e){s&&o.hasOwnProperty(e.type)&&o[e.type]&&("keydown"===e.type&&BrowserDetect.isFirefox()&&(e.keyCode<48||e.keyCode>90)||("copy"===p.get_operation(e)&&(_=!0,f&&clearTimeout(f),f=setTimeout((function(){_=!1,f=null}),2e3)),e.type,o[e.type]=!1,g()))},a.set_last_selection_fid=function(e){r=e},m(),e.interp.registerOpcodeHandler("clpbd-data",y)}function CopyPasteControl(e){var t=this,n=!1,r=!1,i=!0,o=!1,a=0,s=!1,l=["copy","cut","paste","drop","file_upload"],c={COPY_DISABLED:1,PASTE_DISABLED:2,PASTE_RESTRICTED:3,COPY_PASTE_DISABLED:4};function d(e){var t,n,r,i,o,s=!1;if("paste"===e.type?t=e.clipboardData:"drop"===e.type&&(t=e.dataTransfer),t&&t.getData)for(n=0;n<t.types.length;n+=1)"text/plain"===(r=t.types[n])?i=t.getData(r):"text/html"===r?o=t.getData(r):s=!0;else"paste"===e.type&&window.clipboardData&&window.clipboardData.getData&&(i=window.clipboardData.getData("Text"));return i?i.length>a:o?o.length>a:!!s}function u(t){var i,o;if(!s){switch(assert(-1!==l.indexOf(t)),t){case"paste":case"drop":case"file_upload":r&&(a>0?(i=c.PASTE_RESTRICTED,o=a):i=n?c.COPY_PASTE_DISABLED:c.PASTE_DISABLED);break;case"copy":case"cut":n&&(i=r&&0===a?c.COPY_PASTE_DISABLED:c.COPY_DISABLED);break;default:assert(!1)}i&&e.ui_frame.call("showCopyPasteRestricted",i,o)}}function _(t){!function(t){s||(e.surrogate_channel.send("report-user-action",t),assert(-1!==l.indexOf(t)))}(t),u(t)}t.enforce_on_user_action=function(e,t){switch(t.type){case"paste":if(r&&d(t))return t.preventDefault(),_(t.type),!0;break;case"copy":case"cut":if(n)return t.preventDefault(),_(t.type),!0;break;case"contextmenu":if(o||i&&"img"===e.nodeName.toLowerCase())return t.preventDefault(),!0;break;case"drop":if(r&&d(t))return t.preventDefault(),_(t.type),!0;break;case"dragstart":if(n)return t.preventDefault(),!0}return!1},t.enforce_on_file_upload=function(){return!!r&&(_("file_upload"),!0)},t.enforce_on_clipb_data=function(){return!!n&&(reportErrorClientEvent("tc-copy-paste-policy-error",{detail:"The surrogate should have stopped the clipboard update."}),u("copy"),!0)},t.enforce_on_cb_api_data=function(e,t,i){switch(e){case"paste":if(!r)return!1;if("text/plain"!==i&&"text/html"!==i)return!0;if(t.length>a)return _(e),!0;break;case"copy":case"cut":if(n)return _(e),!0}return!1},t.has_paste_restriction=function(){return r},t.msgbox_types=c,e.interp.registerOpcodeHandler("copy-paste-policy-update",(function(e){JSON.stringify(e),n=!!e.disable_copy,r=!!e.restrict_paste,i=!!e.disable_img_ctx_menu,o=!!e.disable_all_ctx_menu,a=parseInt(e.char_len_limit_if_paste_restricted),(isNaN(a)||a<0)&&(a=0),s=!!e.is_fail_closed_policy}))}function Geolocation(e){var t,n,r={};function i(t,n,r){var i;switch(t.code){case t.PERMISSION_DENIED:i=0;break;case t.POSITION_UNAVAILABLE:i=1;break;case t.TIMEOUT:i=2;break;default:i=3}e.surrogate_channel.send("geo-perm",!1,n,i,r)}function o(r,o,a){if(!r){var s=new Error;return s.PERMISSION_DENIED=!0,void i(s,o,a)}!function(t,r){var i=n.coords.latitude,o=n.coords.longitude,a=n.coords.accuracy;assert(n),e.surrogate_channel.send("geo-perm",!0,t,i,o,a,r)}(o,a),t&&(navigator.geolocation.clearWatch(t),t=null),t=navigator.geolocation.watchPosition((function(t){assert(n=t),e.surrogate_channel.send("geo-pos",n.coords.latitude,n.coords.longitude,n.coords.accuracy)}),(function(e){window.reportClientEvent("tc-geolocation-error",{detail:"unable to add to local storage"})}))}function a(e,t,n,r){var i=JSON.parse(window.localStorage.getItem("sv_permissions"));i[t]=e;try{window.localStorage.setItem("sv_permissions",JSON.stringify(i))}catch(e){window.reportClientEvent("tc-geolocation-error",{detail:"unable to add to local storage"})}o(e,n,r)}function s(e){try{window.localStorage.setItem("sv_permissions",JSON.stringify(e))}catch(e){window.reportClientEvent("tc-geolocation-error",{detail:"corrupt or no sv_permissions map set in localStorage"})}}function l(t){var l=function(e){var t;window.localStorage.getItem("sv_permissions")||s(t={});try{t=JSON.parse(window.localStorage.getItem("sv_permissions"))}catch(e){s(t={})}return t[e.origin]}(t);!0===l&&n||!1===l?o(l,t.id,"prior-decision"):navigator.geolocation?navigator.geolocation.getCurrentPosition((function(r){n=r,TPROXY_ENABLED?a(!0,t.origin,t.id,"proxy-mode"):void 0===l?e.ui_frame.call("geolocationAllowReject",(function(e){a(e,t.origin,t.id,"ui-decision")}),t.origin):o(l,t.id,"prior-decision")}),(function(e){i(e,t.id,"perm-req")}),r):o(!1,t.id,"no-geolocation")}r.timeout=1e4,e.interp.registerOpcodeHandler("permissions-request",l)}function ImageRequestMgr(e){var t=this,n=!1,r={};function i(e){var t,n,r,i=e.split("_");return n=parseInt(i[0],10),r=parseInt(i[1],10),isNaN(n)||isNaN(r)?(reportErrorClientEvent("tc-imgreq-invalid-req-id-error",{req_id:e}),null):"img"!==(t=getNodeByUid(n,r)).nodeName.toLowerCase()?(reportErrorClientEvent("tc-imgreq-wrong-elem-type-error",{type:t.nodeName}),null):t}function o(e,t){var n;t&&t.substring(0,24),Date.now(),r[e]?(n=i(e))?(t&&(n.src=t),function(e){var t;(t=i(e))&&t.style&&t.style.cursor&&r[e]&&r[e].cursor_set&&(r[e].cursor?t.style.cursor=r[e].cursor:t.style.removeProperty("cursor"),delete r[e].cursor_set,delete r[e].cursor)}(e),n.__sv_is_dataurl=!0,function(e){var t=r[e].image;t&&t.parentNode&&t.parentNode.removeChild(t),delete r[e]}(e)):reportWarnClientEvent("tc-imgreq-image-missing-error",{req_id:e,location:"image response"}):reportErrorClientEvent("tc-imgreq-request-data-missing-error",{req_id:e})}t.request_image=function(t,o){var a,s,l,c,d=null,u=o.type;if(assert("img"===t.nodeName.toLowerCase()),n&&"contextmenu"===u&&o.preventDefault(),l=getFidByNode(s=t),c=getUidByNode(s),(a=void 0===l||void 0===c?null:l+"_"+c)&&!t.__sv_is_dataurl&&t.src)if(r[a])"contextmenu"!==u||r[a].cursor_set||setTimeout((function(){!function(e){var t;r[e]&&!r[e].cursor_set&&((t=i(e))?(t.style&&t.style.cursor&&(r[e].cursor=t.style.cursor),t.style&&(t.style.cursor="wait",r[e].cursor_set=!0)):reportErrorClientEvent("tc-imgreq-image-missing-error",{req_id:e,location:"visual indicator"}))}(a)}),750);else{if(0!==t.src.indexOf("data:"))(d=new Image(64,64)).src=t.src+(-1===t.src.indexOf("?")?"?":"&"),d.src=d.src+"req_tab="+e.pairing_dict.tab_id+"&req_id="+a+"&rand="+__randstr(8),function(e){assert(e),e.decode?e.decode():(e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.visibility="hidden",document.body.appendChild(e))}(d);else{if(0!==t.src.indexOf("data:image/webp")&&0!==t.src.indexOf("data:image/avif"))return;e.surrogate_channel.send("compat-img-req",getFidByNode(t),getUidByNode(t))}r[a]={image:d,ts:Date.now()},r[a].ts}},t.reset=function(e){delete e.__sv_is_dataurl},t.enable_test=function(){n=!0},e.interp.registerOpcodeHandler("img_data_http_url",o),e.interp.registerOpcodeHandler("img_data_non_http_url",(function(e,t,n){o(e+"_"+t,n)}))}function Webauthn(e){var t,n=new Logger("webauthn",{level:"info"});function r(e,t){var r={success:!0,id:t.id,type:t.type};return"password"===t.type?(r.password=t.password,r.name=t.name):"public-key"===t.type?(r.raw_id=Util.array_buffer_to_base64(t.rawId),r.authenticator_attachment=t.authenticatorAttachment,r.client_data_json=Util.array_buffer_to_base64(t.response.clientDataJSON),"create"===e?(r.attestation_object=Util.array_buffer_to_base64(t.response.attestationObject),t.response.getAuthenticatorData&&(r.authenticator_data=Util.array_buffer_to_base64(t.response.getAuthenticatorData())),t.response.getPublicKey&&(r.public_key=Util.array_buffer_to_base64(t.response.getPublicKey())),t.response.getPublicKeyAlgorithm&&(r.public_key_algorithm=t.response.getPublicKeyAlgorithm()),t.response.getTransports&&(r.transports=t.response.getTransports())):(r.authenticator_data=Util.array_buffer_to_base64(t.response.authenticatorData),r.signature=Util.array_buffer_to_base64(t.response.signature),r.user_handle=Util.array_buffer_to_base64(t.response.userHandle))):"federated"===t.type?(r.provider=t.provider,r.name=t.name):(n.error("Unsupported credential type: "+t.type),r.success=!1),r}function i(e){var t;for(t in e)"string"==typeof e[t]?"__blob__"===e[t].substring(0,8)?e[t]=Util.base64_to_array_buffer(e[t].substring(8)):"__str__"===e[t].substring(0,7)&&(e[t]=e[t].substring(7)):"object"==typeof e[t]&&i(e[t])}t={create:function(e){return i(e),navigator.credentials.create(e).then((function(e){return r("create",e)}))},get:function(e){return i(e),navigator.credentials.get(e).then((function(e){return r("get",e)}))},store:function(e){var t=null;if("password"===e.type&&window.PasswordCredential)t=new window.PasswordCredential({id:e.id,name:e.name,password:e.password});else{if("federated"!==e.type||!window.FederatedCredential){const t=new Error("Unsupported credential type: "+e.type);throw t.name="NotSupportedError",t}t=new window.FederatedCredential({id:e.id,name:e.name,provider:e.provider})}return navigator.credentials.store(t).then((function(){return{success:!0}}))},preventSilentAccess:function(){return navigator.credentials.preventSilentAccess().then((function(){return{success:!0}}))}},e.interp.registerOpcodeHandler("webauthn",(function(r,i,o){var a=function(t){e.surrogate_channel.send("webauthn-response",r,i,t)};if(TPROXY_ENABLED&&navigator.credentials&&t.hasOwnProperty(o.action))try{!function(t){var n,r,i,o,a,s=getTopFrameFid();if(s===t)return;o=getWindowByFid(s).location,(n=getNodeByFrameFid(t))&&(r=getNodeByUid(n.fid,n.uid));if(r)try{i=new URL(atob(r.getAttribute("data-sv-src")))}catch(e){}if(o&&i&&i.protocol===o.protocol&&i.hostname===o.hostname&&i.port===o.port)return;o&&(o=o.toString());i&&(i=i.toString());throw e.fatalError("tc-webauthn-cross-origin",{top_src:o,frame_src:i}),(a=new Error("Cross-origin iframe not supported")).name="NotSupportedError",a}(r),t[o.action](o.options).then(a).catch((function(e){n.error("Error handling "+o.action+": "+e.name+" "+e.message),a({success:!1,message:e.message,name:e.name})}))}catch(e){a({success:!1,message:e.message,name:e.name})}else n.error("Unsupported command: "+o.action),a({success:!1})}))}var tc_kernel,safeview,cof_server_frame,MSG_KIND_DATA=1,MSG_KIND_CONTROL=2,MSG_KIND_COMPOSITOR_COMMIT=3,MSG_KIND_CANVAS=4,mf=null,DOM_LOADED_ELEM_ID="__safely_dom_loaded",local_echo_enabled=!1,local_echo_config={};function onLatencyChange(e){var t,n,r="sv-pointer-progress",i="sv-pointer-wait",o=document.getElementById(r),a=document.getElementById(i),s=document.head||document.getElementsByTagName("head")[0];if(assert(e>=0&&e<=2),0===e)return o&&o.parentNode&&o.parentNode.removeChild(o),void(a&&a.parentNode&&a.parentNode.removeChild(a));if(1===e){if(a&&a.parentNode&&a.parentNode.removeChild(a),o)return}else if(o&&o.parentNode&&o.parentNode.removeChild(o),a)return;n="* {cursor:"+(1===e?"progress":"wait")+"} ",n+="input {cursor: progress}",(t=document.createElement("style")).id=1===e?r:i,t.type="text/css",t.styleSheet?t.styleSheet.cssText=n:t.appendChild(document.createTextNode(n)),s.appendChild(t)}function startSurrogateChannelLoop(){var e=safeview.pairing_dict,t={cid:e.cid,rid:e.rid,tab_id:e.tab_id||1};return e.cluster_id&&(t.cl=e.cluster_id),safeview.openChannel("surrogate",{use_websockets:safeview.perf.use_websockets&&("Explorer"!==browser.name||11===browser.version&&safeview.perf.use_websockets_on_ie11),service_prefix:"/r",query_params:t,on_connect:function(e,t){safeview.callback.fire("surrogate-channel-connected",t)},on_disconnect:function(e){"client-close"!==e&&"client-detach"!==e&&(Util.isTabVisible()?safeview.reload("ping-404"===e?0:3e3):(reportClientEvent("tc-detach-from-channel-failure",{}),safeview.tab.detachAfterChannelClose()))},on_recv:function(e){var t,n,r,i,o,a,s,l,c;if(i=new DataView(e,0,4).getUint32(0,!0))for(r=new DataView(e,4,i),c=4+i,o=0;o<i/5;o+=1){if(l=r.getUint32(5*o,!0),s=r.getUint8(5*o+4),t=new Uint8Array(e,c,l),s===MSG_KIND_DATA||s===MSG_KIND_CONTROL){if(window.TextDecoder)t=JSON.parse(new TextDecoder("utf-8").decode(t));else{for(n="",a=0;a<t.length;a+=1)n+=String.fromCharCode(t[a]);t=JSON.parse(decodeURIComponent(window.escape(n)))}assert(t instanceof Array&&t.length>=1,"Malformed command "+t)}if(c+=l,!safeview.interpret(s,t))break}},on_report:function(e,t){reportClientEvent(e,t)},url_builder:safeview.url_builder.buildProtocolUrl,ajax:safeview.serverCall,on_latency_change:safeview.onLatencyChange})}function checkPairingResult(e){return e.error?("tab_limit"===e.error?safeview.ui_frame.call("showTabLimit"):"show_error_page"===e.error?safeview.ui_frame.call("showErrorPage",e.title,e.message,e.details):"access_denied_redirect"===e.error?Util.locationSet(window,e.redirect_url):safeview.showError(e.error,e.description),!1):!e.block&&(safeview.http_alert.configHttpAlert(e),safeview.preload_indicator.configPreloadIndicator(e),e&&e.client_caps&&(safeview.perf=e.client_caps.perf,e.client_caps.local_echo&&(local_echo_enabled=e.client_caps.local_echo.enabled,local_echo_config=e.client_caps.local_echo,"Explorer"===browser.name&&(local_echo_config.extended=!1),safeview.lecho_regulator_ext.apply_config(),safeview.lecho_error_alert.config_alert(local_echo_enabled))),!0)}function insertDomLoadedElement(e,t){var n,r=mf.document.body;assert("top"===safeview.role||"main"===safeview.role),r&&((n=mf.document.createElement("input")).type="hidden",n.value=JSON.stringify(e),n.id="__safely_dom_loaded",r.appendChild(n))}function CommFrameChannel(e){var t=this;t.send=function(){e.postToCommFrame({kind:"send",args:argumentsToArray(arguments)})},t.resume_client_update=function(){e.postToCommFrame({kind:"resume_client_update"})},t.close=function(t){e.postToCommFrame({kind:"close",reason:t})}}function FrameUpdateQueue(){var e=this,t={};e.queue=function(e,n){t[e]||(t[e]=[]),t[e].push(n)},e.deliver=function(e,n){var r;t[e]&&(r=t[e],delete t[e],n(r))},e.discard=function(e){var n=t[e];return n&&delete t[e],n},e.count=function(e){return t[e]?t[e].length:0},e.change_top_frame_fid=function(e){t[e]=t[-1],delete t[-1]}}function TopFrame(){var e=this,t=new Logger("main",{level:"info"});function n(t){e.fid=t,__init_id_state(t)}function r(t,n,r){e.ctx_menu_mode||(e.ctx_menu_mode={}),e.ctx_menu_mode.backend_driven=n,e.ctx_menu_mode.native_menu_for_input=r}function i(){safeview.context_menu.display.apply(safeview.context_menu,arguments)}function o(t){e.allow_backend_dragdrop=!0}function a(t,n,r,i,o,a){var s,l=Util.getDoctypeDecl(window);assert(o),e.fid=t,l!==i?((s=safeview.tab_store.load()).is_pending_doctype_correction=!0,safeview.tab_store.save(s),Util.xframe_reload()):e.postToCommFrame({kind:"tf_ready",doctype:Util.getDoctypeDecl(window)})}function s(s){var l,c,d=s.data;if(s.origin===e.url_builder.getServiceDomain())switch(d.kind){case"cf_ready":e.comm_frame=s.source,e.sc_delegate=new ServerCallDelegate(e),e.serverCall=e.sc_delegate.call,e.stats=new XFrameStats(e),e.interp=new Interpreter(e),e.xbrowser=new XBrowserHelpers,e.alert=new AlertSupport(e),e.cof=new CrossOriginFrame(e,e.url_builder.buildInspectURL("/safeview-template/cof_frame.html?v="+BUILD_ID)),e.cof.call(["setDebugFlag",window.DEBUG]),e.tab_store=new TabStorage,e.history=new HistorySupport(e),e.download=new DownloadSupport(e),e.ui_frame=new UIFrame(e),e.context_menu=new ContextMenu(e),e.media_objects=new MediaObjects(e),e.media_source_extensions=new MediaSourceExtensions(e),window.EncryptedMediaExtensions&&(e.encrypted_media_extensions=new EncryptedMediaExtensions(e)),window.MediaSession&&(e.media_session=new MediaSession(e)),e.wa_manager=new WebAudioManager(e),e.canvas=new CanvasSupport(e),e.selection=new Selection(e),e.tab=new TabSupport(e),e.voodoo=new BrowserVoodoo(e),e.readonly=new ReadonlySupport(e),e.http_alert=new HttpAlertSupport(e),e.preload_indicator=new PreloadIndicator(e),e.print_handler=new PrintHandler(e),e.imgreq_mgr=new ImageRequestMgr(e),e.local_events=new LocalEvents(e),e.local_input=new LocalInput(e),e.lecho_regulator=new LEchoRegulator(e),e.lecho_regulator_ext=new LEchoRegulatorExt(e),e.lecho_error_alert=new LEchoErrorAlert(e),e.clipboard=new Clipboard(e),e.copy_paste_ctrl=new CopyPasteControl(e),e.text_monitor=new TextMonitor(e),e.dom_updater=new DOMUpdater(e),e.sheet_loader=new SheetLoader(e),e.exit_handler=new ExitHandler(e),e.fullscreen=new Fullscreen(e),e.geolocation=new Geolocation(e),e.wheel_ctrl=new WheelCtrl(e),e.key_ctrl=new KeyCtrl(e),e.webauthn=new Webauthn(e),e.interp.registerOpcodeHandler("set_doctype",a),e.interp.registerOpcodeHandler("set_top_fid",n),e.interp.registerOpcodeHandler("set_ctxmenu_mode",r),e.interp.registerOpcodeHandler("display_contextmenu",i),e.interp.registerOpcodeHandler("backend_dragdrop",o),e.callback.register("dom-loaded",(function(n){e.ui_frame.load(),insertDomLoadedElement(n,t)})),e.callback.register("surrogate-channel-connected",(function(t){t&&(e.local_events.resize_event(null,null),e.local_events.install_event_listeners(mf.window,mf.document)),e.surrogate_channel.send("rttpong",0,0,0)})),l=new Pairing(e).loadPairingState(),c={kind:"start_pairing",tab_id:Util.getOrSetTabID(),url:Util.getRawPageUrl(),hid:e.history.getHID(),doctype:Util.getDoctypeDecl(window),tproxy_enabled:window.TPROXY_ENABLED,persisted_state:l,localization_data:e.localization.get_localization_data(),framing_status:Util.getFramingStatus()},window.performance&&window.performance.timing&&(c.nav_start_time=window.performance.timing.navigationStart),e.postToCommFrame(c);break;case"command":e.stats.start("t_tip"),d.command_kind===MSG_KIND_CANVAS?e.interp.processOneCommand(d.command_kind,new DataView(d.command)):e.interp.processOneCommand(d.command_kind,d.command),e.stats.stop("t_tip");break;case"pairing_dict":if(e.pairing_dict=d.pairing_dict,!checkPairingResult(e.pairing_dict))break;e.postToCommFrame({kind:"start_surrogate_channel_loop"}),new Pairing(e).savePairingState(e.pairing_dict),e.active_tab=new ActiveTab(e),e.policy=new PolicySupport(e),e.feedback_bar=new FeedbackBar(e,window,!0);break;case"server_call_resp":e.sc_delegate.on_sc_result(s.source,s.origin,d);break;case"cb_reg":case"cb_dereg":case"cb_fired":e.callback.on_cb_msg(d);break;case"reload":d.reset_tab_store&&e.tab_store.clear(),Util.xframe_reload(!0);break;case"show_msg_bar":Util.show_message_bar(d.text);break;case"show_embedded_error":Util.showEmbeddedError(d.title,d.body,d.extra,e.template);break;case"latency_changed":onLatencyChange(d.latency_level);break;default:e.cof.onReceiveMessage(s)}else reportErrorClientEvent("tc-commframe-invalid-domain",{expected:e.url_builder.getServiceDomain(),actual:s.origin,message:d.kind,frame:"top"})}function l(){var n;t.info({event:"tc-started",build_id:BUILD_ID,url:window.location.href}),(n=document.createElement("iframe")).id="safeview-communication",n.name="comm",n.width=0,n.height=0,n.style.display="none",n.tabindex=-1,n.src=e.url_builder.buildServiceURL("/safeview-template/comm_frame.html/"+window.location.href),document.documentElement.appendChild(n)}e.useRemotingV2=function(){return!1},e.init=function(){Util.parseConfig(),e.url_builder=new URLBuilder(e),mf={window:window,document:window.document},window.mf=mf,e.fid="-1",__init_id_state(e.fid),e.role="top",e.callback=new XFrameCallbackSupport(e),e.surrogate_channel=new CommFrameChannel(e),e.template=new Template(e),e.localization=new Localization(e),EventListener.addListener(window,"message",s,!1),EventListener.addListener(window,"load",l,!1)},e.postToCommFrame=function(t){assert(e.comm_frame),t.fid=e.fid,e.comm_frame.postMessage(JSON.stringify(t),e.url_builder.getServiceDomain())}}function SubFrame(){var e=this;function t(t,n,r,i,o,a){var s,l=Util.getDoctypeDecl(window);assert(!o),assert(t===e.fid),l!==i||window.location.origin!==(window.TPROXY_ENABLED?r:e.url_builder.getServiceDomain())?(s=Util.compute_iframe_src(r,t,i),Util.locationReplace(window,s)):e.postToCommFrame({kind:"sf_ready",doctype:Util.getDoctypeDecl(window)})}function n(t){var n=t.data;if(t.origin===e.url_builder.getServiceDomain())switch(n.kind){case"command":n.command_kind===MSG_KIND_CANVAS?e.interp.processOneCommand(n.command_kind,new DataView(n.command)):e.interp.processOneCommand(n.command_kind,n.command);break;case"pairing_dict":e.pairing_dict=n.pairing_dict;break;case"server_call_resp":e.sc_delegate.on_sc_result(t.source,t.origin,n);break;default:assert(0)}else reportErrorClientEvent("tc-commframe-invalid-domain",{expected:e.url_builder.getServiceDomain(),actual:t.origin,message:n.kind,sub_frame_fid:e.fid})}function r(){BUILD_ID,e.sc_delegate=new ServerCallDelegate(e),e.serverCall=e.sc_delegate.call,e.template=new Template(e),e.stats=new XFrameStats(e),e.interp=new Interpreter(e),e.xbrowser=new XBrowserHelpers(e),e.url_builder=new URLBuilder(e),e.media_objects=new MediaObjects(e),e.media_source_extensions=new MediaSourceExtensions(e),window.EncryptedMediaExtensions&&(e.encrypted_media_extensions=new EncryptedMediaExtensions(e)),window.MediaSession&&(e.media_session=new MediaSession(e)),e.wa_manager=new WebAudioManager(e),e.canvas=new CanvasSupport(e),e.selection=new Selection(e),e.tab=new TabSupport(e),e.voodoo=new BrowserVoodoo(e),e.policy=new PolicySupport(e),e.print_handler=new PrintHandler(e),e.imgreq_mgr=new ImageRequestMgr(e),e.local_events=new LocalEvents(e),e.local_input=new LocalInput(e),e.lecho_regulator=new LEchoRegulator(e),e.lecho_regulator_ext=new LEchoRegulatorExt(e),e.lecho_error_alert=new LEchoErrorAlert(e),e.clipboard=new Clipboard(e),e.copy_paste_ctrl=new CopyPasteControl(e),e.text_monitor=new TextMonitor(e),e.dom_updater=new DOMUpdater(e),e.fullscreen=new Fullscreen(e),e.wheel_ctrl=new WheelCtrl(e),e.key_ctrl=new KeyCtrl(e),e.webauthn=new Webauthn(e),e.interp.registerOpcodeHandler("set_doctype",t),e.comm_frame=window.top.frames.comm,e.postToCommFrame({kind:"sf_ready",fid:e.fid,doctype:Util.getDoctypeDecl(window)})}e.useRemotingV2=function(){return!1},e.init=function(){Util.parseConfig(),e.role="sub",e.callback=new CallbackSupport(e),e.surrogate_channel=new CommFrameChannel(e),mf={window:window,document:window.document},window.mf=mf,e.fid=Util.getParam("fid"),__init_id_state(e.fid),window.TPROXY_ENABLED=1===parseInt(Util.getParam("tpe"),10),EventListener.addListener(window,"message",n,!1),EventListener.addListener(window,"load",r,!1)},e.postToCommFrame=function(t){assert(e.comm_frame),t.fid=e.fid,e.comm_frame.postMessage(JSON.stringify(t),e.url_builder.getServiceDomain())}}function CommFrame(){var e=this,t=new Logger("main",{level:"info"}),n={},r={};function i(t){var r,i=n[t];assert(i),i.match=!1,window.TPROXY_ENABLED?(r=i.origin_backend||i.origin_pairing)&&r===i.origin&&(i.match=!0):i.origin===window.location.origin&&(i.match=!0),i.doctype_backend&&i.doctype_backend!==i.doctype&&(i.match=!1),i.match&&t!==e.top_frame_fid&&e.postToFrame(t,{kind:"pairing_dict",pairing_dict:e.pairing_dict})}function o(e,t,r,o){var a;n[e]||(n[e]={}),(a=n[e]).origin_backend=t,a.doctype_backend=r,a.is_top_frame=o,i(e)}function a(t,r){var i,o,a=e.top_frame_fid,s={kind:"command",command:r,command_kind:t},l=!1;switch(t===MSG_KIND_DATA||t===MSG_KIND_CONTROL?o=r[0]:t===MSG_KIND_CANVAS&&(a=new window.DataView(r.buffer,r.byteOffset,8).getUint32(0,!1),s.command=r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)),"fupd"!==o&&"set_doctype"!==o&&"set_top_fid"!==o||(a=r[1]),assert(i=n[a]),o){case"set_top_fid":e.postToTopFrame(s),l=!0;break;case"set_doctype":i.frame&&(e.postToFrame(a,s,!0),r[5]||function(e,t){delete e.match,delete e.doctype,delete e.origin,delete e.frame}(i),l=!0);break;case"fupd":i.match&&(e.postToFrame(a,s),l=!0);break;default:t===MSG_KIND_CANVAS?i.match&&(e.postToFrame(a,s,!1,[s.command]),l=!0):(e.postToTopFrame(s),l=!0)}return l||e.update_queue.queue(a,[t,r]),l}function s(t){e.postToTopFrame({kind:"show_msg_bar",text:t})}function l(t){e.postToTopFrame({kind:"reload",reset_tab_store:t})}function c(t,r){var i,o,a,s,l,c,d,u;switch(i=r.fid,r.kind){case"start_pairing":if(s=t.source,l=t.origin,c=r.url,d=r.tproxy_enabled,u=new ParsedURL(c).origin,!(d?l===u&&s===parent:l===window.location.origin&&s===parent))return reportErrorClientEvent("tc-pairing-invalid-url",{top_frame_domain:t.origin,requested_url:r.url}),!1;break;case"send":case"server_call":case"client_report_msg":if(o=n[i],!(a=window.TPROXY_ENABLED?o.origin_backend||o.origin_pairing:e.url_builder.getServiceDomain())||a!==t.origin)return reportErrorClientEvent("tc-domframe-invalid-domain",{expected:a,actual:t.origin}),!1}return!0}function d(t){var r,o,s,l;if(c(t,r=JSON.parse(t.data)))switch(o=r.fid,n[o]||(n[o]={origin:t.origin,frame:t.source}),s=n[o],r.kind){case"start_pairing":window.TPROXY_ENABLED=r.tproxy_enabled,e.tab_store=new TabStorageBackedByLocalStorage(r.tab_id),e.localization=new Localization(e,r.localization_data),s.origin_pairing=t.origin,s.origin=t.origin,s.doctype=r.doctype,r.nav_start_time&&e.stats.setNavStartTime(r.nav_start_time),(l=new Pairing(e)).initPairingState(r.persisted_state),l.withSurrogateDo({on_complete:function(t){e.pairing_dict=t,e.postToTopFrame({kind:"pairing_dict",pairing_dict:e.pairing_dict})}},r.doctype,r.framing_status,r.url,r.hid||null);break;case"start_surrogate_channel_loop":e.surrogate_channel=startSurrogateChannelLoop();break;case"send":e.surrogate_channel.send.apply(this,r.args);break;case"close":e.surrogate_channel.close(r.reason);break;case"resume_client_update":e.surrogate_channel.send("resume_client_update");break;case"sf_ready":case"tf_ready":!function(e,t,r,o){var a;n[e]||(n[e]={}),(a=n[e]).frame=t,a.doctype=o,a.origin=r,i(e)}(o,t.source,t.origin,r.doctype),function(t){assert(n[t]),e.update_queue.count(t)&&e.update_queue.deliver(t,(function(e){var t;for(t=0;t<e.length;t+=1)a(e[t][0],e[t][1])}))}(o);break;case"server_call":e.sc_dispatcher.dispatch(o,r);break;case"cb_reg":case"cb_dereg":case"cb_fired":e.callback.on_cb_msg(r);break;case"client_report_msg":reportClientEvent(r.event,r.extrainfo,r.warn,r.always);break;case"stats":e.stats.on_xframe_stats_msg(r);break;default:assert(0,"Unknown message: "+r.kind)}}function u(){var t;for(t in r)r.hasOwnProperty(t)&&e.closeChannel(t)}e.useRemotingV2=function(){return!1},window.onload=function(){t.info("Comm frame for "+BUILD_ID+"."),EventListener.addListener(window,"message",d,!1),e.server_call=new ServerCall(e),e.serverCall=e.server_call.call,e.sc_dispatcher=new ServerCallDispatcher(e),e.template=new Template(e),e.stats=new Stats(e),e.event_reporter=new ClientEventReporter(e),e.interp=new Interpreter(e),e.xbrowser=new XBrowserHelpers(e),e.url_builder=new URLBuilder(e),e.media_objects=new MediaObjects(e),e.media_source_extensions=new MediaSourceExtensions(e),window.EncryptedMediaExtensions&&(e.encrypted_media_extensions=new EncryptedMediaExtensions(e)),window.MediaSession&&(e.media_session=new MediaSession(e)),e.restore_on_reattach=new RestoreOnReattach(e),e.selection=new Selection(e),e.tab=new TabSupport(e),e.update_queue=new FrameUpdateQueue,e.exit_handler=new ExitHandler(e),e.webauthn=new Webauthn(e),e.callback.register("frame-node-removed",(function(e){delete n[e]})),parent.postMessage({kind:"cf_ready"},"*")},e.openChannel=function(e,t){var n=new Channel(e,t);return r[e]=n,n},e.closeChannel=function(e){r[e].close(),delete r[e]},e.fatalError=function(n,r){t.error(r),DEBUG&&(u(),e.ui_frame.call("showModal","Crash")),reportClientEvent(n,r)},e.finish=function(){u()},e.init=function(){Util.parseConfig(),e.role="comm",e.top_frame_fid="-1",e.callback=new XFrameCallbackSupport(e)},e.interpret=function(t,r){return t===MSG_KIND_CONTROL&&function(t){var r,i,a,s;function l(t){e.update_queue.change_top_frame_fid(t),n[-1]&&(n[t]=n[-1])}switch(t[0]){case"set_top_fid":r=t[1],e.top_frame_fid!==r&&(e.top_frame_fid=r,l(r)),o(r,void 0,void 0,!0);break;case"set_doctype":r=t[1],s=t[3],a=t[4],(i=t[5])&&e.top_frame_fid!==r&&(e.top_frame_fid=r,l(r)),o(r,s,a,i)}}(r),a(t,r),!0},e.reset=function(t){e.event_reporter.flush(),l(!0)},e.reload=function(e){reportClientEvent("tc-reload-started",{countdown_ms:e}),e?new Countdown(e,s,(function(){l(!1)}),t).restart():l(!1)},e.showError=function(t,n,r){reportErrorClientEvent("show-error-page",{title:t,body:n,extra:r}),e.event_reporter.flush(),function(t,n,r){e.postToTopFrame({kind:"show_embedded_error",title:t,body:n,extra:r})}(t,n,r)},e.onLatencyChange=function(t){e.postToTopFrame({kind:"latency_changed",latency_level:t})},e.postToFrame=function(t,r,i,o){var a,s=n[t];(a=i?s.origin:s.origin_backend||s.origin_pairing)?(window.TPROXY_ENABLED||(a=e.url_builder.getServiceDomain()),s.frame.postMessage(r,a,o)):reportErrorClientEvent("tc-domframe-domain-check",{fid:t})},e.postToTopFrame=function(t){e.postToFrame(e.top_frame_fid,t)}}function Safeview(e){var t,n,r=this,i=new Logger("main",{level:"info"}),o={},a=!1,s={},l=Object.freeze({kValueDeviceWidth:-1});function c(e){r.fid=e,__init_id_state(e),r.update_queue.deliver(e,r.interpretQueued)}function d(e,t,n){r.ctx_menu_mode||(r.ctx_menu_mode={}),r.ctx_menu_mode.backend_driven=t,r.ctx_menu_mode.native_menu_for_input=n}function u(){safeview.context_menu.display.apply(safeview.context_menu,arguments)}function _(e){r.allow_backend_dragdrop=!0}function f(){window.clearInterval(t),t=null}function p(e,t){}function m(e){var t,n={};if(checkPairingResult(e)){if(r.pairing_dict=e,window.TPROXY_ENABLED&&Util.isFrameBuster()){if(!window.FRAMEBUST.new_window)return void Util.locationSet(window.top,window.location.href);Util.windowOpen(window.location.href)}r.surrogate_channel=startSurrogateChannelLoop(),Util.isAboutBlankUrl()&&safeview.surrogate_channel.send("get-persistent-policy"),n.through=!0,n.redirect_list=r.pairing_dict.rc_rlist,(t=safeview.url_builder.getDomain("inspect"))&&n.redirect_list&&-1===n.redirect_list.indexOf(t)&&(n.redirect_list+=","+t),n.login_url=r.pairing_dict.rc_url,n.transparent_mode=window.TPROXY_ENABLED,n.url=window.location.href,r.pairing.doCheckRequest(n)}}function g(){var e;for(e in o)o.hasOwnProperty(e)&&r.closeChannel(e)}function h(e){safeview.surrogate_channel&&safeview.surrogate_channel.send.apply(safeview.surrogate_channel,e)}function v(e){var t,n;h(["srm",e==="2".charCodeAt(0)]),t=function(){Util.xframe_reload()},h(["req-ack",n=__randstr(16)]),r.interp.registerOpcodeHandler("ack",(function(e){e===n&&(r.interp.deregisterOpcodeHandler("ack"),t(n))}))}function w(e){if(e.ctrlKey&&e.altKey&&e.shiftKey&&"keydown"===e.type)switch(e.keyCode){case"1".charCodeAt(0):case"2".charCodeAt(0):v(e.keyCode);break;case"S".charCodeAt(0):r.surrogate_view.start("keyboard shortcut");break;case"P".charCodeAt(0):h(["stop-dom"]);break;case"C".charCodeAt(0):h(["throttle-canvas"])}}function y(e){var t={renderer:"",vendor:""},n=e.getExtension("WEBGL_debug_renderer_info");return n&&(t.renderer=e.getParameter(n.UNMASKED_RENDERER_WEBGL),t.vendor=e.getParameter(n.UNMASKED_VENDOR_WEBGL)),t}function b(e){var t,n;try{if((t=document.createElement("canvas")).width=1,t.height=1,document.body.appendChild(t),n=t.getContext(e,{stencil:!0}))return function(e){return{glVersion:e.getParameter(e.VERSION),shadingLanguageVersion:e.getParameter(e.SHADING_LANGUAGE_VERSION),vendor:e.getParameter(e.VENDOR),renderer:e.getParameter(e.RENDERER),card:y(e),antialias:e.getContextAttributes().antialias?"Available":"Not available",redBits:e.getParameter(e.RED_BITS),greenBits:e.getParameter(e.GREEN_BITS),blueBits:e.getParameter(e.BLUE_BITS),alphaBits:e.getParameter(e.ALPHA_BITS),depthBits:e.getParameter(e.DEPTH_BITS),stencilBits:e.getParameter(e.STENCIL_BITS),maxRenderBufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxCombinedTextureImageUnits:e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxCubeMapTextureSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxFragmentUniformVectors:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxVaryingVectors:e.getParameter(e.MAX_VARYING_VECTORS),maxVertexAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexUniformVectors:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),extensions:e.getSupportedExtensions()}}(n)}catch(e){return null}finally{t&&t.parentNode&&t.parentNode.removeChild(t)}return null}function E(){var e,t,n=["webgl","experimental-webgl","webgl2","experimental-webgl2"],r={};for(e=0;e<n.length;e+=1)r[n[e]]=Util.splunkify(b(n[e]));r.wasm="object"==typeof window.WebAssembly,navigator&&(r.nr_cores=navigator.hardwareConcurrency,r.device_memory_gb=navigator.deviceMemory,navigator.javaEnabled&&(r.java_enabled=navigator.javaEnabled()),r.do_not_track=navigator.doNotTrack,r.max_touch_points=navigator.maxTouchPoints,(t=navigator.connection||navigator.mozConnection||navigator.webkitConnection)&&(r.connection=Util.splunkify({downlink:t.downlink,effective_type:t.effectiveType,rtt:t.rtt,save_data:t.saveData})));try{r.avail_canvas_memory=function(){for(var e,t,n=0,r=400*Math.pow(2,20),i=[];n<r&&(e=document.createElement("canvas"))&&(e.width=e.height=1024,t=e.getContext("2d"));)t.clearRect(0,0,1024,1024),i.push(e),n+=e.width*e.height*4;return i.forEach((function(e){e.width=e.height=0})),n}()}catch(e){}return r}e=__object_assign({parseConfig:Util.parseConfig,getContentWindow:function(){return window},enable_active_tab:!0},e||{}),r.role="main",r.setLayoutViewport=function(e){var n,i=[];assert("object"==typeof e),s&&JSON.stringify(s)===JSON.stringify(e)||((n=document.getElementById("svm"))||(n=document.createElement("meta"),document.head.appendChild(n),n.id="svm"),n.setAttribute("name","viewport"),void 0!==e.width&&i.push("width="+function(e){switch(assert(void 0!==e),e){case l.kValueDeviceWidth:return"device-width";default:return e}}(e.width)),void 0!==e.initial_scale&&i.push("initial-scale="+e.initial_scale),void 0!==e.user_zoom&&i.push("user-scalable="+(e.user_zoom?1:0)),void 0!==e.minimum_scale&&i.push("minimum-scale="+e.minimum_scale),void 0!==e.maximum_scale&&i.push("maximum-scale="+e.maximum_scale),n.setAttribute("content",i.join(",")),s=e,t&&f(),function(e){var n=Date.now();t=window.setInterval((function(){r.callback.fire("layout-viewport-props-changed",e),Date.now()-n>1e3&&f()}),100)}(e))},r.getLayoutViewport=function(){return Util.copyDict(s)},r.start=function(e){i.info({event:"tc-started",build_id:BUILD_ID,url:window.location.href}),r.qs_hinting="true"===Util.getQueryValue(window.location.search,"from_isolation"),e?m(e):r.pairing.withSurrogateDo({on_complete:m},Util.getDoctypeDecl(window),Util.getFramingStatus())},r.setPairing=function(e){r.pairing=e},window.onerror=function(e,t,n,i,o){function a(e){return e?e.toString():null}if("ResizeObserver loop limit exceeded"!==e)try{!function(e,t,n,i,o){var a={error_msg:e,url:t,line:n,column:i,stacktrace:printStackTrace(o),exception:o?o.toString():null};r.fatalError("tc-uncaught-exception",a)}(e,t,n,i,o)}catch(t){try{reportErrorClientEvent("double-fault",{error_msg:e,"first-exception":a(o),"second-exception":a(t)})}catch(n){window.triple_fault={error_msg:e,"first-exception":a(o),"second-exception":a(t),"third-exception":a(n)}}}},r.openChannel=function(e,t){var n=new Channel(e,t);return o[e]=n,n},r.closeChannel=function(e){o[e].close(),delete o[e]},r.fatalError=function(e,t){DEBUG&&(g(),r.ui_frame.call("showModal","Crash")),reportErrorClientEvent(e,t)},r.finish=function(){r.compositor&&(r.compositor.release(),r.compositor=null),r.metrics_observer&&r.metrics_observer.release(),g(),window.reportClientEvent=function(){},r.local_events.uninstall_event_listeners(mf.window,mf.document),r.lecho_regulator_ext.cleanup(),window.onerror=null},r.interpret=function(e,t){var n,i;if(!(e!==MSG_KIND_DATA&&e!==MSG_KIND_CONTROL||"fupd"!==t[0]&&"add_shadow_root"!==t[0])){if(n=t[1],r.frameset_wrapper&&isTopFrameFid(n)&&r.frameset_wrapper.is_pending()&&!a)return r.update_queue.queue(n,[e,t]),!0;if(r.dom_updater.has_pending_shadow_root(n))return r.update_queue.queue(n,[e,t]),!0;if(getWindowByFid(n)!==mf.window&&!safeview.frame_loader.isFrameReadyForUpdates(n)&&!a)return r.update_queue.queue(n,[e,t]),!0}return r.stats.start("t_tip"),i=r.interp.processOneCommand(e,t),r.stats.stop("t_tip"),i},r.interpretQueued=function(e){var t;for(t=0;t<e.length&&r.interpret(e[t][0],e[t][1]);t+=1);},r.reset=function(e){try{reportWarnClientEvent("tc-reset",{reason:e}),r.event_reporter&&r.event_reporter.flush(),r.tab_store&&r.tab_store.clear()}catch(e){}Util.xframe_reload(!0)},r.reload=function(e){reportClientEvent("tc-reload-started",{countdown_ms:e}),safeview.finish(),e?new Countdown(e,Util.show_message_bar,(function(){Util.xframe_reload(!0)}),i).restart():Util.xframe_reload(!0)},r.onLatencyChange=onLatencyChange,r.useRemotingV2=function(){return a},r.getLastMousePos=function(){return a?r.compositor.getLastMousePos():r.local_events.get_last_mouse_pos()},r.sendCommand=function(e){safeview.surrogate_channel&&safeview.surrogate_channel.send.apply(safeview.surrogate_channel,e)},r.isMobile=function(){return BrowserDetect.isMobile()},r.isAndroidChrome=function(){return BrowserDetect.isAndroidChrome()},r.isChrome=function(){return BrowserDetect.isChrome()},e.parseConfig(),n=e.getContentWindow(),mf={window:n,document:n.document},window.mf=mf,r.callback=new CallbackSupport(r),r.callback.register("dom-loaded",(function(e){r.ui_frame.load(),insertDomLoadedElement(e,i)})),r.callback.register("surrogate-channel-connected",(function(e){e&&r.local_events.resize_event(null,null),r.surrogate_channel.send("rttpong",0,0,0)})),r.callback.register("dom-init",(function(e,t){t||safeview.local_events.install_event_listeners(mf.window,mf.document)})),r.server_call=new ServerCall(r),r.serverCall=r.server_call.call,r.template=new Template(r),r.stats=new Stats(r),window.performance&&window.performance.timing&&r.stats.setNavStartTime(window.performance.timing.navigationStart),r.event_reporter=new ClientEventReporter(r),r.interp=new Interpreter(r),r.xbrowser=new XBrowserHelpers(r),r.alert=new AlertSupport(r),r.url_builder=new URLBuilder(r),r.tab_store=new TabStorage,r.pairing=new Pairing(r),r.pairing_dict=r.pairing.loadPairingState(),r.cof=new CrossOriginFrame(r,r.url_builder.buildInspectURL("/safeview-template/cof_frame.html?v="+BUILD_ID),cof_server_frame),r.cof.call(["setDebugFlag",window.DEBUG]),e.enable_active_tab&&(r.active_tab=new ActiveTab(r)),r.history=new HistorySupport(r),r.upload=new UploadSupport(r),r.geolocation=new Geolocation(r),r.ui_frame=new UIFrame(r),r.context_menu=new ContextMenu(r),r.feedback_bar=new FeedbackBar(r,window,!0),r.media_objects=new MediaObjects(r),r.media_source_extensions=new MediaSourceExtensions(r),window.EncryptedMediaExtensions&&(r.encrypted_media_extensions=new EncryptedMediaExtensions(r)),window.MediaSession&&(r.media_session=new MediaSession(r)),r.wa_manager=new WebAudioManager(r),r.restore_on_reattach=new RestoreOnReattach(r),r.canvas=new CanvasSupport(r),r.selection=new Selection(r),r.tab=new TabSupport(r),r.voodoo=new BrowserVoodoo(r),r.policy=new PolicySupport(r),r.readonly=new ReadonlySupport(r),r.http_alert=new HttpAlertSupport(r),r.preload_indicator=new PreloadIndicator(r),r.print_handler=new PrintHandler(r),r.imgreq_mgr=new ImageRequestMgr(r),r.local_events=new LocalEvents(r),r.local_input=new LocalInput(r),r.lecho_regulator=new LEchoRegulator(r),r.lecho_regulator_ext=new LEchoRegulatorExt(r),r.lecho_error_alert=new LEchoErrorAlert(r),r.clipboard=new Clipboard(r),r.copy_paste_ctrl=new CopyPasteControl(r),r.text_monitor=new TextMonitor(r),r.frame_loader=new FrameLoader(r),r.dom_updater=new DOMUpdater(r),r.ux=new UX(r,document),r.update_queue=new FrameUpdateQueue,r.sheet_loader=new SheetLoader(r),r.localization=new Localization(r),r.download=new DownloadSupport(r),r.surrogate_view=new SurrogateView(r),r.exit_handler=new ExitHandler(r),r.fullscreen=new Fullscreen(r),r.wheel_ctrl=new WheelCtrl(r),r.key_ctrl=new KeyCtrl(r),r.webauthn=new Webauthn(r),r.perf=CLIENT_PERF,r.metrics_observer=new MetricsObserver(r),r.interp.registerOpcodeHandler("set_top_fid",c),r.interp.registerOpcodeHandler("set_ctxmenu_mode",d),r.interp.registerOpcodeHandler("display_contextmenu",u),r.interp.registerOpcodeHandler("backend_dragdrop",_),r.interp.registerOpcodeHandler("rttping",(function(e,t,n){safeview.rtt_timestamp=e,safeview.surrogate_channel.send("rttpong",e,t,n)})),r.interp.registerOpcodeHandler("lvpc",p),r.interp.registerOpcodeHandler("MPA_session",(function(){})),EventListener.addListener(window,"message",r.cof.onReceiveMessage,!1),EventListener.addListener(window,"keydown",w,!1),r.callback.register("dom-init",(function(e){try{r.cof.call(["getFeatureReport"],(function(e){var t;e||(reportClientEvent("tc-feature-report",t=E(),!1),r.cof.call(["setFeatureReport",JSON.stringify(t)]))}))}catch(e){i.error({event:"tc-report-features-error",e:e})}(a=e)&&(r.compositor||(r.compositor=new Compositor.Display(r)))}))}function start(){var e=document.documentElement.getAttribute("sv_role"),t=Util.getParam("sv_itok",!0),n=Util.getParam("sv_reload",!0),r=Util.getParam("_sc_check",!0);t&&(Util.removeParam("sv_itok",t),t=decodeURIComponent(t)),n&&Util.removeParam("sv_reload",n),r&&Util.removeParam("_sc_check",r);try{window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""))}catch(e){}switch(e){case"main":(safeview=new Safeview).itok=t,tc_kernel||(window.onload=function(){safeview.start()});break;case"cof-server":Util.parseConfig(),(safeview=new CrossOriginFrameServer).init();break;case"top":(safeview=new TopFrame).init();break;case"comm":Util.parseConfig(),(safeview=new CommFrame).init();break;case"sub":(safeview=new SubFrame).init();break;default:assert(0)}}start();/*!
@fileoverview gl-matrix - High performance matrix and vector operations
@author Brandon Jones
@author Colin MacKenzie IV
@version 3.0.0

Copyright (c) 2015-2019, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).glMatrix={})}(this,(function(e){"use strict";var t=1e-6,r="undefined"!=typeof Float32Array?Float32Array:Array,n=Math.random,o=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var i=Object.freeze({EPSILON:t,get ARRAY_TYPE(){return r},RANDOM:n,setMatrixArrayType:function(e){r=e},toRadian:function(e){return e*o},equals:function(e,r){return Math.abs(e-r)<=t*Math.max(1,Math.abs(e),Math.abs(r))}});function a(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=r[0],l=r[1],c=r[2],u=r[3];return e[0]=n*s+i*l,e[1]=o*s+a*l,e[2]=n*c+i*u,e[3]=o*c+a*u,e}function s(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}var l=a,c=s,u=Object.freeze({create:function(){var e=new r(4);return r!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new r(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},fromValues:function(e,t,n,o){var i=new r(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=o,i},set:function(e,t,r,n,o){return e[0]=t,e[1]=r,e[2]=n,e[3]=o,e},transpose:function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},invert:function(e,t){var r=t[0],n=t[1],o=t[2],i=t[3],a=r*i-o*n;return a?(a=1/a,e[0]=i*a,e[1]=-n*a,e[2]=-o*a,e[3]=r*a,e):null},adjoint:function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:a,rotate:function(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+i*s,e[1]=o*l+a*s,e[2]=n*-s+i*l,e[3]=o*-s+a*l,e},scale:function(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=r[0],l=r[1];return e[0]=n*s,e[1]=o*s,e[2]=i*l,e[3]=a*l,e},fromRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3])},LDU:function(e,t,r,n){return e[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-e[2]*r[1],[e,t,r]},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},subtract:s,exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals:function(e,r){var n=e[0],o=e[1],i=e[2],a=e[3],s=r[0],l=r[1],c=r[2],u=r[3];return Math.abs(n-s)<=t*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(o-l)<=t*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(i-c)<=t*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-u)<=t*Math.max(1,Math.abs(a),Math.abs(u))},multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},mul:l,sub:c});function d(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=r[0],u=r[1],d=r[2],f=r[3],p=r[4],g=r[5];return e[0]=n*c+i*u,e[1]=o*c+a*u,e[2]=n*d+i*f,e[3]=o*d+a*f,e[4]=n*p+i*g+s,e[5]=o*p+a*g+l,e}function f(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}var p=d,g=f,m=Object.freeze({create:function(){var e=new r(6);return r!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new r(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},fromValues:function(e,t,n,o,i,a){var s=new r(6);return s[0]=e,s[1]=t,s[2]=n,s[3]=o,s[4]=i,s[5]=a,s},set:function(e,t,r,n,o,i,a){return e[0]=t,e[1]=r,e[2]=n,e[3]=o,e[4]=i,e[5]=a,e},invert:function(e,t){var r=t[0],n=t[1],o=t[2],i=t[3],a=t[4],s=t[5],l=r*i-n*o;return l?(l=1/l,e[0]=i*l,e[1]=-n*l,e[2]=-o*l,e[3]=r*l,e[4]=(o*s-i*a)*l,e[5]=(n*a-r*s)*l,e):null},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:d,rotate:function(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=Math.sin(r),u=Math.cos(r);return e[0]=n*u+i*c,e[1]=o*u+a*c,e[2]=n*-c+i*u,e[3]=o*-c+a*u,e[4]=s,e[5]=l,e},scale:function(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=r[0],u=r[1];return e[0]=n*c,e[1]=o*c,e[2]=i*u,e[3]=a*u,e[4]=s,e[5]=l,e},translate:function(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=r[0],u=r[1];return e[0]=n,e[1]=o,e[2]=i,e[3]=a,e[4]=n*c+i*u+s,e[5]=o*c+a*u+l,e},fromRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e[4]=0,e[5]=0,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},subtract:f,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,r){var n=e[0],o=e[1],i=e[2],a=e[3],s=e[4],l=e[5],c=r[0],u=r[1],d=r[2],f=r[3],p=r[4],g=r[5];return Math.abs(n-c)<=t*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(o-u)<=t*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(i-d)<=t*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-f)<=t*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-p)<=t*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(l-g)<=t*Math.max(1,Math.abs(l),Math.abs(g))},mul:p,sub:g});function k(){var e=new r(9);return r!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function h(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],f=r[0],p=r[1],g=r[2],m=r[3],k=r[4],h=r[5],S=r[6],y=r[7],v=r[8];return e[0]=f*n+p*a+g*c,e[1]=f*o+p*s+g*u,e[2]=f*i+p*l+g*d,e[3]=m*n+k*a+h*c,e[4]=m*o+k*s+h*u,e[5]=m*i+k*l+h*d,e[6]=S*n+y*a+v*c,e[7]=S*o+y*s+v*u,e[8]=S*i+y*l+v*d,e}function S(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}var y=h,v=S,b=Object.freeze({create:k,fromMat4:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone:function(e){var t=new r(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromValues:function(e,t,n,o,i,a,s,l,c){var u=new r(9);return u[0]=e,u[1]=t,u[2]=n,u[3]=o,u[4]=i,u[5]=a,u[6]=s,u[7]=l,u[8]=c,u},set:function(e,t,r,n,o,i,a,s,l,c){return e[0]=t,e[1]=r,e[2]=n,e[3]=o,e[4]=i,e[5]=a,e[6]=s,e[7]=l,e[8]=c,e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){if(e===t){var r=t[1],n=t[2],o=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=o}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},invert:function(e,t){var r=t[0],n=t[1],o=t[2],i=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=u*a-s*c,f=-u*i+s*l,p=c*i-a*l,g=r*d+n*f+o*p;return g?(g=1/g,e[0]=d*g,e[1]=(-u*n+o*c)*g,e[2]=(s*n-o*a)*g,e[3]=f*g,e[4]=(u*r-o*l)*g,e[5]=(-s*r+o*i)*g,e[6]=p*g,e[7]=(-c*r+n*l)*g,e[8]=(a*r-n*i)*g,e):null},adjoint:function(e,t){var r=t[0],n=t[1],o=t[2],i=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8];return e[0]=a*u-s*c,e[1]=o*c-n*u,e[2]=n*s-o*a,e[3]=s*l-i*u,e[4]=r*u-o*l,e[5]=o*i-r*s,e[6]=i*c-a*l,e[7]=n*l-r*c,e[8]=r*a-n*i,e},determinant:function(e){var t=e[0],r=e[1],n=e[2],o=e[3],i=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*(c*i-a*l)+r*(-c*o+a*s)+n*(l*o-i*s)},multiply:h,translate:function(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],f=r[0],p=r[1];return e[0]=n,e[1]=o,e[2]=i,e[3]=a,e[4]=s,e[5]=l,e[6]=f*n+p*a+c,e[7]=f*o+p*s+u,e[8]=f*i+p*l+d,e},rotate:function(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],f=Math.sin(r),p=Math.cos(r);return e[0]=p*n+f*a,e[1]=p*o+f*s,e[2]=p*i+f*l,e[3]=p*a-f*n,e[4]=p*s-f*o,e[5]=p*l-f*i,e[6]=c,e[7]=u,e[8]=d,e},scale:function(e,t,r){var n=r[0],o=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},fromRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat:function(e,t){var r=t[0],n=t[1],o=t[2],i=t[3],a=r+r,s=n+n,l=o+o,c=r*a,u=n*a,d=n*s,f=o*a,p=o*s,g=o*l,m=i*a,k=i*s,h=i*l;return e[0]=1-d-g,e[3]=u-h,e[6]=f+k,e[1]=u+h,e[4]=1-c-g,e[7]=p-m,e[2]=f-k,e[5]=p+m,e[8]=1-c-d,e},normalFromMat4:function(e,t){var r=t[0],n=t[1],o=t[2],i=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=t[9],f=t[10],p=t[11],g=t[12],m=t[13],k=t[14],h=t[15],S=r*s-n*a,y=r*l-o*a,v=r*c-i*a,b=n*l-o*s,C=n*c-i*s,_=o*c-i*l,T=u*m-d*g,w=u*k-f*g,R=u*h-p*g,x=d*k-f*m,D=d*h-p*m,M=f*h-p*k,F=S*M-y*D+v*x+b*R-C*w+_*T;return F?(F=1/F,e[0]=(s*M-l*D+c*x)*F,e[1]=(l*R-a*M-c*w)*F,e[2]=(a*D-s*R+c*T)*F,e[3]=(o*D-n*M-i*x)*F,e[4]=(r*M-o*R+i*w)*F,e[5]=(n*R-r*D-i*T)*F,e[6]=(m*_-k*C+h*b)*F,e[7]=(k*v-g*_-h*y)*F,e[8]=(g*C-m*v+h*S)*F,e):null},projection:function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},subtract:S,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals:function(e,r){var n=e[0],o=e[1],i=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=e[8],f=r[0],p=r[1],g=r[2],m=r[3],k=r[4],h=r[5],S=r[6],y=r[7],v=r[8];return Math.abs(n-f)<=t*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(o-p)<=t*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(i-g)<=t*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(a-m)<=t*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-k)<=t*Math.max(1,Math.abs(s),Math.abs(k))&&Math.abs(l-h)<=t*Math.max(1,Math.abs(l),Math.abs(h))&&Math.abs(c-S)<=t*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(u-y)<=t*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(d-v)<=t*Math.max(1,Math.abs(d),Math.abs(v))},mul:y,sub:v});function C(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],f=t[9],p=t[10],g=t[11],m=t[12],k=t[13],h=t[14],S=t[15],y=r[0],v=r[1],b=r[2],C=r[3];return e[0]=y*n+v*s+b*d+C*m,e[1]=y*o+v*l+b*f+C*k,e[2]=y*i+v*c+b*p+C*h,e[3]=y*a+v*u+b*g+C*S,y=r[4],v=r[5],b=r[6],C=r[7],e[4]=y*n+v*s+b*d+C*m,e[5]=y*o+v*l+b*f+C*k,e[6]=y*i+v*c+b*p+C*h,e[7]=y*a+v*u+b*g+C*S,y=r[8],v=r[9],b=r[10],C=r[11],e[8]=y*n+v*s+b*d+C*m,e[9]=y*o+v*l+b*f+C*k,e[10]=y*i+v*c+b*p+C*h,e[11]=y*a+v*u+b*g+C*S,y=r[12],v=r[13],b=r[14],C=r[15],e[12]=y*n+v*s+b*d+C*m,e[13]=y*o+v*l+b*f+C*k,e[14]=y*i+v*c+b*p+C*h,e[15]=y*a+v*u+b*g+C*S,e}function T(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=n+n,l=o+o,c=i+i,u=n*s,d=n*l,f=n*c,p=o*l,g=o*c,m=i*c,k=a*s,h=a*l,S=a*c;return e[0]=1-(p+m),e[1]=d+S,e[2]=f-h,e[3]=0,e[4]=d-S,e[5]=1-(u+m),e[6]=g+k,e[7]=0,e[8]=f+h,e[9]=g-k,e[10]=1-(u+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function w(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function R(e,t){var r=t[0],n=t[1],o=t[2],i=t[4],a=t[5],s=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.hypot(r,n,o),e[1]=Math.hypot(i,a,s),e[2]=Math.hypot(l,c,u),e}function x(e,t){var n=new r(3);R(n,t);var o=1/n[0],i=1/n[1],a=1/n[2],s=t[0]*o,l=t[1]*i,c=t[2]*a,u=t[4]*o,d=t[5]*i,f=t[6]*a,p=t[8]*o,g=t[9]*i,m=t[10]*a,k=s+d+m,h=0;return k>0?(h=2*Math.sqrt(k+1),e[3]=.25*h,e[0]=(f-g)/h,e[1]=(p-c)/h,e[2]=(l-u)/h):s>d&&s>m?(h=2*Math.sqrt(1+s-d-m),e[3]=(f-g)/h,e[0]=.25*h,e[1]=(l+u)/h,e[2]=(p+c)/h):d>m?(h=2*Math.sqrt(1+d-s-m),e[3]=(p-c)/h,e[0]=(l+u)/h,e[1]=.25*h,e[2]=(f+g)/h):(h=2*Math.sqrt(1+m-s-d),e[3]=(l-u)/h,e[0]=(p+c)/h,e[1]=(f+g)/h,e[2]=.25*h),e}function D(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}var M=_,F=D,E=Object.freeze({create:function(){var e=new r(16);return r!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},clone:function(e){var t=new r(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:function(e,t,n,o,i,a,s,l,c,u,d,f,p,g,m,k){var h=new r(16);return h[0]=e,h[1]=t,h[2]=n,h[3]=o,h[4]=i,h[5]=a,h[6]=s,h[7]=l,h[8]=c,h[9]=u,h[10]=d,h[11]=f,h[12]=p,h[13]=g,h[14]=m,h[15]=k,h},set:function(e,t,r,n,o,i,a,s,l,c,u,d,f,p,g,m,k){return e[0]=t,e[1]=r,e[2]=n,e[3]=o,e[4]=i,e[5]=a,e[6]=s,e[7]=l,e[8]=c,e[9]=u,e[10]=d,e[11]=f,e[12]=p,e[13]=g,e[14]=m,e[15]=k,e},identity:C,transpose:function(e,t){if(e===t){var r=t[1],n=t[2],o=t[3],i=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=i,e[11]=t[14],e[12]=o,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:function(e,t){var r=t[0],n=t[1],o=t[2],i=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=t[9],f=t[10],p=t[11],g=t[12],m=t[13],k=t[14],h=t[15],S=r*s-n*a,y=r*l-o*a,v=r*c-i*a,b=n*l-o*s,C=n*c-i*s,_=o*c-i*l,T=u*m-d*g,w=u*k-f*g,R=u*h-p*g,x=d*k-f*m,D=d*h-p*m,M=f*h-p*k,F=S*M-y*D+v*x+b*R-C*w+_*T;return F?(F=1/F,e[0]=(s*M-l*D+c*x)*F,e[1]=(o*D-n*M-i*x)*F,e[2]=(m*_-k*C+h*b)*F,e[3]=(f*C-d*_-p*b)*F,e[4]=(l*R-a*M-c*w)*F,e[5]=(r*M-o*R+i*w)*F,e[6]=(k*v-g*_-h*y)*F,e[7]=(u*_-f*v+p*y)*F,e[8]=(a*D-s*R+c*T)*F,e[9]=(n*R-r*D-i*T)*F,e[10]=(g*C-m*v+h*S)*F,e[11]=(d*v-u*C-p*S)*F,e[12]=(s*w-a*x-l*T)*F,e[13]=(r*x-n*w+o*T)*F,e[14]=(m*y-g*b-k*S)*F,e[15]=(u*b-d*y+f*S)*F,e):null},adjoint:function(e,t){var r=t[0],n=t[1],o=t[2],i=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=t[9],f=t[10],p=t[11],g=t[12],m=t[13],k=t[14],h=t[15];return e[0]=s*(f*h-p*k)-d*(l*h-c*k)+m*(l*p-c*f),e[1]=-(n*(f*h-p*k)-d*(o*h-i*k)+m*(o*p-i*f)),e[2]=n*(l*h-c*k)-s*(o*h-i*k)+m*(o*c-i*l),e[3]=-(n*(l*p-c*f)-s*(o*p-i*f)+d*(o*c-i*l)),e[4]=-(a*(f*h-p*k)-u*(l*h-c*k)+g*(l*p-c*f)),e[5]=r*(f*h-p*k)-u*(o*h-i*k)+g*(o*p-i*f),e[6]=-(r*(l*h-c*k)-a*(o*h-i*k)+g*(o*c-i*l)),e[7]=r*(l*p-c*f)-a*(o*p-i*f)+u*(o*c-i*l),e[8]=a*(d*h-p*m)-u*(s*h-c*m)+g*(s*p-c*d),e[9]=-(r*(d*h-p*m)-u*(n*h-i*m)+g*(n*p-i*d)),e[10]=r*(s*h-c*m)-a*(n*h-i*m)+g*(n*c-i*s),e[11]=-(r*(s*p-c*d)-a*(n*p-i*d)+u*(n*c-i*s)),e[12]=-(a*(d*k-f*m)-u*(s*k-l*m)+g*(s*f-l*d)),e[13]=r*(d*k-f*m)-u*(n*k-o*m)+g*(n*f-o*d),e[14]=-(r*(s*k-l*m)-a*(n*k-o*m)+g*(n*l-o*s)),e[15]=r*(s*f-l*d)-a*(n*f-o*d)+u*(n*l-o*s),e},determinant:function(e){var t=e[0],r=e[1],n=e[2],o=e[3],i=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],k=e[15];return(t*a-r*i)*(d*k-f*m)-(t*s-n*i)*(u*k-f*g)+(t*l-o*i)*(u*m-d*g)+(r*s-n*a)*(c*k-f*p)-(r*l-o*a)*(c*m-d*p)+(n*l-o*s)*(c*g-u*p)},multiply:_,translate:function(e,t,r){var n,o,i,a,s,l,c,u,d,f,p,g,m=r[0],k=r[1],h=r[2];return t===e?(e[12]=t[0]*m+t[4]*k+t[8]*h+t[12],e[13]=t[1]*m+t[5]*k+t[9]*h+t[13],e[14]=t[2]*m+t[6]*k+t[10]*h+t[14],e[15]=t[3]*m+t[7]*k+t[11]*h+t[15]):(n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],f=t[9],p=t[10],g=t[11],e[0]=n,e[1]=o,e[2]=i,e[3]=a,e[4]=s,e[5]=l,e[6]=c,e[7]=u,e[8]=d,e[9]=f,e[10]=p,e[11]=g,e[12]=n*m+s*k+d*h+t[12],e[13]=o*m+l*k+f*h+t[13],e[14]=i*m+c*k+p*h+t[14],e[15]=a*m+u*k+g*h+t[15]),e},scale:function(e,t,r){var n=r[0],o=r[1],i=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},rotate:function(e,r,n,o){var i,a,s,l,c,u,d,f,p,g,m,k,h,S,y,v,b,C,_,T,w,R,x,D,M=o[0],F=o[1],E=o[2],I=Math.hypot(M,F,E);return I<t?null:(M*=I=1/I,F*=I,E*=I,i=Math.sin(n),s=1-(a=Math.cos(n)),l=r[0],c=r[1],u=r[2],d=r[3],f=r[4],p=r[5],g=r[6],m=r[7],k=r[8],h=r[9],S=r[10],y=r[11],v=M*M*s+a,b=F*M*s+E*i,C=E*M*s-F*i,_=M*F*s-E*i,T=F*F*s+a,w=E*F*s+M*i,R=M*E*s+F*i,x=F*E*s-M*i,D=E*E*s+a,e[0]=l*v+f*b+k*C,e[1]=c*v+p*b+h*C,e[2]=u*v+g*b+S*C,e[3]=d*v+m*b+y*C,e[4]=l*_+f*T+k*w,e[5]=c*_+p*T+h*w,e[6]=u*_+g*T+S*w,e[7]=d*_+m*T+y*w,e[8]=l*R+f*x+k*D,e[9]=c*R+p*x+h*D,e[10]=u*R+g*x+S*D,e[11]=d*R+m*x+y*D,r!==e&&(e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e)},rotateX:function(e,t,r){var n=Math.sin(r),o=Math.cos(r),i=t[4],a=t[5],s=t[6],l=t[7],c=t[8],u=t[9],d=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*o+c*n,e[5]=a*o+u*n,e[6]=s*o+d*n,e[7]=l*o+f*n,e[8]=c*o-i*n,e[9]=u*o-a*n,e[10]=d*o-s*n,e[11]=f*o-l*n,e},rotateY:function(e,t,r){var n=Math.sin(r),o=Math.cos(r),i=t[0],a=t[1],s=t[2],l=t[3],c=t[8],u=t[9],d=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*o-c*n,e[1]=a*o-u*n,e[2]=s*o-d*n,e[3]=l*o-f*n,e[8]=i*n+c*o,e[9]=a*n+u*o,e[10]=s*n+d*o,e[11]=l*n+f*o,e},rotateZ:function(e,t,r){var n=Math.sin(r),o=Math.cos(r),i=t[0],a=t[1],s=t[2],l=t[3],c=t[4],u=t[5],d=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*o+c*n,e[1]=a*o+u*n,e[2]=s*o+d*n,e[3]=l*o+f*n,e[4]=c*o-i*n,e[5]=u*o-a*n,e[6]=d*o-s*n,e[7]=f*o-l*n,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotation:function(e,r,n){var o,i,a,s=n[0],l=n[1],c=n[2],u=Math.hypot(s,l,c);return u<t?null:(s*=u=1/u,l*=u,c*=u,o=Math.sin(r),a=1-(i=Math.cos(r)),e[0]=s*s*a+i,e[1]=l*s*a+c*o,e[2]=c*s*a-l*o,e[3]=0,e[4]=s*l*a-c*o,e[5]=l*l*a+i,e[6]=c*l*a+s*o,e[7]=0,e[8]=s*c*a+l*o,e[9]=l*c*a-s*o,e[10]=c*c*a+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:T,fromQuat2:function(e,t){var n=new r(3),o=-t[0],i=-t[1],a=-t[2],s=t[3],l=t[4],c=t[5],u=t[6],d=t[7],f=o*o+i*i+a*a+s*s;return f>0?(n[0]=2*(l*s+d*o+c*a-u*i)/f,n[1]=2*(c*s+d*i+u*o-l*a)/f,n[2]=2*(u*s+d*a+l*i-c*o)/f):(n[0]=2*(l*s+d*o+c*a-u*i),n[1]=2*(c*s+d*i+u*o-l*a),n[2]=2*(u*s+d*a+l*i-c*o)),T(e,t,n),e},getTranslation:w,getScaling:R,getRotation:x,fromRotationTranslationScale:function(e,t,r,n){var o=t[0],i=t[1],a=t[2],s=t[3],l=o+o,c=i+i,u=a+a,d=o*l,f=o*c,p=o*u,g=i*c,m=i*u,k=a*u,h=s*l,S=s*c,y=s*u,v=n[0],b=n[1],C=n[2];return e[0]=(1-(g+k))*v,e[1]=(f+y)*v,e[2]=(p-S)*v,e[3]=0,e[4]=(f-y)*b,e[5]=(1-(d+k))*b,e[6]=(m+h)*b,e[7]=0,e[8]=(p+S)*C,e[9]=(m-h)*C,e[10]=(1-(d+g))*C,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,r,n,o){var i=t[0],a=t[1],s=t[2],l=t[3],c=i+i,u=a+a,d=s+s,f=i*c,p=i*u,g=i*d,m=a*u,k=a*d,h=s*d,S=l*c,y=l*u,v=l*d,b=n[0],C=n[1],_=n[2],T=o[0],w=o[1],R=o[2],x=(1-(m+h))*b,D=(p+v)*b,M=(g-y)*b,F=(p-v)*C,E=(1-(f+h))*C,I=(k+S)*C,P=(g+y)*_,L=(k-S)*_,O=(1-(f+m))*_;return e[0]=x,e[1]=D,e[2]=M,e[3]=0,e[4]=F,e[5]=E,e[6]=I,e[7]=0,e[8]=P,e[9]=L,e[10]=O,e[11]=0,e[12]=r[0]+T-(x*T+F*w+P*R),e[13]=r[1]+w-(D*T+E*w+L*R),e[14]=r[2]+R-(M*T+I*w+O*R),e[15]=1,e},fromQuat:function(e,t){var r=t[0],n=t[1],o=t[2],i=t[3],a=r+r,s=n+n,l=o+o,c=r*a,u=n*a,d=n*s,f=o*a,p=o*s,g=o*l,m=i*a,k=i*s,h=i*l;return e[0]=1-d-g,e[1]=u+h,e[2]=f-k,e[3]=0,e[4]=u-h,e[5]=1-c-g,e[6]=p+m,e[7]=0,e[8]=f+k,e[9]=p-m,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,r,n,o,i,a){var s=1/(r-t),l=1/(o-n),c=1/(i-a);return e[0]=2*i*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*l,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(o+n)*l,e[10]=(a+i)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*i*2*c,e[15]=0,e},perspective:function(e,t,r,n,o){var i,a=1/Math.tan(t/2);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=o&&o!==1/0?(i=1/(n-o),e[10]=(o+n)*i,e[14]=2*o*n*i):(e[10]=-1,e[14]=-2*n),e},perspectiveFromFieldOfView:function(e,t,r,n){var o=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+s),c=2/(o+i);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-s)*l*.5,e[9]=(o-i)*c*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e},ortho:function(e,t,r,n,o,i,a){var s=1/(t-r),l=1/(n-o),c=1/(i-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(o+n)*l,e[14]=(a+i)*c,e[15]=1,e},lookAt:function(e,r,n,o){var i,a,s,l,c,u,d,f,p,g,m=r[0],k=r[1],h=r[2],S=o[0],y=o[1],v=o[2],b=n[0],_=n[1],T=n[2];return Math.abs(m-b)<t&&Math.abs(k-_)<t&&Math.abs(h-T)<t?C(e):(d=m-b,f=k-_,p=h-T,i=y*(p*=g=1/Math.hypot(d,f,p))-v*(f*=g),a=v*(d*=g)-S*p,s=S*f-y*d,(g=Math.hypot(i,a,s))?(i*=g=1/g,a*=g,s*=g):(i=0,a=0,s=0),l=f*s-p*a,c=p*i-d*s,u=d*a-f*i,(g=Math.hypot(l,c,u))?(l*=g=1/g,c*=g,u*=g):(l=0,c=0,u=0),e[0]=i,e[1]=l,e[2]=d,e[3]=0,e[4]=a,e[5]=c,e[6]=f,e[7]=0,e[8]=s,e[9]=u,e[10]=p,e[11]=0,e[12]=-(i*m+a*k+s*h),e[13]=-(l*m+c*k+u*h),e[14]=-(d*m+f*k+p*h),e[15]=1,e)},targetTo:function(e,t,r,n){var o=t[0],i=t[1],a=t[2],s=n[0],l=n[1],c=n[2],u=o-r[0],d=i-r[1],f=a-r[2],p=u*u+d*d+f*f;p>0&&(u*=p=1/Math.sqrt(p),d*=p,f*=p);var g=l*f-c*d,m=c*u-s*f,k=s*d-l*u;return(p=g*g+m*m+k*k)>0&&(g*=p=1/Math.sqrt(p),m*=p,k*=p),e[0]=g,e[1]=m,e[2]=k,e[3]=0,e[4]=d*k-f*m,e[5]=f*g-u*k,e[6]=u*m-d*g,e[7]=0,e[8]=u,e[9]=d,e[10]=f,e[11]=0,e[12]=o,e[13]=i,e[14]=a,e[15]=1,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},subtract:D,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},equals:function(e,r){var n=e[0],o=e[1],i=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=e[8],f=e[9],p=e[10],g=e[11],m=e[12],k=e[13],h=e[14],S=e[15],y=r[0],v=r[1],b=r[2],C=r[3],_=r[4],T=r[5],w=r[6],R=r[7],x=r[8],D=r[9],M=r[10],F=r[11],E=r[12],I=r[13],P=r[14],L=r[15];return Math.abs(n-y)<=t*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-v)<=t*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(i-b)<=t*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(a-C)<=t*Math.max(1,Math.abs(a),Math.abs(C))&&Math.abs(s-_)<=t*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(l-T)<=t*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-w)<=t*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(u-R)<=t*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(d-x)<=t*Math.max(1,Math.abs(d),Math.abs(x))&&Math.abs(f-D)<=t*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(p-M)<=t*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(g-F)<=t*Math.max(1,Math.abs(g),Math.abs(F))&&Math.abs(m-E)<=t*Math.max(1,Math.abs(m),Math.abs(E))&&Math.abs(k-I)<=t*Math.max(1,Math.abs(k),Math.abs(I))&&Math.abs(h-P)<=t*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(S-L)<=t*Math.max(1,Math.abs(S),Math.abs(L))},mul:M,sub:F});function I(){var e=new r(3);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function P(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function L(e,t,n){var o=new r(3);return o[0]=e,o[1]=t,o[2]=n,o}function O(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function A(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function B(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function H(e,t){var r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2];return Math.hypot(r,n,o)}function N(e,t){var r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2];return r*r+n*n+o*o}function U(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function V(e,t){var r=t[0],n=t[1],o=t[2],i=r*r+n*n+o*o;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function z(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function W(e,t,r){var n=t[0],o=t[1],i=t[2],a=r[0],s=r[1],l=r[2];return e[0]=o*l-i*s,e[1]=i*a-n*l,e[2]=n*s-o*a,e}var G,j=O,Y=A,X=B,q=H,K=N,Q=P,J=U,Z=(G=I(),function(e,t,r,n,o,i){var a,s;for(t||(t=3),r||(r=0),s=n?Math.min(n*t+r,e.length):e.length,a=r;a<s;a+=t)G[0]=e[a],G[1]=e[a+1],G[2]=e[a+2],o(G,G,i),e[a]=G[0],e[a+1]=G[1],e[a+2]=G[2];return e}),$=Object.freeze({create:I,clone:function(e){var t=new r(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:P,fromValues:L,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},subtract:O,multiply:A,divide:B,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},scaleAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e},distance:H,squaredDistance:N,squaredLength:U,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:V,dot:z,cross:W,lerp:function(e,t,r,n){var o=t[0],i=t[1],a=t[2];return e[0]=o+n*(r[0]-o),e[1]=i+n*(r[1]-i),e[2]=a+n*(r[2]-a),e},hermite:function(e,t,r,n,o,i){var a=i*i,s=a*(2*i-3)+1,l=a*(i-2)+i,c=a*(i-1),u=a*(3-2*i);return e[0]=t[0]*s+r[0]*l+n[0]*c+o[0]*u,e[1]=t[1]*s+r[1]*l+n[1]*c+o[1]*u,e[2]=t[2]*s+r[2]*l+n[2]*c+o[2]*u,e},bezier:function(e,t,r,n,o,i){var a=1-i,s=a*a,l=i*i,c=s*a,u=3*i*s,d=3*l*a,f=l*i;return e[0]=t[0]*c+r[0]*u+n[0]*d+o[0]*f,e[1]=t[1]*c+r[1]*u+n[1]*d+o[1]*f,e[2]=t[2]*c+r[2]*u+n[2]*d+o[2]*f,e},random:function(e,t){t=t||1;var r=2*n()*Math.PI,o=2*n()-1,i=Math.sqrt(1-o*o)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=o*t,e},transformMat4:function(e,t,r){var n=t[0],o=t[1],i=t[2],a=r[3]*n+r[7]*o+r[11]*i+r[15];return a=a||1,e[0]=(r[0]*n+r[4]*o+r[8]*i+r[12])/a,e[1]=(r[1]*n+r[5]*o+r[9]*i+r[13])/a,e[2]=(r[2]*n+r[6]*o+r[10]*i+r[14])/a,e},transformMat3:function(e,t,r){var n=t[0],o=t[1],i=t[2];return e[0]=n*r[0]+o*r[3]+i*r[6],e[1]=n*r[1]+o*r[4]+i*r[7],e[2]=n*r[2]+o*r[5]+i*r[8],e},transformQuat:function(e,t,r){var n=r[0],o=r[1],i=r[2],a=r[3],s=t[0],l=t[1],c=t[2],u=o*c-i*l,d=i*s-n*c,f=n*l-o*s,p=o*f-i*d,g=i*u-n*f,m=n*d-o*u,k=2*a;return u*=k,d*=k,f*=k,p*=2,g*=2,m*=2,e[0]=s+u+p,e[1]=l+d+g,e[2]=c+f+m,e},rotateX:function(e,t,r,n){var o=[],i=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],i[0]=o[0],i[1]=o[1]*Math.cos(n)-o[2]*Math.sin(n),i[2]=o[1]*Math.sin(n)+o[2]*Math.cos(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e},rotateY:function(e,t,r,n){var o=[],i=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],i[0]=o[2]*Math.sin(n)+o[0]*Math.cos(n),i[1]=o[1],i[2]=o[2]*Math.cos(n)-o[0]*Math.sin(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e},rotateZ:function(e,t,r,n){var o=[],i=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],i[0]=o[0]*Math.cos(n)-o[1]*Math.sin(n),i[1]=o[0]*Math.sin(n)+o[1]*Math.cos(n),i[2]=o[2],e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e},angle:function(e,t){var r=L(e[0],e[1],e[2]),n=L(t[0],t[1],t[2]);V(r,r),V(n,n);var o=z(r,n);return o>1?0:o<-1?Math.PI:Math.acos(o)},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equals:function(e,r){var n=e[0],o=e[1],i=e[2],a=r[0],s=r[1],l=r[2];return Math.abs(n-a)<=t*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(o-s)<=t*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(i-l)<=t*Math.max(1,Math.abs(i),Math.abs(l))},sub:j,mul:Y,div:X,dist:q,sqrDist:K,len:Q,sqrLen:J,forEach:Z});function ee(){var e=new r(4);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function te(e){var t=new r(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function re(e,t,n,o){var i=new r(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=o,i}function ne(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function oe(e,t,r,n,o){return e[0]=t,e[1]=r,e[2]=n,e[3]=o,e}function ie(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function ae(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function se(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function le(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function ce(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function ue(e,t){var r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2],i=t[3]-e[3];return Math.hypot(r,n,o,i)}function de(e,t){var r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2],i=t[3]-e[3];return r*r+n*n+o*o+i*i}function fe(e){var t=e[0],r=e[1],n=e[2],o=e[3];return Math.hypot(t,r,n,o)}function pe(e){var t=e[0],r=e[1],n=e[2],o=e[3];return t*t+r*r+n*n+o*o}function ge(e,t){var r=t[0],n=t[1],o=t[2],i=t[3],a=r*r+n*n+o*o+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=n*a,e[2]=o*a,e[3]=i*a,e}function me(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function ke(e,t,r,n){var o=t[0],i=t[1],a=t[2],s=t[3];return e[0]=o+n*(r[0]-o),e[1]=i+n*(r[1]-i),e[2]=a+n*(r[2]-a),e[3]=s+n*(r[3]-s),e}function he(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Se(e,r){var n=e[0],o=e[1],i=e[2],a=e[3],s=r[0],l=r[1],c=r[2],u=r[3];return Math.abs(n-s)<=t*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(o-l)<=t*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(i-c)<=t*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-u)<=t*Math.max(1,Math.abs(a),Math.abs(u))}var ye=ae,ve=se,be=le,Ce=ue,_e=de,Te=fe,we=pe,Re=function(){var e=ee();return function(t,r,n,o,i,a){var s,l;for(r||(r=4),n||(n=0),l=o?Math.min(o*r+n,t.length):t.length,s=n;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],i(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}(),xe=Object.freeze({create:ee,clone:te,fromValues:re,copy:ne,set:oe,add:ie,subtract:ae,multiply:se,divide:le,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale:ce,scaleAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},distance:ue,squaredDistance:de,length:fe,squaredLength:pe,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},normalize:ge,dot:me,cross:function(e,t,r,n){var o=r[0]*n[1]-r[1]*n[0],i=r[0]*n[2]-r[2]*n[0],a=r[0]*n[3]-r[3]*n[0],s=r[1]*n[2]-r[2]*n[1],l=r[1]*n[3]-r[3]*n[1],c=r[2]*n[3]-r[3]*n[2],u=t[0],d=t[1],f=t[2],p=t[3];return e[0]=d*c-f*l+p*s,e[1]=-u*c+f*a-p*i,e[2]=u*l-d*a+p*o,e[3]=-u*s+d*i-f*o,e},lerp:ke,random:function(e,t){var r,o,i,a,s,l;t=t||1;do{s=(r=2*n()-1)*r+(o=2*n()-1)*o}while(s>=1);do{l=(i=2*n()-1)*i+(a=2*n()-1)*a}while(l>=1);var c=Math.sqrt((1-s)/l);return e[0]=t*r,e[1]=t*o,e[2]=t*i*c,e[3]=t*a*c,e},transformMat4:function(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3];return e[0]=r[0]*n+r[4]*o+r[8]*i+r[12]*a,e[1]=r[1]*n+r[5]*o+r[9]*i+r[13]*a,e[2]=r[2]*n+r[6]*o+r[10]*i+r[14]*a,e[3]=r[3]*n+r[7]*o+r[11]*i+r[15]*a,e},transformQuat:function(e,t,r){var n=t[0],o=t[1],i=t[2],a=r[0],s=r[1],l=r[2],c=r[3],u=c*n+s*i-l*o,d=c*o+l*n-a*i,f=c*i+a*o-s*n,p=-a*n-s*o-l*i;return e[0]=u*c+p*-a+d*-l-f*-s,e[1]=d*c+p*-s+f*-a-u*-l,e[2]=f*c+p*-l+u*-s-d*-a,e[3]=t[3],e},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},exactEquals:he,equals:Se,sub:ye,mul:ve,div:be,dist:Ce,sqrDist:_e,len:Te,sqrLen:we,forEach:Re});function De(){var e=new r(4);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Me(e,t,r){r*=.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function Fe(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=r[0],l=r[1],c=r[2],u=r[3];return e[0]=n*u+a*s+o*c-i*l,e[1]=o*u+a*l+i*s-n*c,e[2]=i*u+a*c+n*l-o*s,e[3]=a*u-n*s-o*l-i*c,e}function Ee(e,t,r){r*=.5;var n=t[0],o=t[1],i=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+a*s,e[1]=o*l+i*s,e[2]=i*l-o*s,e[3]=a*l-n*s,e}function Ie(e,t,r){r*=.5;var n=t[0],o=t[1],i=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l-i*s,e[1]=o*l+a*s,e[2]=i*l+n*s,e[3]=a*l-o*s,e}function Pe(e,t,r){r*=.5;var n=t[0],o=t[1],i=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+o*s,e[1]=o*l-n*s,e[2]=i*l+a*s,e[3]=a*l-i*s,e}function Le(e,r,n,o){var i,a,s,l,c,u=r[0],d=r[1],f=r[2],p=r[3],g=n[0],m=n[1],k=n[2],h=n[3];return(a=u*g+d*m+f*k+p*h)<0&&(a=-a,g=-g,m=-m,k=-k,h=-h),1-a>t?(i=Math.acos(a),s=Math.sin(i),l=Math.sin((1-o)*i)/s,c=Math.sin(o*i)/s):(l=1-o,c=o),e[0]=l*u+c*g,e[1]=l*d+c*m,e[2]=l*f+c*k,e[3]=l*p+c*h,e}function Oe(e,t){var r,n=t[0]+t[4]+t[8];if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var o=0;t[4]>t[0]&&(o=1),t[8]>t[3*o+o]&&(o=2);var i=(o+1)%3,a=(o+2)%3;r=Math.sqrt(t[3*o+o]-t[3*i+i]-t[3*a+a]+1),e[o]=.5*r,r=.5/r,e[3]=(t[3*i+a]-t[3*a+i])*r,e[i]=(t[3*i+o]+t[3*o+i])*r,e[a]=(t[3*a+o]+t[3*o+a])*r}return e}var Ae,Be,He,Ne,Ue,Ve,ze=te,We=re,Ge=ne,je=oe,Ye=ie,Xe=Fe,qe=ce,Ke=me,Qe=ke,Je=fe,Ze=Je,$e=pe,et=$e,tt=ge,rt=he,nt=Se,ot=(Ae=I(),Be=L(1,0,0),He=L(0,1,0),function(e,t,r){var n=z(t,r);return n<-.999999?(W(Ae,Be,t),Q(Ae)<1e-6&&W(Ae,He,t),V(Ae,Ae),Me(e,Ae,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(W(Ae,t,r),e[0]=Ae[0],e[1]=Ae[1],e[2]=Ae[2],e[3]=1+n,tt(e,e))}),it=(Ne=De(),Ue=De(),function(e,t,r,n,o,i){return Le(Ne,t,o,i),Le(Ue,r,n,i),Le(e,Ne,Ue,2*i*(1-i)),e}),at=(Ve=k(),function(e,t,r,n){return Ve[0]=r[0],Ve[3]=r[1],Ve[6]=r[2],Ve[1]=n[0],Ve[4]=n[1],Ve[7]=n[2],Ve[2]=-t[0],Ve[5]=-t[1],Ve[8]=-t[2],tt(e,Oe(e,Ve))}),st=Object.freeze({create:De,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:Me,getAxisAngle:function(e,r){var n=2*Math.acos(r[3]),o=Math.sin(n/2);return o>t?(e[0]=r[0]/o,e[1]=r[1]/o,e[2]=r[2]/o):(e[0]=1,e[1]=0,e[2]=0),n},multiply:Fe,rotateX:Ee,rotateY:Ie,rotateZ:Pe,calculateW:function(e,t){var r=t[0],n=t[1],o=t[2];return e[0]=r,e[1]=n,e[2]=o,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-o*o)),e},slerp:Le,random:function(e){var t=n(),r=n(),o=n(),i=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*r),e[1]=i*Math.cos(2*Math.PI*r),e[2]=a*Math.sin(2*Math.PI*o),e[3]=a*Math.cos(2*Math.PI*o),e},invert:function(e,t){var r=t[0],n=t[1],o=t[2],i=t[3],a=r*r+n*n+o*o+i*i,s=a?1/a:0;return e[0]=-r*s,e[1]=-n*s,e[2]=-o*s,e[3]=i*s,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},fromMat3:Oe,fromEuler:function(e,t,r,n){var o=.5*Math.PI/180;t*=o,r*=o,n*=o;var i=Math.sin(t),a=Math.cos(t),s=Math.sin(r),l=Math.cos(r),c=Math.sin(n),u=Math.cos(n);return e[0]=i*l*u-a*s*c,e[1]=a*s*u+i*l*c,e[2]=a*l*c-i*s*u,e[3]=a*l*u+i*s*c,e},str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},clone:ze,fromValues:We,copy:Ge,set:je,add:Ye,mul:Xe,scale:qe,dot:Ke,lerp:Qe,length:Je,len:Ze,squaredLength:$e,sqrLen:et,normalize:tt,exactEquals:rt,equals:nt,rotationTo:ot,sqlerp:it,setAxes:at});function lt(e,t,r){var n=.5*r[0],o=.5*r[1],i=.5*r[2],a=t[0],s=t[1],l=t[2],c=t[3];return e[0]=a,e[1]=s,e[2]=l,e[3]=c,e[4]=n*c+o*l-i*s,e[5]=o*c+i*a-n*l,e[6]=i*c+n*s-o*a,e[7]=-n*a-o*s-i*l,e}function ct(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}var ut=Ge,dt=Ge;function ft(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=r[4],l=r[5],c=r[6],u=r[7],d=t[4],f=t[5],p=t[6],g=t[7],m=r[0],k=r[1],h=r[2],S=r[3];return e[0]=n*S+a*m+o*h-i*k,e[1]=o*S+a*k+i*m-n*h,e[2]=i*S+a*h+n*k-o*m,e[3]=a*S-n*m-o*k-i*h,e[4]=n*u+a*s+o*c-i*l+d*S+g*m+f*h-p*k,e[5]=o*u+a*l+i*s-n*c+f*S+g*k+p*m-d*h,e[6]=i*u+a*c+n*l-o*s+p*S+g*h+d*k-f*m,e[7]=a*u-n*s-o*l-i*c+g*S-d*m-f*k-p*h,e}var pt=ft,gt=Ke,mt=Je,kt=mt,ht=$e,St=ht,yt=Object.freeze({create:function(){var e=new r(8);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},clone:function(e){var t=new r(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},fromValues:function(e,t,n,o,i,a,s,l){var c=new r(8);return c[0]=e,c[1]=t,c[2]=n,c[3]=o,c[4]=i,c[5]=a,c[6]=s,c[7]=l,c},fromRotationTranslationValues:function(e,t,n,o,i,a,s){var l=new r(8);l[0]=e,l[1]=t,l[2]=n,l[3]=o;var c=.5*i,u=.5*a,d=.5*s;return l[4]=c*o+u*n-d*t,l[5]=u*o+d*e-c*n,l[6]=d*o+c*t-u*e,l[7]=-c*e-u*t-d*n,l},fromRotationTranslation:lt,fromTranslation:function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},fromRotation:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},fromMat4:function(e,t){var n=De();x(n,t);var o=new r(3);return w(o,t),lt(e,n,o),e},copy:ct,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},set:function(e,t,r,n,o,i,a,s,l){return e[0]=t,e[1]=r,e[2]=n,e[3]=o,e[4]=i,e[5]=a,e[6]=s,e[7]=l,e},getReal:ut,getDual:function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},setReal:dt,setDual:function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},getTranslation:function(e,t){var r=t[4],n=t[5],o=t[6],i=t[7],a=-t[0],s=-t[1],l=-t[2],c=t[3];return e[0]=2*(r*c+i*a+n*l-o*s),e[1]=2*(n*c+i*s+o*a-r*l),e[2]=2*(o*c+i*l+r*s-n*a),e},translate:function(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=.5*r[0],l=.5*r[1],c=.5*r[2],u=t[4],d=t[5],f=t[6],p=t[7];return e[0]=n,e[1]=o,e[2]=i,e[3]=a,e[4]=a*s+o*c-i*l+u,e[5]=a*l+i*s-n*c+d,e[6]=a*c+n*l-o*s+f,e[7]=-n*s-o*l-i*c+p,e},rotateX:function(e,t,r){var n=-t[0],o=-t[1],i=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=s*a+u*n+l*i-c*o,f=l*a+u*o+c*n-s*i,p=c*a+u*i+s*o-l*n,g=u*a-s*n-l*o-c*i;return Ee(e,t,r),n=e[0],o=e[1],i=e[2],a=e[3],e[4]=d*a+g*n+f*i-p*o,e[5]=f*a+g*o+p*n-d*i,e[6]=p*a+g*i+d*o-f*n,e[7]=g*a-d*n-f*o-p*i,e},rotateY:function(e,t,r){var n=-t[0],o=-t[1],i=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=s*a+u*n+l*i-c*o,f=l*a+u*o+c*n-s*i,p=c*a+u*i+s*o-l*n,g=u*a-s*n-l*o-c*i;return Ie(e,t,r),n=e[0],o=e[1],i=e[2],a=e[3],e[4]=d*a+g*n+f*i-p*o,e[5]=f*a+g*o+p*n-d*i,e[6]=p*a+g*i+d*o-f*n,e[7]=g*a-d*n-f*o-p*i,e},rotateZ:function(e,t,r){var n=-t[0],o=-t[1],i=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=s*a+u*n+l*i-c*o,f=l*a+u*o+c*n-s*i,p=c*a+u*i+s*o-l*n,g=u*a-s*n-l*o-c*i;return Pe(e,t,r),n=e[0],o=e[1],i=e[2],a=e[3],e[4]=d*a+g*n+f*i-p*o,e[5]=f*a+g*o+p*n-d*i,e[6]=p*a+g*i+d*o-f*n,e[7]=g*a-d*n-f*o-p*i,e},rotateByQuatAppend:function(e,t,r){var n=r[0],o=r[1],i=r[2],a=r[3],s=t[0],l=t[1],c=t[2],u=t[3];return e[0]=s*a+u*n+l*i-c*o,e[1]=l*a+u*o+c*n-s*i,e[2]=c*a+u*i+s*o-l*n,e[3]=u*a-s*n-l*o-c*i,s=t[4],l=t[5],c=t[6],u=t[7],e[4]=s*a+u*n+l*i-c*o,e[5]=l*a+u*o+c*n-s*i,e[6]=c*a+u*i+s*o-l*n,e[7]=u*a-s*n-l*o-c*i,e},rotateByQuatPrepend:function(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=r[0],l=r[1],c=r[2],u=r[3];return e[0]=n*u+a*s+o*c-i*l,e[1]=o*u+a*l+i*s-n*c,e[2]=i*u+a*c+n*l-o*s,e[3]=a*u-n*s-o*l-i*c,s=r[4],l=r[5],c=r[6],u=r[7],e[4]=n*u+a*s+o*c-i*l,e[5]=o*u+a*l+i*s-n*c,e[6]=i*u+a*c+n*l-o*s,e[7]=a*u-n*s-o*l-i*c,e},rotateAroundAxis:function(e,r,n,o){if(Math.abs(o)<t)return ct(e,r);var i=Math.hypot(n[0],n[1],n[2]);o*=.5;var a=Math.sin(o),s=a*n[0]/i,l=a*n[1]/i,c=a*n[2]/i,u=Math.cos(o),d=r[0],f=r[1],p=r[2],g=r[3];e[0]=d*u+g*s+f*c-p*l,e[1]=f*u+g*l+p*s-d*c,e[2]=p*u+g*c+d*l-f*s,e[3]=g*u-d*s-f*l-p*c;var m=r[4],k=r[5],h=r[6],S=r[7];return e[4]=m*u+S*s+k*c-h*l,e[5]=k*u+S*l+h*s-m*c,e[6]=h*u+S*c+m*l-k*s,e[7]=S*u-m*s-k*l-h*c,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e},multiply:ft,mul:pt,scale:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e},dot:gt,lerp:function(e,t,r,n){var o=1-n;return gt(t,r)<0&&(n=-n),e[0]=t[0]*o+r[0]*n,e[1]=t[1]*o+r[1]*n,e[2]=t[2]*o+r[2]*n,e[3]=t[3]*o+r[3]*n,e[4]=t[4]*o+r[4]*n,e[5]=t[5]*o+r[5]*n,e[6]=t[6]*o+r[6]*n,e[7]=t[7]*o+r[7]*n,e},invert:function(e,t){var r=ht(t);return e[0]=-t[0]/r,e[1]=-t[1]/r,e[2]=-t[2]/r,e[3]=t[3]/r,e[4]=-t[4]/r,e[5]=-t[5]/r,e[6]=-t[6]/r,e[7]=t[7]/r,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},length:mt,len:kt,squaredLength:ht,sqrLen:St,normalize:function(e,t){var r=ht(t);if(r>0){r=Math.sqrt(r);var n=t[0]/r,o=t[1]/r,i=t[2]/r,a=t[3]/r,s=t[4],l=t[5],c=t[6],u=t[7],d=n*s+o*l+i*c+a*u;e[0]=n,e[1]=o,e[2]=i,e[3]=a,e[4]=(s-n*d)/r,e[5]=(l-o*d)/r,e[6]=(c-i*d)/r,e[7]=(u-a*d)/r}return e},str:function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},equals:function(e,r){var n=e[0],o=e[1],i=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=r[0],f=r[1],p=r[2],g=r[3],m=r[4],k=r[5],h=r[6],S=r[7];return Math.abs(n-d)<=t*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-f)<=t*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(i-p)<=t*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(a-g)<=t*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(s-m)<=t*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(l-k)<=t*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(c-h)<=t*Math.max(1,Math.abs(c),Math.abs(h))&&Math.abs(u-S)<=t*Math.max(1,Math.abs(u),Math.abs(S))}});function vt(){var e=new r(2);return r!=Float32Array&&(e[0]=0,e[1]=0),e}function bt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function Ct(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function _t(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function Tt(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.hypot(r,n)}function wt(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function Rt(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function xt(e){var t=e[0],r=e[1];return t*t+r*r}var Dt=Rt,Mt=bt,Ft=Ct,Et=_t,It=Tt,Pt=wt,Lt=xt,Ot=function(){var e=vt();return function(t,r,n,o,i,a){var s,l;for(r||(r=2),n||(n=0),l=o?Math.min(o*r+n,t.length):t.length,s=n;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],i(e,e,a),t[s]=e[0],t[s+1]=e[1];return t}}(),At=Object.freeze({create:vt,clone:function(e){var t=new r(2);return t[0]=e[0],t[1]=e[1],t},fromValues:function(e,t){var n=new r(2);return n[0]=e,n[1]=t,n},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,r){return e[0]=t,e[1]=r,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},subtract:bt,multiply:Ct,divide:_t,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},scaleAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e},distance:Tt,squaredDistance:wt,length:Rt,squaredLength:xt,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize:function(e,t){var r=t[0],n=t[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},cross:function(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e},lerp:function(e,t,r,n){var o=t[0],i=t[1];return e[0]=o+n*(r[0]-o),e[1]=i+n*(r[1]-i),e},random:function(e,t){t=t||1;var r=2*n()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},transformMat2:function(e,t,r){var n=t[0],o=t[1];return e[0]=r[0]*n+r[2]*o,e[1]=r[1]*n+r[3]*o,e},transformMat2d:function(e,t,r){var n=t[0],o=t[1];return e[0]=r[0]*n+r[2]*o+r[4],e[1]=r[1]*n+r[3]*o+r[5],e},transformMat3:function(e,t,r){var n=t[0],o=t[1];return e[0]=r[0]*n+r[3]*o+r[6],e[1]=r[1]*n+r[4]*o+r[7],e},transformMat4:function(e,t,r){var n=t[0],o=t[1];return e[0]=r[0]*n+r[4]*o+r[12],e[1]=r[1]*n+r[5]*o+r[13],e},rotate:function(e,t,r,n){var o=t[0]-r[0],i=t[1]-r[1],a=Math.sin(n),s=Math.cos(n);return e[0]=o*s-i*a+r[0],e[1]=o*a+i*s+r[1],e},angle:function(e,t){var r=e[0],n=e[1],o=t[0],i=t[1],a=r*r+n*n;a>0&&(a=1/Math.sqrt(a));var s=o*o+i*i;s>0&&(s=1/Math.sqrt(s));var l=(r*o+n*i)*a*s;return l>1?0:l<-1?Math.PI:Math.acos(l)},zero:function(e){return e[0]=0,e[1]=0,e},str:function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]},equals:function(e,r){var n=e[0],o=e[1],i=r[0],a=r[1];return Math.abs(n-i)<=t*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(o-a)<=t*Math.max(1,Math.abs(o),Math.abs(a))},len:Dt,sub:Mt,mul:Ft,div:Et,dist:It,sqrDist:Pt,sqrLen:Lt,forEach:Ot});e.glMatrix=i,e.mat2=u,e.mat2d=m,e.mat3=b,e.mat4=E,e.quat=st,e.quat2=yt,e.vec2=At,e.vec3=$,e.vec4=xe,Object.defineProperty(e,"__esModule",{value:!0})})),/*! https://mths.be/utf8js v3.0.0 by @mathias */
function(e){var t,r,n,o=String.fromCharCode;function i(){if(n>=r)throw Error("Invalid byte index");var e=255&t[n];if(n++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function a(){var e,o;if(n>r)throw Error("Invalid byte index");if(n==r)return!1;if(e=255&t[n],n++,0==(128&e))return e;if(192==(224&e)){if((o=(31&e)<<6|i())>=128)return o;throw Error("Invalid continuation byte")}if(224==(240&e)){if((o=(15&e)<<12|i()<<6|i())>=2048)return function(e){if(e>=55296&&e<=57343)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}(o),o;throw Error("Invalid continuation byte")}if(240==(248&e)&&(o=(7&e)<<18|i()<<12|i()<<6|i())>=65536&&o<=1114111)return o;throw Error("Invalid UTF-8 detected")}e.decodeByteArray=function(e){r=(t=e).length,n=0;for(var i,s=[];!1!==(i=a());)s.push(i);return function(e){for(var t,r=e.length,n=-1,i="";++n<r;)(t=e[n])>65535&&(i+=o((t-=65536)>>>10&1023|55296),t=56320|1023&t),i+=o(t);return i}(s)}}(this.utf8={});var Sk={Verb:Object.freeze({Save:0,SaveLayer:1,Restore:2,Concat:3,ClipRect:4,ClipRRect:5,ClipPath:6,ClipRegion:7,DrawArc:8,DrawAtlas:9,DrawDRRect:10,DrawText:11,DrawPosText:12,DrawPosTextH:13,DrawRegion:14,DrawTextOnPath:15,DrawTextBlob:16,DrawTextRSXform:17,DrawPatch:18,DrawPaint:19,DrawPoints:20,DrawRect:21,DrawPath:22,DrawOval:23,DrawRRect:24,DrawImage:25,DrawImageRect:26,DrawImageNine:27,DrawImageLattice:28,DrawVertices:29,DrawPicture:30,DrawAnnotation:31,DefineImage:32,DefineImageURL:33,DefinePath:34,DefineGlyph:35,DefineTextBlob:36,DefinePaint:37,DefinePicture:38,DefineRasterPicture:39,DefineTypeface:40,DefineFontData:41,DefineDrawOps:42,DefineHitTestData:43,EndDefinitions:44}),HT:{DisplayItemType:Object.freeze({kOther:0,kDrawingPaintPhase:1,kBoxDecorationBackground:2,kCaret:3,kDebugDrawing:4,kScrollCorner:5}),ElementType:Object.freeze({kUnknown:0,kFormControl:1,kTextNode:2,kElementNode:3,kInnerEditorElement:4,kImageElement:5,kHtmlElement:6,kCustomScrollbarPart:7}),ElementFlags:Object.freeze({kHitTestable:1,kHasLink:2,kInShadowTree:4,kHasInputElementOwner:8,kHasTextAreaOwner:16,kHasContentEditableOwner:32,kHasDebugData:64,kHasCursor:128,kSelectable:256,kIsPlaceholderText:512,kHasTemporalElementOwner:1024,kHasColorInputOwner:2048,kInsideBlockingTouchEventHandler:4096,kHasScrollableContainerId:8192}),GenericFontFamily:Object.freeze({kNoFamily:0,kStandardFamily:1,kSerifFamily:2,kSansSerifFamily:3,kMonospaceFamily:4,kCursiveFamily:5,kFantasyFamily:6}),FontStyle:Object.freeze({kNormal:0,kItalic:1,kOblique:2}),FontFlags:Object.freeze({kWebFont:1,kRightToLeft:2,kAntialiased:4,kUseKerning:8,kSmallCaps:16,kHasStretchOrSpacing:32}),CursorType:Object.freeze({kUnknown:0,kNone:1,kCopy:2,kAuto:3,kCrosshair:4,kDefault:5,kPointer:6,kMove:7,kVerticalText:8,kCell:9,kContextMenu:10,kAlias:11,kProgress:12,kNoDrop:13,kNotAllowed:14,kZoomIn:15,kZoomOut:16,kEResize:17,kNeResize:18,kNwResize:19,kNResize:20,kSeResize:21,kSwResize:22,kSResize:23,kWResize:24,kEwResize:25,kNsResize:26,kNeswResize:27,kNwseResize:28,kColResize:29,kRowResize:30,kText:31,kWait:32,kHelp:33,kAllScroll:34,kGrab:35,kGrabbing:36}),FormControlElement:Object.freeze({Type:{kUnknown:0,kInput:1,kTextArea:2,kSelect:3,kContentEditable:4},Flags:{kDisabled:1,kReadOnly:2,kAutoComplete:4,kSupportsFocus:8,kAutoCapitalize:16,kRequired:32,kRightToLeft:64,kHasEnterKeyHint:128,kHasTextAreaInfo:256}}),InputElement:Object.freeze({Type:{kUnknown:0,kEmail:1,kFile:2,kMonth:3,kNumber:4,kPassword:5,kSearch:6,kTel:7,kText:8,kTime:9,kUrl:10,kWeek:11,kRange:12,kDate:13,kDatetimeLocal:14,kColor:15},Flags:{kAutoComplete:1,kIsBaseTemporal:2}}),SelectItem:Object.freeze({Type:{kUnknown:0,kSeparator:1,kGroup:2,kOption:3},Flags:{kChecked:1,kEnabled:2,kInGroup:4,kHidden:8}}),TextAreaElement:Object.freeze({Flags:{kHasFormOwner:1,kLast:255}}),CustomScrollbarPart:Object.freeze({Flags:{kIsHorizontal:1,kIsLeftSideVertical:2,kJumpOnTrackClick:4,kSupportsDragSnapBack:8,kLastScrollbarProp:65535}})},SE:Object.freeze({Type:Object.freeze({kShadowAnchorNode:0,kShadowSelect:1,kShadowTextControl:2,kShadowTextNode:3,kShadowImageNode:4})}),FontSlant:Object.freeze({kNormal:0,kItalic:1,kOblique:2}),FontStretch:Object.freeze({kUltraCondensed_Width:1,kExtraCondensed_Width:2,kCondensed_Width:3,kSemiCondensed_Width:4,kNormal_Width:5,kSemiExpanded_Width:6,kExpanded_Width:7,kExtraExpanded_Width:8,kUltraExpanded_Width:9}),SaveLayerMask:Object.freeze({Flags:255,HasBounds:256,HasPaint:512,HasBackdrop:1024,DontClipToLayer:2048,HasClipMask:4096,HasClipMatrix:8192,ClipIntersectsBounds:16384}),TypeMask:Object.freeze({SetMatrix:16,Float16:32}),MatrixMask:Object.freeze({Translate:1,Scale:2,Affine:4,Perspective:8}),DrawImageMask:Object.freeze({HasPaint:1}),DrawImageRectMask:Object.freeze({Constraint:1,HasPaint:2,HasSrcRect:4,UseRemoteSrc:8}),DrawPictureMask:Object.freeze({HasMatrix:1<<21,HasPaint:1<<22}),ClipOp:Object.freeze({kDifference:0,kIntersect:1}),PathDirection:Object.freeze({kCW_Direction:0,kCCW_Direction:1}),FillRule:Object.freeze({kWinding:0,kEvenOdd:1,kInverseWinding:2,kInverseEvenOdd:3}),GlyphPositioning:Object.freeze({kDefault:0,kHorizontal:1,kFull:2}),NonDef:Object.freeze({kTextSize:1,kTextScaleX:2,kTextSkewX:4,kStrokeWidth:8,kStrokeMiter:16,kColor:32,kTypeface:64,kPathEffect:128,kShader:256,kMaskFilter:512,kColorFilter:1024,kRasterizer:2048,kImageFilter:4096}),Color:Object.freeze({BLACK:4278190080,RED:4294901760,getAlpha:function(e){return e>>24&255},isTransparent:function(e){return 0===this.getAlpha(e)},isOpaque:function(e){return 255===this.getAlpha(e)}}),NamedColorSpace:Object.freeze({kSRGB:0,kAdobeRGB:1,kSRGBLinear:2}),GradientSerializationFlags:Object.freeze({kHasPosition:2147483648,kHasLegacyLocalMatrix:1073741824,kHasColorSpace:536870912,kTileModeShift:8,kTileModeMask:15,kInterpolationColorSpaceShift:4,kInterpolationColorSpaceMask:15,kInterpolationHueMethodShift:1,kInterpolationHueMethodMask:7,kInterpolationInPremul:1}),BlendMode:Object.freeze({kClear:0,kSrc:1,kDst:2,kSrcOver:3,kDstOver:4,kSrcIn:5,kDstIn:6,kSrcOut:7,kDstOut:8,kSrcATop:9,kDstATop:10,kXor:11,kPlus:12,kModulate:13,kScreen:14,kOverlay:15,kDarken:16,kLighten:17,kColorDodge:18,kColorBurn:19,kHardLight:20,kSoftLight:21,kDifference:22,kExclusion:23,kMultiply:24,kHue:25,kSaturation:26,kColor:27,kLuminosity:28,kCustom_SkBlendMode:255,kArithmetic_SkBlendMode:256}),PaintUsage:Object.freeze({kText:1,kGeometry:2,kImage:4,kPaint:8,kAll:4294967295}),TileMode:Object.freeze({kClamp:0,kRepeat:1}),PointMode:Object.freeze({kPoints:0,kLines:1,kPolygon:2}),PathVerb:Object.freeze({kMove:0,kLine:1,kQuad:2,kConic:3,kCubic:4,kClose:5}),RRectType:Object.freeze({kEmpty:0,kRect:1,kOval:2,kSimple:3,kNinePatch:4,kComplex:5,kLast:6}),FilterQuality:Object.freeze({kNone:0,kLow:1,kMedium:2,kHigh:3}),DefineImageExtra:Object.freeze({kHintLoadSync:1,kGIForWEBP:2}),PictureFlags:Object.freeze({kHasText:1,kHasPaths:2,kHasPictures:4,kHasImages:8,kHasFillGeometry:16,kHintDoNotCache:32,kHintDoNotRasterCache:64,kHasRasterSubPicture:128,kHasHardCompositingOp:256,kHasBlendOp:512,kHasComplexClip:1024,kHasColorFilter:2048,kHintNeedsTextureSync:4096,kHasImageFilter:8192,kHasCSSGradientShader:32768}),CropEdge:Object.freeze({kHasLeft_CropEdge:1,kHasTop_CropEdge:2,kHasWidth_CropEdge:4,kHasHeight_CropEdge:8,kHasAll_CropEdge:15}),ScrollbarPart:Object.freeze({kNoPart:0,kBackButtonStartPart:1,kForwardButtonStartPart:2,kBackTrackPart:4,kThumbPart:8,kForwardTrackPart:16,kBackButtonEndPart:32,kForwardButtonEndPart:64,kScrollbarBGPart:128,kTrackBGPart:256,kAllParts:4294967295}),DebugFlags:Object.freeze({kDebugEnabled:1,kHighlightRasterCacheItems:2}),setDebugEnabled:function(e){e?this.debugFlags|=Sk.DebugFlags.kDebugEnabled:this.debugFlags&=~Sk.DebugFlags.kDebugEnabled},isDebugEnabled:function(){return!!(this.debugFlags&Sk.DebugFlags.kDebugEnabled)},setDebugFlags:function(e){this.debugFlags=e},getDebugFlags:function(){return this.debugFlags},setImageQuality:function(e,t){this.imageQuality=[t||e,e]},getImageQuality:function(){return this.imageQuality},init:function(e){var t,r;for(r in Function.prototype.curry||(Function.prototype.curry=function(){"use strict";var e=this,t=Array.prototype.slice.call(arguments);return function(){return e.apply(this,t.concat(Array.prototype.slice.call(arguments)))}}),Sk.maxRasterArea,Sk.maxPlatformCanvasArea,e)e.hasOwnProperty(r)&&(t=e[r],this.canvasMemoryLimit[r]=t,this.canvasMemoryUsage[r]=0)},fini:function(){var e;for(e in Sk.htmlCanvasDeviceById)Sk.htmlCanvasDeviceById.hasOwnProperty(e)&&Sk.htmlCanvasDeviceById[e].release()},flushCaches:function(){},decodeUTF8ByteArray:function(e){return window.TextDecoder?new window.TextDecoder("utf-8").decode(e):window.utf8.decodeByteArray(e)},nextCanvasId:0,nextHTMLCanvasDeviceId:0,nextDOMDeviceId:0,nextRecordingId:0,nextImageId:0,nextTextFitterId:0,debugFlags:0,subPixelPrecision:.5,maxSubPixelPrecision:1/64,maxPlatformCanvasArea:16777216,maxRasterArea:262144,imageQuality:[.8,.6],defaultMaxImageLoadRetries:3,defaultMaxConcurrentImageLoads:3,canvasMemoryUsage:{},canvasMemoryLimit:{},rasterCacheUseThreshold:2,htmlCanvasDeviceById:{},disabledRemoteCaret:!1,focusedElementInfoByNodeId:{}};Sk.Paint=new function(){"use strict";var e=this;e.Flags=Object.freeze({kAntiAlias:1,kDither:4,kFakeBoldText:32,kLinearText:64,kSubpixelText:128,kDevKernText:256,kLCDRenderText:512,kEmbeddedBitmapText:1024,kAutoHinting:2048,kVerticalText:4096,kAllFlags:65535}),e.Align=Object.freeze({kLeft:0,kCenter:1,kRight:2}),e.Hinting=Object.freeze({kNo:0,kSlight:1,kNormal:2,kFull:3}),e.Style=Object.freeze({kFill_Style:0,kStroke_Style:1,kStrokeAndFill_Style:2}),e.Cap=Object.freeze({kButt:0,kRound:1,kSquare:2}),e.Join=Object.freeze({kMiter:0,kRound:1,kBevel:2}),e.TextEncoding=Object.freeze({kUTF8:0,kUTF16:1,kUTF32:2,kGlyphID:3}),e.skColorToCSSColor=function(e){return"rgba("+((e>>16&255)+","+(e>>8&255)+","+(255&e)+","+(e>>24&255)/255)+")"},e.skColorToCanvasAlpha=function(e){return(e>>24&255)/255},e.skColorToHexadecimalColor=function(e){return[e>>16&255,e>>8&255,255&e].reduce((function(e,t){return e+t.toString(16).padStart(2,"0")}),"#")},e.skNamedColorSpaceToColorInterpolation=function(e){switch(e){case Sk.NamedColorSpace.kSRGB:return"sRGB";case Sk.NamedColorSpace.kSRGBLinear:return"linearRGB";default:return"auto"}},e.skFillRuleToCanvasFillRule=function(e){switch(e){case Sk.FillRule.kWinding:return"nonzero";case Sk.FillRule.kEvenOdd:return"evenodd";default:return"nonzero"}},e.skFilterQualityToCanvasFilterQuality=function(e){switch(e){case Sk.FilterQuality.kNone:return"none";case Sk.FilterQuality.kLow:return"low";case Sk.FilterQuality.kMedium:return"medium";case Sk.FilterQuality.kHigh:return"high"}return null},e.isCompositingOp=function(e){switch(e){case Sk.BlendMode.kClear:case Sk.BlendMode.kSrc:case Sk.BlendMode.kSrcOver:case Sk.BlendMode.kDstOver:case Sk.BlendMode.kSrcIn:case Sk.BlendMode.kDstIn:case Sk.BlendMode.kSrcOut:case Sk.BlendMode.kDstOut:case Sk.BlendMode.kSrcATop:case Sk.BlendMode.kDstATop:case Sk.BlendMode.kXor:case Sk.BlendMode.kArithmetic_SkBlendMode:return!0;default:return!1}},e.isBlendOp=function(t){return!e.isCompositingOp(t)},e.skBlendModeToCompositeOp=function(e){switch(e){case Sk.BlendMode.kClear:return"clear";case Sk.BlendMode.kSrc:return"copy";case Sk.BlendMode.kSrcOver:return"source-over";case Sk.BlendMode.kDstOver:return"destination-over";case Sk.BlendMode.kSrcIn:return"source-in";case Sk.BlendMode.kDstIn:return"destination-in";case Sk.BlendMode.kSrcOut:return"source-out";case Sk.BlendMode.kDstOut:return"destination-out";case Sk.BlendMode.kSrcATop:return"source-atop";case Sk.BlendMode.kDstATop:return"destination-atop";case Sk.BlendMode.kXor:return"xor";case Sk.BlendMode.kPlus:case Sk.BlendMode.kScreen:return"screen";case Sk.BlendMode.kOverlay:return"overlay";case Sk.BlendMode.kDarken:return"darken";case Sk.BlendMode.kLighten:return"lighten";case Sk.BlendMode.kColorDodge:return"color-dodge";case Sk.BlendMode.kColorBurn:return"color-burn";case Sk.BlendMode.kHardLight:return"hard-light";case Sk.BlendMode.kSoftLight:return"soft-light";case Sk.BlendMode.kDifference:return"difference";case Sk.BlendMode.kExclusion:return"exclusion";case Sk.BlendMode.kMultiply:return"multiply";case Sk.BlendMode.kHue:return"hue";case Sk.BlendMode.kSaturation:return"saturation";case Sk.BlendMode.kColor:return"color";case Sk.BlendMode.kLuminosity:return"luminosity";default:return"source-over"}},e.skBlendModeToFeBlendMode=function(e){switch(e){case Sk.BlendMode.kSrcOver:return"normal";case Sk.BlendMode.kScreen:case Sk.BlendMode.kPlus:return"screen";case Sk.BlendMode.kOverlay:return"overlay";case Sk.BlendMode.kDarken:return"darken";case Sk.BlendMode.kLighten:return"lighten";case Sk.BlendMode.kColorDodge:return"color-dodge";case Sk.BlendMode.kColorBurn:return"color-burn";case Sk.BlendMode.kHardLight:return"hard-light";case Sk.BlendMode.kSoftLight:return"soft-light";case Sk.BlendMode.kDifference:return"difference";case Sk.BlendMode.kExclusion:return"exclusion";case Sk.BlendMode.kMultiply:return"multiply";case Sk.BlendMode.kHue:return"hue";case Sk.BlendMode.kSaturation:return"saturation";case Sk.BlendMode.kColor:return"color";case Sk.BlendMode.kLuminosity:return"luminosity";default:return"normal"}},e.skBlendModeToFeCompositeOp=function(e){switch(e){case Sk.BlendMode.kSrcOver:return"over";case Sk.BlendMode.kSrcIn:return"in";case Sk.BlendMode.kSrcOut:return"out";case Sk.BlendMode.kSrcATop:return"atop";case Sk.BlendMode.kXor:return"xor";case Sk.BlendMode.kArithmetic_SkBlendMode:return"arithmetic";default:return"over"}},e.skStrokeCapToCanvasLineCap=function(t){switch(t){case e.Cap.kButt:return"butt";case e.Cap.kRound:return"round";case e.Cap.kSquare:return"square";default:return"butt"}},e.skStrokeJoinToCanvasLineJoin=function(t){switch(t){case e.Join.kMiter:return"miter";case e.Join.kRound:return"round";case e.Join.kBevel:return"bevel";default:return"miter"}},e.skPointModeToString=function(e){switch(e){case Sk.PointMode.kPoints:return"points";case Sk.PointMode.kLines:return"lines";case Sk.PointMode.kPolygon:return"polygon";default:return"null"}},e.populatePaintStrings=function(t){return t.filterQualityStr=e.skFilterQualityToCanvasFilterQuality(t.filterQuality),t.strokeCapStr=e.skStrokeCapToCanvasLineCap(t.strokeCap),t.strokeJoinStr=e.skStrokeJoinToCanvasLineJoin(t.strokeJoin),t.blendModeStr=e.skBlendModeToCompositeOp(t.blendMode),t.cssColor=e.skColorToCSSColor(t.color),t.alphaFloat=e.skColorToCanvasAlpha(t.color),t},e.Default=Object.freeze(e.populatePaintStrings({color:4278190080,blendMode:Sk.BlendMode.kSrcOver,filterQuality:Sk.FilterQuality.kNone,style:0,strokeWidth:0,strokeMiter:4,strokeCap:0,strokeJoin:0})),e.makePaint=function(t){var r=Sk.Util.copyDict(e.Default);return Sk.Util.updateDict(r,t),Object.freeze(e.populatePaintStrings(r))},e.kTextFields=Object.freeze(["flags","typeface","textSize","textScaleX","textSkewX","textAlign","hinting","textEncoding"]),e.isValidTextPaint=function(t){var r;for(r=0;r<e.kTextFields.length;r+=1)if(void 0===t[e.kTextFields[r]])return!1;return!0},e.flagsToString=function(t){var r,n=[];for(r in e.Flags)e.Flags.hasOwnProperty(r)&&t.flags&e.Flags[r]&&n.push(r);return n},e.applyTextRunPaint=function(t,r){var n,o=e.kTextFields;for(e.isValidTextPaint(r),n=0;n<o.length;n+=1)t[o[n]]=r[o[n]]},e.isValid=function(t){function r(e,t){var r;for(r in e)if(e.hasOwnProperty(r)&&e[r]===t)return!0;return!1}return r(e.Style,t.style)&&r(e.Align,t.textAlign)&&r(e.Hinting,t.hinting)&&r(e.TextEncoding,t.textEncoding)},e.kCanonicalTextSizeForPaths=64,e.getTextScale=function(t){return t.textSize,t.textSize/e.kCanonicalTextSizeForPaths},e.getShadowSigma=function(e,t){var r=e.mask_filter?e.mask_filter.sigma:0;return e.mask_filter&&!e.mask_filter.ignore_ctm&&(r=Sk.Matrix.mapRadius(t,r)),r},e.getShadowBlurRadius=function(t,r){return 2*e.getShadowSigma(t,r)},e.applyBlendMode=function(e,t){t.blendMode!==Sk.BlendMode.kSrcOver&&(t.blendMode!==Sk.BlendMode.kSrc||t.shader||1!==t.alphaFloat)&&(Sk.Paint.isCompositingOp(t.blendMode)?Sk.isDebugEnabled()&&e.setAttribute("unhandled_blend_mode",t.blendModeStr):void 0!==e.style.mixBlendMode&&(e.style.mixBlendMode=Sk.Paint.skBlendModeToCompositeOp(t.blendMode)))}},Sk.Logger=function(e){"use strict";var t=this;function r(e,t){var r=t;"object"==typeof t&&(r=JSON.stringify(t)),console[e](r)}t.debug=function(e){},t.info=function(e){r("log",e)},t.warn=function(e){r("warn",e)},t.error=function(e){r("error",e)}},Sk.fatal=function(e,t){"use strict";var r={event:"fatal-error",error:e,details:t};throw new Error(JSON.stringify(r))},Sk.assert=function(e,t){"use strict";var r;if(!e)throw r={event:"assert-failed",details:t},new Error(JSON.stringify(r))},Sk.assertUnimplemented=function(){},Sk.Util=function(){"use strict";var e={};function t(e,t){var r="";if(e.length>=t)return e;for(;e.length<t;)r+="0",t-=1;return r+e}return e.copyDict=function(e){var t,r={};for(t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r},e.updateDict=function(e,t){var r;for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e.createSVGElement=function(e){return document.createElementNS("http://www.w3.org/2000/svg",e)},e.toSVGTransformAttribute=function(e){return Array.isArray(e)&&e.length,"matrix("+e.join(" ")+")"},e.createSVGRootElement=function(e,t){var r="http://www.w3.org/2000/svg",n=document.createElementNS(r,"svg");return n.setAttribute("xmlns",r),n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttribute("width",e),n.setAttribute("height",t),n.createElement=function(e){return document.createElementNS(r,e)},n},e.makeImageBlobFromU8Array=function(e){return new window.Blob([e],{type:"image/*"})},e.getImageFromU8Array=function(t,r){var n=e.makeImageBlobFromU8Array(t),o=new Image;function i(e){o.src,window.URL.revokeObjectURL(o.src),o.onload=o.onerror=null,r(o,e)}o.onload=i.curry(!0),o.onerror=i.curry(!1),o.src=window.URL.createObjectURL(n)},e.setImageSmoothingEnabled=function(e,t){Sk.imageSmoothingVar||(Sk.imageSmoothingVar=function(){var t,r=["imageSmoothingEnabled","webkitImageSmoothingEnabled","msImageSmoothingEnabled","mozImageSmoothingEnabled"];for(t=0;t<r.length;t+=1)if(void 0!==e[r[t]])return r[t];return null}()),Sk.imageSmoothingVar&&(e[Sk.imageSmoothingVar]=t)},e.copyArray=function(e){return e.slice(0)},e.urlWrap=function(e){return"url("+e+")"},e.argumentsToArray=function(e){return Array.prototype.slice.call(e).slice(0)},e.forEachItem=function(e,t){var r;for(r in e)if(e.hasOwnProperty(r)&&t(r,e[r]))return},e.marshalFrameToken=function(e,r){return t(e.toString(16),8)+t(r.toString(16),8)},e.getNodeKey=function(e,t){return e+":"+t},e.scalarArrayToPoints=function(e,t){var r;if(!t.length||t.length%2!=0)return!1;for(r=0;r<t.length;r+=2)e.push([t[r],t[r+1]]);return!0},e}(),Sk.BinaryWriter=function(e){"use strict";var t,r,n,o=this,i=0,a=!0;function s(e){var o,a;if(!(e<=n)){for(a=new Uint8Array(e),o=0;o<i;o+=1)a[o]=r[o];r=a,t=new window.DataView(r.buffer,r.byteOffset,r.byteLength),n=e}}function l(e){var t=i;return i>=n&&s(n+256),i+=e,t}o.isLE=function(){return a},o.getOffset=function(){return i},o.getView=function(){return t},o.getSize=function(){return n},o.writeUint8=function(e){var r=l(1);t.setUint8(r,e,a)},o.writeUint32=function(e){var r=l(4);t.setUint32(r,e,a)},o.writeInt32=function(e){var r=l(4);t.setInt32(r,e,a)},o.writeFloat32=function(e){var r=l(4);t.setFloat32(r,e,a)},o.writeRect=function(e){e.length,o.writeFloat32(e[0]),o.writeFloat32(e[1]),o.writeFloat32(e[2]),o.writeFloat32(e[3])},o.writeBytes=function(e){var t,n=i,o=e.length+3>>2<<2;for(s(n+o),t=0;t<e.length;t+=1)r[n]=e[t],n+=1;i+=o},o.writeByteArray=function(e){o.writeUint32(e.length),o.writeBytes(e)},o.writePoint=function(e){void 0!==e.x&&e.y,o.writeFloat32(e.x),o.writeFloat32(e.y)},o.getData=function(){return r.subarray(0,i)},n=e=e||0,r=new Uint8Array(e),t=new window.DataView(r.buffer,r.byteOffset,r.byteLength)},Sk.BinaryReader=function(e,t){"use strict";var r=new window.DataView(e.buffer,e.byteOffset,e.byteLength),n=this,o=0,i=!0;function a(e){Sk.fatal("SkBinaryReaderError",e)}function s(e){return e+3>>2<<2}n.readUint8=function(){var e=r.getUint8(o,i);return o+=1,e},n.readInt32=function(){var e=r.getInt32(o,i);return o+=4,e},n.readBool=function(){return n.readInt32()},n.readUint16=function(e){var t=r.getUint16(o,i);return e||(o+=2),t},n.readInt16=function(e){var t=r.getInt16(o,i);return e||(o+=2),t},n.readUint32=function(e){var t=r.getUint32(o,i);return e||(o+=4),t},n.readFloat16=function(){var e,t,r,o;return t=(32768&(e=n.readUint16()))>>15,o=1023&e,0==(r=(31744&e)>>10)?(t?-1:1)*Math.pow(2,-14)*(o/Math.pow(2,10)):31==r?o?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,r-15)*(1+o/Math.pow(2,10))},n.readFloat16Array=function(e){var t,r=[];for(t=0;t<e;t+=1)r.push(n.readFloat16());return e%2==1&&n.readFloat16(),r},n.readFloat32=function(){var e=r.getFloat32(o,i);return o+=4,e},n.readRect=function(){var e,t=[];for(e=0;e<4;e+=1)t.push(n.readFloat32());return t},n.readPoint=function(){return[n.readFloat32(),n.readFloat32()]},n.readBytes=function(t,r){var n=e.subarray(o,o+t);return n.length,n.length,r||(o+=t),n},n.readUint16Array=function(e){var t,r=[];for(t=0;t<e;t+=1)r.push(n.readUint16());return r},n.readFloat32Array=function(e){var t,r=[];for(t=0;t<e;t+=1)r.push(n.readFloat32());return r},n.readString=function(){var e,t=n.readUint32(),r=n.readBytes(t,!0);return r.length,e=Sk.decodeUTF8ByteArray(r),n.skip(s(t+1)),n.offset(),e},n.skip=function(e){o+=e},n.eof=function(){return o>=e.length},n.offset=function(){return o},n.reset=function(){o=0},n.length=function(){return e.length},n.canRead=function(e){return o+e<=n.length()},n.bytesRead=function(e){var t,r=n.offset();return t=n[e](),{bytes_read:n.offset()-r,object:t}},n.readByteArray=function(){var e=n.readUint32(),t=n.readBytes(e,!0);return n.skip(s(e)),t},n.readUint32Array=function(){var e,t=n.readUint32(),r=[];for(e=0;e<t;e+=1)r.push(n.readUint32());return r},n.readScalarArray=function(){var e=n.readUint32();return n.readFloat32Array(e)},n.readFlattenable=function(){return Sk.FlattenableReader.readFrom(n)},n.readTypefaceDef=function(){var e,t,r,o,i,a={};for(a.deduper={},a.id=n.readUint32(),a.coordinates=[],e=n.readUint32(),t=0;t<e;t+=1)r=n.readUint32(),o=n.readFloat32(),a.coordinates.push([r,o]);return i=n.readUint32(),a.weight=65535&i,a.width=i>>16&255,a.slant=i>>24&15,a.has_font_data=!!(i>>28&1),a.is_platform_font=!!(i>>29&1),a.has_font_data&&(a.font_data=n.readFontData().data),Object.freeze(a)},n.readFontDataDef=function(){var e={deduper:{}};return e.data=n.readByteArray(),e.data.length,e},n.readPaintDef=function(){var e,t,r={};function o(e,r){return t&e?n.readFloat32():r}function i(e){return t&e?n.readFlattenable():null}return function(e){function t(e){return(1<<e)-1}r.flags=e>>16&t(16),r.filterQuality=e>>14&t(2),r.style=e>>12&t(2),r.strokeCap=e>>10&t(2),r.strokeJoin=e>>8&t(2),r.hinting=e>>6&t(2),r.textAlign=e>>4&t(2),r.textEncoding=e>>2&t(2)}(n.readUint32()),e=n.readUint32(),t=e>>16&65535,r.blendMode=e>>8&255,r.textSize=o(Sk.NonDef.kTextSize,12),r.textScaleX=o(Sk.NonDef.kTextScaleX,1),r.textSkewX=o(Sk.NonDef.kTextSkewX,0),r.strokeWidth=o(Sk.NonDef.kStrokeWidth,0),r.strokeMiter=o(Sk.NonDef.kStrokeMiter,4),r.color=t&Sk.NonDef.kColor?n.readUint32():Sk.Color.BLACK,t&Sk.NonDef.kTypeface&&(r.typeface=n.readTypeface()),r.path_effect=i(Sk.NonDef.kPathEffect),r.shader=i(Sk.NonDef.kShader),r.mask_filter=i(Sk.NonDef.kMaskFilter),r.color_filter=i(Sk.NonDef.kColorFilter),r.image_filter=i(Sk.NonDef.kImageFilter),r.deduper={},Sk.Paint.isValid(r),Object.freeze(Sk.Paint.populatePaintStrings(r))},n.readTypeface=function(){var e=n.readUint32(),r=t.get(Sk.Deduper.Type.kTypeface,e);return r||a({event:"invalid-typeface-index",index:e}),r},n.readFontData=function(){var e=n.readUint32(),r=t.get(Sk.Deduper.Type.kFontData,e);return r||a({event:"invalid-font-data-index",index:e}),r},n.readPaint=function(){var e=n.readUint32(),r=t.get(Sk.Deduper.Type.kPaint,e);return r||a({event:"invalid-paint-index",index:e}),r},n.readTextBlobDef=function(){for(var e,r,o,i={runs:[],deduper:{}};e={},4294967295!==(r=n.readUint32());)e.positioning=3&r,o=e.positioning===Sk.GlyphPositioning.kFull?2:1,e.offset=n.readPoint(),e.paint=n.readPaint(),e.glyph_count=n.readUint32(),e.glyph_reader=new Sk.BinaryReader(n.readBytes(e.glyph_count*(4+4*o)),t),i.runs.push(e);return Object.freeze(i)},n.readTextBlobByIndex=function(e){return t.get(Sk.Deduper.Type.kTextBlob,e)},n.readSparseMatrix=function(e){var t,r=[1,0,0,1,0,0];return e&(Sk.MatrixMask.Affine|Sk.MatrixMask.Perspective|Sk.MatrixMask.Scale)?r=e&Sk.TypeMask.Float16?n.readFloat16Array(6):n.readFloat32Array(6):e&Sk.MatrixMask.Translate&&(t=e&Sk.TypeMask.Float16?n.readFloat16Array(2):n.readFloat32Array(2),r[4]=t[0],r[5]=t[1]),r},n.readMatrix=function(){return n.readSparseMatrix(n.readUint32())},n.readSampling=function(){var e={};return e.max_aniso=n.readUint32(),0===e.max_aniso&&(e.use_cubic=n.readBool(),e.use_cubic?e.cubic={B:n.readFloat32(),C:n.readFloat32()}:(e.filter=n.readUint32(),e.mipmap=n.readUint32())),e},n.readRRect=function(e){var t,r,o,i;switch(e>=0&&Sk.RRectType.kLast,e){case Sk.RRectType.kRect:t=n.readRect();break;case Sk.RRectType.kSimple:for(t=n.readRect(),o=n.readFloat32Array(2),r=[],i=0;i<4;i+=1)r=r.concat(o);break;case Sk.RRectType.kEmpty:case Sk.RRectType.kOval:case Sk.RRectType.kNinePatch:case Sk.RRectType.kComplex:t=n.readRect(),r=n.readFloat32Array(8)}return{rect:t,radii:r}},n.readImage=function(){var e=n.readUint32(),r=t.get(Sk.Deduper.Type.kImage,e);return r||a({event:"invalid-image-index",index:e}),r},n.readPathDef=function(){var e=n.readUint32(),t=e>>16&1,r=n.readByteArray(),o=n.readUint32(),i=n.readFloat32Array(2*o),a=t?n.readUint32():0,s=a>0?n.readFloat32Array(a):null,l=function(e){var t,r,n,o,i;if(e.length<2)return Sk.Rect.makeEmpty();for(r=o=e[0],n=i=e[1],t=2;t<e.length;t++)e[t]<r?r=e[t]:e[t]>o&&(o=e[t]),e[++t]<n?n=e[t]:e[t]>i&&(i=e[t]);return Sk.Rect.fromLTRB(r,n,o,i)}(i);return Object.freeze({fill_rule:e>>8&255,first_direction:e>>26&3,point_count:o,verbs_u8a:r,points_f32a:i,weight_count:a,weights_f32a:s,bounds:l,deduper:{}})},n.readPathByIndex=function(e){return e=e||n.readUint32(),t.get(Sk.Deduper.Type.kPath,e)},n.readGlyphDef=function(){return{id:n.readUint32(),bounds:n.readRect(),path:n.readPathDef(),deduper:{}}},n.readGlyphByIndex=function(e,r){return e=e||n.readUint32(),t.get(Sk.Deduper.Type.kGlyph,e,r)}},Sk.Canvas=function(e,t,r,n){"use strict";var o,i=this,a=new Sk.Logger("sk-canvas",{level:"info",debug:n}),s=null,l=null,c=[{matrix_clip_ops:[],canvas_clip:Sk.Rect.makeLargest(),ctm:Sk.Matrix.identity(),device:e}];function u(){return c[c.length-1]}function d(){return u().device}function f(){return u().matrix_clip_ops}function p(){return u().ctm}function g(){return u().canvas_clip}function m(e){u().ctm=e}function k(e){return Sk.Rect.isValid(e),Sk.Rect.roundOut0(Sk.Matrix.mapRect(p(),e))}function h(){c.length,c.push({matrix_clip_ops:f().slice(0),canvas_clip:Sk.Rect.makeCopy(g()),ctm:p().slice(0),device:d()})}function S(e,t){var r;t===Sk.ClipOp.kIntersect&&(r=Sk.Rect.intersection(g(),k(e)),u().canvas_clip=r)}function y(e,r){r&&r.isComplete(),t&&!Sk.Rect.isEmpty(e)&&t(e,"image-load-complete")}function v(e){var t,r;if(e.display_item_type===Sk.HT.DisplayItemType.kCaret)return!Sk.disabledRemoteCaret;if(function(e){return e.flags&Sk.HT.ElementFlags.kInShadowTree&&(e.flags&Sk.HT.ElementFlags.kHasInputElementOwner||e.flags&Sk.HT.ElementFlags.kHasTextAreaOwner||e.flags&Sk.HT.ElementFlags.kHasTemporalElementOwner||e.flags&Sk.HT.ElementFlags.kHasColorInputOwner)&&!(e.flags&Sk.HT.ElementFlags.kIsPlaceholderText)}(e)&&(t=e.type===Sk.HT.ElementType.kTextNode,r=Sk.focusedElementInfoByNodeId[e.owner_node_uid])){if(t)return!1;if(e.flags&(Sk.HT.ElementFlags.kHasTemporalElementOwner|Sk.HT.ElementFlags.kHasColorInputOwner))return!1;if(BrowserDetect.isMobileSafari())return!("search"===r.type&&e.type===Sk.HT.ElementType.kElementNode)}return!0}i.setHostCanvas=function(e){s=e},i.getOptions=function(){return r},i.getActiveMatrixClipListRef=function(){return f()},i.getCTM=function(){return p()},i.toCanvasBounds=k,i.getNode=function(){return e.getNode()},i.getDeviceContainerNode=function(){return i.getNode().parentNode?i.getNode().parentNode:s.getNode().parentNode},i.release=function(){e.release(),e=null,s=null,t=null},i.save=function(){var e=c.length;return h(),d().save(),e},i.saveLayer=function(e,t){var r,n=g();e.local_bounds&&(n=Sk.Rect.intersection(n,i.toCanvasBounds(e.local_bounds))),r=i.rootToDeviceBounds(n),Sk.Rect.isEmpty(r)?i.save():function(e,t){h(),f(),u().device=d().createDevice("save-layer",e,f()),u().device.setCanvas(i),u().paint=t}(r,e.paint||Sk.Paint.Default),e.local_bounds&&function(e){return!(e&Sk.SaveLayerMask.DontClipToLayer)}(t)&&i.clipRRect({rect:e.local_bounds}),Sk.SaveLayerMask.HasBackdrop,Sk.SaveLayerMask.HasClipMask,Sk.SaveLayerMask.HasClipMatrix},i.restore=function(){var e=u(),t=d();return c.length,c.pop(),d()===t?d().restore():(e.paint,d().drawDevice(t,t.getDeviceBounds(),e.paint),t.release(!0),t=null),c.length},i.concat=function(e){f().push({concat_mat:e}),d().concat(e),m(Sk.Matrix.multiply(p(),Sk.Matrix.fromMat2D(e)))},i.setMatrix=function(e,t){e.length,f().push({set_mat:e}),d().setMatrix(e,t),m(t?Sk.Matrix.multiply(t,Sk.Matrix.fromMat2D(e)):Sk.Matrix.fromMat2D(e))},i.scale=function(e,t){i.concat([e,0,0,t,0,0])},i.translate=function(e,t){i.concat([1,0,0,1,e,t])},i.clipRRect=function(e,t){Sk.Rect.isValid(e.rect),void 0===t&&(t=Sk.ClipOp.kIntersect),S(e.rect,t),f().push({clip_rrect:e,clip_op:t}),d().clipRRect(e,t)},i.clipRect=function(e){Sk.Rect.isValid(e),i.clipRRect({rect:e})},i.clearRect=function(e){Sk.Rect.isValid(e),d().clearRect(e)},i.drawRRect=function(e,t){d().drawRRect(e,t||Sk.Paint.Default)},i.fillText=function(e,t,r,n){d().fillText(e,t,r,n)},i.fillRect=function(e,t){d().fillRect(e,t)},i.setNeedsRedrawOnLoad=function(e,t){e.asDict(),e.setCompletionCallback(o+":"+Sk.Rect.toString(t),y.curry(t))},i.drawVideoRect=function(e,t,r,n){HTMLVideoElement,d().drawVideoRect(e,t,r,n)},i.drawImageRect=function(e,t,r,n,o){var s;"ClientCanvasSrc"!==e?(Sk.Image,Sk.Rect.isValid(r)||Sk.Point.isValid(r),e.asDict(),e.isSuccess()&&(e.isComplete()||(i.setNeedsRedrawOnLoad(e,Sk.Rect.isValid(r)?k(r):Sk.Rect.makeLargest()),o=0),(s=e.getFrame(o))&&(HTMLImageElement,e.asDict(),s.naturalWidth&&s.naturalHeight?(t=t||Sk.Rect.fromXYWH(0,0,s.naturalWidth,s.naturalHeight),Sk.Rect.isEmpty(t),Sk.Rect.isValid(r)||(Sk.Point.isValid(r),r=Sk.Rect.fromXYWH(r[0],r[1],s.naturalWidth,s.naturalHeight)),Sk.Rect.isValid(r),Sk.Rect.isEmpty(t)||Sk.Rect.isEmpty(r)||d().drawImageRect(e,t,r,n||Sk.Paint.Default,o)):a.error({event:"undefined-or-empty-image",naturalWidth:e.naturalWidth,naturalHeight:e.naturalHeight})))):d().drawImageRect(e,t,r,n||Sk.Paint.Default,o)},i.toDeviceBounds=function(e){var t=d().getDeviceScaleFactor();return Sk.Rect.roundOut0(Sk.Matrix.mapRect(Sk.Matrix.postScale(i.getCTM(),t,t),e))},i.rootToDeviceBounds=function(e){var t=d().getDeviceScaleFactor();return Sk.Rect.roundOut0(Sk.Matrix.mapRect(Sk.Matrix.makeScale(t,t),e))},i.getDeviceScaleFactor=function(){return d().getDeviceScaleFactor()},i.rasterShader=function(e){var r,o,c,u={},d={rect:e.tile,rsf:1};return Sk.Rect.isEmpty(e.tile),l&&(r=l.get(Sk.Deduper.Type.kPicture,e.index)),r?(c=new Sk.HTMLCanvasDevice("shader",Sk.Rect.roundOut0(Sk.Rect.scale(d.rect,d.rsf)),{x:Sk.Rect.getX(d.rect),y:Sk.Rect.getY(d.rect)},d.rsf)).tryAlloc()?(u.use_raster_cache=!0,u.text_boxes=!1,(o=new Sk.Canvas(c,t,u,n)).setHostCanvas(i),o.drawPicture(r,r.getCullRect()),c.setCanvas(null),o.setHostCanvas(null),o=null,c):(a.error({event:"picture-shader",details:"unable to allocate new device",index:e.index}),null):s?s.rasterShader(e):(a.error({event:"picture-shader",details:"no picture found",index:e.index}),null)},i.drawPicture=function(e,t,n,o){var a,s=k(e.getCullRect());Sk.Rect.intersects(s,g())&&((a=e.getHitTestData())&&(r.hit_item_listener&&r.hit_item_listener(t,a),!v(a))||(l=e.getAssetCache(),d().onWillDrawPicture&&d().onWillDrawPicture(e,t),function(e,t){var n,o=e.getRasterImage();if(e.use_count||(e.use_count=0),r.use_raster_cache&&!o&&e.use_count>=Sk.rasterCacheUseThreshold&&(n=e.getRasterCache().getOrCreate(e.getContentId(),e,i)),e.use_count+=1,n&&r.use_raster_cache)return Sk.Paint.Default.filterQuality,Sk.FilterQuality.kNone,void d().drawDevice(n,t,Sk.Paint.Default,!0);o?(Sk.Rect.isIntRect(e.getCullRect()),o.isComplete(),i.drawImageRect(o,Sk.Rect.fromXYWH(0,0,o.getFrame(0).naturalWidth,o.getFrame(0).naturalHeight),e.getCullRect(),Sk.Paint.Default,0),d().drawDebugRect(e.getCullRect(),"rgba(255,0,0,0.5)")):(i.save(),i.translate(e.getCullRect()[0],e.getCullRect()[1]),e.playback(i,{original_ctm:i.getCTM().slice(0)}),i.restore())}(e,s),d().onDidDrawPicture&&d().onDidDrawPicture(),l=null,a&&a.formctrl&&d().drawDebugRect(e.getCullRect(),"rgba(0,255,0,0.5)")))},i.drawAnnotation=function(e,t){},i.clipPath=function(e,t){S(e.bounds,t),f().push({clip_path:e,clip_op:t}),d().clipPath(e,t)},i.clipQuad=function(e,t){S(Sk.Rect.bboxRect(e),t),f().push({clip_quad:e,clip_op:t}),d().clipQuad(e,t)},i.drawPath=function(e,t){d().drawPath(e,t)},i.drawTextBlob=function(e,t,r,n){d().drawTextBlob(e,t,r,n)},i.drawPaint=function(e){d().drawPaint(e)},i.drawPoints=function(e,t,r,n){d().drawPoints(e,t,r,n)},i.toDataURL=function(t){e.toDataURL(t)},i.usesRasterCache=function(){return r.use_raster_cache},i.getDevice=function(){return e},e.setCanvas(i),o=Sk.nextCanvasId,Sk.nextCanvasId+=1,r=r||{use_raster_cache:!1}},Sk.Deduper={Type:{kPicture:0,kImage:1,kPath:2,kGlyph:3,kPaint:4,kTextBlob:5,kTypeface:6,kFontData:7},ObjectMap:function(){"use strict";var e,t,r=this;r.add=function(r,n,o){e.hasOwnProperty(r)||(n.deduper&&n.deduper.index,n.deduper.index=r,e[r]=n,t.size+=o,t.min_obj_size=t.count?Math.min(t.min_obj_size,o):o,t.max_obj_size=t.count?Math.max(t.max_obj_size,o):o,t.count+=1)},r.get=function(r){return e.hasOwnProperty(r)?(t.hits+=1,e[r]):null},r.reset=function(){e={},(t={}).size=0,t.count=0,t.hits=0,t.min_obj_size=0,t.max_obj_size=0},r.getStats=function(){return{stats:t,avg_obj_size:t.count?t.size/t.count:0}},r.reset()},GlyphCache:function(e,t){"use strict";var r,n=this,o=(new Sk.Logger("sk-glyph-cache",{level:"info"}),new Sk.Deduper.ObjectMap),i=new Sk.SVGEmitter,a=new Sk.PathTools(i);function s(e){return"glyph-"+t+":"+e}n.add=function(e,t,r){o.add(e,t,r)},n.get=function(t,n){var l=o.get(t);return l&&n&&!document.getElementById(s(t))&&function(t,n){var o=e.createElement("path"),l=void 0!==n.path.fill_rule?n.path.fill_rule:Sk.FillRule.kWinding,c=Sk.Paint.skFillRuleToCanvasFillRule(l);o.id=s(t),a.drawPath(n.path,Sk.ClipOp.kIntersect),o.setAttribute("d",i.flushPathList().join(" ")),o.setAttribute("fill-rule",c),r||((r=e.createElement("defs")).setAttribute("id","sv-def-glyphs"),e.appendChild(r)),r.appendChild(o)}(t,l),l},n.getStats=o.getStats,n.reset=function(){o.reset(),r&&(r.parentNode.removeChild(r),r=null)},n.reset()},Cache:function(e,t){"use strict";var r,n=this,o=(new Sk.Logger("sk-cache-host",{level:"info"}),{});n.add=function(e,t,r,n){var i=o[e];i.add(t,r,n)},n.get=function(e,t){return o[e].get.apply(o[e],Sk.Util.argumentsToArray(arguments).slice(1))},n.getStats=function(e){return{draw_cache:o[e].getStats()}},n.release=function(){var e;for(e in Sk.Deduper.Type)Sk.Deduper.Type.hasOwnProperty(e)&&o[Sk.Deduper.Type[e]].reset();r&&r.parentNode&&r.parentNode.removeChild(r),r=null},n.getContainer=function(){return r},function(){var n;for(n in(r=Sk.Util.createSVGRootElement(1,1)).setAttribute("id","sv-cache-defs"),r.style.display="none",Sk.Deduper.Type)if(Sk.Deduper.Type.hasOwnProperty(n))switch(Sk.Deduper.Type[n]){case Sk.Deduper.Type.kGlyph:o[Sk.Deduper.Type.kGlyph]=new Sk.Deduper.GlyphCache(r,t);break;case Sk.Deduper.Type.kTypeface:o[Sk.Deduper.Type.kTypeface]=e;break;default:o[Sk.Deduper.Type[n]]=new Sk.Deduper.ObjectMap}}()}},Sk.Point={fromXY:function(e,t){return[e,t]},isValid:function(e){return"object"==typeof e&&2===e.length}},Sk.Quad=new function(){"use strict";this.isRect=function(e){return e[0][0]===e[3][0]&&e[1][0]===e[2][0]&&e[0][1]===e[1][1]&&e[2][1]===e[3][1]}},Sk.Region=new function(){"use strict";var e=this;e.makeEmpty=function(){return[]},e.makeRect=function(e){return[e]},e.makeCopy=function(e){var t,r=[];for(t=0;t<e.length;t+=1)r.push(Sk.Rect.makeCopy(e[t]));return r},e.isEmpty=function(t){return Sk.Rect.isEmpty(e.getBoundingIntRect(t))},e.addRect=function(e,t){var r,n=!0;if(Sk.Rect.isValid(t),Sk.Rect.isEmpty(t))return e;for(r=0;r<e.length;r+=1)if(Sk.Rect.intersects(t,e[r])){n=!1,Sk.Rect.join(e[r],t);break}return n&&e.push(t),e},e.subtractRect=function(t,r,n){var o,i,a;for(Sk.Rect.isValid(r),n&&t.length>1&&(i=e.getBoundingIntRect(t),t.splice(0,t.length),t.push(i)),o=t.length-1;o>=0;o-=1)if(i=t[o],Sk.Rect.contains(r,i))t.splice(o,1);else if(a=Sk.Rect.intersection(i,r),!Sk.Rect.isEmpty(a)){var s=Sk.Rect.getLeft(i),l=Sk.Rect.getTop(i),c=Sk.Rect.getRight(i),u=Sk.Rect.getBottom(i),d=Sk.Rect.getLeft(a),f=Sk.Rect.getTop(a),p=Sk.Rect.getRight(a),g=Sk.Rect.getBottom(a),m=[Sk.Rect.fromLTRB(s,l,d,u),Sk.Rect.fromLTRB(d,l,p,f),Sk.Rect.fromLTRB(d,g,p,u),Sk.Rect.fromLTRB(p,l,c,u)];t.splice(o,1),m.forEach((function(e){Sk.Rect.isEmpty(e)||t.push(e)}))}return t},e.addRegion=function(t,r){var n;for(n=0;n<r.length;n+=1)e.addRect(t,r[n])},e.getBoundingIntRect=function(e,t){var r,n,o=Sk.Rect.makeEmpty();for(r=0;r<e.length;r+=1)n=t?Sk.Rect.intersection(e[r],t):e[r],Sk.Rect.join(o,n);return Sk.Rect.roundOut0(o)},e.getBoundingRect=e.getBoundingIntRect,e.intersectsRect=function(e,t){var r;for(r=0;r<e.length;r+=1)if(Sk.Rect.intersects(e[r],t))return!0;return!1},e.containsPoint=function(e,t){var r;for(r=0;r<e.length;r+=1)if(Sk.Rect.containsPoint(e[r],t))return!0;return!1},e.iterateSafeFromUpdate=function(t,r){var n,o=e.makeCopy(t);for(n=0;n<o.length;n+=1)r(o[n])}},Sk.Rect={toXYWH:function(e){"use strict";return this.isValid(e),[e[0],e[1],e[2]-e[0],e[3]-e[1]]},toQuad:function(e){"use strict";var t=[];return t.push([e[0],e[1]]),t.push([e[2],e[1]]),t.push([e[2],e[3]]),t.push([e[0],e[3]]),t},toString:function(e){return(e[0]<=-Number.MAX_VALUE?"MIN":e[0])+":"+(e[1]<=-Number.MAX_VALUE?"MIN":e[1])+":"+(e[2]>=Number.MAX_VALUE?"MAX":e[2])+":"+(e[3]>=Number.MAX_VALUE?"MAX":e[3])},toCSSStyle:function(e,t){"absolute"===t.position||t.position,t.left=Sk.Rect.getLeft(e)+"px",t.top=Sk.Rect.getTop(e)+"px",t.width=Sk.Rect.getWidth(e)+"px",t.height=Sk.Rect.getHeight(e)+"px"},toCSSClip:function(e){return this.isValid(e),"rect("+e[1]+"px "+e[2]+"px "+e[3]+"px "+e[0]+"px)"},toCSSClipPath:function(e,t){return this.isValid(e)&&this.isValid(t),"inset("+Sk.Rect.getTop(t)+"px "+(Sk.Rect.getWidth(e)-Sk.Rect.getRight(t))+"px "+(Sk.Rect.getHeight(e)-Sk.Rect.getBottom(t))+"px "+Sk.Rect.getLeft(t)+"px)"},fromQuad:function(e){return this.bboxRect(e)},fromXYWH:function(e,t,r,n){var o=[e,t,e+r,t+n];return this.isValid(o),o},fromWH:function(e,t){var r=[0,0,e,t];return this.isValid(r),r},fromLTRB:function(e,t,r,n){var o=[e,t,r,n];return this.isValid(o),o},fromRect:function(e){return this.isValid(e),[e[0],e[1],e[2],e[3]]},set:function(e,t,r,n,o){return e[0]=t,e[1]=r,e[2]=n,e[3]=o,this.isValid(e),e},setXYWH:function(e,t,r,n,o){return e[0]=t,e[1]=r,e[2]=t+n,e[3]=r+o,this.isValid(e),e},setEmpty:function(e){return e[0]=e[1]=e[2]=e[3]=0,this.isValid(e),e},bboxRect:function(e){"use strict";var t,r,n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(!e.length)return[0,0,0,0];for(t=0;t<e.length;t+=1)r=e[t],n=Math.min(n,r[0]),i=Math.min(i,r[1]),o=Math.max(o,r[0]),a=Math.max(a,r[1]);return[n,i,o,a]},roundOut:function(e){return this.fromLTRB(Math.floor(e[0]),Math.floor(e[1]),Math.ceil(e[2]),Math.ceil(e[3]))},roundOut0:function(e){return this.isValid(e),e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3]),e},makeCopy:function(e){return[e[0],e[1],e[2],e[3]]},makeEmpty:function(){return[0,0,0,0]},MIN_INT32:1<<31,MAX_INT32:~(1<<31),makeLargest:function(){return[this.MIN_INT32,this.MIN_INT32,this.MAX_INT32,this.MAX_INT32]},isLargest:function(e){return e[0]<=this.MIN_INT32&&e[1]<=this.MIN_INT32&&e[2]>=this.MAX_INT32&&e[3]>=this.MAX_INT32},makeOffset:function(e,t,r){"use strict";return this.set(e,e[0]+t,e[1]+r,e[2]+t,e[3]+r)},makeFromMidpoint:function(e,t,r){return[e.x-t,e.y-r,e.x+t,e.y+r]},moveToOrigin:function(e){"use strict";return this.makeOffset(e,-this.getX(e),-this.getY(e))},isEmpty:function(e){"use strict";return e.length,e[2]-e[0]<=0||e[3]-e[1]<=0},isValid:function(e){return 4===e.length&&Number.isFinite(e[0])&&Number.isFinite(e[1])&&Number.isFinite(e[2])&&Number.isFinite(e[3])&&e[this.LEFT]<=e[this.RIGHT]&&e[this.TOP]<=e[this.BOTTOM]},isIntRect:function(e){return Sk.Rect.equals(e,Sk.Rect.roundOut(e))},isSizeEqual:function(e,t){return Sk.Rect.getWidth(e)===Sk.Rect.getWidth(t)&&Sk.Rect.getHeight(e)===Sk.Rect.getHeight(t)},getArea:function(e){return Sk.Rect.getWidth(e)*Sk.Rect.getHeight(e)},getX:function(e){return e[0]},getY:function(e){return e[1]},getLeft:function(e){return this.getX(e)},getTop:function(e){return this.getY(e)},getRight:function(e){return e[2]},getBottom:function(e){return e[3]},getWidth:function(e){return e[2]-e[0]},getHeight:function(e){return e[3]-e[1]},getOvalRadii:function(e){var t,r;return this.isValid(e),[t=this.getWidth(e)/2,r=this.getHeight(e)/2,t,r,t,r,t,r]},getCenter:function(e){return[this.getX(e)+this.getWidth(e)/2,this.getY(e)+this.getHeight(e)/2]},resize:function(e,t){return this.isValid(e),[e[0]-t,e[1]-t,e[2]+t,e[3]+t]},equals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},isEqual:function(e,t){return this.equals(e,t)},intersects:function(e,t){return this.isValid(e),this.isValid(t),!(Sk.Rect.isEmpty(e)||Sk.Rect.isEmpty(t)||this.getLeft(t)>=this.getRight(e)||this.getRight(t)<=this.getLeft(e)||this.getTop(t)>=this.getBottom(e)||this.getBottom(t)<=this.getTop(e))},intersection:function(e,t){var r,n,o,i;return this.isValid(e)&&this.isValid(t),Sk.Rect.isEmpty(e)||Sk.Rect.isEmpty(t)?r=n=o=i=0:(r=Math.max(Sk.Rect.getX(e),Sk.Rect.getX(t)),n=Math.max(Sk.Rect.getY(e),Sk.Rect.getY(t)),o=Math.min(Sk.Rect.getRight(e),Sk.Rect.getRight(t)),i=Math.min(Sk.Rect.getBottom(e),Sk.Rect.getBottom(t))),(r>=o||n>=i)&&(r=n=o=i=0),this.fromXYWH(r,n,o-r,i-n)},contains:function(e,t){return this.isValid(e)&&this.isValid(t),Sk.Rect.getX(t)>=Sk.Rect.getX(e)&&Sk.Rect.getRight(t)<=Sk.Rect.getRight(e)&&Sk.Rect.getY(t)>=Sk.Rect.getY(e)&&Sk.Rect.getBottom(t)<=Sk.Rect.getBottom(e)},containsPoint:function(e,t){return"number"==typeof t.x&&t.y,this.contains(e,this.fromXYWH(t.x,t.y,0,0))},join:function(e,t){return this.isValid(e)&&this.isValid(t),this.getLeft(t)>=this.getRight(t)||this.getTop(t)>=this.getBottom(t)?e:this.getLeft(e)>=this.getRight(e)||this.getTop(e)>=this.getBottom(e)?this.set(e,this.getLeft(t),this.getTop(t),this.getRight(t),this.getBottom(t)):this.set(e,Math.min(this.getLeft(e),this.getLeft(t)),Math.min(this.getTop(e),this.getTop(t)),Math.max(this.getRight(e),this.getRight(t)),Math.max(this.getBottom(e),this.getBottom(t)))},subtract:function(e,t){var r=this.getX(e),n=this.getY(e),o=this.getRight(e),i=this.getBottom(e);return this.intersects(e,t)?this.contains(t,e)?this.set(e,0,0,0,0):(Sk.Rect.getY(t)<=n&&Sk.Rect.getBottom(t)>=i?Sk.Rect.getX(t)<=r?r=Sk.Rect.getRight(t):Sk.Rect.getRight(t)>=o&&(o=Sk.Rect.getX(t)):Sk.Rect.getX(t)<=r&&Sk.Rect.getRight(t)>=o&&(Sk.Rect.getY(t)<=n?n=Sk.Rect.getBottom(t):Sk.Rect.getBottom(t)>=i&&(i=Sk.Rect.getY(t))),this.set(e,r,n,o,i)):e},scaleXY:function(e,t,r){return 1===t&&1===r?Sk.Rect.makeCopy(e):Sk.Matrix.mapRect(Sk.Matrix.makeScale(t,r),e)},scale:function(e,t){return this.scaleXY(e,t,t)},translate:function(e,t,r){return e[this.LEFT]+=t,e[this.RIGHT]+=t,e[this.TOP]+=r,e[this.BOTTOM]+=r,e},LEFT:0,TOP:1,RIGHT:2,BOTTOM:3},Sk.Radii={isValid:function(e){return e&&8===e.length},getUpperLeftX:function(e){return e[0]},getUpperLeftY:function(e){return e[1]},getUpperRightX:function(e){return e[2]},getUpperRightY:function(e){return e[3]},getLowerRightX:function(e){return e[4]},getLowerRightY:function(e){return e[5]},getLowerLeftX:function(e){return e[6]},getLowerLeftY:function(e){return e[7]},resize:function(e,t){var r,n=[];if(!this.isValid(e))return e;for(r=0;r<e.length;r++)n.push(e[r]+t);return n},toCSSStyle:function(e,t){"absolute"===t.position||t.position,t.borderTopLeftRadius=this.getUpperLeftX(e)+"px "+this.getUpperLeftY(e)+"px",t.borderTopRightRadius=this.getUpperRightX(e)+"px "+this.getUpperRightY(e)+"px",t.borderBottomRightRadius=this.getLowerRightX(e)+"px "+this.getLowerRightY(e)+"px",t.borderBottomLeftRadius=this.getLowerLeftX(e)+"px "+this.getLowerLeftY(e)+"px"}},Sk.Conic={isValid:function(e){return 7===e.length},chop:function(e){var t=.5,r=e[0],n=e[1],o=e[2],i=e[3],a=e[4],s=e[5],l=e[6],c=1/(1+l),u=Math.sqrt(t+l*t),d=l*o,f=l*i,p=(r+d+d+a)*c*t,g=(n+f+f+s)*c*t,m=(r+d)*c,k=(n+f)*c,h=(d+a)*c,S=(f+s)*c,y=[];return y[0]=[r,n,0,0,0,0,u],y[0][2]=m,y[0][3]=k,y[0][4]=p,y[0][5]=g,y[1]=[0,0,0,0,a,s,u],y[1][0]=p,y[1][1]=g,y[1][2]=h,y[1][3]=S,y},getP0X:function(e){return this.isValid(e),e[0]},getP0Y:function(e){return this.isValid(e),e[1]},getP1X:function(e){return this.isValid(e),e[2]},getP1Y:function(e){return this.isValid(e),e[3]},getP2X:function(e){return this.isValid(e),e[4]},getP2Y:function(e){return this.isValid(e),e[5]},setP0X:function(e,t){this.isValid(e),e[0]=t},setP0Y:function(e,t){this.isValid(e),e[1]=t},setP1X:function(e,t){this.isValid(e),e[2]=t},setP1Y:function(e,t){this.isValid(e),e[3]=t},setP2X:function(e,t){this.isValid(e),e[4]=t},setP2Y:function(e,t){this.isValid(e),e[5]=t},between:function(e,t,r){return(e-t)*(r-t)<=0},subdivide:function(e,t,r){var n,o,i,a,s;if(0===r)return t.push(this.getP1X(e)),t.push(this.getP1Y(e)),t.push(this.getP2X(e)),void t.push(this.getP2Y(e));(n=this.chop(e)).length,o=this.getP0Y(e),i=this.getP2Y(e),this.between(o,this.getP1Y(e),i)&&(a=this.getP2Y(n[0]),this.between(o,a,i)||(s=Math.abs(a-o)<Math.abs(a-i)?o:i,this.setP2Y(n[0],s),this.setP0Y(n[1],s)),this.between(o,this.getP1Y(n[0]),this.getP2Y(n[0]))||this.setP1Y(n[0],o),this.between(this.getP0Y(n[1]),this.getP1Y(n[1]),i)||this.setP1Y(n[1],i),this.between(o,this.getP1Y(n[0]),this.getP2Y(n[0])),this.between(this.getP1Y(n[0]),this.getP2Y(n[0]),this.getP1Y(n[1])),this.between(this.getP2Y(n[0]),this.getP1Y(n[1]),i)),--r,this.subdivide(n[0],t,r),this.subdivide(n[1],t,r)},convertConicToQuads:function(e,t){var r=[];return r.push(this.getP0X(e)),r.push(this.getP0Y(e)),this.subdivide(e,r,t),r.length,r}},Sk.HTMLCanvasDevice=function(e,t,r,n){"use strict";var o,i,a,s,l,c,u,d=this,f=new Sk.Logger("sk-canvas-device",{level:"info"}),p=0,g=!0,m=new Sk.TextBlobIterator,k=-1,h={};function S(){c&&c.parentNode&&c.parentNode.removeChild(c),u=null,c=null,h={}}function y(e,t){return t.linear_gradient?function(e,t){var r,n=e.createLinearGradient(t.start[0],t.start[1],t.end[0],t.end[1]),o=1/(t.colors.length-1);for(r=0;r<t.colors.length;r+=1)n.addColorStop(t.position?t.position[r]:o*r,Sk.Paint.skColorToCSSColor(t.colors[r]));return n}(e,t.linear_gradient):t.radial_gradient?function(e,t){var r,n=e.createRadialGradient(t.center[0],t.center[1],0,t.center[0],t.center[1],t.radius),o=1/(t.colors.length-1);for(r=0;r<t.colors.length;r+=1)n.addColorStop(t.position?t.position[r]:o*r,Sk.Paint.skColorToCSSColor(t.colors[r]));return n}(e,t.radial_gradient):null}function v(e){var t,n,o,l,d,f=e.image_filter;if(e.color_filter&&e.color_filter.is_luma_color_filter&&(d=e.color_filter),f||d){if(c||(c=Sk.Util.createSVGRootElement(0,0),u=c.createElement("defs"),c.appendChild(u),a.getDeviceContainerNode().appendChild(c)),n=Sk.Matrix.multiply(Sk.Matrix.makeTranslation(-r.x,-r.y),a.getCTM()),o={filter:f||d,ctm:n},Sk.Util.forEachItem(h,(function(e,r){return JSON.stringify(r)===JSON.stringify(o)&&(t=e,l=document.getElementById(t),!0)})),void 0===t){if(!(l=Sk.SVGFilterHelper.buildWith(f||d,n)))return;t=["res-canvas",s,k+=1].join("-"),l.setAttribute("id",t),u.appendChild(l),h[t]=o}BrowserDetect.isSafari()||BrowserDetect.isIE()||BrowserDetect.isEdge()?function(e){var t,r,n;(t=e.querySelectorAll("feColorMatrix"))&&1===t.length&&t[0]&&(n="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0",(r=t[0].getAttribute("values"))&&r.slice(0,n.length)===n&&(i.globalAlpha=Number(r.split(" ")[18])))}(l):(i.filter=Sk.Util.urlWrap("#"+t),i.filter)}}function b(e){var t;e&&(t=i.strokeStyle,i.strokeStyle="rgba(0,0,0,0)",i.stroke()),i.clip(),e&&(i.strokeStyle=t)}function C(e,t){var r,o,s,l,c;e.color_filter&&!e.color_filter.is_luma_color_filter&&(l=a?a.getCTM():Sk.Matrix.identity(),c=Sk.Matrix.getDecomposedScale(l),o=function(e,t,r){var n=t;return e.style&&e.style!==Sk.Paint.Style.kFill_Style&&e.strokeWidth>1&&(n=Sk.Rect.resize(t,e.strokeWidth/2)),Sk.Rect.resize(n,r+1)}(e,t,r=Sk.Paint.getShadowBlurRadius(e,l)),i.save(),i.beginPath(),i.rect.apply(i,Sk.Rect.toXYWH(o)),i.closePath(),b(!0),i.shadowColor=Sk.Paint.skColorToCSSColor(e.color_filter.color),i.shadowBlur=r*n,s=Sk.Rect.getWidth(o)+1,i.shadowOffsetX-=s*n*c[0],i.translate(s,0))}function _(e){e.color_filter&&!e.color_filter.is_luma_color_filter&&i.restore()}function T(e,t){var r=e.strokeWidth;if(t&(Sk.PaintUsage.kGeometry|Sk.PaintUsage.kPaint)){if(e.shader)try{!function(e){var t,r,n=e.shader.image,o=e.shader.picture,s=y(i,e.shader);s?i.fillStyle=i.strokeStyle=s:n?((r=n.image).getFrame(0)?i.fillStyle=i.strokeStyle=i.createPattern(r.getFrame(0),(n.tile_mode_x,n.tile_mode_y,"repeat")):i.fillStyle=i.strokeStyle=Sk.isDebugEnabled()?"green":"rgba(0, 0, 0, 0)",r.isComplete()||a.setNeedsRedrawOnLoad(r,Sk.Rect.makeLargest())):o&&(t=a.rasterShader(o))&&(Sk.HTMLCanvasDevice,i.fillStyle=i.strokeStyle=i.createPattern(t.getNode(),(o.tile_mode_x,o.tile_mode_y,"repeat")),t.release(),t=null),i.fillStyle&&i.strokeStyle,i.globalAlpha=e.alphaFloat}(e)}catch(t){f.error({event:"apply-shader-error",paint:e})}else e.style===Sk.Paint.Style.kFill_Style?i.fillStyle=e.cssColor:e.style===Sk.Paint.Style.kStroke_Style?i.strokeStyle=e.cssColor:i.fillStyle=i.strokeStyle=e.cssColor;t&Sk.PaintUsage.kText&&(r/=e.textSize/Sk.Paint.kCanonicalTextSizeForPaths||1),e.path_effect&&(i.setLineDash(e.path_effect.intervals),i.lineDashOffset=e.path_effect.phase),r!==Sk.Paint.Default.strokeWidth&&(i.lineWidth=r),e.strokeMiter!==Sk.Paint.Default.strokeMiter&&(i.miterLimit=e.strokeMiter),e.strokeCap!==Sk.Paint.Default.strokeCap&&(i.lineCap=e.strokeCapStr),e.strokeJoin!==Sk.Paint.Default.strokeJoin&&(i.lineJoin=e.strokeJoinStr)}t&Sk.PaintUsage.kImage&&(e.color,e.filterQuality,i.globalAlpha=e.alphaFloat,e.filterQuality!==Sk.FilterQuality.kNone?(e.filterQualityStr,e.filterQuality,Sk.Util.setImageSmoothingEnabled(i,!0),void 0!==i.imageSmoothingQuality&&(i.imageSmoothingQuality=e.filterQualityStr)):Sk.Util.setImageSmoothingEnabled(i,!1)),e.blendMode,e.blendMode!==Sk.BlendMode.kSrcOver&&function(e){var t=e.blendModeStr;e.blendMode,"clear"===t?(i.globalCompositeOperation="copy",i.fillStyle=i.strokeStyle="rgba(0, 0, 0, 0)",i.globalCompositeOperation):(i.globalCompositeOperation=t,i.globalCompositeOperation!==t&&(i.globalCompositeOperation="source-over",i.globalCompositeOperation)),i.globalCompositeOperation}(e),v(e)}function w(){i.setTransform(1,0,0,1,0,0),i.scale(n,n),(r.x||r.y)&&d.translate(-r.x,-r.y)}function R(e,t){var r,n,o,a;switch(void 0===t&&(t=Sk.FillRule.kWinding),r=Sk.Paint.skFillRuleToCanvasFillRule(t),e.shader&&((o=e.shader.image||e.shader.picture)?n=o.matrix:e.shader.radial_gradient&&(n=e.shader.radial_gradient.transform),n&&(i.save(),i.transform.apply(i,n))),e.style){case Sk.Paint.Style.kFill_Style:i.fill(r);break;case Sk.Paint.Style.kStroke_Style:i.stroke();break;case Sk.Paint.Style.kStrokeAndFill_Style:i.stroke(),i.fill(r);break;default:a={event:"unknown-paint-style",style:e.style},Sk.fatal("HTMLCanvasDeviceError",a)}n&&i.restore()}function x(e,t,r){var n,o,a={};(o=t.blendMode)!==Sk.BlendMode.kClear&&o!==Sk.BlendMode.kSrc&&o!==Sk.BlendMode.kSrcIn&&o!==Sk.BlendMode.kDstIn&&o!==Sk.BlendMode.kSrcOut&&o!==Sk.BlendMode.kDstATop||(i.beginPath(),void 0===t.style||t.style===Sk.Paint.Style.kFill_Style||t.strokeWidth<=1?l.drawRRectPath(e):(n=t.strokeWidth/2,a.rect=Sk.Rect.resize(e.rect,n),e.radii&&(a.radii=Sk.Radii.resize(e.radii,n)),l.drawRRectPath(a)),i.closePath(),b(r))}function D(e,t,r,n){if(e instanceof HTMLImageElement||e instanceof HTMLVideoElement||HTMLCanvasElement,Sk.Rect.isValid(t),Sk.Rect.isValid(r),Sk.Rect.isEmpty(t)||Sk.Rect.isEmpty(r))HTMLVideoElement;else{if(i.save(),T(n,Sk.PaintUsage.kImage),x({rect:r},n),n.blendMode===Sk.BlendMode.kClear)d.clearRect(r);else{C(n,r);try{i.drawImage(e,Sk.Rect.getX(t),Sk.Rect.getY(t),Sk.Rect.getWidth(t),Sk.Rect.getHeight(t),Sk.Rect.getX(r),Sk.Rect.getY(r),Sk.Rect.getWidth(r),Sk.Rect.getHeight(r))}catch(e){f.error({event:"draw-image-error",e:e})}_(n)}i.restore()}}d.setCanvas=function(e){a=e},d.getSizeRect=function(){return o},d.getNode=function(){return i.canvas,i.canvas},d.save=function(){p+=1,i.save()},d.restoreToCount=function(e){for(;p>e;)i.restore(),p-=1},d.restore=function(){0!==p&&d.restoreToCount(p-1)},d.concat=function(e){e.length,i.transform.apply(i,e)},d.translate=function(e,t){i.translate(e,t)},d.scale=function(e,t){i.scale(e,t)},d.skew=function(e,t){i.transform(1,e,t,1,0,0)},d.playbackMatrixAndClipOps=function(e){var t,r;for(t=0;t<e.length;t+=1)(r=e[t]).concat_mat?d.concat(r.concat_mat):r.set_mat?d.setMatrix(r.set_mat):r.clip_rrect?d.clipRRect(r.clip_rrect,r.clip_op):r.clip_path?d.clipPath(r.clip_path,r.clip_op):r.clip_quad&&d.clipQuad(r.clip_quad,r.clip_op)},d.setMatrix=function(e,t){e.length,w(),t&&i.transform.apply(i,Sk.Matrix.toMat2D(t)),i.transform.apply(i,e)},d.clipRRect=function(e,t){i.beginPath(),l.drawRRect(e,t),i.closePath(),i.clip()},d.clipRect=function(e,t){Sk.Rect.isValid(e),d.clipRRect({rect:e},t)},d.clipQuad=function(e,t){t===Sk.ClipOp.kIntersect||Sk.ClipOp.kDifference,e.length,Sk.Quad.isRect(e)?d.clipRect(Sk.Rect.fromQuad(e),t):(i.beginPath(),l.drawQuad(e,t),i.closePath(),i.clip())},d.clearRect=function(e){Sk.Rect.isValid(e),i.clearRect.apply(i,Sk.Rect.toXYWH(e))},d.drawPath=function(e,t,r,n,o){i.save(),void 0!==r&&i.translate(r.x,r.y),void 0!==n&&i.scale(n,n),T(t,Sk.PaintUsage.kGeometry|(o?Sk.PaintUsage.kText:0)),C(t,e.bounds),i.beginPath(),l.drawPath(e,Sk.ClipOp.kIntersect),R(t,e.fill_rule),_(t),i.restore()},d.drawTextBlob=function(e,t,r,n){!function(e,t,r,n){m.forEachRun(e,n,(function(e,n,o){e.forEachGlyph(n,t,r,(function(e,t,r){d.drawPath(e.path,o,{x:t,y:r},n.paint.textSize/Sk.Paint.kCanonicalTextSizeForPaths,!0)}))}))}(e,t,r,n)},d.clipPath=function(e,t){i.beginPath(),l.drawPath(e,t),i.clip()},d.drawPaint=function(e){i.save(),T(e,Sk.PaintUsage.kPaint),i.setTransform(1,0,0,1,0,0),i.fillRect.apply(i,d.getSizeRect()),i.restore()},d.drawPoints=function(e,t,r,n){Sk.PointMode.kLines,i.save(),T(n,Sk.PaintUsage.kGeometry),i.beginPath(),l.drawPointsPath(r),R(n,Sk.FillRule.kWinding),i.restore()},d.drawRRect=function(e,t){i.save(),x(e,t,!0),T(t,Sk.PaintUsage.kGeometry),C(t,e.rect),i.beginPath(),l.drawRRectPath(e),i.closePath(),R(t),_(t),i.restore()},d.fillText=function(e,t,r,n){i.save(),i.font=n||"10px arial",i.fillText(e,t,r),i.restore()},d.fillRect=function(e,t){i.save(),i.fillStyle=t,i.globalAlpha=.3,i.fillRect.apply(i,Sk.Rect.toXYWH(e)),i.restore()},d.drawDebugRect=function(e,t){Sk.isDebugEnabled()&&d.fillRect(e,t||"green")},d.drawDebugDeviceRect=function(e,t){Sk.isDebugEnabled()&&(i.save(),w(),d.drawDebugRect(e,t),i.restore())},d.drawImageRect=function(e,t,r,n,o){D("ClientCanvasSrc"===e&&i?i.canvas:e.getFrame(o),t,r,n)},d.drawVideoRect=function(e,t,r,n){D(e,t,r,n)},d.getDeviceBounds=function(){return t},d.createDevice=function(e,t,r){var o={x:Sk.Rect.getX(t)/n,y:Sk.Rect.getY(t)/n},i=new Sk.HTMLCanvasDevice(e,t,o,n);return Sk.Rect.isIntRect(t),i.tryAlloc()?(r&&i.playbackMatrixAndClipOps(r),i.setCanvas(a),i):(f.error({event:"create-device-alloc-failed",device_bounds:t,mem:Sk.canvasMemoryUsage}),null)},d.drawDevice=function(e,t,o,a){Sk.Rect.isIntRect(t),d.save(),i.setTransform(1,0,0,1,0,0),a&&i.scale(n,n),(r.x||r.y)&&(a?d.translate(-r.x,-r.y):d.translate(-r.x*n,-r.y*n)),D(e.getNode(),e.getSizeRect(),t,o),d.restore()},d.release=function(){i&&i.canvas,S(),i.canvas.width=i.canvas.height=0,i=null,a=null,l=null,Sk.htmlCanvasDeviceCount-=1,Sk.canvasMemoryUsage[e]-=d.getMemoryUsage(),Sk.htmlCanvasDeviceById.hasOwnProperty(s),delete Sk.htmlCanvasDeviceById[s]},d.reset=function(a,s,l,c){i&&i.canvas,g||(Sk.canvasMemoryUsage[e]-=d.getMemoryUsage()),t=s,o=Sk.Rect.fromWH(Sk.Rect.getWidth(t),Sk.Rect.getHeight(t)),r=l,n=c,e=a,S(),Sk.canvasMemoryUsage[e],Sk.canvasMemoryUsage[e]+=d.getMemoryUsage(),g=!1,d.restoreToCount(0),i.globalCompositeOperation,i.globalAlpha,i.canvas.width=Sk.Rect.getWidth(t),i.canvas.height=Sk.Rect.getHeight(t),Sk.Rect.getArea(t),Sk.maxPlatformCanvasArea,Sk.Rect.getArea(t),Sk.maxPlatformCanvasArea,d.save(),w()},d.toDataURL=function(e){e(d.getNode().toDataURL())},d.getDeviceScaleFactor=function(){return n},d.getMemoryUsage=function(){return 4*Sk.Rect.getArea(t)},d.getId=function(){return s},d.tryAlloc=function(){return o=Sk.canvasMemoryUsage[e],a=Sk.canvasMemoryLimit[e],c=d.getMemoryUsage(),!(o+c>a)&&(!!(i=(u=t,f=document.createElement("canvas"),Sk.Rect.isValid(u),f.width=Sk.Rect.getWidth(u),f.height=Sk.Rect.getHeight(u),f).getContext("2d"))&&(l=new Sk.PathTools(new Sk.CanvasEmitter(i)),d.reset(e,t,r,n),Sk.Util.setImageSmoothingEnabled(i,!1),Sk.htmlCanvasDeviceById[s]=d,!0));var o,a,c,u,f},Sk.Rect.isIntRect(t),s=Sk.nextHTMLCanvasDeviceId,Sk.nextHTMLCanvasDeviceId+=1},Sk.HitTestCanvas=function(){"use strict";var e,t,r=this,n=(new Sk.Logger("sk-hit-canvas",{level:"info"}),[{canvas_clip:Sk.Rect.makeLargest(),ctm:Sk.Matrix.identity()}]),o=[],i=new Compositor.OrderedMap,a=[],s=!1;function l(){return n[n.length-1]}function c(){return l().ctm}function u(){return l().canvas_clip}function d(e){l().ctm=e}function f(e){return Sk.Rect.isValid(e),Sk.Rect.roundOut0(Sk.Matrix.mapRect(c(),e))}function p(e,t){var r;t===Sk.ClipOp.kIntersect&&(r=Sk.Rect.intersection(u(),f(e)),l().canvas_clip=r)}function g(e,n,o){var i,a,s,l={rect:n,rsf:1};if(!(a=new Sk.HTMLCanvasDevice("hit-test",Sk.Rect.roundOut0(Sk.Rect.scale(l.rect,l.rsf)),{x:Sk.Rect.getX(l.rect),y:Sk.Rect.getY(l.rect)},l.rsf)).tryAlloc())return null;(i=new Sk.Canvas(a,null,{})).setHostCanvas(r),i.setMatrix(Sk.Matrix.toMat2D(o)),i.drawPicture(e,e.getCullRect());try{s=a.getNode().toDataURL()}catch(e){}return i.release(),i=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,s}r.save=function(){var e=n.length;return n.length,n.push({canvas_clip:Sk.Rect.makeCopy(u()),ctm:c().slice(0)}),e},r.saveLayer=function(e,t){r.save()},r.restore=function(){return n.length,n.pop(),n.length},r.concat=function(e){d(Sk.Matrix.multiply(c(),Sk.Matrix.fromMat2D(e)))},r.setMatrix=function(e,t){e.length,d(t?Sk.Matrix.multiply(t,Sk.Matrix.fromMat2D(e)):Sk.Matrix.fromMat2D(e))},r.scale=function(e,t){r.concat([e,0,0,t,0,0])},r.translate=function(e,t){r.concat([1,0,0,1,e,t])},r.clipRRect=function(e,t){Sk.Rect.isValid(e.rect),void 0===t&&(t=Sk.ClipOp.kIntersect),p(e.rect,t)},r.clipRect=function(e){Sk.Rect.isValid(e),r.clipRRect({rect:e})},r.clearRect=function(e){},r.drawRRect=function(e,t){},r.fillText=function(e,t,r,n){},r.fillRect=function(e,t){},r.drawImageRect=function(t,r,n,o,i){var a;s&&t&&t instanceof Sk.Image&&t.getFrame(i)&&"blob:"!==(a=t.getFrame(i).getAttribute("src")).slice(0,5)&&(e=a)},r.getNode=function(){return t||(t=document.createElement("div"),Sk.isDebugEnabled()&&t.setAttribute("id","sv-hittest-raster"),document.body.appendChild(t)),t},r.drawPicture=function(t,n,l,d){var p,m,k,h,S=f(t.getCullRect());Sk.Rect.isValid(n)&&!function(e){return Sk.Rect.intersects(e,u())}(n)||((p=t.getHitTestData())&&(m={visual_rect:n,canvas_bounds:S,data:p,blobs:[]},p.node_uid,(k=i.get(p.node_uid))||(k=i.set(p.node_uid,[])),p.type===Sk.HT.ElementType.kImageElement&&(s=!0,h=c()),k.push(m),o.push(m),a.push(m)),r.save(),r.translate(t.getCullRect()[0],t.getCullRect()[1]),t.playback(r,{original_ctm:c().slice(0)}),r.restore(),p&&a.pop(),s&&(e||(e=g(t,n,h)),m.image_src=e),s=!1,e=null)},r.clipPath=function(e,t){p(e.bounds,t)},r.clipQuad=function(e,t){p(Sk.Rect.bboxRect(e),t)},r.drawPath=function(e,t){},r.drawTextBlob=function(e,t,r,n){var o=a[a.length-1],i={x:t,y:r,blob:e,paint:n,ctm:c().slice(0)};o&&o.blobs.push(i)},r.drawAnnotation=function(e,t){var r=a[a.length-1];r&&(r.border_box_rect=f(e))},r.drawPaint=function(e){},r.drawPoints=function(e,t,r,n){},r.usesRasterCache=function(){return!1},r.getItemMap=function(){return i},r.getItemList=function(){return o}},Sk.ImageLoader=function(e,t,r){"use strict";var n,o=new Sk.Logger("sk-image-loader",{level:"info"}),i=[[],[]],a=0,s=0;function l(e){return"blob:"===e.slice(0,5)}function c(e,n,i){var s=r;if(n.src&&n.completion_cb,e=e&&n.complete,l(n.src)?window.URL.revokeObjectURL(n.src):(a-=1,d()),n.onload=n.onerror=null,e)n.completion_cb(!0,n);else{if(i)return void 0===s&&(s=1e3*Math.pow(2,Math.max(0,t-i))),o.warn({event:"image-load-needs-retry",src:n.src,retries_left:i,delay_ms:s}),void setTimeout((function(){u(n.src,n.completion_cb,i-1)}),s);o.error({event:"image-load-failed",src:n.src}),n.completion_cb(!1,n)}}function u(e,r,n){var o=new Image;o.completion_cb=r,void 0===n&&(n=t),o.onload=c.curry(!0,o,n),o.onerror=c.curry(!1,o,n),o.src=e,l(e)||(a+=1,s+=1)}function d(t){var r,o,l,c=e(i,t,s),f=!1;for(n&&(clearTimeout(n),n=null),o=0;o<i.length;o+=1){for(l="number"==typeof c[o]?c[o]:Sk.defaultMaxConcurrentImageLoads;i[o].length&&a<l;)u((r=i[o].shift())[0],r[1]);i[o].length&&(f=!0)}f&&!n&&(n=setTimeout((function(){d(t)}),200))}this.submit=function(e,t,r,n){i.length,i[t].push([e,n]),d(r)},this.release=function(){n&&(clearTimeout(n),n=null)},void 0===t&&(t=Sk.defaultMaxImageLoadRetries)},Sk.Image=function(e,t,r,n,o,i,a){"use strict";var s,l=new Sk.Logger("sk-image",{level:"info"}),c=this,u=0,d=1,f=2,p={},g=0,m={},k=u,h=!0;function S(e){var t,r;for(t in k=f,h=e,m)m.hasOwnProperty(t)&&(r=m[t],delete m[t],r(c))}function y(e){return"blob:"===e.slice(0,5)}function v(e,t,n){if("number"==typeof e&&n.src&&n.complete,y(n.src)&&window.URL.revokeObjectURL(n.src),!t)return l.error({event:"image-load-failed",frame_idx:e,image:c.asDict()}),void S(!1);p[e],p[e]=n,(g+=1)===r&&(S(!0),c.asDict())}function b(e,t){var r,s=t,l=o;p[e]||(0===e&&(l=n),y(t)||(r=-1===t.indexOf("?")?"?":"&",s=t+r+"fi="+e+"&q="+l),i.submit(s,0===e?0:1,a,v.curry(e)))}c.setCompletionCallback=function(e,t){m[e]=t},c.startLoading=function(t){var n;if(k!==u)throw"load already pending or completed";if(c.asDict(),k=d,t&&c.setCompletionCallback("startLoading",t),y(e))b(0,e);else for(n=0;n<r;n+=1)b(n,e)},c.isComplete=function(){return k===f},c.isSuccess=function(){return!!h},c.asDict=function(){return{id:s,url:e,frame_count:r,load_state:k,load_success:h,nr_frames_loaded:g}},c.getId=function(){return s},c.getFrame=function(t){return c.isSuccess()?(y(e)&&(t=0),!c.isComplete()||p[t],c.asDict(),p[t]):null},c.getBlob=function(){return t},c.deduper={},y(e)&&(r=1),s=Sk.nextImageId,Sk.nextImageId+=1},Sk.ImagePool=function(){"use strict";var e={},t=(new Sk.Logger("sk-img-pool",{level:"info"}),{}),r={};function n(e,t){return Sk.Image,e.getBlob()?window.URL.createObjectURL(e.getBlob()):e.getFrame(t).src}return e.get=function(e,o,i,a){var s,l,c=[o.getId(),i,a].join(":"),u=t[c];return Sk.Image,u&&u.length?l=u.shift():a?(l=Sk.Util.createSVGElement("image")).setAttribute("href",n(o,i)):(l=new Image).src=n(o,i),l?(r.hasOwnProperty(e)||(r[e]={}),(s=r[e]).hasOwnProperty(c)||(s[c]=[]),s[c].push(l),l):null},e.put=function(e){var n=r[e];n&&(Sk.Util.forEachItem(n,(function(e){var r,o;for(t[e]||(t[e]=[]),r=0;r<n[e].length;r+=1)(o=n[e][r]).parentNode&&o.parentNode.removeChild(o),o.setAttribute("style",""),o instanceof SVGElement?o.setAttribute("transform",""):o.style.transform,t[e].length>20&&t[e].shift(),t[e].push(o);t[e].length})),delete r[e])},e}(),Sk.LRU=function(e,t){"use strict";var r,n,o=this,i=(new Sk.Logger("sk-lru",{level:"info"}),{}),a=0,s=0;o.size=function(){return a},o.cost=function(){return s},o.forEachEntry=function(e){var t;for(t in i)i.hasOwnProperty(t)&&e(t,i[t])},o.updateCost=function(t,r){var n=i[t];if(!n)throw"key not found";for(s-=n.cost,n.cost=r,s+=n.cost;s>e&&o.shift(););},o.reserve=function(t){for(;s+t>e;)if(!o.shift())return!1;return!0},o.add=function(t,l,c){var u=i[t];if(u)throw"entry already exists";if(null==c&&(c=1),c>e)return null;for(i[t]=u={key:t,value:l,cost:c},n?(n.newer=u,u.older=n):r=u,n=u,a+=1,s+=c;s>e;)o.shift();return u},o.peek=function(e){return i[e]},o.get=function(e){var t=i[e];if(t)return function(e){e!==n&&(e.newer&&(e===r&&(r=e.newer),e.newer.older=e.older),e.older&&(e.older.newer=e.newer),e.newer=null,e.older=n,n&&(n.newer=e),n=e)}(t),t},o.detach=function(e){var t=i[e];if(t)return t.newer&&t.older?(t.older.newer=t.newer,t.newer.older=t.older):t.newer?(t.newer.older=null,r=t.newer):t.older?(t.older.newer=null,n=t.older):r=n=null,delete i[e],a-=1,s-=t.cost,t},o.remove=function(e){var r=o.detach(e);if(r)return t&&t(r),r},o.shift=function(){return r?o.remove(r.key):null},o.clear=function(){for(;o.shift(););}},Sk.Matrix={isValid:function(e){"use strict";return"object"==typeof e&&9===e.length},identity:function(){return mat3.identity([])},isIdentity:function(e){return mat3.equals(e,mat3.identity([]))},isIdentityOrTranslation:function(e){return this.isValid(e),1===this.getScaleX(e)&&1===this.getScaleY(e)&&(0===this.getSkewX(e)&&0===this.getSkewY(e))},fromMat2D:function(e){var t=[];return e.length,mat3.fromMat2d(t,e),t},toMat2D:function(e){this.isValid(e);var t=[];return t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t[4]=e[6],t[5]=e[7],t},toMat2DStr:function(e){return"matrix("+this.toMat2D(e).join(",")+")"},makeScale:function(e,t){return mat3.fromScaling([],[e,t])},makeTranslation:function(e,t){return mat3.fromTranslation([],[e,t])},makeRectToRect:function(e,t){var r,n,o,i,a;return Sk.Rect.isEmpty(e)||Sk.Rect.isEmpty(t)?null:(o=Sk.Rect.getWidth(t)/Sk.Rect.getWidth(e),i=Sk.Rect.getHeight(t)/Sk.Rect.getHeight(e),a=this.makeScale(o,i),r=Sk.Rect.getLeft(t)-Sk.Rect.getLeft(e)*o,n=Sk.Rect.getTop(t)-Sk.Rect.getTop(e)*i,this.setTranslate(a,r,n),a)},multiply:function(e,t){var r=[];return e.length,t.length,mat3.multiply(r,e,t),r},postScale:function(e,t,r){var n=[];return mat3.multiply(n,this.makeScale(t,r),e),n},copy:function(e,t){e.length,t.length,mat3.copy(e,t)},getScaleX:function(e){return e[0]},getScaleY:function(e){return e[4]},getSkewX:function(e){return e[3]},getSkewY:function(e){return e[1]},getTranslateX:function(e){return e[6]},getTranslateY:function(e){return e[7]},setTranslate:function(e,t,r){e.length,e[6]=t,e[7]=r},hasPerspective:function(e){return e.length,0!==e[2]||0!==e[5]||1!==e[8]},getScaleSkewKey:function(e){function t(e){return Math.round(1024*e)/1024}return""+t(Sk.Matrix.getScaleX(e))+t(Sk.Matrix.getSkewX(e))+t(Sk.Matrix.getSkewY(e))+t(Sk.Matrix.getScaleY(e))},asString:function(e){return e.join(":")},getDecomposedScale:function(e){var t,r;return e.length,0===Sk.Matrix.getSkewX(e)&&0===Sk.Matrix.getSkewY(e)?(t=Sk.Matrix.getScaleX(e),r=Sk.Matrix.getScaleY(e)):Sk.Matrix.hasPerspective(e)?t=r=1:(t=vec2.length([Sk.Matrix.getScaleX(e),Sk.Matrix.getSkewY(e)]),r=vec2.length([Sk.Matrix.getSkewX(e),Sk.Matrix.getScaleY(e)])),[t,r]},mapVector:function(e,t,r){var n,o=[],i=[];return e.length,t.length,void 0!==r?(n=[(o=vec3.transformMat3(o,t,e))[0]/o[2],o[1]/o[2]],vec2.subtract(n,n,r)):(mat3.copy(i,e),Sk.Matrix.setTranslate(i,0,0),n=[(o=vec3.transformMat3(o,t,i))[0]/o[2],o[1]/o[2]]),n},mapRadius:function(e,t){var r,n,o,i,a=[t,0,1],s=[0,t,1];return e.length,Sk.Matrix.hasPerspective(e)&&(o=[(i=vec3.transformMat3(i,[0,0,1],e))[0]/i[2],i[1]/i[2]]),r=Sk.Matrix.mapVector(e,a,o),n=Sk.Matrix.mapVector(e,s,o),Math.sqrt(vec2.length(r)*vec2.length(n))},mapPoints:function(e,t){"use strict";var r,n,o,i,a=[];for(r=0;r<t.length;r+=1)o=[(n=t[r])[0],n[1],1],i=[],vec3.transformMat3(i,o,e),i[2]&&(i[2]=1/i[2]),a.push([i[0]*i[2],i[1]*i[2]]);return a},mapRect:function(e,t){"use strict";return Sk.Rect.bboxRect(Sk.Matrix.mapPoints(e,Sk.Rect.toQuad(t)))},isValid:function(e){"use strict";return"object"==typeof e&&9===e.length},isSizeEqual:function(e,t){return Sk.Rect.getWidth(e)===Sk.Rect.getWidth(t)&&Sk.Rect.getHeight(e)===Sk.Rect.getHeight(t)}},Sk.SafeviewRecording=function(e,t,r,n,o,i,a,s){"use strict";var l,c,u,d,f,p,g,m=this,k=new Sk.Logger("skr",{level:"info"}),h=0,S=0,y=!1;function v(e){Sk.fatal("SkSafeviewRecordingError",e)}function b(){t&&(t(m),t=null)}function C(e){S+=1,y&&h===S&&b()}function _(e,t,n){var s=n.readUint32(),l=s>>16,c=n.readByteArray(),u=e?null:new window.Blob([c],{type:"image/*"}),d=e?o(c):window.URL.createObjectURL(u),f=new Sk.Image(d,u,l,Sk.imageQuality[0],Sk.imageQuality[1],i,e&&!a);r.add(Sk.Deduper.Type.kImage,t,f),!e||a?(h+=1,f.startLoading((function(e){e.isComplete(),C()}))):f.startLoading()}function T(e,t){var n=t.bytesRead("readPathDef");r.add(Sk.Deduper.Type.kPath,e,n.object,n.bytes_read)}function w(e,t){var n=t.bytesRead("readGlyphDef");r.add(Sk.Deduper.Type.kGlyph,e,n.object,n.bytes_read)}function R(e,t){var n=t.bytesRead("readTextBlobDef");r.add(Sk.Deduper.Type.kTextBlob,e,n.object,n.bytes_read)}function x(e,t){var n=t.bytesRead("readPaintDef");r.add(Sk.Deduper.Type.kPaint,e,n.object,n.bytes_read)}function D(e,t){var n=t.bytesRead("readTypefaceDef");r.add(Sk.Deduper.Type.kTypeface,e,n.object,n.bytes_read)}function M(e,t){var n=t.bytesRead("readFontDataDef");r.add(Sk.Deduper.Type.kFontData,e,n.object,n.bytes_read)}function F(e,t,s){var l,c,u=s.readByteArray();h+=1,l=function(e,t){return new Sk.SafeviewRecording(e,C,r,n,o,i,a,t)}(u,t),r.add(Sk.Deduper.Type.kPicture,t,l,u.length),e&&(h+=1,c=Sk.Util.makeImageBlobFromU8Array(s.readByteArray()),new Sk.Image(window.URL.createObjectURL(c),c,1,Sk.imageQuality[0],Sk.imageQuality[1],i,!1).startLoading((function(e){l.setRasterImage(e),C()})))}function E(e,t){var r;t.typeface_id=e.readUint32(),r=e.readUint32(),t.font_generic_family=15&r,t.font_style=r>>4&15,t.font_weight=r>>8&65535,t.font_flags=r>>24&255,t.font_flags&Sk.HT.FontFlags.kHasStretchOrSpacing?(t.font_stretch=e.readFloat32(),t.letter_spacing=e.readFloat32(),t.word_spacing=e.readFloat32()):(t.font_stretch=100,t.letter_spacing=0,t.word_spacing=0)}function I(e){var t,r={};switch(r.display_item_type=e.readUint32(),r.type=e.readUint32(),r.flags=e.readUint32(),r.node_id=String(e.readInt32()),r.frame_token=Sk.Util.marshalFrameToken(e.readUint32(),e.readUint32()),r.node_uid=Sk.Util.getNodeKey(r.frame_token,r.node_id),r.owner_node_id=String(e.readInt32()),r.owner_node_uid=Sk.Util.getNodeKey(r.frame_token,r.owner_node_id),r.flags&Sk.HT.ElementFlags.kHasDebugData&&(r.debug_name=e.readString(),r.debug_item_type=e.readInt32()),r.flags&Sk.HT.ElementFlags.kHasLink&&(r.link_url=e.readString()),r.flags&Sk.HT.ElementFlags.kHasCursor&&(r.cursor=e.readUint32()),r.flags&Sk.HT.ElementFlags.kHasScrollableContainerId&&(r.scrollable_container_id=e.readUint32()),r.type){case Sk.HT.ElementType.kFormControl:r.formctrl=function(e){var t,r={};switch(t=e.readUint32(),r.type=65535&t,r.flags=t>>16&65535,r.id_attr=e.readString(),r.name_attr=e.readString(),r.autocomplete_attr=e.readString(),r.flags&Sk.HT.FormControlElement.Flags.kHasEnterKeyHint&&(r.enterkeyhint_attr=e.readString()),E(e,r),r.font_size=e.readInt32(),r.color=e.readUint32(),r.padding_left=e.readFloat32(),r.padding_top=e.readFloat32(),r.padding_right=e.readFloat32(),r.padding_bottom=e.readFloat32(),r.border_width_left=e.readFloat32(),r.border_width_top=e.readFloat32(),r.border_width_right=e.readFloat32(),r.border_width_bottom=e.readFloat32(),r.text_indent=e.readFloat32(),r.type){case Sk.HT.FormControlElement.Type.kInput:r.input={},t=e.readUint32(),r.input.type=65535&t,r.input.flags=t>>16&65535,r.input.flags&Sk.HT.InputElement.Flags.kIsBaseTemporal?(r.input.value=e.readFloat32(),r.input.min=e.readFloat32(),r.input.max=e.readFloat32()):r.input.type===Sk.HT.InputElement.Type.kColor&&(r.input.color=e.readUint32());break;case Sk.HT.FormControlElement.Type.kTextArea:r.textarea={},r.flags&Sk.HT.FormControlElement.Flags.kHasTextAreaInfo&&(t=e.readUint32(),r.textarea.flags=255&t,r.textarea.rows=t>>8&4095,r.textarea.cols=t>>20&4095);break;case Sk.HT.FormControlElement.Type.kContentEditable:r.contenteditable={};break;case Sk.HT.FormControlElement.Type.kSelect:r.select=function(e){var t,r,n,o=[],i=e.readUint32();for(t=0;t<i;t+=1)r={},n=e.readUint32(),r.type=15&n,r.flags=n>>4&4095,r.index=n>>16&65535,r.label=e.readString(),r.tool_tip=e.readString(),o.push(r);return{items:o}}(e)}return r}(e);break;case Sk.HT.ElementType.kTextNode:r.text=e.readString(),r.box_rect=e.readRect(),E(e,r);break;case Sk.HT.ElementType.kCustomScrollbarPart:r.custom_scrollbar_part={},t=e.readUint32(),r.custom_scrollbar_part.flags=t>>16&65535,r.custom_scrollbar_part.part=65535&t,r.custom_scrollbar_part.rect=e.readRect();break;case Sk.HT.ElementType.kElementNode:case Sk.HT.ElementType.kUnknown:case Sk.HT.ElementType.kInnerEditorElement:case Sk.HT.ElementType.kImageElement:case Sk.HT.ElementType.kHtmlElement:break;default:r.type}return r}function P(e,t,r){var n=r>>1&1,o=r>>2&15,i=t.readRRect(o);e.clipRRect(i,n)}function L(e,t,r){var n=t.readRRect(r),o=t.readPaint();e.drawRRect(n,o)}function O(e,t,r){var n=t.readRect(),o={rect:n,radii:Sk.Rect.getOvalRadii(n)},i=t.readPaint();e.drawRRect(o,i)}function A(e,t,r){var n=null,o=t.readImage(),i=t.readFloat32(),a=t.readFloat32(),s=Sk.Point.fromXY(i,a),l=r>>1&65535;r&Sk.DrawImageMask.HasPaint&&(n=t.readPaint()),e.drawImageRect(o,null,s,n,l)}function B(e,t,r){var n,o=null,i=null,a=null,s=(Sk.DrawImageRectMask.Constraint,r>>4&65535);i=r&Sk.DrawImageRectMask.UseRemoteSrc?"ClientCanvasSrc":t.readImage(),r&Sk.DrawImageRectMask.HasSrcRect&&(a=t.readRect()),n=t.readRect(),r&Sk.DrawImageRectMask.HasPaint&&(o=t.readPaint()),e.drawImageRect(i,a,n,o,s)}function H(e,t,r){var n={};r&Sk.SaveLayerMask.HasBounds&&(n.local_bounds=t.readRect()),r&Sk.SaveLayerMask.HasPaint&&(n.paint=t.readPaint()),r&Sk.SaveLayerMask.HasBackdrop&&(n.backdrop=t.readFlattenable()),r&Sk.SaveLayerMask.HasClipMask&&(n.clip_mask=t.readImage()),r&Sk.SaveLayerMask.HasClipMatrix&&(n.clip_matrix=t.readMatrix()),e.saveLayer(n,r)}function N(e,t,n){var o,i,a,s=n,l=r.get(Sk.Deduper.Type.kPicture,s);s?(l||v({event:"draw-picture-error",reason:"pic not found",index:s}),o=t.readRect(),n&Sk.DrawPictureMask.HasMatrix&&(a=t.readMatrix()),n&Sk.DrawPictureMask.HasPaint&&(i=t.readPaint()),e.drawPicture(l,o,a,i)):k.error({event:"draw-picture-error",reason:"index is 0 -- server encode error?",index:s})}function U(e,t,r){e.drawAnnotation(t.readRect())}function V(e,t,r){var n=t.readTextBlobByIndex(r),o=t.readFloat32(),i=t.readFloat32(),a=t.readPaint();e.drawTextBlob(n,o,i,a)}function z(e,t,r,n){var o=!!(r&Sk.TypeMask.SetMatrix),i=t.readSparseMatrix(r);o?e.setMatrix(i,n):e.concat(i)}function W(e,t,r){var n=t.readPathByIndex(r),o=t.readUint32(),i=o>>1&1;e.clipPath(n,i)}function G(e,t,r){var n=t.readPathByIndex(r),o=t.readPaint();e.drawPath(n,o)}function j(e,t,r){e.drawPaint(t.readPaint())}function Y(e,t,r){var n=t.readUint32(),o=[],i=t.readFloat32Array(2*n);Sk.Util.scalarArrayToPoints(o,i);e.drawPoints(r,n,o,t.readPaint())}m.getCullRect=function(){return l},m.playback=function(e,t){var r,n,o,i=d;for(i.reset();!i.eof();)switch(n=(r=i.readUint32())>>24&255,o=16777215&r,i.offset(),n){case Sk.Verb.ClipRect:case Sk.Verb.ClipRRect:P(e,i,n===Sk.Verb.ClipRRect?o:o|Sk.RRectType.kRect<<2);break;case Sk.Verb.ClipPath:W(e,i,o);break;case Sk.Verb.Save:e.save();break;case Sk.Verb.SaveLayer:H(e,i,o);break;case Sk.Verb.Restore:e.restore();break;case Sk.Verb.Concat:z(e,i,o,t?t.original_ctm:null);break;case Sk.Verb.DrawRect:case Sk.Verb.DrawRRect:L(e,i,n===Sk.Verb.DrawRRect?o:Sk.RRectType.kRect);break;case Sk.Verb.DrawOval:O(e,i);break;case Sk.Verb.DrawImage:A(e,i,o);break;case Sk.Verb.DrawImageRect:B(e,i,o);break;case Sk.Verb.DrawTextBlob:V(e,i,o);break;case Sk.Verb.DrawPath:G(e,i,o);break;case Sk.Verb.DrawPaint:j(e,i);break;case Sk.Verb.DrawPoints:Y(e,i,o);break;case Sk.Verb.DrawPicture:N(e,i,o);break;case Sk.Verb.DrawAnnotation:U(e,i);break;default:v({event:"unknown-draw-op",op:n})}},m.isSuitableForRasterCaching=function(e){return!(c&Sk.PictureFlags.kHasPictures)&&(!(c&Sk.PictureFlags.kHintDoNotCache)&&(!(c&Sk.PictureFlags.kHintDoNotRasterCache)&&(!(Sk.Rect.getArea(e.toDeviceBounds(l))>Sk.maxRasterArea)&&(!(c&Sk.PictureFlags.kHasImages)&&!!(c&(Sk.PictureFlags.kHasText|Sk.PictureFlags.kHasPaths))))))},m.getProperties=function(){return c},m.getHitTestData=function(){return u},m.getId=function(){return f},m.getMemoryUsage=function(){return e.length},m.getContentId=function(){return s},m.getRasterImage=function(){return p},m.setRasterImage=function(e){p=e},m.getRasterCache=function(){return n},m.getAssetCache=function(){return r},m.getCullRect=function(){return l},m.deduper={},g=new Sk.BinaryReader(e,r),f=Sk.nextRecordingId,Sk.nextRecordingId+=1,function(e){l=e.readRect()}(g),function(e){for(var t,n,o,i=!1;!i;)switch(o=16777215&(t=e.readUint32()),n=t>>24&255){case Sk.Verb.DefineImage:case Sk.Verb.DefineImageURL:_(n===Sk.Verb.DefineImageURL,o,e);break;case Sk.Verb.DefinePath:T(o,e);break;case Sk.Verb.DefineGlyph:w(o,e);break;case Sk.Verb.DefineTextBlob:R(o,e);break;case Sk.Verb.DefinePaint:x(o,e);break;case Sk.Verb.DefineTypeface:D(o,e);break;case Sk.Verb.DefineFontData:M(o,e);break;case Sk.Verb.DefinePicture:case Sk.Verb.DefineRasterPicture:F(n===Sk.Verb.DefineRasterPicture,o,e);break;case Sk.Verb.DefineDrawOps:c=o,d=new Sk.BinaryReader(e.readByteArray(),r);break;case Sk.Verb.DefineHitTestData:u=I(e);break;case Sk.Verb.EndDefinitions:i=!0;break;default:v({event:"unknown-definition-verb",verb:n})}y=!0,h===S&&b()}(g)},Sk.RasterCacheClass=function(){"use strict";var e=this,t=(new Sk.Logger("sk-raster-cache",{level:"info"}),Sk.canvasMemoryLimit.rcache),r=new Sk.LRU(t,(function(e){e.value.release()})),n={};function o(e,t){var n,o,i,a=e.getCullRect(),s=t.getCTM();return(n=function(e,t,n){var o={x:Sk.Rect.getX(e)/n,y:Sk.Rect.getY(e)/n},i=new Sk.HTMLCanvasDevice("rcache",e,o,n);for(Sk.Rect.getArea(e),Sk.maxRasterArea,r.reserve(i.getMemoryUsage());!i.tryAlloc();)if(!r.shift())return null;return Sk.Rect.isIntRect(e),Sk.Rect.getWidth(e),Sk.Rect.getHeight(e),i.setMatrix(Sk.Matrix.toMat2D(t)),i}(t.toDeviceBounds(a),s,t.getDeviceScaleFactor()))?((i=Sk.Util.copyDict(t.getOptions())).use_raster_cache=!1,(o=new Sk.Canvas(n,null,i)).setHostCanvas(t),o.clipRect(a),o.translate(Sk.Rect.getX(a),Sk.Rect.getY(a)),e.playback(o,{original_ctm:s}),Sk.getDebugFlags()&Sk.DebugFlags.kHighlightRasterCacheItems&&(o.fillRect(a,"rgba(0, 160, 200, 0.5)"),o.fillText(e.getId()+":"+n.getId(),Sk.Rect.getX(a),Sk.Rect.getY(a)+8)),n.setCanvas(null),o.setHostCanvas(null),o=null,n):null}e.getOrCreate=function(e,t,i){var a,s=e+":"+Sk.Matrix.getScaleSkewKey(i.getCTM())+":"+i.getDeviceScaleFactor(),l=r.get(s);return l?(n.hit_count+=1,l.value):(n.miss_count+=1,t.isSuitableForRasterCaching(i)&&(a=o(t,i)),a&&(r.remove(s),r.add(s,a,a.getMemoryUsage())||(a=null)),a)},e.remove=function(e){r.remove(e)},e.getMemoryUsage=function(){return r.cost()},e.flush=function(){r.clear(),(n={}).hit_count=0,n.miss_count=0},e.getStats=function(){return n}},Sk.CanvasEmitter=function(e){"use strict";this.emitVerb=function(t,r){switch(r.length,t){case Sk.PathVerb.kMove:r.length,e.moveTo(r[0][0],r[0][1]);break;case Sk.PathVerb.kClose:r.length,e.closePath();break;case Sk.PathVerb.kLine:r.length,e.lineTo(r[0][0],r[0][1]);break;case Sk.PathVerb.kQuad:r.length,e.quadraticCurveTo(r[0][0],r[0][1],r[1][0],r[1][1]);break;case Sk.PathVerb.kCubic:r.length,e.bezierCurveTo(r[0][0],r[0][1],r[1][0],r[1][1],r[2][0],r[2][1])}}},Sk.SVGEmitter=function(){"use strict";var e,t=this,r=[];t.setTransform=function(t){e=t},t.flushPathList=function(t){var n=r;return r=[],e=null,n},t.emitVerb=function(t,n){switch(n.length,t){case Sk.PathVerb.kMove:n.length,r.push("M");break;case Sk.PathVerb.kClose:n.length,r.push("Z");break;case Sk.PathVerb.kLine:n.length,r.push("L");break;case Sk.PathVerb.kQuad:n.length,r.push("Q");break;case Sk.PathVerb.kCubic:n.length,r.push("C")}!function(t,r){var n,o;for(e&&(r=Sk.Matrix.mapPoints(e,r)),n=0;n<r.length;n+=1)o=r[n],t.push(o[0].toFixed(3),o[1].toFixed(3))}(r,n)}},Sk.PathTools=function(e){"use strict";var t=this,r=(new Sk.Logger("sk-path-tools",{level:"info"}),Sk.Rect.resize(Sk.Rect.fromWH(10,10),1e6)),n=e.emitVerb;function o(e,t,r,o,i,a,s){var l,c=[e,t,r,o,i,a,s];(l=Sk.Conic.convertConicToQuads(c,1)).length,l[0],l[1],l[8],l[9],n(Sk.PathVerb.kQuad,[[l[2],l[3]],[l[4],l[5]]]),n(Sk.PathVerb.kQuad,[[l[6],l[7]],[l[8],l[9]]])}function i(e,t,r,i,a,s){var l=0;switch(e){case Sk.PathVerb.kLine:t[i],t[i+1],l=1,n(e,[[t[i],t[i+1]]]),r[0]=t[i],r[1]=t[i+1];break;case Sk.PathVerb.kQuad:t[i],t[i+1],t[i+a],t[i+a+1],l=2,n(e,[[t[i],t[i+1]],[t[i+a],t[i+a+1]]]),r[0]=t[i+a],r[1]=t[i+a+1];break;case Sk.PathVerb.kConic:t[i],t[i+1],t[i+a],t[i+a+1],l=2,o(r[0],r[1],t[i],t[i+1],t[i+a],t[i+a+1],s),r[0]=t[i+a],r[1]=t[i+a+1];break;case Sk.PathVerb.kCubic:t[i],t[i+1],t[i+a],t[i+a+1],t[i+2*a],t[i+2*a+1],l=3,n(e,[[t[i],t[i+1]],[t[i+a],t[i+a+1]],[t[i+2*a],t[i+2*a+1]]]),r[0]=t[i+2*a],r[1]=t[i+2*a+1]}return l}function a(e){var t,r,o,a=e.points_f32a,s=0,l=e.verbs_u8a,c=e.weights_f32a,u=0,d=[],f=[];for(r=0;r<l.length;r+=1){switch(l[r]){case Sk.PathVerb.kMove:a[s],a[s+1],t=1,n(l[r],[[a[s],a[s+1]]]),d[0]=f[0]=a[s],d[1]=f[1]=a[s+1];break;case Sk.PathVerb.kClose:f[0],f[1],t=0,n(l[r],[]),d[0]=f[0],d[1]=f[1];break;case Sk.PathVerb.kConic:e.weight_count,o=c[u],u+=1,t=i(l[r],a,d,s,2,o);break;default:t=i(l[r],a,d,s,2,o)}s+=2*t,o=void 0}}function s(e,t){var r,o,i=e.length;for(n(Sk.PathVerb.kMove,[e[0]]),r=1;r<i;r+=1)o=t?e[i-r]:e[r],n(Sk.PathVerb.kLine,[o])}function l(){t.drawRRectPath({rect:r},!1)}t.drawRRectPath=function(e,t){var r,i,a,s,l,c,u,d,f=Sk.Rect.getX(e.rect),p=Sk.Rect.getY(e.rect),g=Sk.Rect.getRight(e.rect),m=Sk.Rect.getBottom(e.rect),k=[];if(Sk.Radii.isValid(e.radii)){for(r=Sk.Radii.getUpperLeftX(e.radii),i=Sk.Radii.getUpperLeftY(e.radii),a=Sk.Radii.getUpperRightX(e.radii),s=Sk.Radii.getUpperRightY(e.radii),l=Sk.Radii.getLowerRightX(e.radii),k=[f,p+i,f,p,f+r,p,g-a,p,g,p,g,p+s,g,m-Sk.Radii.getLowerRightY(e.radii),g,m,g-l,m,f+Sk.Radii.getLowerLeftX(e.radii),m,f,m,f,m-Sk.Radii.getLowerLeftY(e.radii)],!0===t?(u=k.length-2,d=-2):(u=0,d=2),n(Sk.PathVerb.kMove,[[k[u],k[u+1]]]),c=u;o(k[c],k[c+1],k[c+d],k[c+d+1],k[c+2*d],k[c+2*d+1],.707106781),!((c+=3*d)<0||c>=k.length);)n(Sk.PathVerb.kLine,[[k[c],k[c+1]]]);n(Sk.PathVerb.kLine,[[k[u],k[u+1]]])}else n(Sk.PathVerb.kMove,[[f,p]]),t?(n(Sk.PathVerb.kLine,[[f,m]]),n(Sk.PathVerb.kLine,[[g,m]]),n(Sk.PathVerb.kLine,[[g,p]])):(n(Sk.PathVerb.kLine,[[g,p]]),n(Sk.PathVerb.kLine,[[g,m]]),n(Sk.PathVerb.kLine,[[f,m]])),n(Sk.PathVerb.kLine,[[f,p]])},t.drawPointsPath=s,t.drawRRect=function(e,r){r===Sk.ClipOp.kIntersect||Sk.ClipOp.kDifference;var n=r===Sk.ClipOp.kDifference;n&&l(),t.drawRRectPath(e,n)},t.drawQuad=function(e,t){t===Sk.ClipOp.kIntersect||Sk.ClipOp.kDifference;var r=t===Sk.ClipOp.kDifference;r&&l(),s(e,r)},t.drawPath=function(e,t){if(t===Sk.ClipOp.kIntersect||Sk.ClipOp.kDifference,t===Sk.ClipOp.kDifference)return l(),e.first_direction,void(e.first_direction===Sk.PathDirection.kCCW_Direction?a(e):function(e){var t,r,o,a,s=e.points_f32a,l=e.verbs_u8a,c=e.weights_f32a,u=e.weight_count-1,d=[],f=[],p=!1,g=!0;for(l&&l.length,s&&s.length,r=s.length-2,o=l.length-1;o>=0;o-=1){switch(g&&(n(Sk.PathVerb.kMove,[[s[r],s[r+1]]]),d[0]=f[0]=s[r],d[1]=f[1]=s[r+1],g=!1),l[o]){case Sk.PathVerb.kMove:s[r],s[r+1],t=1,p&&(n(Sk.PathVerb.kClose,[]),p=!1),g=!0;break;case Sk.PathVerb.kClose:f[0],f[1],t=0,p=!0;break;case Sk.PathVerb.kConic:a=c[u],u-=1,t=i(l[o],s,d,r-2,-2,a);break;default:t=i(l[o],s,d,r-2,-2,a)}r-=2*t,a=void 0}}(e));a(e)}},Sk.Font=function(){"use strict";var e={};new Sk.Logger("sk-font",{level:"info"});function t(e){switch(e){case Sk.HT.FontStyle.kNormal:return"normal";case Sk.HT.FontStyle.kItalic:return"italic";case Sk.HT.FontStyle.kOblique:return"oblique";default:return""}}function r(e){switch(e){case 400:return"normal";case 700:return"bold";default:return String(e)}}return e.getFamilyName=function(e,t){return["Face",e,t].join("_")},e.toCSSFont=function(n,o,i,a,s){var l=[];return l.push('"'+e.getFamilyName(s,a)+'"'),l.push(function(e){switch(e){case Sk.HT.GenericFontFamily.kNoFamily:case Sk.HT.GenericFontFamily.kStandardFamily:case Sk.HT.GenericFontFamily.kSansSerifFamily:return"sans-serif";case Sk.HT.GenericFontFamily.kSerifFamily:return"serif";case Sk.HT.GenericFontFamily.kMonospaceFamily:return"monospace";case Sk.HT.GenericFontFamily.kCursiveFamily:return"cursive";case Sk.HT.GenericFontFamily.kFantasyFamily:return"fantasy";default:return""}}(n.font_generic_family)),[t(n.font_style),r(n.font_weight),o+"px / "+i+"px",l.join(",")].join(" ")},e.applyFontStyle=function(t,r,n,o,i,a){t.style.font=e.toCSSFont(r,n,o,i,a),r.font_flags&Sk.HT.FontFlags.kHasStretchOrSpacing&&(t.style.fontStretch=r.font_stretch+"%",t.style.letterSpacing=r.letter_spacing+"px",t.style.wordSpacing=r.word_spacing+"px"),r.font_flags&Sk.HT.FontFlags.kAntialiased&&(t.style.webkitFontSmoothing="antialiased"),r.font_flags&Sk.HT.FontFlags.kRightToLeft&&(t.style.direction="rtl"),r.font_flags&Sk.HT.FontFlags.kUseKerning||(t.style.fontKerning="none"),r.font_flags&Sk.HT.FontFlags.kSmallCaps&&(t.style.fontVariant="small-caps"),t.style.width=null,t.style.height=null,t.style.padding=t.style.margin="0px",t.style.whiteSpace="pre",t.style.boxSizing="border-box"},e}(),Sk.TextBlobIterator=function(e){"use strict";var t=this;function r(t){var r,n,o=t.glyph_reader,i={};switch(t.positioning){case Sk.GlyphPositioning.kDefault:case Sk.GlyphPositioning.kHorizontal:r=o.readFloat32(),n=t.offset[1];break;case Sk.GlyphPositioning.kFull:r=o.readFloat32(),n=o.readFloat32()}return i.x_pos=r,i.y_pos=n,i.glyph=o.readGlyphByIndex(void 0,e),i}t.forEachGlyph=function(e,t,n,o){var i,a;for(e.glyph_reader.reset(),i=0;i<e.glyph_count;i+=1)o((a=r(e)).glyph,t+a.x_pos,n+a.y_pos)},t.readGlyphAtIndex=function(e,t){var n=e.glyph_reader,o=e.positioning===Sk.GlyphPositioning.kFull?8:4;return o+=4,n.reset(),n.skip(t*o),r(e)},t.forEachRun=function(e,r,n,o){var i,a,s=null===r||Sk.Util.copyDict(r);for(o=void 0!==o?Math.min(e.runs.length,o):e.runs.length,i=0;i<o;i+=1)a=e.runs[i],null!==r&&Sk.Paint.applyTextRunPaint(s,a.paint),n(t,a,s)}},Sk.TextUtils=function(){"use strict";var e={},t=(new Sk.Logger("sk-text-fitter",{level:"info"}),document.createElement("canvas"));function r(e,r,n){var o=function(e,r){var n,o=t.getContext("2d");return o.font=r,void 0!==(n=o.measureText(function(e){var t,r="",n=!1;for(t=e.length-1;t>=0;t-=1)" "!==e[t]||n?(r=e[t]+r,n=!0):r="l"+r;return r}(e))).actualBoundingBoxLeft?Math.abs(n.actualBoundingBoxLeft)+Math.abs(n.actualBoundingBoxRight):(n.width,n.width)}(e,r);return o+=n*e.length,Number.isFinite(o),o}return e.getBestUnderfit=function(e,t,n,o,i,a,s){var l,c,u=o,d=Number.MAX_SAFE_INTEGER;do{c=(i+o)/2,(l=r(e,Sk.Font.toCSSFont(n,c,Sk.Rect.getHeight(t),a,s),n.letter_spacing)-Sk.Rect.getWidth(t))<=0?(o=c+.1,Math.abs(l)<Math.abs(d)&&(d=l,u=c)):i=c-.1}while(o<i&&0!==l);return{size:u,delta:d}},e}(),Sk.TextFitter=function(e,t){"use strict";var r,n,o=this,i=(new Sk.Logger("sk-dom",{level:"info"}),[]);function a(e,r,n,o,i){Sk.Font.applyFontStyle(e,r,i,Sk.Rect.getHeight(n),o,t),e.textContent=r.text}function s(e){var r,o=e.target,i=e.contentRect.width;o&&o.parentNode&&o.run_bounds&&(r=i-Sk.Rect.getWidth(o.run_bounds),Math.abs(r)<=3||(!function(e,r,n,o,i){var s;r.text.length&&(i>0&&(s=Sk.TextUtils.getBestUnderfit(r.text,n,r,1,o.textSize,o.typeface.id,t),a(e,r,n,o.typeface.id,s.size),i=s.delta,Sk.isDebugEnabled()&&(e.style.backgroundColor="rgba(173,216,230,0.6)")),i<0&&(e.style.letterSpacing=r.letter_spacing+Math.abs(i)/r.text.length+"px",Sk.isDebugEnabled()&&(e.style.backgroundColor="rgba(173,216,230,0.6)")))}(o,o.htd,o.run_bounds,o.paint,r),n.unobserve(o)))}function l(e){e.forEach(s)}function c(){i.forEach((function(e){a(e,e.htd,e.run_bounds,e.paint.typeface.id,e.paint.textSize),n.observe(e)}))}o.registerDiv=function(e){a(e,e.htd,e.run_bounds,e.paint.typeface.id,e.paint.textSize),i.push(e),n&&n.observe(e)},o.reset=function(){n&&(n.disconnect(),e.deregisterCallback(r)),window.ResizeObserver&&(i=[],n=new window.ResizeObserver(l),e.registerCallback(r,c))},o.release=function(){i=null,n&&(n.disconnect(),n=null,e.deregisterCallback(r))},r="tld:"+Sk.nextTextFitterId,Sk.nextTextFitterId+=1,o.reset()},Sk.HTMLPaintApplicator=function(e){"use strict";new Sk.Logger("sk-html-paint",{level:"info"});function t(e,t,r){t.linear_gradient||t.radial_gradient,t.linear_gradient?function(e,t,r){var n,o,i,a,s,l,c,u,d={x:t.start[0]-t.end[0],y:t.start[1]-t.end[1]};for(t.colors.length,i=1/(t.colors.length-1),o="linear-gradient("+Compositor.Offset.angleBetween({x:0,y:1},d,!0)+"deg",n=0;n<t.colors.length;++n)o+=","+Sk.Paint.skColorToCSSColor(t.colors[n])+" ",o+=100*(t.position?t.position[n]:i*n)+"%";e.style.backgroundImage=o+")",t.gradient_size&&(t.gradient_size.length,c=Sk.Rect.getLeft(r),u=Sk.Rect.getTop(r),a=Sk.Rect.bboxRect([t.start,t.end]),s=Sk.Rect.getCenter(a),0===d.x?(s[0]=t.gradient_size[0]/2,c=0):0===d.y&&(s[1]=t.gradient_size[1]/2,u=0),l=Sk.Rect.makeFromMidpoint({x:s[0],y:s[1]},t.gradient_size[0]/2,t.gradient_size[1]/2),Sk.Rect.translate(l,-c,-u),e.style.backgroundPosition=Sk.Rect.getLeft(l)+"px "+Sk.Rect.getTop(l)+"px",e.style.backgroundSize=t.gradient_size[0]+"px "+t.gradient_size[1]+"px")}(e,t.linear_gradient,r):function(e,t,r){var n,o,i,a,s,l,c=t.center,u=t.radius,d=[];for(t.colors.length,i=1/(t.colors.length-1),t.transform?(d=Sk.Matrix.fromMat2D(t.transform),l=Sk.Matrix.makeTranslation(-Sk.Rect.getLeft(r),-Sk.Rect.getTop(r)),d=Sk.Matrix.multiply(l,d),c=Sk.Matrix.mapPoints(d,[c])[0],a=Sk.Matrix.getScaleX(d),s=Sk.Matrix.getScaleY(d)):a=s=1,o=a===s?"radial-gradient("+u+"px circle at "+c[0]+"px "+c[1]+"px":"radial-gradient("+u*a+"px "+u*s+"px ellipse at "+c[0]+"px "+c[1]+"px",n=0;n<t.colors.length;++n)o+=","+Sk.Paint.skColorToCSSColor(t.colors[n])+" ",o+=100*(t.position?t.position[n]:i*n)+"%";e.style.backgroundImage=o+")"}(e,t.radial_gradient,r)}this.applyPaint=function(r,n,o,i,a){return HTMLElement,!!function(t){var r;return!(t.shader&&!((r=t.shader.linear_gradient||t.shader.radial_gradient)&&r.interpolate_in_premul&&e.isCSSGradientsAllowed()))&&t.strokeCap===Sk.Paint.Cap.kButt&&t.strokeJoin===Sk.Paint.Join.kMiter}(n)&&(i&(Sk.PaintUsage.kGeometry|Sk.PaintUsage.kPaint)&&function(e,r,n){var o=r.strokeWidth||1;r.style!==Sk.Paint.Style.kFill_Style&&r.style!==Sk.Paint.Style.kStrokeAndFill_Style||(r.shader?t(e,r.shader,n):e.style.backgroundColor=r.cssColor),r.style!==Sk.Paint.Style.kStroke_Style&&r.style!==Sk.Paint.Style.kStrokeAndFill_Style||(e.style.border=o+"px solid "+r.cssColor)}(r,n,a),i&Sk.PaintUsage.kText&&function(e,t){var r=t.strokeWidth||1;t.shader,t.style!==Sk.Paint.Style.kFill_Style&&t.style!==Sk.Paint.Style.kStrokeAndFill_Style?(t.style,Sk.Paint.Style.kStroke_Style,void 0!==e.style.webkitTextStrokeWidth&&e.style.webkitTextStrokeColor,e.style.webkitTextStrokeWidth=r+"px",e.style.webkitTextStrokeColor=t.cssColor,e.style.webkitTextFillColor="rgba(0,0,0,0)"):e.style.color=t.cssColor}(r,n),i&Sk.PaintUsage.kImage&&(n.shader,1!==n.alphaFloat&&(r.style.opacity=String(n.alphaFloat))),Sk.Paint.applyBlendMode(r,n),function(e,t,r){t.color_filter&&(e.style.filter,e.style.backgroundColor=Sk.Paint.skColorToCSSColor(t.color_filter.color),e.style.filter="blur("+Sk.Paint.getShadowSigma(t,r)+"px)")}(r,n,o),function(t,r,n){var o,i=e.generateResourceId();r.image_filter&&(o=Sk.SVGFilterHelper.buildWith(r.image_filter,n))&&(o.setAttribute("id",i),e.getDefs().appendChild(o),t.style.filter=Sk.Util.urlWrap("#"+i))}(r,n,o),!0)}},Sk.SVGPaintApplicator=function(e){"use strict";new Sk.Logger("sk-svg-paint",{level:"info"});function t(t){var r=Sk.Util.createSVGElement(t),n=e.generateResourceId();return r.setAttribute("id",n),r}function r(r,n){var o,i,a,s,l,c=n.shader;return c?(Sk.isDebugEnabled()&&r.setAttribute("shader",JSON.stringify(c)),c.linear_gradient?o=function(e,r){var n,o,i=t("linearGradient"),a=1/(r.colors.length-1);for(i.setAttribute("x1",r.start[0]+"px"),i.setAttribute("y1",r.start[1]+"px"),i.setAttribute("x2",r.end[0]+"px"),i.setAttribute("y2",r.end[1]+"px"),i.setAttribute("gradientUnits","userSpaceOnUse"),o=0;o<r.colors.length;o+=1)(n=Sk.Util.createSVGElement("stop")).setAttribute("offset",100*(r.position?r.position[o]:a*o)+"%"),n.setAttribute("stop-color",Sk.Paint.skColorToCSSColor(r.colors[o])),i.appendChild(n);return i}(0,c.linear_gradient):c.radial_gradient?o=function(e,r){var n,o,i=t("radialGradient"),a=1/(r.colors.length-1);for(i.setAttribute("fx",r.center[0]+"px"),i.setAttribute("fy",r.center[1]+"px"),i.setAttribute("cx",r.center[0]+"px"),i.setAttribute("cy",r.center[1]+"px"),i.setAttribute("r",r.radius+"px"),i.setAttribute("gradientUnits","userSpaceOnUse"),o=0;o<r.colors.length;o+=1)(n=Sk.Util.createSVGElement("stop")).setAttribute("offset",100*(r.position?r.position[o]:a*o)+"%"),n.setAttribute("stop-color",Sk.Paint.skColorToCSSColor(r.colors[o])),i.appendChild(n);return r.transform&&i.setAttribute("gradientTransform",Sk.Util.toSVGTransformAttribute(r.transform)),i}(0,c.radial_gradient):c.image?(i=c.image,s=i.image,l=s.getFrame(0),Sk.Image,o=s.isComplete()?((a=t("pattern")).appendChild(Sk.ImagePool.get(e.getRootDevice().getId(),s,0,!0)),a.setAttribute("x","0"),a.setAttribute("y","0"),a.setAttribute("width",l.naturalWidth),a.setAttribute("height",l.naturalHeight),a.setAttribute("patternUnits","userSpaceOnUse"),a.setAttribute("patternContentUnits","userSpaceOnUse"),a.setAttribute("patternTransform",Sk.Matrix.toMat2DStr(Sk.Matrix.fromMat2D(i.matrix))),a):(e.getCanvas().setNeedsRedrawOnLoad(s,Sk.Rect.makeLargest()),null)):c.picture&&(o=function(r,n){var o,i,a=n.tile;return(i=e.getCanvas().rasterShader(n))?(Sk.HTMLCanvasDevice,i.toDataURL((function(e){var r;o=t("pattern"),(r=t("image")).setAttribute("x","0"),r.setAttribute("y","0"),r.setAttribute("width",Sk.Rect.getWidth(a)),r.setAttribute("height",Sk.Rect.getHeight(a)),r.setAttribute("href",e),o.appendChild(r),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("width",Sk.Rect.getWidth(a)),o.setAttribute("height",Sk.Rect.getHeight(a)),o.setAttribute("patternUnits","userSpaceOnUse"),o.setAttribute("patternContentUnits","userSpaceOnUse"),o.setAttribute("patternTransform",Sk.Matrix.toMat2DStr(Sk.Matrix.fromMat2D(n.matrix)))})),i.release(),i=null,o):null}(0,c.picture)),o&&e.getDefs().appendChild(o),o):null}function n(e,t){var r=e.getAttribute("visibility");BrowserDetect.isSafari()&&"pattern"===t.tagName&&(e.setAttribute("visibility","hidden"),setTimeout((function(){e.setAttribute("visibility",r)}),0))}this.applyPaint=function(o,i,a,s){return SVGElement,s&(Sk.PaintUsage.kGeometry|Sk.PaintUsage.kPaint|Sk.PaintUsage.kText)&&function(e,t){var o=t.strokeWidth,i=r(e,t);t.style===Sk.Paint.Style.kFill_Style||t.style===Sk.Paint.Style.kStrokeAndFill_Style?i?(e.setAttribute("fill",Sk.Util.urlWrap("#"+i.getAttribute("id"))),1!==t.alphaFloat&&e.setAttribute("fill-opacity",String(t.alphaFloat)),n(e,i)):e.setAttribute("fill",t.cssColor):e.setAttribute("fill","none"),t.style===Sk.Paint.Style.kStroke_Style||t.style===Sk.Paint.Style.kStrokeAndFill_Style?(i?(e.setAttribute("stroke",Sk.Util.urlWrap("#"+i.getAttribute("id"))),1!==t.alphaFloat&&e.setAttribute("stroke-opacity",String(t.alphaFloat)),n(e,i)):e.setAttribute("stroke",t.cssColor),0===o&&(o=1,e.setAttribute("vector-effect","non-scaling-stroke")),e.setAttribute("stroke-width",o),e.setAttribute("stroke-linecap",t.strokeCapStr),e.setAttribute("stroke-join",t.strokeJoinStr),t.strokeJoin===Sk.Paint.Join.kMiter&&e.setAttribute("stroke-miterlimit",t.strokeMiter),t.path_effect&&(e.setAttribute("stroke-dashoffset",t.path_effect.phase),e.setAttribute("stroke-dasharray",t.path_effect.intervals.join(" ")))):e.setAttribute("stroke","none")}(o,i),s&Sk.PaintUsage.kImage&&1!==i.alphaFloat&&(o.style.opacity=String(i.alphaFloat)),Sk.Paint.applyBlendMode(o,i),function(r,n,o){var i,a;n.color_filter&&((i=t("filter")).setAttribute("x","-20%"),i.setAttribute("y","-40%"),i.setAttribute("width","140%"),i.setAttribute("height","160%"),(a=Sk.Util.createSVGElement("feGaussianBlur")).setAttribute("stdDeviation",String(Sk.Paint.getShadowSigma(n,o))),i.appendChild(a),e.getDefs().appendChild(i),r.style.filter=Sk.Util.urlWrap("#"+i.getAttribute("id")),r.setAttribute("fill",Sk.Paint.skColorToCSSColor(n.color_filter.color)))}(o,i,a),function(t,r,n){var o,i=e.generateResourceId();r.image_filter&&(o=Sk.SVGFilterHelper.buildWith(r.image_filter,n))&&(o.setAttribute("id",i),e.getDefs().appendChild(o),t.style.filter=Sk.Util.urlWrap("#"+i))}(o,i,a),!0}},Sk.DOMDevice=function(e,t,r,n,o,i,a,s){"use strict";var l,c,u,d,f,p,g,m,k,h=this,S=(new Sk.Logger("sk-dom",{level:"info"}),Sk.Rect.fromWH(Sk.Rect.getWidth(t),Sk.Rect.getHeight(t))),y=new Sk.SVGEmitter,v=new Sk.PathTools(y),b=new Sk.TextBlobIterator(!0),C=new Sk.HTMLPaintApplicator(h),_=new Sk.SVGPaintApplicator(h),T=0,w=0,R=-1;function x(){return d[d.length-1]}function D(){return x().ctm}function M(){var e=document.createElement("div");return e.style.position="absolute",e.style.padding=e.style.margin="0px",e.style.boxSizing="border-box",e}function F(e){return f.createElement(e)}function E(e,t,r){e.setAttributeNS(null,t,r)}function I(e,t,r,n){return e instanceof SVGElement?_.applyPaint(e,t,D(),r):C.applyPaint(e,t,D(),r,n)}function P(e,t,r){Sk.Matrix.isIdentity(t)||(e instanceof SVGElement?e.setAttribute("transform",Sk.Matrix.toMat2DStr(t)):(Element,e.style.position,e.style.transform=Sk.Matrix.toMat2DStr(t),e.style.transformOrigin=void 0!==r?-Sk.Rect.getLeft(r)+"px "+-Sk.Rect.getTop(r)+"px":"0px 0px 0px"))}function L(e,t){"svg"===e.localName.toLowerCase()||(e.namespaceURI,u.namespaceURI),e.parentNode,Sk.isDebugEnabled()&&t&&(e.id=["op",c,w,t].join("-"),e.setAttribute("detail",t),w+=1),u.appendChild(e)}function O(e,r){var n=Sk.Util.createSVGRootElement(Sk.Rect.getWidth(t),Sk.Rect.getHeight(t)),o=n;n.style.position="absolute",n.style.top="0px",n.style.left="0px",Sk.Matrix.isIdentity(D())||(P(o=F("g"),D()),n.appendChild(o)),r(o),L(n,e)}function A(e,t){var r,n=F("path");return void 0===t&&(t=Sk.FillRule.kWinding),r=Sk.Paint.skFillRuleToCanvasFillRule(t),E(n,"d",e.join(" ")),E(n,"clip-rule",r),E(n,"fill-rule",r),n}function B(){var e=M();return e.style.left="0px",e.style.top="0px",e.style.width="auto",e.style.height="auto",e}function H(e,t){var r,o,i=B();i.style.clipPath,i.style.clipPath=n?'path("'+e.join(" ")+'")':Sk.Util.urlWrap("#"+(r=A(e),o=F("clipPath"),r&&SVGElement,o.id=["cl",c,T].join("-"),T+=1,o.appendChild(r),g.appendChild(o),o.id)),L(i,t),u=i}function N(e,t,r,n){O(n,(function(n){var o=A(e,t);I(o,r,Sk.PaintUsage.kGeometry),n.appendChild(o)}))}function U(e,t){var r=t.strokeWidth;return r>0?Sk.Rect.resize(e,r/2):e}function V(e,t,r){var n=M(),o=U(e,t);if(I(n,t,Sk.PaintUsage.kGeometry,o))return Sk.Rect.toCSSStyle(o,n.style),P(n,D(),o),void L(n,r);O(r,(function(r){var n=F("rect");I(n,t,Sk.PaintUsage.kGeometry),E(n,"x",Sk.Rect.getX(e)),E(n,"y",Sk.Rect.getY(e)),E(n,"width",Sk.Rect.getWidth(e)),E(n,"height",Sk.Rect.getHeight(e)),r.appendChild(n)}))}function z(e,t,r){var n=M(),o=U(e.rect,t);return!!I(n,t,Sk.PaintUsage.kGeometry,o)&&(Sk.Rect.toCSSStyle(o,n.style),e.radii&&Sk.Radii.toCSSStyle(function(e,t){var r=t.strokeWidth;return r>0?Sk.Radii.resize(e,r/2):e}(e.radii,t),n.style),P(n,D(),o),L(n,r),!0)}function W(){return!!i&&(!(!p||!p.text)&&((e=p).type!==Sk.HT.ElementType.kTextNode||!(e.flags&Sk.HT.ElementFlags.kHasContentEditableOwner||e.flags&Sk.HT.ElementFlags.kInShadowTree&&(e.flags&Sk.HT.ElementFlags.kHasInputElementOwner||e.flags&Sk.HT.ElementFlags.kHasTextAreaOwner)&&!(e.flags&Sk.HT.ElementFlags.kIsPlaceholderText))));var e}function G(){!function(e){var t;for(t=e.childNodes.length-1;t>=0;t-=1)e.removeChild(e.childNodes[t]);e.childNodes.length}(l),f=Sk.Util.createSVGRootElement(Sk.Rect.getWidth(t),Sk.Rect.getHeight(t)),g=f.createElement("defs"),f.appendChild(g),l.appendChild(f),T=0,u=l,d=[{ctm:Sk.Matrix.makeTranslation(-r.x,-r.y),saved_cursor:u}],g.parentNode,f.parentNode,g.parentNode,i&&i.reset()}h.isCSSGradientsAllowed=function(){return o},h.save=function(){d.push({ctm:Sk.Util.copyArray(D()),saved_cursor:u})},h.restore=function(){d.length,d.length>1&&(u=d.pop().saved_cursor)},h.concat=function(e){x().ctm=Sk.Matrix.multiply(D(),Sk.Matrix.fromMat2D(e))},h.setMatrix=function(e,t){var n=Sk.Matrix.makeTranslation(-r.x,-r.y);t&&(n=Sk.Matrix.multiply(n,t)),n=Sk.Matrix.multiply(n,Sk.Matrix.fromMat2D(e)),x().ctm=n},h.translate=function(e,t){x().ctm=Sk.Matrix.multiply(D(),Sk.Matrix.makeTranslation(e,t))},h.scale=function(e,t){x().ctm=Sk.Matrix.multiply(D(),Sk.Matrix.makeScale(e,t))},h.clipRRect=function(e,r){var n,o,i,a=Sk.Matrix.mapPoints(D(),Sk.Rect.toQuad(e.rect));if(Sk.Quad.isRect(a)&&!Sk.Radii.isValid(e.radii)&&r===Sk.ClipOp.kIntersect)return n=Sk.Rect.bboxRect(a),o="clipRect",void(Sk.Rect.contains(n,t)||((i=B()).style.clip=Sk.Rect.toCSSClip(n),L(i,o),u=i));y.setTransform(D()),v.drawRRect(e,r),H(y.flushPathList(),"clipRRect")},h.clipRect=function(e,t){h.clipRRect({rect:e},t)},h.clipPath=function(e,t){y.setTransform(D()),v.drawPath(e,t),H(y.flushPathList(),"clipPath")},h.clipQuad=function(e,t){t===Sk.ClipOp.kIntersect||Sk.ClipOp.kDifference,e.length,Sk.Quad.isRect(e)?h.clipRect(Sk.Rect.fromQuad(e),t):(y.setTransform(D()),v.drawQuad(e,t),H(y.flushPathList(),"clipQuad"))},h.drawPath=function(e,t,r,n,o){h.save(),void 0!==r&&h.translate(r.x,r.y),void 0!==n&&h.scale(n,n),e.fill_rule,v.drawPath(e,Sk.ClipOp.kIntersect),N(y.flushPathList(),e.fill_rule,t,"drawPath"),h.restore()},h.drawRRect=function(e,t){e.radii?z(e,t,"drawRRect")||(v.drawRRect(e,Sk.ClipOp.kIntersect),N(y.flushPathList(),void 0,t,"drawRRect")):V(e.rect,t,"drawRect")},h.drawPaint=function(e){h.save(),x().ctm=Sk.Matrix.identity(),V(h.getSizeRect(),e,"drawPaint"),h.restore()},h.drawPoints=function(e,t,r,n){Sk.PointMode.kLines,v.drawPointsPath(r),N(y.flushPathList(),Sk.FillRule.kWinding,n,"drawPoints")},h.drawTextBlob=function(e,t,r,n){e.runs.length&&(W()?function(e,t,r,n){var o=p.box_rect;b.forEachRun(e,n,(function(e,t,r){var n=M();h.drawDebugRect(o,"rgba(150,150,150,0.3)"),Sk.Rect.toCSSStyle(o,n.style),I(n,r,Sk.PaintUsage.kText),r.textSize,P(n,D(),o),n.run_bounds=o,n.htd=p,n.paint=r,i.registerDiv(n),L(n,"TextRun")}),1)}(e,0,0,n):function(e,t,r,n){O("drawTextBlobAsSVG",(function(o){b.forEachRun(e,n,(function(e,n,i){var a,l=Sk.Paint.getTextScale(i);n.glyph_count&&(I(a=F("g"),i,Sk.PaintUsage.kText),e.forEachGlyph(n,t,r,(function(e,t,r){var n=F("use");e.deduper.index,n.setAttribute("href","#glyph-"+s+":"+e.deduper.index),n.setAttribute("transform","translate("+[t,r].join(" ")+") scale("+l+")"),a.appendChild(n)})),o.appendChild(a))}))}))}(e,t,r,n))},h.clearRect=function(e){},h.drawImageRect=function(e,t,r,n,o){var i=Sk.ImagePool.get(a.getId(),e,o,!1),s=Sk.Matrix.makeRectToRect(t,r);HTMLImageElement,i.src,i.style.position="absolute",i.style.left="0px",i.style.top="0px",I(i,n,Sk.PaintUsage.kImage),P(i,Sk.Matrix.multiply(D(),s)),h.save(),h.clipRect(r,Sk.ClipOp.kIntersect),L(i,"drawImageRect"),Sk.isDebugEnabled()&&(u.setAttribute("src",t),u.setAttribute("dst",r)),i.src,h.restore()},h.drawVideoRect=function(e,t,r,n){HTMLVideoElement},h.playbackMatrixAndClipOps=function(e){var t,r;for(t=0;t<e.length;t+=1)(r=e[t]).concat_mat?h.concat(r.concat_mat):r.set_mat&&h.setMatrix(r.set_mat)},h.createDevice=function(e,l,c){var u=new Sk.DOMDevice(e,t,r,n,o,i,a,s);return c&&u.playbackMatrixAndClipOps(c),Sk.isDebugEnabled()&&u.getNode().setAttribute("device_bounds",l),u},h.drawDevice=function(e,t,n,o){var i,a=Sk.Matrix.makeRectToRect(e.getSizeRect(),t),s=Sk.Matrix.makeTranslation(-r.x,-r.y),l=Sk.Matrix.multiply(s,a),c=e.getNode();I(c,n,Sk.PaintUsage.kImage),Sk.isDebugEnabled()&&c.setAttribute("dst_device_rect",t),P(c,l),(i=c).style.isolation,i.style.isolation="isolate",L(c,"drawDevice")},h.onWillDrawPicture=function(e,t){var r;p=e.getHitTestData(),Sk.isDebugEnabled()&&(h.save(),L(r=document.createElement("div"),"drawPicture"),r.setAttribute("htd",JSON.stringify(p)),r.setAttribute("visual_rect",t),u=r)},h.onDidDrawPicture=function(){Sk.isDebugEnabled()&&h.restore()},h.drawDebugRect=function(e,t){var r;Sk.isDebugEnabled()&&(r=M(),Sk.Rect.toCSSStyle(e,r.style),r.style.backgroundColor=t||"rgba(255, 0, 0, 0.4)",P(r,D(),e),L(r,"debugRect"))},h.getId=function(){return c},h.generateResourceId=function(){return["res",c,R+=1].join("-")},h.getDeviceBounds=function(){return t},h.setCanvas=function(e){m=e},h.getMemoryUsage=function(){return 0},h.getDeviceScaleFactor=function(){return 1},h.getNode=function(){return l},h.toDataURL=function(e){},h.getSizeRect=function(){return S},h.release=function(e){h===a&&(l&&l.parentNode&&l.parentNode.removeChild(l),l=null,i&&i.release(),Sk.ImagePool.put(c))},h.reset=function(){G(),Sk.ImagePool.put(a.getId())},h.getDefs=function(){return g},h.getCanvas=function(){return m},h.getRootDevice=function(){return a},Sk.Rect.isIntRect(t),c=Sk.nextDOMDeviceId,Sk.nextDOMDeviceId+=1,a=a||h,(k=M()).style.left="0px",k.style.top="0px",k.style.width=Sk.Rect.getWidth(t)+"px",k.style.height=Sk.Rect.getHeight(t)+"px",k.style.overflow="hidden",Sk.isDebugEnabled()&&(k.setAttribute("detail","SkDOMDevice"),k.setAttribute("bounds",t),k.setAttribute("origin",JSON.stringify(r)),k.setAttribute("purpose",e)),l=k,G()},Sk.SVGMatrixColorFilterBuilder=function(){"use strict";var e,t;this.build=function(r,n,o){"SkMatrixColorFilter"===r.name||r.name,e=[],(t=Sk.Util.createSVGElement("feColorMatrix")).setAttribute("type","matrix"),t.setAttribute("values",r.matrix.join(" ")),t.setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),o&&o(t),e.push(t)},this.getProduct=function(){return e}},Sk.SVGTableColorFilterBuilder=function(){"use strict";var e,t;this.build=function(r,n,o){var i,a,s,l=["A","R","G","B"];for("SkTableColorFilter"===r.name||r.name,e=[],(t=Sk.Util.createSVGElement("feComponentTransfer")).setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),i=0;i<l.length;++i)s=l[i],r.table_color_filter.hasOwnProperty(s)&&((a=Sk.Util.createSVGElement("feFunc"+s)).setAttribute("type","discrete"),a.setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),a.setAttribute("tableValues",r.table_color_filter[s].join(" ")),t.appendChild(a));o&&o(t),e.push(t)},this.getProduct=function(){return e}},Sk.SVGLumaColorFilterBuilder=function(){"use strict";var e,t;this.build=function(r,n,o){r.name,e=[],r.is_luma_color_filter&&((t=Sk.Util.createSVGElement("feColorMatrix")).setAttribute("type","luminanceToAlpha"),t.setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),o&&o(t),e.push(t))},this.getProduct=function(){return e}},Sk.SVGComposeColorFilterBuilder=function(){"use strict";var e,t;this.build=function(r,n,o){r.name,e=[],r.inner&&(Sk.SVGFilterHelper.isColorFilter(r.inner.name),(t=Sk.SVGFilterHelper.createColorFilterBuilder(r.inner.name)).build(r.inner,n,o),e=t.getProduct()),r.outer&&(Sk.SVGFilterHelper.isColorFilter(r.outer.name),(t=Sk.SVGFilterHelper.createColorFilterBuilder(r.outer.name)).build(r.outer,n,o),e=e.concat(t.getProduct()))},this.getProduct=function(){return e}},Sk.SVGBlendModeColorFilterBuilder=function(){"use strict";var e,t;this.build=function(r,n,o,i){"SkBlendModeColorFilter"===r.name||r.name,e=[],(t=Sk.Util.createSVGElement("feFlood")).setAttribute("flood-color",Sk.Paint.skColorToCSSColor(r.color)),t.setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),t.setAttribute("result","src-color"),o&&o(t),e.push(t),r.mode!==Sk.BlendMode.kSrc&&(t.setAttribute("flood-opacity",Sk.Paint.skColorToCanvasAlpha(r.color)),Sk.Paint.isBlendOp(r.mode)?(t=Sk.Util.createSVGElement("feBlend")).setAttribute("mode",Sk.Paint.skBlendModeToFeBlendMode(r.mode)):(t=Sk.Util.createSVGElement("feComposite")).setAttribute("operator",Sk.Paint.skBlendModeToFeCompositeOp(r.mode)),t.setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),t.setAttribute("in","src-color"),t.setAttribute("in2",function(e){return e&&e[0]?e[0]:"SourceGraphic"}(i)),o&&o(t),e.push(t))},this.getProduct=function(){return e}},Sk.SVGColorSpaceXformColorFilterBuilder=function(){"use strict";this.build=function(e){var t=e.dst_color_space;e.name,Sk.SVGFilterHelper.setCurrentColorSpace(Sk.Paint.skNamedColorSpaceToColorInterpolation(t))},this.getProduct=function(){return[]}},Sk.SVGBlurImageFilterImplBuilder=function(){"use strict";var e,t;this.build=function(r,n,o){var i;r.name,r.base.inputs.length,i=function(e,t){return Sk.Matrix.mapVector(e,[t[0],t[1],1]).slice(0,2)}(n,r.sigma),e=Sk.SVGFilterHelper.buildImageFilterBase(r.base,n,o),(t=Sk.Util.createSVGElement("feGaussianBlur")).setAttribute("stdDeviation",i.join(" ")),t.setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),o&&o(t),e.push(t)},this.getProduct=function(){return e}},Sk.SVGColorFilterImageFilterImplBuilder=function(){"use strict";var e,t;this.build=function(r,n,o){var i=[];r.name,r.base.inputs.length,e=Sk.SVGFilterHelper.buildImageFilterBase(r.base,n,o,i),r.color_filter&&((t=Sk.SVGFilterHelper.createColorFilterBuilder(r.color_filter.name)).build(r.color_filter,n,o,i),e=e.concat(t.getProduct()))},this.getProduct=function(){return e}},Sk.SVGDropShadowImageFilterImplBuilder=function(){"use strict";var e,t,r;this.build=function(n,o,i){n.name,n.base.inputs.length,e=Sk.SVGFilterHelper.buildImageFilterBase(n.base,o,i),t=Sk.Util.createSVGElement("feDropShadow"),r=n.offset.concat([1]),r=Sk.Matrix.mapVector(o,r),t.setAttribute("dx",r[0]),t.setAttribute("dy",r[1]),r=n.sigma.concat([1]),r=Sk.Matrix.mapVector(o,r),t.setAttribute("stdDeviation",r.join(" ")),t.setAttribute("flood-color",Sk.Paint.skColorToCSSColor(n.color)),t.setAttribute("flood-opacity",Sk.Paint.skColorToCanvasAlpha(n.color)),t.setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),i&&i(t),e.push(t)},this.getProduct=function(){return e}},Sk.SVGMatrixTransformImageFilterBuilder=function(){"use strict";var e,t;this.build=function(r,n,o){var i,a;r.name,r.base.inputs.length,r.matrix,i=Sk.Matrix.fromMat2D(r.matrix),Sk.Matrix.isIdentityOrTranslation(i),a=Sk.Matrix.mapVector(n,[Sk.Matrix.getTranslateX(i),Sk.Matrix.getTranslateY(i),1]),e=Sk.SVGFilterHelper.buildImageFilterBase(r.base,n,o),(t=Sk.Util.createSVGElement("feOffset")).setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),t.setAttribute("dx",a[0]),t.setAttribute("dy",a[1]),o&&o(t),e.push(t)},this.getProduct=function(){return e}},Sk.SVGBlendImageFilterBuilder=function(){"use strict";var e,t,r;this.build=function(n,o,i){n.name,n.base.inputs.length,e=[],n.custom_blend_mode||(t=[],e=Sk.SVGFilterHelper.buildImageFilterBase(n.base,o,i,t),Sk.Paint.isBlendOp(n.blend_mode)?(r=Sk.Util.createSVGElement("feBlend")).setAttribute("mode",Sk.Paint.skBlendModeToFeBlendMode(n.blend_mode)):((r=Sk.Util.createSVGElement("feComposite")).setAttribute("operator",Sk.Paint.skBlendModeToFeCompositeOp(n.blend_mode)),n.arithmetic_coefficients&&n.arithmetic_coefficients.forEach((function(e,t){r.setAttribute("k"+(t+1),e)}))),r.setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),i&&i(r),["in2","in"].forEach((function(e,n){r.setAttribute(e,function(e){return t[e]||"SourceGraphic"}(n))})),e.push(r))},this.getProduct=function(){return e}},Sk.SVGCropImageFilterBuilder=function(){"use strict";var e,t;function r(e){e.setAttribute("x",Sk.Rect.getX(t)+"px"),e.setAttribute("y",Sk.Rect.getY(t)+"px"),e.setAttribute("width",Sk.Rect.getWidth(t)+"px"),e.setAttribute("height",Sk.Rect.getHeight(t)+"px")}this.build=function(n,o){n.name,n.base.inputs.length,n.crop_rect,t=Sk.Matrix.mapRect(o,n.crop_rect),e=Sk.SVGFilterHelper.buildImageFilterBase(n.base,o,r)},this.getProduct=function(){return e}},Sk.SVGFilterHelper=function(){"use strict";var e={},t="sRGB";return e.isImageFilter=function(e){return"SkColorFilterImageFilterImpl"===e||"SkBlurImageFilterImpl"===e||"SkDropShadowImageFilterImpl"===e||"SkCropImageFilter"===e||"SkBlendImageFilter"===e||"SkMatrixTransformImageFilter"===e},e.isColorFilter=function(e){return"SkBlendModeColorFilter"===e||"SkModeColorFilter"===e||"SkMatrixColorFilter"===e||"SkColorFilter_Matrix"===e||"SkTableColorFilter"===e||"SkTable_ColorFilter"===e||"SkRuntimeColorFilter"===e||"SkComposeColorFilter"===e||"SkColorSpaceXformColorFilter"===e},e.isMaskFilter=function(e){return"SkBlurMaskFilterImpl"===e},e.isShader=function(e){return"SkLinearGradient"===e||"SkRadialGradient"===e||"SkImageShader"===e||"SkPictureShader"===e},e.isSupportedPathEffect=function(e){return"SkDashImpl"===e},e.createColorFilterBuilder=function(t){return e.isColorFilter(t),"SkComposeColorFilter"===t?new Sk.SVGComposeColorFilterBuilder:"SkMatrixColorFilter"===t||"SkColorFilter_Matrix"===t?new Sk.SVGMatrixColorFilterBuilder:"SkTableColorFilter"===t||"SkTable_ColorFilter"===t?new Sk.SVGTableColorFilterBuilder:"SkRuntimeColorFilter"===t?new Sk.SVGLumaColorFilterBuilder:"SkBlendModeColorFilter"===t||"SkModeColorFilter"===t?new Sk.SVGBlendModeColorFilterBuilder:"SkColorSpaceXformColorFilter"===t?new Sk.SVGColorSpaceXformColorFilterBuilder:void 0},e.createImageFilterBuilder=function(t){return e.isImageFilter(t),"SkColorFilterImageFilterImpl"===t?new Sk.SVGColorFilterImageFilterImplBuilder:"SkBlurImageFilterImpl"===t?new Sk.SVGBlurImageFilterImplBuilder:"SkDropShadowImageFilterImpl"===t?new Sk.SVGDropShadowImageFilterImplBuilder:"SkCropImageFilter"===t?new Sk.SVGCropImageFilterBuilder:"SkBlendImageFilter"===t?new Sk.SVGBlendImageFilterBuilder:"SkMatrixTransformImageFilter"===t?new Sk.SVGMatrixTransformImageFilterBuilder:void 0},e.createFilterBuilder=function(t){return e.isColorFilter(t)?e.createColorFilterBuilder(t):e.isImageFilter(t)?e.createImageFilterBuilder(t):void 0},e.setCurrentColorSpace=function(e){t=e},e.getCurrentColorSpace=function(){return t},e.buildImageFilterBase=function(t,r,n,o){var i=!!o,a=[];return t.cropRect.flags,Sk.Rect.isEmpty(t.cropRect.rect),t.inputs&&t.inputs.length?(t.inputs.forEach((function(t){var s,l;t&&((l=e.createFilterBuilder(t.name)).build(t,r,n),s=l.getProduct(),a=a.concat(s),i&&(s.length?(s[s.length-1].setAttribute("result",t.name),o.push(t.name)):o.push(null)))})),a):[]},e.buildWith=function(t,r){var n;if(t)return(n=e.createFilterBuilder(t.name)).build(t,r),function(e){var t,r;if(!e||0===e.length)return null;for(t=Sk.Util.createSVGElement("filter"),r=0;r<e.length;++r)t.appendChild(e[r]);return t}(n.getProduct())},e}(),Sk.FlattenableReader=function(){"use strict";var e={};function t(e,t,r){var n={};return n.name=t,n.base=function(e){var t,r=e.readInt32(),n=[];for(t=0;t<r;++t)e.readBool()?n.push(Sk.FlattenableReader.readFrom(e)):n.push(null);return{cropRect:{rect:e.readRect(),flags:e.readUint32()},inputs:n}}(e),"SkColorFilterImageFilterImpl"===t?(n.base.inputs.length,n.color_filter=Sk.FlattenableReader.readFrom(e)):"SkBlurImageFilterImpl"===t?(n.base.inputs.length,n.sigma=[e.readFloat32(),e.readFloat32()],n.tile_mode=e.readInt32()):"SkDropShadowImageFilterImpl"===t?(n.base.inputs.length,n.offset=[e.readFloat32(),e.readFloat32()],n.sigma=[e.readFloat32(),e.readFloat32()],n.color=e.readUint32(),n.shadow_only=e.readInt32()):"SkCropImageFilter"===t?n.crop_rect=e.readRect():"SkBlendImageFilter"===t?(n.blend_mode=e.readUint32(),n.blend_mode===Sk.BlendMode.kArithmetic_SkBlendMode?(n.arithmetic_coefficients=[e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32()],n.enforce_premul=e.readBool()):n.blend_mode===Sk.BlendMode.kCustom_SkBlendMode&&(n.custom_blend_mode=!0,e.skip(r-4))):"SkMatrixTransformImageFilter"===t?(n.matrix=e.readMatrix(),n.sampling=e.readSampling()):e.skip(r),n}function r(e,t,r){var n,o={};return o.name=t,"SkBlendModeColorFilter"===t||"SkModeColorFilter"===t?(o.color=e.readUint32(),o.mode=e.readUint32()):"SkMatrixColorFilter"===t||"SkColorFilter_Matrix"===t?(o.matrix=e.readScalarArray(),o.domain=e.readBool()):"SkComposeColorFilter"===t?(o.outer=Sk.FlattenableReader.readFrom(e),o.inner=Sk.FlattenableReader.readFrom(e)):"SkTableColorFilter"===t||"SkTable_ColorFilter"===t?((n=e.readByteArray())&&n.length,o.table_color_filter=function(e){var t,r,n,o=[],i={},a=["A","R","G","B"];for(t=0;t<256;t++)o.push(t);for(t=0;t<a.length;++t)n=a[t],r=Array.prototype.slice.call(e.subarray(256*t,256*(t+1))),JSON.stringify(r)!==JSON.stringify(o)&&(i[n]=r.map((function(e){return 1*e/255})));return i}(n)):"SkRuntimeColorFilter"===t?o.is_luma_color_filter=e.readBool():"SkColorSpaceXformColorFilter"===t?4===r?o.dst_color_space=e.readUint32():(o.dst_color_space=Sk.NamedColorSpace.kSRGB,e.skip(r)):e.skip(r),o}function n(e){var t,r={};return t=e.readUint32(),r.colors=e.readUint32Array(),r.interpolate_in_premul=!!(t&Sk.GradientSerializationFlags.kInterpolationInPremul),t&Sk.GradientSerializationFlags.kHasPosition&&(r.colors,r.position=e.readScalarArray(),r.position),r}return e.readFrom=function(e){var o,i;return o=e.readString(),i=e.readUint32(),Sk.SVGFilterHelper.isImageFilter(o)?t(e,o,i):Sk.SVGFilterHelper.isColorFilter(o)?r(e,o,i):Sk.SVGFilterHelper.isMaskFilter(o)?function(e,t,r){var n;return"SkBlurMaskFilterImpl"==t?{sigma:e.readFloat32(),blur_style:(n=e.readUint32())>>16&65535,ignore_ctm:!!(65535&n)}:(e.skip(r),null)}(e,o,i):Sk.SVGFilterHelper.isShader(o)?function(e,t,r){var o={};return o.name=t,"SkLinearGradient"===t?((o=n(e)).start=e.readPoint(),o.end=e.readPoint(),e.readBool()&&(o.gradient_size=[e.readFloat32(),e.readFloat32()]),{linear_gradient:o}):"SkRadialGradient"===t?((o=n(e)).center=e.readPoint(),o.radius=e.readFloat32(),e.readBool()&&(o.transform=e.readMatrix()),{radial_gradient:o}):"SkImageShader"===t?(o.image={},o.image.tile_mode_x=e.readUint32(),o.image.tile_mode_y=e.readUint32(),o.image.matrix=e.readMatrix(),o.image.image=e.readImage(),o):"SkPictureShader"===t?(safeview.compositor.getConfig().useNewPictureShader()?(o.picture={},o.picture.matrix=e.readMatrix(),o.picture.tile_mode_x=e.readUint32(),o.picture.tile_mode_y=e.readUint32(),o.picture.tile=e.readRect(),o.picture.index=e.readUint32()):(o.image={},o.image.matrix=e.readMatrix(),o.image.tile_mode_x=e.readUint32(),o.image.tile_mode_y=e.readUint32(),e.readBool()&&(o.image.image=e.readImage())),o):(e.skip(r),null)}(e,o,i):Sk.SVGFilterHelper.isSupportedPathEffect(o)?function(e,t,r){return"SkDashImpl"===t?{name:t,phase:e.readFloat32(),intervals:e.readScalarArray()}:(e.skip(r),null)}(e,o,i):(e.skip(i),null)},e}();var Compositor={};Compositor.Options=Object.freeze({kDisableVideo:1,kEnableDebug:2,kEnableBBoxView:4,kSyncImageLoad:8,kDisableNativeVideo:16,kEnableHUD:32,kEnableDebugAnnotation:64,kEnableNativeOVSLScrolling:128,kHideScrollbarLayers:256,kEnableLogStats:512}),Compositor.HitTest=Object.freeze({kNonFastRegion:0,kLayer:1,kDrawing:2,kTouchActionRegion:3,kScrollingOrScrollbarLayer:4,kTextureLayer:5,kWheelEventRegion:6,kTouchEventRegion:7,kScrollableContainerId:8,kEventTarget:9}),Compositor.CommitState=Object.freeze({kLoadNotStarted:0,kLoadStarted:1,kLoadComplete:2}),Compositor.DrawFrameReason=Object.freeze({kRecordingsLoaded:1,kLayerProjectionChanged:2,kTilesBecameDirty:4,kBecameVisible:8,kVideoSizeChanged:16,kDebugRectsChanged:32,kLayerEffectChanged:64,kParentLayerTreeHostChanged:128}),Compositor.Config=function(e){"use strict";var t=this,r={flags:0},n=!1;function o(e,n){var o=r.flags,i=Util.copyDict(r||{});n?o|=e:o&=~e,i.flags=o,t.setConfig(i)}t.getPreDrawDistanceFactor=function(){return r.pre_draw_distance_factor},t.getPreDrawDistanceFactorForDOMRaster=function(){var e=r.pre_draw_distance_factor_for_dom_raster,n=5;return!t.getEnableDOMText()&&document.getElementsByTagName("*").length>4e3&&(n=BrowserDetect.isDesktop()&&BrowserDetect.isChrome()?1:3),e>=1?e:n},t.getPreferAsyncScrolling=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kPreferAsyncScrolling)},t.getPreferScrollingCorrectness=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kPreferScrollingCorrectness)},t.getTouchSize=function(){return{width:50,height:50}},t.getMouseEmulationTimeoutMs=function(){return 1e3},t.getMaxPreDrawDistance=function(){return r.max_pre_draw_distance||4096},t.getEnableDOMRasterization=function(){return!BrowserDetect.isIE()&&!BrowserDetect.isEdge()&&(!(BrowserDetect.isFirefox()&&BrowserDetect.getVersion()<80)&&Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kEnableDOMRasterization))},t.setEnableDOMRasterization=function(e){o(Compositor.ConfigFlags.kEnableDOMRasterization,e)},t.getSelectionOverApproximation=function(){return{horizontal:128,vertical:128}},t.getEnableDOMText=function(){return!(!BrowserDetect.supportsResizeObserver()||!BrowserDetect.supportsFontAPI())&&(t.getEnableDOMRasterization()&&Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kEnableDOMText))},t.getEnableCSSGradients=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kAllowCSSGradients)},t.setEnableDOMText=function(e){o(Compositor.ConfigFlags.kEnableDOMText,e)},t.setEnableCSSGradientsForTest=function(e){n=e,o(Compositor.ConfigFlags.kAllowCSSGradients,e)},t.getPruneOccludedTiles=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kPruneOccludedTiles)},t.getEnableUnifiedInput=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kEnableUnifiedInput)},t.getEnableDisplayListDeltaForDrag=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kAllowDisplayListDeltaForDrag)},t.isScrollUnificationEnabled=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kEnableScrollUnification)},t.allowClientCanvasSrc=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kAllowClientCanvasSrc)},t.setFeatureIfNeeded=function(e){Compositor.Util.checkFlag(e,Compositor.ConfigFlags.kEnableScrollUnification)&&(r.flags|=Compositor.ConfigFlags.kEnableScrollUnification)},t.useNewPictureShader=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kUseNewPictureShader)},t.setConfig=function(t){var o=0;r&&JSON.stringify(r)===JSON.stringify(t)||(n&&(t.flags|=Compositor.ConfigFlags.kAllowCSSGradients),void 0!==r.flags&&(r.flags,o=r.flags^t.flags),r=t,e&&e(o))}},Compositor.Stats=function(){"use strict";var e=this,t={},r=null;e.inc=function(e,r){t.hasOwnProperty(e)||(t[e]=0),void 0===r&&(r=1),t[e]+=r},e.get=function(e){return t.hasOwnProperty(e)?t[e]:0},e.reset=function(){t={}},e.startLogging=function(){r||(r=setInterval((function(){window.reportClientEvent("tc-compositor-stats",t,!1,!0)}),5e3))},e.stopLogging=function(){r&&(clearInterval(r),r=null)}},Compositor.EventType={kWheel:0,kTouch:1,kMouse:2},Compositor.Display=function(e){"use strict";var t,r,n,o,i,a,s,l,c,u,d,f,p,g,m,k,h,S,y,v,b=this,C=0,_=Compositor.Options.kEnableNativeOVSLScrolling,T=new Compositor.ManagedListeners,w=new Compositor.Stats,R=1e3,x=[],D=0,M=!1,F=Sk.Rect.makeEmpty(),E={},I={},P="0:0",L=[],O=new Compositor.BiMap,A=!1;function B(t){var r;b.isLthAlive(t)||(r=new Compositor.LayerTreeHost(e,b,t),E[t]=r,document.body.appendChild(r.getDiv()),r.isMainFrame()||(r.getDiv().style.display="none"))}function H(e){var t,r=[k];function n(e,t){b.isLthAlive(e)&&r.push(E[e])}for(;r.length&&!e(t=r.pop());)t.forEachChildLth(n)}function N(e){var t,r,n=Sk.Rect.getCenter(e.screen_rect),o=Sk.Rect.getCenter(b.getScreenRect());return t=n,r=o,Math.sqrt(Math.pow(t[0]-r[0],2)+Math.pow(t[1]-r[1],2))}function U(e,t){var r=e.getLayerTreeHost(),n=t.getLayerTreeHost();if(r.getFrameSinkId()===n.getFrameSinkId()){if(e.paintsBefore(t))return 1}else if(r.paintsBefore(n,e,t))return 1;return-1}function V(e){var t=[],r=[];return e.sort((function(e,t){return U(e.layer,t.layer)})),e.forEach((function(e){var n=e.layer;n.willDraw(),function(e){var r,n=Sk.Rect.makeCopy(e.screen_rect);for(r=0;r<t.length&&!Sk.Rect.isEmpty(n);r+=1)Sk.Rect.subtract(n,t[r]);return!Sk.Rect.isEmpty(n)}(e)&&(e.screen_rect.rect_stays_rect,n.occludesContentBelow()&&e.screen_rect.rect_stays_rect&&t.push(e.screen_rect),r.push(e))})),r}function z(){var e,t;return H((function(e){e.invalidateTilesForNewlyExposedRegions()})),t=[],H((function(e){t=t.concat(e.gatherDirtyTiles())})),e=t,a.getPruneOccludedTiles()?V(e):e}function W(){var e={now:[],soon:[]},t=z();return w.inc("visible_tiles_count",t.length),t.sort((function(e,t){return N(e)<N(t)?-1:1})),t.forEach((function(t){Sk.Rect.intersects(b.getScreenRect(),t.screen_rect)?e.now.push(t):e.soon.push(t)})),b.isDebugEnabled()&&e.now.length>8&&(t.length,e.now.length,e.soon.length),e}function G(e,t){for(var r,n,o={tile_draw_failed:!1};e.length&&t>0;){if(n=Date.now(),!(r=e[0]).layer.drawTilesInRect(r.tile_rect)){o.tile_draw_failed=!0;break}e.shift(),r.draw_time_ms=Date.now()-n,t-=r.draw_time_ms}return e.forEach((function(e){e.layer.getLayerTreeHost().setLayerTilesBecameDirty(e.layer.getID())})),o.time_remaining_ms=Math.max(0,t),o}function j(){H((function(e){e.getPropertyTrees().willDraw(),e.updateProjections(),e.updateClips(),e.updateEffects(),e.updateDebugRects()})),b.callback.fire("will-draw"),function(){var e,t,r,n;do{(n=G((e=W()).now,1e3)).tile_draw_failed&&(r=Math.min(R,Math.ceil(i)),(r=Math.max(r-1,1))<R&&(t=Util.copyDict(Sk.canvasMemoryUsage),b.setMaxRasterScaleFactor(r)))}while(r>1&&!n.tile_draw_failed);(n.tile_draw_failed||t)&&(window.reportClientEvent(n.tile_draw_failed?"tc-compositor-draw-retry-fail":"tc-compositor-dsf-fallback",{final_max_rsf:R,mem_usage:t,mem_limit:Sk.canvasMemoryLimit}),n.tile_draw_failed)||G(e.soon,Math.min(100,n.time_remaining_ms))}()}function Y(){var e,t,r,n,o;M=!0,C+=1,x.push(Date.now()),x.length>60&&x.shift(),b.callback.fire("begin-animation-frame"),o=!1,H((function(e){if(e.arePropertyTreesDirty())return o=!0,!0})),(o||D)&&(e=Date.now(),D=0,H((function(e){e.activateReadyTrees()})),n=k.getPropertyTrees().getClipTree(),b.getInnerViewportScrollLayer()&&b.getOuterViewportScrollLayer()&&(t=b.getInnerViewportScrollLayer().getClipTreeIndex(),(r=n.getNode(t))&&r.setClipRect(b.getScreenRect())),H((function(e){e.invalidateLayerProjectionsAndClips()})),j(),w.inc("frames_drawing_time",Date.now()-e),w.inc("frames_drawing_count")),H((function(e){e.clearDirtyLayers()})),M=!1}function X(t){e.surrogate_channel&&e.surrogate_channel.send.apply(e.surrogate_channel,t)}function q(e,t){var r=Util.Uint8ArrayToBase64(t);w.inc("tx_bytes",r.length),X(["CM",e,r])}function K(e){var t=Compositor.MessageFlags.kPixelDistance,r=new Sk.BinaryWriter(8);r.writeUint32(t),r.writeUint32(e),q(0,r.getData())}function Q(){var e=Compositor.MessageFlags.kInvalidateLayerTree,t=new Sk.BinaryWriter(4);t.writeUint32(e),q(0,t.getData())}function J(){H((function(e){e.hardInvalidateTiles()}))}function Z(){Compositor.Util.toggleStyle("sv-tile-style",".sv-tile { outline: 1px solid green }"),Compositor.Util.toggleStyle("sv-tile-label-style",".sv-tile-label { display: block !important; }"),Compositor.Util.toggleStyle("sv-layer-style",".svl { outline: 1px solid orange; }")}function $(){var e;return x.length<60||(e=x[x.length-1]-x[0])<=0?60:x.length/(e/1e3)}function ee(e){var t,r,n,o,i=["#FF0000","#00FF00","#0000FF","#FFFCF9"],a=0,l=0;function c(e,t){var r=[],n=0;return Util.forEachItem(e,(function(e,o){r.push([t?t(o):o,i[n%i.length]]),n+=1})),r}e.cps.update([[w.get("commit_count")]]),t={rx:w.get("commit_rx_bytes")/1024,tx:w.get("tx_bytes")/1024},e.crx.update(c(t)),e.cql.update([[(o=0,H((function(e){o+=e.getPendingCommitCount()})),o)]]),e.sfps.update([[1e3/s.getSenderDelay()]]),e.fps.update([[$()]]),e.canvas.update(c(Sk.canvasMemoryUsage,(function(e){return e/(1<<20)}))),r=function(){var e={Transform:0,Clip:0,Scroll:0,Effect:0};return H((function(t){e.Transform+=t.getPropertyTrees().getTransformTree().getSize(),e.Clip+=t.getPropertyTrees().getClipTree().getSize(),e.Scroll+=t.getPropertyTrees().getScrollTree().getSize(),e.Effect+=t.getPropertyTrees().getEffectTree().getSize()})),e}(),e.ptn_count.update(c(r)),n={Transform:w.get("transform_tree_mutation_count"),Clip:w.get("clip_tree_mutation_count"),Scroll:w.get("scroll_tree_mutation_count"),Effect:w.get("effect_tree_mutations_count")},e.ptn_mutations.update(c(n)),0!==w.get("frames_drawing_count")&&(a=w.get("frames_drawing_time")/w.get("frames_drawing_count"),l=w.get("visible_tiles_count")/w.get("frames_drawing_count")),e.fdt.update([[a]]),e.vtc.update([[l]]),w.reset()}function te(e){var t,r;if(l&&function(e){return!(!e.shiftKey||!e.ctrlKey||"keydown"!==e.type)}(e))switch(e.keyCode){case"F".charCodeAt(0):Q();break;case"H".charCodeAt(0):b.setFlags(_^Compositor.Options.kEnableHUD),b.setHUDVisibility(b.isHUDEnabled());break;case"I".charCodeAt(0):Sk.setImageQuality(1),Q();break;case"R".charCodeAt(0):t=Compositor.MessageFlags.kInvalidateAllLayers,(r=new Sk.BinaryWriter(4)).writeUint32(t),q(0,r.getData());break;case"L".charCodeAt(0):b.setMaxRasterScaleFactor(1);break;case"D".charCodeAt(0):H((function(e){e.hardInvalidateTiles()}));break;case"T".charCodeAt(0):Z();break;case"V".charCodeAt(0):b.setFlags(_^Compositor.Options.kDisableNativeVideo),H((function(e){e.toggleVideoMode()}));break;case"U".charCodeAt(0):b.setFlags(_^Compositor.Options.kEnableDebugAnnotation),Q();break;case"Z".charCodeAt(0):a.setEnableDOMRasterization(!a.getEnableDOMRasterization());break;case"N".charCodeAt(0):a.setEnableDOMText(!a.getEnableDOMText());break;case"P".charCodeAt(0):b.setFlags(_^Compositor.Options.kEnableLogStats),b.isLogStatsEnabled()?(b.isHUDEnabled(),w.startLogging()):w.stopLogging();break;default:!1}}function re(e,t,r){var n,o,i,a=b.input||f,s=[25,3];return t?a?(n=a.getLastActivityTime(),o=Date.now()-n.input,i=Date.now()-n.key,Date.now()-n.click,e.length,o<1e3?[i<1e3?0:25,0]:s):s:[100,100]}function ne(){var e,t=a.getMaxPreDrawDistance();return a.getEnableDOMRasterization()?e=a.getPreDrawDistanceFactorForDOMRaster():(e=BrowserDetect.isDesktop()&&BrowserDetect.isChrome()?1:3,a.getPreDrawDistanceFactor()>=0&&(e=a.getPreDrawDistanceFactor())),Math.min(Math.round(Sk.Rect.getHeight(F)*e),t)}function oe(e){var t,r,n=MetricsUtils.getVisualViewportMetrics();return t=Sk.Rect.fromXYWH(0,0,n.width,BrowserDetect.isDesktop()?MetricsUtils.getWebViewSize().height:MetricsUtils.getScreenHeight()),r=Sk.Rect.resize(t,ne()),!(!e&&Sk.Rect.isEqual(t,F)&&Sk.Rect.isEqual(r,o))&&(F=t,o=r,b.invalidateLthProjections(P),!0)}function ie(e,t){b.setDeviceScaleFactor(e.device_scale_factor),oe()&&(BrowserDetect.isMobile()||X(["resize",Sk.Rect.getWidth(F),Sk.Rect.getHeight(F),e.device_scale_factor]))}function ae(){H((function(e){e.getLayerTree()&&e.getLayerTree().freeTiles((function(e){return e.type===Compositor.TileType.kCanvasDevice})),e.flushRasterCache()})),Sk.flushCaches()}function se(){Util.isTabVisible()||(x=[]),!Util.isTabVisible()&&BrowserDetect.isMobile()&&ae(),Util.isTabVisible()&&b.setNeedsDrawFrame(Compositor.DrawFrameReason.kBecameVisible)}function le(e,r,n){var o=document.createElement(e);return o.style.padding=o.style.margin="0px",b.isDebugEnabled()&&(o.id="sv-video:"+r+":"+n),t.appendChild(o),setNodeIds(o,n,r),b.callback.fire("media-node-inserted",n),o}function ce(e,t){var r=getNodeByUid(e,t);r&&(r.parentNode.removeChild(r),b.callback.fire("remove-media-node",e,t),removeUidNodeEntry(e,t))}function ue(){b.release()}function de(){oe(),i=MetricsUtils.getAllMetrics().device_scale_factor}function fe(e){var t=e.is_main_frame?P:e.frame_sink_id;e.flags&Compositor.CommitFlags.kDirtyConfig&&(e.is_main_frame?a.setConfig(e.config):a.setFeatureIfNeeded(e.config.flags)),B(t),E[t].onCompositorMessage(e),e.is_main_frame&&e.flags&Compositor.CommitFlags.kDirtyConfig&&de(),function(e){b.commit_count+=1,w.inc("commit_count"),e.full_tree&&(b.full_tree_commit_count+=1,w.inc("full_tree_commit_count")),e.transform_tree_mutations&&w.inc("transform_tree_mutation_count",e.transform_tree_mutations.length),e.clip_tree_mutations&&w.inc("clip_tree_mutation_count",e.clip_tree_mutations.length),e.scroll_tree_mutations&&w.inc("scroll_tree_mutation_count",e.scroll_tree_mutations.length),e.effect_tree_mutations&&w.inc("effect_tree_mutation_count",e.effect_tree_mutations.length)}(e)}function pe(e,t){return e!==MSG_KIND_COMPOSITOR_COMMIT||(fe((new Compositor.BinaryReader).readCommit(t,b)),b.commit_bytes+=t.length,w.inc("commit_rx_bytes",t.length)),!0}function ge(e){e.forEachChildLth((function(t,r){var n=E[t],o=e.getLayerTree().getLayer(r);n&&ge(n),o&&L.push(o)}))}function me(){0===L.length&&(ge(k),L.sort(U))}function ke(e,t,r,n,o){var i;return!e.hasChildLth()||n>2?o(e.getFid(),r):e.hitTestLayerTree(t,(function(a,s){return!a.isUnHittableSurface()&&(a.isSurfaceForChildFrame()&&(i=b.getLthFromSurface(a))?ke(i,t,s,n+1,o):!!a.hasHittableItemAt(s)&&o(e.getFid(),r))}))}function he(e){var t=I[e];t&&function(e){var t=E[e];t.isMainFrame()||(delete I[t.getFid()],t.release(),delete E[e],b.resetCachedSurfaceLayerList())}(t)}function Se(t,r,n){t=t.toLowerCase(),n?O.erase(r,t):O.set(r,t),e.callback.fire("ftim-updated",t,r,n)}function ye(e){oe(!0),e&Compositor.ConfigFlags.kEnableDOMRasterization&&(a.getEnableDOMRasterization()&&ae(),J()),(e&Compositor.ConfigFlags.kEnableDOMText||e&Compositor.ConfigFlags.kAllowCSSGradients)&&J()}b.getTileManager=function(){return S},b.getRemoteInputTracker=function(){return y},b.getRAFManager=function(){return u},b.getMainFrame=function(){return k},b.getMainFrameSinkId=function(){return P},b.getDeviceScaleFactor=function(){return i},b.getDebugRectsEnabled=function(){return c},b.getImageLoader=function(){return r},b.getStats=function(){return w},b.setSpecialIds=function(e){m=e,A&&m&&-1!==m.outer_content&&b.setFlags(_&~Compositor.Options.kHideScrollbarLayers)},b.getInnerViewportScrollNode=function(){return m?k.getPropertyTrees().getScrollTree().getNode(m.inner_scroll):null},b.getOuterViewportScrollNode=function(){return m?k.getPropertyTrees().getScrollTree().getNode(m.outer_scroll):null},b.isOuterViewportScrollNode=function(e,t){return e.isMainFrame()&&m&&t===m.outer_scroll},b.getPageScaleTransformNode=function(){return m?k.getPropertyTrees().getTransformTree().getNode(m.page_scale):null},b.getInnerViewportScrollLayer=function(){var e=b.getInnerViewportScrollNode();return e?k.getLayerTree().getLayerByElementId(e.getElementId()):null},b.getOuterViewportScrollLayer=function(){var e=b.getOuterViewportScrollNode();return e?k.getLayerTree().getLayerByElementId(e.getElementId()):null},b.getOuterViewportContentLayer=function(){return m?-1===m.outer_content?b.getOuterViewportScrollLayer():k.getLayerTree().getLayer(m.outer_content):null},b.updateFrameSink=function(e,t){I[e]=t},b.isLthAlive=function(e){return E.hasOwnProperty(e)},b.invalidateLthProjections=function(e){E[e].setInvalidateProjections()},b.invalidateLthClips=function(e){E[e].setInvalidateClips()},b.invalidateLthEffects=function(e){E[e].setInvalidateEffects()},b.resetCachedSurfaceLayerList=function(){L=[]},b.registerSurface=function(e,t,r){var n=r.getSurfaceFrameSinkId();B(n),E[n].registerParentLth(e,t,r.getSiblingRank()),r.getChildrenDiv().appendChild(E[n].getDiv()),E[n].getDiv().style.display="block",b.resetCachedSurfaceLayerList()},b.unregisterSurface=function(e){var t=E[e];t&&(t.unregisterParentLth(),document.body.appendChild(t.getDiv()),t.getDiv().style.display="none",b.resetCachedSurfaceLayerList(),f&&f.getShadowElementManager().unregisterSurface(e))},b.isLthTreeReady=function(e){for(;e&&e.getParentLthFrameSinkId();)e=E[e.getParentLthFrameSinkId()];return e&&e.isMainFrame()},b.getLthCount=function(){var e=0;return H((function(t){e+=1})),e},b.updateLthChildPaintRanks=function(e){e.forEachChildLth((function(t,r){var n,o;o=e.getLayerTree().getLayer(r),b.isLthAlive(t)&&o&&((n=E[t]).updatePaintRanks(e.getPaintRanks(),o.getSiblingRank(),!0),b.updateLthChildPaintRanks(n))}))},b.setNeedsDrawFrame=function(e){D|=e},b.isInAnimationFrame=function(){return M},b.sendCommand=X,b.sendCompositorMessage=q,b.requestDisplayListDelta=function(e){var t=Compositor.MessageFlags.kDisplayListDelta,r=new Sk.BinaryWriter(8);r.writeUint32(t),r.writeUint32(e),q(0,r.getData())},b.sendRepaintRequest=function(e,t){var r=Compositor.MessageFlags.kInvalidateLayerRect,n=new Sk.BinaryWriter(24);n.writeUint32(r),n.writeInt32(e),n.writeRect(t),q(0,n.getData())},b.setDebugDataEnabled=function(e){var t=Compositor.MessageFlags.kSetDebugDataEnabled,r=new Sk.BinaryWriter(8);r.writeUint32(t),r.writeUint32(e),q(0,r.getData())},b.setHUDVisibility=function(e){e?(b.isLogStatsEnabled(),n.start(),n.show()):n&&(n.stop(),n.hide())},b.setDebugKeysEnabled=function(e){return l=e},b.setDebugRectsEnabled=function(e){c=e},b.getHUD=function(){return n},b.getInputDelegate=function(){return f},b.getIframeDelegate=function(){return p},b.isScrollbarVisible=function(){return!(_&Compositor.Options.kHideScrollbarLayers)},b.sendCompositorMessage=q,b.toggleTileAndLayerBorders=Z,b.invalidateLayerTree=Q,b.getTimeFromLastInput=function(){var e=(b.input||f).getLastActivityTime();return Date.now()-e.input},b.getLastMousePos=function(){return(b.input||f).getLastMousePos()},b.setFlags=function(e){_=e,Sk.setDebugEnabled(_&Compositor.Options.kEnableDebug)},b.getFlags=function(){return _},b.isVideoEnabled=function(){return!(_&Compositor.Options.kDisableVideo)},b.isNativeVideoEnabled=function(){return b.isVideoEnabled()},b.isBBoxViewEnabled=function(){return!!(_&Compositor.Options.kEnableBBoxView)},b.isHUDEnabled=function(){return!!(_&Compositor.Options.kEnableHUD)},b.isLogStatsEnabled=function(){return!!(_&Compositor.Options.kEnableLogStats)},b.isDebugEnabled=function(){return!!(_&Compositor.Options.kEnableDebug)},b.isDebugAnnotationEnabled=function(){return!!(_&Compositor.Options.kEnableDebugAnnotation)},b.isNativeOVSLScrollingEnabled=function(){return!!(_&Compositor.Options.kEnableNativeOVSLScrolling)},b.getFPS=function(){return $()},b.getFrameCount=function(){return C},b.getMinimumDistanceBeforeDrawRectUpdate=function(){return ne()>512?512:0},b.getScreenRect=function(){return F},b.getDrawRect=function(){return o},b.getLowResRSF=function(){return BrowserDetect.isDesktop()?b.getDeviceScaleFactor():1},b.setDeviceScaleFactor=function(e){i!==e&&(i=e,b.callback.fire("device-scale-factor-changed"))},b.getMaxRasterScaleFactor=function(){return R},b.setMaxRasterScaleFactor=function(e){R=e,H((function(e){e.hardInvalidateTiles()}))},b.getVisualViewportBounds=function(){return F},b.getConfig=function(){return a},b.isFullscreen=function(){return e.fullscreen.isFullscreen()},b.enableComparatorMode=function(){return b.setFlags(Compositor.Options.kDisableVideo|Compositor.Options.kSyncImageLoad|Compositor.Options.kHideScrollbarLayers),e.feedback_bar&&e.feedback_bar.removeFeedbackBar(),d&&(d.style.opacity="0"),b.setDebugRectsEnabled(!1),A=!0,e.surrogate_channel&&e.surrogate_channel.send("show-tab"),b.invalidateLayerTree(),b.full_tree_commit_count},b.hasValidViewportLayers=function(){var e=b.getInnerViewportScrollLayer(),t=b.getOuterViewportScrollLayer(),r=b.getOuterViewportContentLayer();return e&&t&&r},b.getMediaDiv=function(){return t},b.getLayoutViewportDiv=function(){return d},b.asDict=function(){var e=b.getOuterViewportScrollNode(),t=b.getInnerViewportScrollNode(),r=k.getPropertyTrees().getScrollTree(),n=b.getInnerViewportScrollLayer(),o=k.getPropertyTrees().getTransformTree().getNode(n.getTransformTreeIndex()),i=b.getOuterViewportScrollLayer(),a=k.getPropertyTrees().getTransformTree().getNode(i.getTransformTreeIndex()),s=b.getOuterViewportContentLayer(),l=k.getPropertyTrees().getTransformTree().getNode(s.getTransformTreeIndex()),c=b.getPageScaleTransformNode();return{ivsn:{container_bounds:t.getContainerBounds(),content_bounds:t.getContentBounds(),eid:t.getElementId(),max_off:t.maxScrollOffset(),current_off:r.getScrollOffset(t.getElementId()),tn:o.asDict()},ovsn:{container_bounds:e.getContainerBounds(),content_bounds:e.getContentBounds(),eid:e.getElementId(),max_off:e.maxScrollOffset(),current_off:r.getScrollOffset(e.getElementId()),tn:a.asDict()},ovcl_tn:l.asDict(),pstn:c.asDict(),psf:k.getPageScaleFactor(),vv:MetricsUtils.getVisualViewportMetrics(),screen_rect:b.getScreenRect(),draw_rect:b.getDrawRect(),layout_viewport_rect:b.getLayoutViewportDiv().getBoundingClientRect()}},b.getDrawDstId=function(e){switch(e){case Compositor.Projection.kOVCL:return b.getOuterViewportContentLayer().getTransformTreeIndex();case Compositor.Projection.kIVSL:return b.getInnerViewportScrollLayer().getTransformTreeIndex();case Compositor.Projection.kScreenSpace:return 0}},b.getProjectionMatrix=function(e,t){var r,n,o,i,a=t.getLayerTreeHost(),s=h;for(mat4.identity(s);a&&t;)i=a.isMainFrame()?b.getDrawDstId(e):a.getLayerTree().getRoot().getTransformTreeIndex(),r=t.getProjectionMatrix(i),mat4.multiply(s,r,s),n=a.getFrameSinkId(),(o=a.getParentLthFrameSinkId())?t=(a=E[o]).getSurfaceLayerForChildLth(n):a=null;return s},b.calcProjectedClipRect=function(e,t,r){for(var n,o,i,a,s,l,c=e.getLayerTreeHost(),u=Sk.Rect.makeLargest();c&&e;)s=c.isMainFrame()?t:c.getLayerTree().getRoot().getClipTreeIndex(),l=c.isMainFrame()?r:c.getLayerTree().getRoot().getTransformTreeIndex(),n=e.calcClipRect(s,l),Sk.Rect.isLargest(u)?u=Sk.Rect.intersection(n,u):(o=e.getProjectionMatrix(l),u=Sk.Rect.intersection(Compositor.Matrix3D.mapRect(o,u),n)),i=c.getFrameSinkId(),(a=c.getParentLthFrameSinkId())?e=(c=E[a]).getSurfaceLayerForChildLth(i):c=null;return u},b.calcClipRect=function(e){var t=b.getOuterViewportContentLayer().getTransformTreeIndex(),r=b.getOuterViewportContentLayer().getClipTreeIndex(),n=b.getInnerViewportScrollLayer().getTransformTreeIndex(),o=b.getInnerViewportScrollLayer().getClipTreeIndex(),i=e.isFixedToViewport();return b.calcProjectedClipRect(e,i?o:r,i?n:t)},b.getScreenSpaceClipRect=function(e){return b.calcProjectedClipRect(e,0,0)},b.getLthFromSurface=function(e){var t=e.getSurfaceFrameSinkId();return t?E[t]:null},b.hitTestSurface=function(e,t){var r,n,o,i;for(me(),r=0;r<L.length;r+=1)if((n=L[r].hitTestPoint(e))&&(o=L[r].getBoundsRect(),Sk.Rect.containsPoint(o,n)&&(i=b.getLthFromSurface(L[r]))&&t(i,n,L[r])))return;t(k,e,null)},b.findTargetAndCallback=function(e,t){ke(k,e,e,0,t)},b.getFidFromScreenPos=function(t,r){var n=e.fid,o=Compositor.Offset.makeXY(t,r);return b.findTargetAndCallback(o,(function(e,t){return n=e,!0})),n},b.getLthForFrame=function(e){var t=I[e];return t?E[t]:null},b.getSurfaceLayerForFrame=function(e){var t,r=I[e];return r&&(t=E[r].getParentLthFrameSinkId())?E[t].getSurfaceLayerForChildLth(r):null},b.getMainFrameSurfaceLayer=function(e){var t,r;for(e.isMainFrame();e&&!e.isMainFrame();)t=e.getParentLthFrameSinkId(),r=e.getFrameSinkId(),e=E[t];return e?e.getSurfaceLayerForChildLth(r):null},b.toScreenBounds=function(e,t){var r=b.getSurfaceLayerForFrame(e);return r?r.toScreenSpaceRect(t):t},b.wheelHandlerStateChanged=function(e,t){var r=I[e];r&&E[r].getScrollDelegate().wheelHandlerStateChanged(t)},b.processCommit=fe,b.release=function(){b.input&&(b.input.release(),b.input=null),f&&(f.release(),f=null),p&&(p.release(),p=null),n&&(n.release(),n=null),u&&(u.release(),u=null),b.in_page_searcher&&(b.in_page_searcher.release(),b.in_page_searcher=null),T&&(T.release(),T=null),g&&(g.release(),g=null),H((function(e){e.release()})),t&&t.parentNode&&(t.parentNode.removeChild(t),t=null),d&&d.parentNode&&(d.parentNode.removeChild(d),d=null),r&&(r.release(),r=null),A=!1,Sk.fini()},b.getFrameTreeNodeId=function(e){return O.getKeyByVal(e)},b.getFrameToken=function(e){return O.getValByKey(e)},b.onRenderFrameDeleted=he,a=new Compositor.Config(ye),window.mat3=glMatrix.mat3,window.mat4=glMatrix.mat4,window.vec2=glMatrix.vec2,window.vec3=glMatrix.vec3,window.vec4=glMatrix.vec4,h=mat4.create(),Sk.Logger=Logger,Sk.assert=assert,Sk.assertUnimplemented=assert_unimplemented,Sk.init({tile:BrowserDetect.isDesktop()?1<<29:1<<27,rcache:1<<25,shader:1<<24,"save-layer":1<<24,"hit-test":1<<23}),window.DEBUG&&b.setFlags(_|Compositor.Options.kEnableDebug),["safeview-info","sv-template"].forEach((function(e){for(var t;(t=document.getElementsByTagName(e))&&t.length;)t[0].parentNode.removeChild(t[0])})),B(P),k=E["0:0"],e.interp.registerBinaryHandler(pe),b.commit_count=0,b.full_tree_commit_count=0,b.commit_bytes=0,t=document.createElement("div"),b.isDebugEnabled()&&(t.id="sv-media"),t.style.display="none",document.body.appendChild(t),e.media_objects.setClient({new_media_node:le,did_remove_media_node:ce}),de(),b.callback=new CallbackSupport,r=new Sk.ImageLoader(re),(g=new Compositor.VisualViewportDelegate(e,b)).asDict(),BrowserDetect.isDesktop()?(b.input=new Compositor.Input(e,b),b.selection=new Compositor.Selection(e,b),b.ime=new Compositor.IME(e)):f=new Compositor.InputDelegate(e,b),b.in_page_searcher=new Compositor.InPageSearcher(e),p=new Compositor.IframeDelegate(e,b),new Compositor.Extras(e).init(),new Compositor.ScrollContentPrefetcher(e,K).init(),s=new Compositor.FlowController(e,b),b.isDebugEnabled()&&(b.debug=new Compositor.Debug(b)),n=new Compositor.HUD(ee),b.setHUDVisibility(b.isHUDEnabled()),b.setDebugKeysEnabled(b.isDebugEnabled()),b.setDebugDataEnabled(b.isDebugEnabled()),document.body.appendChild(n.getDiv()),(v=document.createElement("div")).id="sv-lvp-div",v.style.display="block",v.style.position="fixed",v.style.backgroundColor="blue",b.isDebugEnabled()||(v.style.opacity="0"),v.style.height="1px",v.style.width="100%",v.style.left="0px",v.style.top="0px",v.style.webkitUserSelect="none",v.style.userSelect="none",document.body.appendChild(v),d=v,b.in_page_searcher.insertInput(),(u=new Compositor.RequestAnimationFrame(Y)).start(),S=new Compositor.TileManager,y=new Compositor.RemoteInputTracker(e,b),e.callback.fire("remoting-v2-activated"),e.callback.register("metrics-changed",ie),e.metrics_observer.checkForMetricsChange("init"),T.add([[document,"keydown",te,!1],[document,"visibilitychange",se,!1],[window,"unload",ue]]),e.interp.registerOpcodeHandler("ftimu",Se),e.interp.registerOpcodeHandler("sifd",he)},Compositor.Offset=function(){"use strict";var e={};return e.isValid=function(e){return"number"==typeof e.x&&"number"==typeof e.y},e.makeXY=function(e,t){return{x:e,y:t}},e.makeZero=function(){return e.makeXY(0,0)},e.makeCopy=function(t){return e.isValid(t),e.makeXY(t.x,t.y)},e.setToZero=function(e){e.x=e.y=0},e.setToMax=function(e,t){return e.x=e.x>=t.x?e.x:t.x,e.y=e.y>=t.y?e.y:t.y,e},e.setToMin=function(e,t){return e.x=e.x<=t.x?e.x:t.x,e.y=e.y<=t.y?e.y:t.y,e},e.add=function(t,r,n){var o=n||e.makeCopy(t);return o.x+=r.x,o.y+=r.y,o},e.subtract=function(t,r,n){var o=n||e.makeCopy(t);return o.x-=r.x,o.y-=r.y,o},e.multiply=function(t,r,n){var o=n||e.makeCopy(t);return o.x*=r.x,o.y*=r.y,o},e.scale=function(t,r,n){var o=n||e.makeCopy(t);return o.x*=r,o.y*=r,o},e.roundDown=function(e){return e.x=Math.floor(e.x),e.y=Math.floor(e.y),e},e.abs=function(t){return e.makeXY(Math.abs(t.x),Math.abs(t.y))},e.sign=function(t){return e.makeXY(Math.sign(t.x),Math.sign(t.y))},e.isEqual=function(t,r){return e.isValid(t)&&e.isValid(r),t.x===r.x&&t.y===r.y},e.isZero=function(t){return e.isValid(t),0===t.x&&0===t.y},e.angleBetween=function(e,t,r){var n,o=vec2.fromValues(e.x,e.y),i=vec2.fromValues(t.x,t.y);return 0===(n=r?Math.sign(vec2.cross([],o,i)[2]):1)&&(n=1),180*(vec2.angle(o,i)*n)/Math.PI},e}(),Compositor.CSS=function(){"use strict";var e={toCursorName:function(e){switch(e){case Sk.HT.CursorType.kNone:return"none";case Sk.HT.CursorType.kCopy:return"copy";case Sk.HT.CursorType.kAuto:return"auto";case Sk.HT.CursorType.kCrosshair:return"crosshair";case Sk.HT.CursorType.kDefault:return"default";case Sk.HT.CursorType.kPointer:return"pointer";case Sk.HT.CursorType.kMove:return"move";case Sk.HT.CursorType.kVerticalText:return"vertical-text";case Sk.HT.CursorType.kCell:return"cell";case Sk.HT.CursorType.kContextMenu:return"context-menu";case Sk.HT.CursorType.kAlias:return"alias";case Sk.HT.CursorType.kProgress:return"progress";case Sk.HT.CursorType.kNoDrop:return"no-drop";case Sk.HT.CursorType.kNotAllowed:return"not-allowed";case Sk.HT.CursorType.kZoomIn:return"zoom-in";case Sk.HT.CursorType.kZoomOut:return"zoom-out";case Sk.HT.CursorType.kEResize:return"e-resize";case Sk.HT.CursorType.kNeResize:return"ne-resize";case Sk.HT.CursorType.kNwResize:return"nw-resize";case Sk.HT.CursorType.kNResize:return"n-resize";case Sk.HT.CursorType.kSeResize:return"se-resize";case Sk.HT.CursorType.kSwResize:return"sw-resize";case Sk.HT.CursorType.kSResize:return"s-resize";case Sk.HT.CursorType.kWResize:return"w-resize";case Sk.HT.CursorType.kEwResize:return"ew-resize";case Sk.HT.CursorType.kNsResize:return"ns-resize";case Sk.HT.CursorType.kNeswResize:return"nesw-resize";case Sk.HT.CursorType.kNwseResize:return"nwse-resize";case Sk.HT.CursorType.kColResize:return"col-resize";case Sk.HT.CursorType.kRowResize:return"row-resize";case Sk.HT.CursorType.kText:return"text";case Sk.HT.CursorType.kWait:return"wait";case Sk.HT.CursorType.kHelp:return"help";case Sk.HT.CursorType.kAllScroll:return"all-scroll";case Sk.HT.CursorType.kGrab:return"grab";case Sk.HT.CursorType.kGrabbing:return"grabbing";default:return"default"}}};return e}(),Compositor.Bounds=function(){"use strict";var e={isValid:function(e){return"number"==typeof e.width&&"number"==typeof e.height},isEmpty:function(e){return e.width*e.height==0},scale:function(e,t){return{width:e.width*t,height:e.height*t}},setToMin:function(e,t){return{width:Math.min(e.width,t.width),height:Math.min(e.height,t.height)}},ceil:function(e){return{width:Math.ceil(e.width),height:Math.ceil(e.height)}}};return e}(),Compositor.Util=function(){"use strict";var e={};return e.quadBezier=function(e,t,r,n){var o=1-e;return t*(o*o)+2*r*o*e+n*(e*e)},e.toggleStyle=function(e,t){var r=document.getElementById(e);r?r.parentNode.removeChild(r):((r=document.createElement("style")).id=e,r.appendChild(document.createTextNode(t)),document.head.appendChild(r))},e.checkFlag=function(e,t){return t,!!(e&t)},e}(),Compositor.Set=function(e){"use strict";var t=this,r={},n=0;t.add=function(t){var o=e(t);r.hasOwnProperty(o)?r[o]=t:(r[o]=t,n+=1)},t.remove=function(t){var o=e(t);return!!r.hasOwnProperty(o)&&(n-=1,delete r[o],!0)},t.has=function(t){var n=e(t);return r.hasOwnProperty(n)},t.size=function(){return n},t.forEachItem=function(e){Util.forEachItem(r,e)},t.asDict=function(){return r}},Compositor.OrderedMap=function(){"use strict";var e=this,t={},r=[],n=0;e.set=function(e,o){return t.hasOwnProperty(e)?(t[e]=o,o):(t[e]=o,r.push(e),n+=1,o)},e.get=function(e){return t[e]},e.has=function(e){return t.hasOwnProperty(e)},e.size=function(){return n},e.forEachEntryInOrder=function(e){var n,o=0;for(o=0;o<r.length;o+=1)n=r[o],t.hasOwnProperty(n)&&e(n,t[n])}},Compositor.BiMap=function(){"use strict";var e=this,t={},r={};e.erase=function(e,n){t.hasOwnProperty(e)&&r.hasOwnProperty(n)&&t[e]===n&&r[n]===e&&(delete t[e],delete r[n])},e.set=function(e,n){t.hasOwnProperty(e)&&t[e]!==n&&delete r[t[e]],r.hasOwnProperty(n)&&r[n]!==e&&delete t[r[n]],t[e]=n,r[n]=e},e.getValByKey=function(e){return t[e]},e.getKeyByVal=function(e){return r[e]},e.viewFromLeft=function(){return __object_assign({},t)},e.viewFromRight=function(){return __object_assign({},r)}},Compositor.ManagedListeners=function(){"use strict";var e=[];this.add=function(t){t.forEach((function(t){e.push(t)})),t.forEach((function(e){EventListener.addListener.apply(EventListener,e)}))},this.release=function(){e.forEach((function(e){EventListener.removeListener.apply(EventListener,e)})),e=[]}},Compositor.FloatingPoint=function(){"use strict";var e={TOLERANCE:1e-5,isEqual:function(t,r,n){return arguments.length<3&&(n=e.TOLERANCE),Math.abs(t-r)<=n||0!==t&&0!==r&&(Math.abs((t-r)/r)<=n||Math.abs((t-r)/t)<=n)}};return e}(),Compositor.TileType=Object.freeze({kSolidColor:0,kCanvasDevice:1,kDOMDevice:2}),Compositor.TilingSet=function(e){"use strict";var t,r,n,o=this,i=0,a=0,s={},l={},c=null,u=Sk.Region.makeEmpty(),d=null,f=!1;function p(e){Sk.Region.subtractRect(u,e)}function g(e,t){return e|t<<16}function m(e){return e.type===Compositor.TileType.kCanvasDevice||e.type===Compositor.TileType.kDOMDevice}function k(t){var r,n,o,i=e.layer.getDisplay().getConfig(),a=0,s=!1;return e.layer.hasVideoContent()||e.delta_mode?Compositor.TileType.kCanvasDevice:void 0!==l[t.key]?l[t.key]:void 0===e.display_list.getSolidColorInRect(t.rect)||e.layer.hasCaret()?(a|=Sk.PictureFlags.kHasHardCompositingOp,(BrowserDetect.isSafari()||BrowserDetect.isIE()||BrowserDetect.isEdge())&&(BrowserDetect.supportsComplexCSSClipPath()||(a|=Sk.PictureFlags.kHasComplexClip),a|=Sk.PictureFlags.kHasColorFilter,a|=Sk.PictureFlags.kHasBlendOp,r=Sk.PictureFlags.kHasImageFilter|Sk.PictureFlags.kHasHardCompositingOp,n=Sk.PictureFlags.kHasCSSGradientShader,s=(o=e.display_list.hasPictureFlagsSetInRect(t.rect,[r,n]))[0]||o[1]),!i.getEnableDOMRasterization()||!s&&e.display_list.hasPictureFlagsInRect(t.rect,a)?Compositor.TileType.kCanvasDevice:Compositor.TileType.kDOMDevice):Compositor.TileType.kSolidColor}function h(t){return n&&Sk.Rect.intersects(t,n)?e.layer.getRasterScaleFactor():e.layer.getDisplay().getLowResRSF()}function S(e){return e.canvas?e.canvas.getNode():e.div}function y(t){e.layer.applyDrawTransform(S(t),t.rect)}function v(t){e.layer.applyDrawClip(S(t),t.rect,d)}function b(t){e.layer.applyDrawOpacity(S(t))}function C(n,s){var l,c,u=Sk.Rect.fromXYWH(i*n,a*s,i,a),d=Sk.Rect.intersection(r,u),f={rect:d,index_x:n,index_y:s,key:g(n,s),lid:e.layer.getID(),layer:e.layer,fid:e.layer.getLayerTreeHost().getFid(),mem_size:0,force_realloc:!1,rsf:h(u)};if(f.type=k(f),f.type===Compositor.TileType.kSolidColor)f.div=(l=d,(c=document.createElement("div")).style.position="absolute",c.style.width=Sk.Rect.getWidth(l)+"px",c.style.height=Sk.Rect.getHeight(l)+"px",c.className=e.class_name||"sv-tile",DEBUG&&c.setAttribute("rect",Sk.Rect.toString(l)),c),t.appendChild(f.div);else{if(f.canvas=function(t){var r,n,i,a,s={};if(m(t),t.type===Compositor.TileType.kCanvasDevice){if(!(r=new Sk.HTMLCanvasDevice("tile",Sk.Rect.roundOut0(Sk.Rect.scale(t.rect,t.rsf)),{x:Sk.Rect.getX(t.rect),y:Sk.Rect.getY(t.rect)},t.rsf)).tryAlloc())return null;s.use_raster_cache=!0}else e.layer.getDisplay().getConfig().getEnableDOMText()&&(a=new Sk.TextFitter(e.layer.getLayerTreeHost().getTypefaceDelegate(),e.layer.getLayerTreeHost().getFid())),r=new Sk.DOMDevice("tile",t.rect,{x:Sk.Rect.getX(t.rect),y:Sk.Rect.getY(t.rect)},BrowserDetect.supportsComplexCSSClipPath(),e.layer.getDisplay().getConfig().getEnableCSSGradients(),a,null,e.layer.getLayerTreeHost().getFid()),s.use_raster_cache=!1;return s.text_boxes=!1,s.hit_item_listener=e.layer.onHitTestData,(i=(n=new Sk.Canvas(r,o.invalidateRect,s,{lid:e.layer.getID()})).getNode()).style.position="absolute",i.style.width=Sk.Rect.getWidth(t.rect)+"px",i.style.height=Sk.Rect.getHeight(t.rect)+"px",i.className=e.class_name||"sv-tile",DEBUG&&(i.id="tile-"+e.layer.getLayerTreeHost().getFid()+":"+e.layer.getID()+"-"+t.index_x+"-"+t.index_y,i.setAttribute("rect",Sk.Rect.toString(t.rect))),n}(f),!f.canvas)return null;f.mem_size=f.canvas.getDevice().getMemoryUsage(),t.appendChild(f.canvas.getNode())}return y(f),v(f),b(f),DEBUG&&(f.label_div=function(t){var r,n=document.createElement("div"),o=e.layer.getScreenSpaceScaleFactor(),s=Math.max(o[0],o[1]);return n.style.display="none",n.style.position="absolute",n.style.left=Sk.Rect.getX(t.rect)+"px",n.style.top=Sk.Rect.getY(t.rect)+"px",n.style.backgroundColor="teal",n.style.color="white",n.style.whiteSpace="nowrap",n.style.pointerEvents="none",n.style.fontSize=Math.max(Math.floor(12/s),1)+"px",n.className="sv-tile-label",e.layer.applyDrawTransform(n,t.rect),r="["+e.layer.getLayerTreeHost().getFid()+":"+e.layer.getID()+"]",e.layer.isSurfaceForChildFrame()&&(r+=" ("+e.layer.getSurfaceFrameSinkId()+")"),r+=" X: "+t.index_x+", Y: "+t.index_y,r+=" "+i+"x"+a,r+=" T: ",t.type===Compositor.TileType.kCanvasDevice?r+="C":t.type===Compositor.TileType.kDOMDevice?r+="D":r+="S",r+=" RSF: "+t.rsf.toFixed(1),t.canvas&&t.canvas.getDevice()&&(r+=" "+(t.canvas.getDevice().getMemoryUsage()/1048576).toFixed(1)+" MB"),n.textContent=r,n}(f),t.appendChild(f.label_div)),e.layer.getDisplay().getTileManager().addTile(f),f}function _(r){s[r.key],delete s[r.key],m(r)?r.canvas&&(t.removeChild(r.canvas.getNode()),r.canvas.release(),r.canvas=null):(r.type,Compositor.TileType.kSolidColor,t.removeChild(r.div),r.div=null),r.label_div&&r.label_div.parentNode&&r.label_div.parentNode.removeChild(r.label_div),e.layer.getDisplay().getTileManager().removeTile(r)}function T(e){var t,n,s,l,c=Sk.Rect.intersection(r,e);return Sk.Rect.isEmpty(c)?null:(t=Math.floor(Sk.Rect.getY(c)/a),n=Math.floor((Sk.Rect.getBottom(c)-1)/a),s=Math.floor(Sk.Rect.getX(c)/i),l=Math.floor((Sk.Rect.getRight(c)-1)/i),Math.ceil(o.height()/a),o.height(),Math.ceil(o.width()/i),{start_r:t,end_r:n,start_c:s,end_c:l})}function w(){Util.forEachItem(s,(function(e,t){var r=h(t.rect);t.type===Compositor.TileType.kCanvasDevice&&(t.rsf<r?(o.hardInvalidateTilesInRect(t.rect),1):t.rsf>r&&(!function(e){_(e),e.key,s[e.key]}(t),o.invalidateRect(t.rect,"downgrade"),1))}))}function R(){var t,n,o,i,a,s,l=(s=e.layer.getScreenSpaceScaleFactor(),e.layer.isAttached()?(o=e.layer.getDisplay().getScreenRect(),i=Sk.Rect.fromWH(Sk.Rect.getWidth(o),Sk.Rect.getHeight(o)/2),t=Math.max(1,s[0]),n=Math.max(1,s[1]),a=Sk.Rect.roundOut0(Sk.Rect.scaleXY(i,1/t,1/n)),{width:Math.min(2048,Sk.Rect.getWidth(a)),height:Math.min(512,Sk.Rect.getHeight(a))}):{width:0,height:0}),c=l.width,u=l.height;return c=Math.min(Sk.Rect.getWidth(r),c),u=Math.min(Sk.Rect.getHeight(r),u),c=Math.ceil(c),u=Math.ceil(u),{width:c=Math.min(2048,c),height:u=Math.min(512,u)}}function x(t,r,n,o,i){var a=t.getCullRect(),s=o.canvas;o.type!==Compositor.TileType.kSolidColor?(m(o),e.layer.subtractHittableRect(i),s.save(),s.clipRect(Sk.Rect.intersection(a,i)),e.delta_mode||r||s.clearRect(i),s.translate(Sk.Rect.getX(a),Sk.Rect.getY(a)),t.playback(s,n),s.restore()):o.div.style.backgroundColor=Sk.Paint.skColorToCSSColor(e.display_list.getSolidColorInRect(i))}function D(t,r,n,o){n.type===Compositor.TileType.kDOMDevice&&(o=n.rect,n.canvas.getDevice().reset()),e.display_list.forEachAllocatedTileInRect(o,(function(o,i){var a=e.display_list.getTileByKey(o);a&&a.getRecording()&&x(a.getRecording(),t,r,n,i)}))}o.isRectDirty=function(e){return Sk.Region.intersectsRect(u,e)},o.getDirtyRegion=function(){return u},o.invalidateRect=function(t,r){Sk.Rect.isEmpty(t)||(e.layer.isTextureLayer()||e.layer.isSurfaceLayerForOSC()?e.layer.getLayerTreeHost().setNeedsRepaint(e.layer.getID(),t):(Sk.Region.addRect(u,t),e.layer.getLayerTreeHost().setLayerTilesBecameDirty(e.layer.getID())))},o.getDomNode=function(){return t},o.width=function(){return Sk.Rect.getWidth(r)},o.height=function(){return Sk.Rect.getHeight(r)},o.removeKnownTilesType=function(){c&&(clearTimeout(c),c=null),c=setTimeout((function(){l={}}),1e3)},o.requestTileType=function(e,t,r){r===Compositor.TileType.kCanvasDevice||r===Compositor.TileType.kDOMDevice||Compositor.TileType.kSolidColor,o.forEachTileInRect(e,(function(e,n,o){var i,a=g(n,o);l[a]=r,e&&e.type!==r&&(_(e),i=(e=C(n,o)).rect,e&&(S(e),s[e.key]=e,p(i),D(t,null,e,i)))}))},o.forEachTileInRect=function(e,t){var r,n,o;if(o=T(e))for(r=o.start_r;r<=o.end_r;r+=1)for(n=o.start_c;n<=o.end_c;n+=1)t(s[g(n,r)],n,r)},o.forEachAllocatedTileInRect=function(e,t){var r,n,o;(o=T(e))&&Util.forEachItem(s,(function(e,i){n=function(e){return 65535&Number(e)}(e),r=function(e){return Number(e)>>16&65535}(e),n<o.start_c||n>o.end_c||r<o.start_r||r>o.end_r||t(i,n,r)}))},o.freeTiles=function(e){var t=Date.now();Util.forEachItem(s,(function(t,r){e&&!e(r)||(_(r),1)})),Date.now()},o.hasTiles=function(){return!Util.isDictEmpty(s)},o.setHighResWindowToRect=function(e){n&&Sk.Rect.isEqual(e,n)||(n=Sk.Rect.makeCopy(e),w())},o.getTileRectByIndices=function(e,t){return Sk.Rect.fromXYWH(i*e,a*t,i,a)},o.drawTilesInRect=function(e,t){Sk.Rect.isValid(e);var n=Sk.Rect.intersection(r,e),i=!0;return Sk.Rect.isEmpty(n)||o.forEachTileInRect(n,(function(e,r,o){var a,l=!1;if(!e||e.type,e&&(e.force_realloc||function(e){return e&&e.type,e.type!==k(e)}(e))&&(l=!0,_(e),e=null),!e){if(!(e=C(r,o)))return void(i=!1);S(e),e.force_realloc,s[e.key]=e}p(a=l?e.rect:Sk.Rect.intersection(n,e.rect)),Sk.Rect.isEmpty(a),t(e,a)})),i},o.hardInvalidateTilesInRect=function(e){o.forEachAllocatedTileInRect(e,(function(t){t.force_realloc=!0,o.invalidateRect(e,"invalidate-tiles")}))},o.hardInvalidateWithTileRecalc=function(){var t;if(o.hardInvalidateTilesInRect(r),e.layer.isUntiled())return i=Sk.Rect.getWidth(r),void(a=Sk.Rect.getHeight(r));t=R(),i=t.width,a=t.height},o.resize=function(t,n,s){var l,c,u=r;u&&Sk.Rect.getWidth(u)===t&&Sk.Rect.getHeight(u)===n&&f===e.layer.isUntiled()||(f=e.layer.isUntiled(),l=Sk.Rect.fromWH(t,n),o.freeTiles(),r=l,Sk.Rect.isEmpty(l)||(e.layer.isUntiled()?(i=t,a=n):(c=R(),i=c.width,a=c.height),o.invalidateRect(l,"resize")))},o.drawRect=function(e,t,r){return Sk.Rect.isIntRect(e),o.drawTilesInRect(e,D.curry(t,r))},o.playback=function(t,r,n,i){return e.delta_mode,o.drawTilesInRect(r,x.curry(t,n,i))},o.release=function(){o.freeTiles(),r=Sk.Rect.makeEmpty(),t&&t.parentNode&&(t.parentNode.removeChild(t),t=null),d=null},o.updateProjection=function(){o.forEachAllocatedTileInRect(r,(function(e){S(e)&&y(e)}))},o.updateClip=function(e){(d||e)&&(d&&e&&Sk.Rect.isEqual(d,e)||(d=e?Sk.Rect.makeCopy(e):null,o.forEachAllocatedTileInRect(r,(function(e){S(e)&&v(e)}))))},o.updateOpacity=function(){o.forEachAllocatedTileInRect(r,(function(e){S(e)&&b(e)}))},o.getLayer=function(){return e.layer},e.delta_mode,t=document.createElement("div"),o.resize(0,0,"init")},Compositor.Input=function(e,t){"use strict";var r,n,o,i,a,s,l,c,u=new Logger("r2-input",{level:"info"}),d=this,f=t.getMainFrame(),p=!1,g={x:0,y:0,type:""},m={x:0,y:0,fid:f.getFid()},k=new KeyMap,h=new ShortcutKeyHandler(e),S=null,y=null,v=null,b=0,C={last_click_time:0,last_mouse_time:0,last_key_time:0},_={},T=!1,w=f.getFid(),R=f.getFid(),x=f.getFid();function D(t){e.surrogate_channel&&e.surrogate_channel.send.apply(e.surrogate_channel,t)}function M(){return e.ctx_menu_mode&&e.ctx_menu_mode.backend_driven}function F(e){return!!Util.findPredicateOnBranch(e.target,(function(e){return e.getAttribute&&!!e.getAttribute("sv-prevent-push")}))}function E(e){if(M()&&(2===e.button||BrowserDetect.isMac()&&0===e.button&&e.ctrlKey))return F(e);if(1===e.button||2===e.button)return!0;if(BrowserDetect.isMac()&&0===e.button){if(e.ctrlKey)return!0;if(e.metaKey)return!0}return!!e.__sv_synthesized_s_click||F(e)}function I(){return m.fid}function P(e){e.type,e.button,function(e){return!E(e)&&"click"===e.type}(e)?e.preventDefault():(E(e)&&e.stopPropagation(),"click"===e.type&&("select"===e.target.tagName.toLowerCase()?(!function(e){var t=e.target.node_id,r=I(),n=e.type;D(["CM-simulate-event",r,t,String(n)])}(e),e.target.hasAttribute("sv-active")?e.target.removeAttribute("sv-active"):e.target.setAttribute("sv-active","")):e.target.hasAttribute("sv-base-temporal")?e.target.setAttribute("sv-base-temporal",1):"color"===e.target.getAttribute("type")&&(e.target.hasAttribute("sv-color-chooser-opens")?e.target.removeAttribute("sv-color-chooser-opens"):e.target.setAttribute("sv-color-chooser-opens",""))))}function L(e,t,r,n,o,i){var a=e?EventListener.addListener:EventListener.removeListener;r.forEach((function(e){a(t,e,n,!!o,!!i)}))}function O(e){var t=e.target.value,r=e.target.node_id;D(["CM-select",I(),r,Number(t)])}function A(e){e.target.hasAttribute("sv-active")&&13===e.keyCode?e.target.removeAttribute("sv-active"):e.target.hasAttribute("sv-active")||38!==e.keyCode&&40!==e.keyCode||e.target.setAttribute("sv-active","")}function B(e){return!!(e.flags&Sk.HT.InputElement.Flags.kIsBaseTemporal)}function H(e){return e.type===Sk.HT.InputElement.Type.kColor}function N(e,r){var n,o,i,a=[e],s=e.data.node_id,l=e.data.node_uid,c=e.data.formctrl,u=c.input,d=t.getFrameTreeNodeId(e.data.frame_token),f=Number(d),p=Number(s);return BrowserDetect.isIE()?null:c.type===Sk.HT.FormControlElement.Type.kInput&&function(e){return!!e&&(B(e)||H(e))}(u)?((n=new Compositor.ShadowTextControl(f,p,String(l),null)).layer=r,n.init(a),n.update(a),o=n.getNode(),n.release(),i=r.toScreenSpaceRect(e.visual_rect),o.style.position="fixed",o.style.opacity="0",o.style.left=Sk.Rect.getLeft(i)+"px",o.style.top=Sk.Rect.getTop(i)+"px",o.style.width=Sk.Rect.getWidth(i)+"px",o.style.height=Sk.Rect.getHeight(i)+"px",B(u)?function(e,r,n,o){var i=o.input;B(i),BrowserDetect.isSafari()&&i.type!==Sk.HT.InputElement.Type.kMonth&&i.type!==Sk.HT.InputElement.Type.kTime&&i.type!==Sk.HT.InputElement.Type.kWeek||e.removeAttribute("sv-prevent-push"),L(!0,e,["change","input"],(function(e){var o=e.target,i=e.type;"change"===i&&o.setAttribute("sv-base-temporal",0),t.sendCommand([i,r,n,o.value])}),!0)}(o,f,p,c):H(u)&&L(!0,o,["change","input"],(function(e){var r=e.target,n=e.type;"change"===n&&r.removeAttribute("sv-color-chooser-opens"),t.sendCommand([n,f,p,r.value])}),!0),o):null}function U(e){e.node_id;var t=e.items,r=null,n=null;e.textContent="",t.forEach((function(t){switch(t.type){case"separator":(r=document.createElement("option")).textContent="-----",r.setAttribute("disabled",!0),e.appendChild(r),n=null;break;case"group":(r=document.createElement("optgroup")).setAttribute("label",t.label),e.appendChild(r),n=r;break;case"option":(r=document.createElement("option")).textContent=t.label,r.setAttribute("value",t.index),t.checked&&r.setAttribute("selected",!0),t.enabled||r.setAttribute("disabled",!0),t.hidden&&(r.setAttribute("hidden",!0),r.style.display="none",r.style.visibility="hidden"),t.in_group?n.appendChild(r):(n=null,e.appendChild(r));break;default:u.error({event:"tc-unrecognized-select-item-type",type:t.type})}}))}function V(t,r){var n,i,a,s={user_initiated:!0,uri:r,target_uri:Util.rewriteRawHref(r)};if(!BrowserDetect.isIE())return(a=new window.MouseEvent("click",{bubbles:!0,shiftKey:!0,button:0})).__sv_synthesized_s_click=!0,i=t||o,void(window.navigator.userActivation&&window.navigator.userActivation.isActive?i.dispatchEvent(a):(s.new_window_cb=function(e){"allow"===e&&i.dispatchEvent(a)},e.ui_frame.call("showPopupOpenModal",s)));n=["innerWidth","innerHeight","screenX","screenY"].reduce((function(e,t){return window[t]?e+","+t+"="+window[t]+"px":e}),"toolbar,location,scrollbars,menubar,resizable"),s.feature_str=n,e.tab.openTabWithInfo(s)}function z(t){var r,n,o,i,a;return t.select_items&&t.select_items.length?(n=t.node_id,o=t.select_items,i=t.viewport_bounds,(a=document.createElement("select")).node_id=n,a.items=o,a.setAttribute("sv-prevent-push",!0),a.style.position="fixed",a.style.left=Sk.Rect.getLeft(i)+"px",a.style.top=Sk.Rect.getTop(i)+"px",a.style.width=Sk.Rect.getWidth(i)+"px",a.style.height=Sk.Rect.getHeight(i)+"px",BrowserDetect.isSafari()&&(a.style.webkitAppearance="none"),a.style.opacity="0",a.style.cursor="inherit",U(a),L(!0,a,["change"],O,!1),L(!0,a,["keyup"],A,!0),r=a):t.url&&!M()?r=function(t){var r=document.createElement("a"),n=document.createElement("div");return n.style.position="fixed",n.style.left=Sk.Rect.getLeft(t.viewport_bounds)+"px",n.style.top=Sk.Rect.getTop(t.viewport_bounds)+"px",n.style.width=Sk.Rect.getWidth(t.viewport_bounds)+"px",n.style.height=Sk.Rect.getHeight(t.viewport_bounds)+"px",r.style.cursor="inherit",r.href=Util.rewriteRawHref(t.url),r.appendChild(n),t.link_target_blank?r.addEventListener("click",(function(r){e.tab.tabPreOpen(t.url)&&r.preventDefault()}),!1):r.addEventListener("click",(function(r){r.ctrlKey&&e.tab.tabPreOpen(t.url)&&r.preventDefault()})),r}(t):t.title&&(r=function(e){var t=document.createElement("div");return t.style.position="fixed",t.style.left=Sk.Rect.getLeft(e.viewport_bounds)+"px",t.style.top=Sk.Rect.getTop(e.viewport_bounds)+"px",t.style.width=Sk.Rect.getWidth(e.viewport_bounds)+"px",t.style.height=Sk.Rect.getHeight(e.viewport_bounds)+"px",t.style.backgroundColor="teal",t.style.opacity="0",t}(t)),r&&t.title&&function(e,t){var r;t.title&&((r=document.createElement("div")).style.display="none",r.style.position="fixed",r.style.maxWidth="200px",r.style.backgroundColor="gray",r.style.background="radial-gradient(circle, rgba(79,83,83,1) 0%, rgba(107,106,105,1) 100%)",r.style.color="white",r.style.font="10px sans-serif",r.style.padding="5px",r.style.border="1px white",r.style.borderRadius="2px",r.textContent=t.title,document.body.appendChild(r),e.tt=r,e.tt_timer||(e.tt_timer=setTimeout((function(){e.tt&&(e.tt.style.display="block",e.tt.style.left=g.x+"px",e.tt.style.top=g.y+20+"px",e.tt_timer=null)}),500)))}(r,t),r}function W(e){o instanceof HTMLImageElement||L(e,o,["mousedown","mouseup","click"],P,!1)}function G(){o&&o.tt&&o.tt.parentNode&&(o.tt.parentNode.removeChild(o.tt),o.tt_timer&&(clearTimeout(o.tt_timer),o.tt_timer=null),o.tt=null)}function j(){return!!o&&(G(),o.parentNode.removeChild(o),W(!1),o=null,!0)}function Y(e){var t,r;return e?(r=e.getLayer(),(t=e.hitsFormControlNode())?N(t,r):(t=e.hitsImageNode())?function(e,t){var r,n,o,i=[e];return(r=new Compositor.ShadowImageNode).layer=t,r.init(i),n=r.getNode(),r.release(),n.style.position="fixed",o=t.toScreenSpaceRect(e.visual_rect),Sk.Rect.toCSSStyle(o,n.style),n}(t,r):null):null}function X(e,r){var n;n=function(e){var t,r="default";return e.url?r="pointer":(e.is_text||e.is_editable)&&(r="text"),"auto"!==(t=e.cursor_name)&&(r=t),r}(r),document.documentElement.style.cursor=n,function(e,r){var n,i,a,s;j(),S=r,n=z(r),(a=(i=t.getLthForFrame(r.frame_id))?i.hitTest(Compositor.HitTest.kEventTarget,e):null)&&(s=Y(a),n?s&&s instanceof HTMLImageElement&&n.appendChild(s):n=s),n&&(document.body.appendChild(n),o=n,W(!0))}(e,r)}function q(){a&&(clearTimeout(a),a=null,D(r),r=null,n=null)}function K(e){return BrowserDetect.isIE()&&("mousedown"===e.type||"mouseup"===e.type||"mousemove"===e.type)&&e.detail>=4&&e.detail>b?b:e.detail}function Q(){var e;c&&(c=null,(e=t.getLthForFrame(w))&&e.getScrollDelegate().doScroll(Compositor.GestureType.kScrollEnd),w=f.getFid())}function J(e,t,r){r.fid=e,r.x=t.x,r.y=t.y}function Z(i){var l,d,k,h,S=MetricsUtils.clientToScreenPos(i.clientX,i.clientY),y={fid:f.getFid(),x:S.x,y:S.y},v=t.getConfig().getEnableDisplayListDeltaForDrag();if("mousedown"===i.type&&(i.shiftKey&&(e.interp.hasOpcodeHandler("WINDOW_new")&&e.interp.deregisterOpcodeHandler("WINDOW_new"),e.interp.registerOpcodeHandler("WINDOW_new",V.curry(i.target))),e.clipboard.piggyback(i),e.callback.fire("interaction",i),G()),function(e){!BrowserDetect.isIE()||"mousedown"!==e.type&&"mouseup"!==e.type&&"mousemove"!==e.type||("mousedown"===e.type?(b+=1,s&&(clearTimeout(s),s=null)):"mouseup"===e.type&&(s=setTimeout((function(){b=0}),500)))}(i),C.last_mouse_time=Date.now(),e.detached)e.prevent_reattach||(e.detached=!1,Util.xframe_reload());else if(Q(),i.type,S.x,S.y,Util.getMouseAndKeyboardModifiers(i,u),i.button,K(i),Util.get_node_tag(i.target),!t.in_page_searcher.mouse_event_search_input(i)&&!F(i)){if(function(e){var t,r=e.target?Util.get_node_tag(e.target):null;return!!document.documentElement&&(e.target&&"html"!==r?(e.target,"div"===r&&(t=e.target.getBoundingClientRect(),!(e.clientX>t.left+e.target.clientWidth&&e.clientY>t.top+e.target.clientHeight)&&(e.clientX>t.left+e.target.clientWidth||e.clientY>t.top+e.target.clientHeight))):e.clientX>document.documentElement.clientWidth||e.clientY>document.documentElement.clientHeight)}(i))return i.type,S.x,S.y,window.innerWidth,window.innerHeight,void Util.get_node_tag(i.target);var T,w,x;if(!(BrowserDetect.isChromiumEdge()&&"mousemove"===i.type&&o&&o.hasAttribute("sv-active")))if("mousemove"!==i.type||!o||!Number(o.getAttribute("sv-base-temporal"))&&!o.hasAttribute("sv-color-chooser-opens"))if("contextmenu"!==i.type){if("mousemove"!==i.type||"mousemove"!==g.type||S.x!==g.x||S.y!==g.y)g.x=m.x=S.x,g.y=m.y=S.y,g.type=i.type,T=g.x,w=g.y,(x=document.getElementById("sv-drag-img"))&&(x.style.left=T+"px",x.style.top=w+"px"),t.findTargetAndCallback(S,(function(e,t){return J(e,t,y),J(e,t,m),!0})),(h=function(e,r,n){var o,i,a,s=t.getLthForFrame(e),l={type:Compositor.PointerResultType.kUnhandled};if(!s||!t.getConfig().isScrollUnificationEnabled())return Compositor.ScrollAction.kNoAction;switch(i=s.getScrollbarController(),a=s.getScrollDelegate(),n.type){case"mousedown":0===n.button&&(l=i.handlePointerDown(r,n.shiftKey||n.ctrlKey));break;case"mouseup":0===n.button&&(l=i.handlePointerUp(r));break;case"mousemove":l=i.handlePointerMove(r)}return"mousemove"===n.type&&R!==e&&(o=t.getLthForFrame(R))&&o.getScrollDelegate()&&o.getScrollbarController()&&o.getScrollbarController().scrollbarScrollIsActive()&&(i=o.getScrollbarController(),a=o.getScrollDelegate(),l=i.handlePointerUp(r)),l.type===Compositor.PointerResultType.kScrollbarScroll?(R=e,a.onPointerEventScrollResult(r,l)):Compositor.ScrollAction.kNoAction}(y.fid,S,i))===Compositor.ScrollAction.kForwardToSurrogate&&(u.warn({event:"scrollbar-scroll",details:"unexpected scroll action",action:h}),i.preventDefault()),h===Compositor.ScrollAction.kPreventNativeScroll&&i.preventDefault(),l=["CM-mouse",y.fid,i.type,S.x,S.y,y.x,y.y,i.button,Util.getMouseAndKeyboardModifiers(i,u),K(i)],ce(),c&&(clearTimeout(c),c=null),"mousemove"===i.type&&(!p&&i.buttons&&v&&(p=!0,t.requestDisplayListDelta(!0)),d=Util.calculateMouseMovement(i),n&&(d.x+=n.x,d.y+=n.y),l.push(d.x),l.push(d.y)),"mousemove"!==i.type||i.buttons?(p&&v&&"mouseup"===i.type&&(p=!1,t.requestDisplayListDelta(!1),t.callback.fire("partial-dl-drag-end")),q(),D(l)):(a||(a=setTimeout((function(){q()}),10)),r=l,n=d),function(e){return"mousedown"===e.type||"mouseup"===e.type}(i)&&("mousedown"===i.type?_[i.button]=!0:_[i.button]=!1,C.last_click_time=Date.now(),i.preventDefault(),BrowserDetect.isIE()&&"mousedown"===i.type&&(k=document.activeElement,document.body.focus(),k&&k.focus()))}else M()&&i.preventDefault()}}function $(t){"html"===Util.get_node_tag(t.target)&&delete e.last_mouse_pos}function ee(t,r,n,o,i,a,s,l){o.relative_to_target=!1,e.surrogate_channel.send("drag",t,{t:r,y:n,p:o,m:i,d:a,f:s,i:l})}function te(){y&&(ee(y.frame,y.node,"dragleave",{x:0,y:0},{x:0,y:0},0,[{type:"text/plain"}],{0:{}}),y=null,v=null)}function re(r){var n,o,i,a,s,l,c,d,p=MetricsUtils.clientToScreenPos(r.clientX,r.clientY),g={fid:f.getFid(),x:p.x,y:p.y};if(e.allow_backend_dragdrop)if(t.findTargetAndCallback(p,(function(e,t){return J(e,t,g),!0})),S){if(s=g.fid,l=S.node_id,a=r.type,r.preventDefault(),"drop"===a){if(e.copy_paste_ctrl.enforce_on_user_action(r.target,r))return;e.upload.setupDroppedUpload(r.dataTransfer.files)}n={x:r.clientX,y:r.clientY,wx:g.x,wy:g.y},o=Util.calculateDragMovement(r),i=Util.getMouseAndKeyboardModifiers(r,u),c=Util.gen_dragdrop_file_list(r.dataTransfer),d=r.dataTransfer.items,y&&l===y.node||(ee(s,l,"dragenter",n,{x:0,y:0},i,c,d),y&&ee(y.frame,y.node,"dragleave",n,{x:0,y:0},i,c,d)),ee(s,l,a,n,o,i,c,d),"drop"!==a?(y={frame:s,node:l},v&&clearTimeout(v),v=setTimeout(te,550)):y=null}else D(["CM-mouse",g.fid,"mousemove",r.clientX,r.clientY,g.x,g.y,r.button,Util.getMouseAndKeyboardModifiers(r,u),r.detail])}function ne(r){var n,o=k.getKeyCode(r),i=r.keyCode,a=r.ctrlKey,s=r.metaKey,l=r.altKey,c=!1;C.last_key_time=Date.now(),e.detached?e.prevent_reattach||(e.detached=!1,Util.xframe_reload()):(r.type,r.keyCode,r.charCode,n=h.get_operation(r),"keydown"!==r.type||t.in_page_searcher.is_search_focused()||(e.clipboard.piggyback(r),e.callback.fire("interaction",r),"copy"===n||"cut"===n?t.selection.preprocess_ctrl_c_or_ctrl_x(n):"paste"===n?t.selection.on_paste_keypress(r,!1):"specialPaste"===n?t.selection.on_paste_keypress(r,!0):"selectAll"!==n&&"undo"!==n&&"redo"!==n||r.preventDefault()),e.callback.fire("key-event",r.target,r),e.print_handler.handlePrintKeyEventIfNeeded(r,n)||(i=Util.get_corresponding_chrome_keycode(r,i),"keypress"===r.type&&r.altKey&&(BrowserDetect.isIE()||RegExp("^.$","u").test(r.key))&&(a=!1,s=!1,l=!1,c=!0),"keyup"!==r.type&&!c&&h.tryProcess(r)||t.in_page_searcher.is_key_event_search_input(r)||F(r)||(D(["kbd",x||f.getFid(),0,r.type,i,r.charCode,o,k.getCode(r),r.shiftKey,a,l,s]),function(e,t,r,n){return t||r||n||"keydown"===e.type&&!k.SPECIAL_KEYS.hasOwnProperty(e.keyCode)}(r,s,a,l)&&!t.in_page_searcher.is_search_operation(r)||r.preventDefault())))}function oe(r){var n,o,i,a=void 0===r.deltaX?0:Math.round(r.deltaX),s=void 0===r.deltaY?0:Math.round(r.deltaY),d=void 0===r.wheelDeltaX?-3*a:r.wheelDeltaX,p=void 0===r.wheelDeltaY?-3*s:r.wheelDeltaY,g=e.xbrowser.getEventTarget(r),m=MetricsUtils.clientToScreenPos(r.clientX,r.clientY),k={fid:f.getFid(),x:m.x,y:m.y},h=f.getScrollDelegate(),S=new Compositor.ScrollState(Compositor.EventType.kWheel,Compositor.Offset.makeXY(m.x,m.y),Compositor.Offset.makeZero()),y=new Compositor.ScrollState(Compositor.EventType.kWheel,Compositor.Offset.makeXY(m.x,m.y),Compositor.Offset.makeXY(a,s)),v=m,b=!1;if(g){if(g.getAttribute&&(function(e){var r=MetricsUtils.clientToScreenPos(e.clientX,e.clientY),n={fid:f.getFid(),x:r.x,y:r.y};j(),l&&clearTimeout(l),t.findTargetAndCallback(r,(function(e,t){return J(e,t,n),!0})),l=setTimeout((function(){D(["CM-mouse",n.fid,"mousemove",r.x,r.y,n.x,n.y,0,0,0,0,0]),l=null}),100)}(r),!F(r))){if(c?(clearTimeout(c),o=t.getLthForFrame(w),(i=t.getSurfaceLayerForFrame(w))&&(v=i.hitTestPoint(m)),v&&o?(h=o.getScrollDelegate(),J(w,v,k),n=h.doScroll(Compositor.GestureType.kScrollUpdate,y),c=setTimeout((function(){Q()}),100)):(Q(),n=Compositor.ScrollAction.kNoAction,c=null)):(t.findTargetAndCallback(m,(function(e,r){var i;return!!(o=t.getLthForFrame(e))&&(h=o.getScrollDelegate(),(n=h.doScroll(Compositor.GestureType.kScrollBegin,S))===Compositor.ScrollAction.kRequiresMainThreadHitTest&&(t.getConfig().isScrollUnificationEnabled(),h.doScroll(Compositor.GestureType.kScrollEnd),S.reset(),(i=o.hitTest(Compositor.HitTest.kScrollableContainerId,m))&&(S.setHasMainThreadHitTestedReasons(),S.setTargetElementId(i.data.scrollable_container_id),n=h.doScroll(Compositor.GestureType.kScrollBegin,S))),n===Compositor.ScrollAction.kForwardToNextFrame?(h.doScroll(Compositor.GestureType.kScrollEnd),S.reset(),!1):(n=h.doScroll(Compositor.GestureType.kScrollUpdate,y))===Compositor.ScrollAction.kForwardToNextFrame?(h.doScroll(Compositor.GestureType.kScrollEnd),S.reset(),y.reset(),!1):(w=e,J(e,r,k),!0))})),c=setTimeout((function(){Q()}),100)),m.x,m.y,ce(w,m),n===Compositor.ScrollAction.kForwardToSurrogate)return b=h.didHandlerPreventDefault(Compositor.EventType.kWheel),D(["CM-wheel",k.fid,m.x,m.y,k.x,k.y,a,s,d,p,!0,b]),void r.preventDefault();n===Compositor.ScrollAction.kPreventNativeScroll&&r.preventDefault(),h.getLth().hasEventListener(Compositor.EventType.kWheel)&&D(["CM-wheel",k.fid,m.x,m.y,k.x,k.y,a,s,d,p,!1,!1])}}else u.error({event:"tc-wheel-event-error",reason:"invalid target"})}function ie(e){var t=e?EventListener.addListener:EventListener.removeListener;t(document,"mousemove",Z,!1),t(document,"mousedown",Z,!1),t(document,"contextmenu",Z,!1),t(document,"mouseup",Z,!1),t(document,"mouseout",$,!1)}function ae(e){var t=e?EventListener.addListener:EventListener.removeListener;t(document,"dragover",re,!1),t(document,"drop",re,!1)}function se(t){var r=t?EventListener.addListener:EventListener.removeListener;r(document,"keydown",ne,!1),r(document,"keypress",ne,!1),r(document,"keyup",ne,!1),e.print_handler.attachKeyEventHandler(t)}function le(e,t){i&&(EventListener.removeListener.apply(Util,i),i=null),e&&(i=[document,"wheel",oe,!1,t],EventListener.addListener.apply(Util,i))}function ce(e,r){var n;e=e||m.fid,r=r||g,(n=(t.getLthForFrame(e)||f).getScrollDelegate().willScrollNatively(Compositor.EventType.kWheel,r))===T&&i||le(!0,T=n)}function ue(e){x=e}e.interp.registerOpcodeHandler("htr",(function(e,r,n,o,i,a,s,l,c,u,d){var f={is_text:r,is_selected:n,is_editable:o,url:i,link_target_blank:a,cursor_name:s,frame_id:e,title:l,node_id:c,viewport_bounds:t.toScreenBounds(e,u),select_items:d};X(g,f),t.selection.onHitTestResult(f)})),e.interp.registerOpcodeHandler("datetime-chooser",(function(e){o&&o.hasAttribute("sv-base-temporal")&&(o.setAttribute("sv-base-temporal",1),o.showPicker())})),e.interp.registerOpcodeHandler("drag-start",(function(e){var t=document.getElementById("sv-drag-img"),r=g.x+"px",n=g.y+"px",o="data:image/png;base64,"+e;t||((t=document.createElement("img")).setAttribute("id","sv-drag-img"),t.src=o,t.style.position="fixed",t.style.opacity="0.7",t.style.filter="drop-shadow(0px 0px 4px gray)",t.style.left=r,t.style.top=n,t.style.transformOrigin="0px 0px 0px",t.style.transform="scale("+1/Util.getDeviceScaleFactor()+")",document.body.appendChild(t))})),e.interp.registerOpcodeHandler("drag-stop",(function(){var e=document.getElementById("sv-drag-img");e&&e.parentNode&&e.parentNode.removeChild(e)})),e.interp.registerOpcodeHandler("did_wh_pd",(function(e,r){t.wheelHandlerStateChanged(e,r)})),d.didUpdateDisplayList=function(e){var t,r,n,i,a;o&&"select"===(t=Util.get_node_tag(o))&&(r=o.getBoundingClientRect(),r=Sk.Rect.fromLTRB(r.left,r.top,r.right,r.bottom),(r=e.fromScreenSpaceRect(r))&&(i=(n=e.getDisplayList())?n.hitTestRect(r):null)&&"select"===t&&(o.node_id,o.items,(a=i.hitsFormControlNode())&&Number(a.data.node_id)===o.node_id&&a.data.formctrl.type===Sk.HT.FormControlElement.Type.kSelect&&function(e,t){var r=e.items,n=[];if(t.forEach((function(e){var t={};switch(t.checked=!!(e.flags&Sk.HT.SelectItem.Flags.kChecked),t.enabled=!!(e.flags&Sk.HT.SelectItem.Flags.kEnabled),t.hidden=!!(e.flags&Sk.HT.SelectItem.Flags.kHidden),t.in_group=!!(e.flags&Sk.HT.SelectItem.Flags.kInGroup),t.index=e.index,t.label=e.label,t.tool_tip=e.tool_tip,e.type){case Sk.HT.SelectItem.Type.kSeparator:t.type="separator";break;case Sk.HT.SelectItem.Type.kGroup:t.type="group";break;case Sk.HT.SelectItem.Type.kOption:t.type="option";break;default:t.type="local-htd-unknown"}n.push(t)})),JSON.stringify(n)===JSON.stringify(r))return;e.items=n,U(e)}(o,a.data.formctrl.select.items)))},d.getLastMousePos=function(){return{x:g.x,y:g.y}},d.getLastActivityTime=function(){return{key:C.last_key_time,mouse:C.last_mouse_time,click:C.last_click_time,input:Math.max(C.last_key_time,C.last_mouse_time)}},d.release=function(){ae(!1),se(!1),le(!1),ie(!1)},ae(!0),se(!0),ce(),t.callback.register("wheel-handler-state-changed",ce),t.callback.register("wheel-event-listener-changed",ce),t.callback.register("scroll-container-scrolled",(function(){Util.forEachItem(_,(function(e,t){t&&(_[e]=!1,D(function(e,t,r,n,o,i,a,s,l,c,u){var d=["CM-mouse",t,e,r,n,o,i,a||0,0,0];return void 0!==c&&d.push(c),void 0!==u&&d.push(u),d}("mouseup",m.fid,g.x,g.y,m.x,m.y,Number(e))))}))})),t.callback.register("input-focused",ue),ie(!0)},Compositor.IME=function(e){"use strict";var t,r,n,o,i,a=!1,s=!1,l=!1,c=0,u=0;function d(e){switch(e){case"compositionstart":return 0;case"compositionupdate":return 1;case"compositionend":return 2}}function f(){return t.value.substring(u)}function p(){var e,i,a=0;e=r+a,BrowserDetect.isIE()||BrowserDetect.isEdge()||(e-=20),i=n+a,t.style.top=i+o-12+"px",t.style.height="12px",t.style.left=e+"px",(BrowserDetect.isIE()||BrowserDetect.isEdge())&&(t.style.padding="0px",t.style.height="0px")}function g(){a=!1,c=0,l&&(p(),l=!1)}function m(r){switch(r.type,r.data,r.type){case"compositionend":r.data,e.surrogate_channel.send("composition",2,r.data,r.data.length),i=null,u=t.value.length,g(),s=!0,setTimeout((function(){s=!1}),0);break;case"compositionstart":case"compositionupdate":a=!0,(i={}).data=r.data,i.type=d(r.type);break;case"selectionchange":i&&(i.type,i.data,e.surrogate_channel.send("composition",i.type,i.data,t.selectionEnd-u),i=null);break;case"textInput":if(a||s)break;r.data,e.surrogate_channel.send("composition",0,r.data,0),r.data,e.surrogate_channel.send("composition",2,r.data,r.data.length),g(),r.preventDefault()}}function k(r){var n,o,i,s,m;switch(r.type,r.data,f(),t.selectionEnd,r.type){case"compositionend":Util.is_korean_char(r.data)?(m=r.data,e.surrogate_channel.send("composition",2,m,m.length),u=t.value.length,g()):(s=(s=f()).substring(c,s.length),e.surrogate_channel.send("composition",2,s,s.length),u=t.value.length,g()),a=!1;break;case"compositionstart":case"compositionupdate":a=!0,o=(n=function(){var e,n,o,i,a=r.data,s=f(),l=t.selectionEnd-u;if(DEBUG,!a)return f(),{finalized_text:"",transient_text:f()};for(n=l-1,o=a.length-1;n>=c&&a[o]===s[n];)n-=1,o-=1;return e=c,c=n+1,i={finalized_text:s.substring(e,c),transient_text:s.substring(c,s.length)},JSON.stringify(i),i}()).finalized_text,i=n.transient_text,o&&(e.surrogate_channel.send("composition",1,o,o.length),e.surrogate_channel.send("composition",2,o,o.length)),i&&(d(r.type),e.surrogate_channel.send("composition",d(r.type),i,i.length)),o&&l&&(BrowserDetect.isIE()||BrowserDetect.isEdge())&&(p(),l=!1);break;case"selectionchange":a&&(f(),e.surrogate_channel.send("composition",1,f(),t.selectionEnd-u))}}function h(r){switch(r.type,r.data,r.type){case"compositionend":r.data,e.surrogate_channel.send("composition",2,r.data,r.data.length),i=null,u=t.value.length,g();break;case"compositionstart":case"compositionupdate":a=!0,(i={}).data=r.data,i.type=d(r.type);break;case"input":i?(i.type,i.data,e.surrogate_channel.send("composition",i.type,i.data,t.selectionEnd-u),i=null):a&&(f(),e.surrogate_channel.send("composition",1,f(),t.selectionEnd-u))}}function S(){t||(t=document.createElement("input"),u=0,t.id="ime_overlay",t.setAttribute("type","text"),t.style.position="fixed",t.style.opacity=0,t.style.backgroundColor="yellow",t.style.width="100px",t.style.borderWidth="0px",t.style.paddingLeft="0px",t.style.pointerEvents="none",t.disabled=!0,t.style.paddingLeft="20px",t.style.letterSpacing="-1em",document.body.appendChild(t),function(){var e,r,n,o={Chrome:["selectionchange","textInput"],Safari:["selectionchange","textInput"],Explorer:["selectionchange"],Firefox:["input"],Edge:[],Other:[]},i={Chrome:m,Safari:m,Explorer:k,Firefox:h,Edge:k,Other:m},a=browser.name;for("ChromiumEdge"===a&&(a="Chrome"),e=(e=o[a]||o.Other).concat(["compositionstart","compositionupdate","compositionend"]),r=i[a]||i.Other,n=0;n<e.length;n+=1)"selectionchange"===e[n]?EventListener.addListener(document,e[n],r,!0):EventListener.addListener(t,e[n],r,!0)}())}function y(e,i,s,c){var d=i===n;DEBUG,a&&d&&(l=!0),r=e,o=c-(n=i),t||S(),l||(d||a||(t.value="",u=0),p())}function v(e){t&&!a&&(e?(t.disabled=!1,document.activeElement!==t&&t.focus()):t.disabled=!0)}e.interp.registerOpcodeHandler("caret_pos",y),e.interp.registerOpcodeHandler("ready_for_input",v)},Compositor.Selection=function(e,t){"use strict";var r,n,o,i=this,a=10,s=!1,l=!1,c=!1,u=!1,d={},f=null,p=!1,g=null,m=null,k=!1,h=!1;function S(){s||l?(r||((r=document.createElement("div")).style.position="fixed",r.style.opacity=0,r.style.backgroundColor="blue",r.style.height=a+"px",r.style.width=a+"px",r.style.borderWidth="0px",document.body.appendChild(r),n=function(e){r.style.left=d.is_editable||d.is_selected?e.clientX-a/2+"px":e.clientX+a/2+"px",r.style.top=e.clientY-a/2+"px"},EventListener.addListener(document,"mousemove",n,!1,!0),EventListener.addListener(document,"mousedown",n,!1)),k&&(r.style.display="none"),r.contentEditable=l,r.style.textIndent=s||!BrowserDetect.isIE()?"0px":"-99999px"):r&&(r.parentNode.removeChild(r),r=void 0,EventListener.removeListener(document,"mousemove",n,!1),EventListener.removeListener(document,"mousedown",n,!1),n=void 0)}function y(t){var r=null,n=null;f&&(r=f.text,n=f.html),e.clipboard.copy_event_handler(t,r,n)}function v(){g&&(g.focus&&g.focus(),g=null)}function b(t){e.copy_paste_ctrl.enforce_on_user_action(t.target,t)||(y(t),v())}function C(t){e.copy_paste_ctrl.enforce_on_user_action(t.target,t)||(y(t),void 0===o||h||e.surrogate_channel.send("execcmd",o,"cut"),h=!1,v())}function _(e){e!==s&&(s=e,S())}function T(){var e,t;r&&(f?(r.textContent=f.text,(e=document.createRange()).selectNodeContents(r),(t=window.getSelection()).removeAllRanges(),t.addRange(e)):r.textContent="")}function w(e,t){(f=JSON.parse(t)).text?(_(!0),T(),o=e):(_(!1),f=null,T(),o=void 0)}function R(t){var r,n,o,i=d.frame_id||1,a=d.node_id||1;e.copy_paste_ctrl.enforce_on_user_action(t.target,t)||(r=e.copy_paste_ctrl.has_paste_restriction(),m&&(clearTimeout(m),m=null),u&&e.surrogate_channel.send("pre-paste"),n=function(t,n,o){var s;for(r&&Util.filterPasteDataList(o),s=0;s<o.length;s+=2)"file_obj_list"===o[s+1]&&(e.upload.setupDroppedUpload(o[s]),o[s]="placeholder");e.surrogate_channel.send("paste",i,a,o,t,n)}.curry(c,u),o=function(t){t&&e.surrogate_channel.send("empty-paste")}.curry(u),Util.makePasteDataList(t,window,n,o),c=!1,u=!1,t.preventDefault())}function x(e){e!==l&&(l=e,S())}function D(){T()}function M(e,r,n){n&&(p=!0,x(!0)),t.callback.fire("input-focused",e)}function F(e,t,r){r&&!d.is_editable&&(x(!1),p=!1)}i.onHitTestResult=function(e){r&&d.is_selected!==e.is_selected&&e.is_selected&&T(),d=e,e.is_selected?_(!0):f||_(!1),e.is_editable?x(!0):p||x(!1)},i.disable=function(){k=!0,r&&(r.style.display="none")},i.enable=function(){k=!1,r&&(r.style.display="")},i.preprocess_ctrl_c_or_ctrl_x=function(e){"cut"===e&&(h=!0),BrowserDetect.isIE()&&f&&r&&document.activeElement!==r&&(g=document.activeElement,T())},i.on_paste_keypress=function(e,t){c=!!t,u=!0,BrowserDetect.isIE()&&(m=setTimeout((function(){R(e)}),200))},e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_SET_SELECTIONS,w),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_FOCUS_ELEMENT,M),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_FOCUS_OUT,F),EventListener.addListener(document,"paste",R,!1),EventListener.addListener(document,"copy",b,!1),EventListener.addListener(document,"cut",C,!1),EventListener.addListener(document,"contextmenu",D,!1)},Compositor.Extras=function(e){"use strict";function t(e){document.title=e}function r(){e.stats.stop("t_tdl"),e.stats.stop("t_tnl"),e.callback.fire("dom-loaded",{mode:"r2",fs:Util.getFramingStatus(),pxy:window.TPROXY_ENABLED?1:0})}this.init=function(){e.interp.registerOpcodeHandler("set_title",t),e.interp.registerOpcodeHandler("did_finish_load",r),e.interp.registerOpcodeHandler("did_fail_load",r)}},Compositor.ScrollContentPrefetcher=function(e,t){"use strict";var r,n=null,o=0;function i(e){r!==e&&(r=e,t(Math.round(e)))}function a(){n&&(clearTimeout(n),n=null)}function s(e,t){a(),i(1e5),n=setTimeout((function(){i(4096),n=null,t&&t()}),e)}function l(){s(3e3)}function c(){a(),i(4096)}function u(){(o+=1)>200&&(c(),o=0)}function d(){e.active_tab.is_active?s(3e3):c()}function f(){setTimeout((function(){s(1e4)}),1e3)}this.init=function(){EventListener.addListener(window,"scroll",l),EventListener.addListener(document,"mousemove",u,!1),EventListener.addListener(document,"mousedown",u,!1),EventListener.addListener(document,"mouseup",u,!1),e.interp.registerOpcodeHandler("dfvnep",f),e.callback.register("window-became-active",d),e.callback.register("window-became-passive",d)}},Compositor.FlowController=function(e,t){"use strict";var r,n,o=Math.floor(1e3/30),i=3e3;function a(e){var r,n,a=.5*t.getFPS();return Util.isTabVisible()?(r=e||1e3/a,n=Util.isTabVisible()?1e3:i,Math.min(Math.max(r,o),n)):i}function s(e,n){var o,i,s,l=a(e);o=l,s=Compositor.MessageFlags.kFrameDelay,(o=Math.floor(o))!==r&&(r=o,(i=new Sk.BinaryWriter(8)).writeUint32(s),i.writeUint32(o),t.sendCompositorMessage(0,i.getData()),1)&&t.getFPS()}function l(){Util.isTabVisible()?(s(n||o),n=null):n||(n=r,s(i))}this.getSenderDelay=function(){return r},setInterval(s,1e3),EventListener.addListener(window,"visibilitychange",l),l()},Compositor.ItemListConcatenator=function(){"use strict";var e={itemToKey:function(e){return e.data.node_uid+":"+e.data.display_item_type+":"+Sk.Rect.toString(e.visual_rect)},concat:function(e,t){var r={};return e.forEach((function(e){var t=Compositor.ItemListConcatenator.itemToKey(e);r[t]=e})),t.forEach((function(t){var n=Compositor.ItemListConcatenator.itemToKey(t);r.hasOwnProperty(n)?r[n].canvas_bounds=Sk.Rect.join(r[n].canvas_bounds,t.canvas_bounds):(r[n]=t,e.push(t))})),e}};return e}(),Compositor.HitTestResult=function(e,t){"use strict";var r=this,n=t.getItemList(),o=t.getItemMap();function i(e){return e.flags&Sk.HT.ElementFlags.kHitTestable}r.concat=function(e){n=Compositor.ItemListConcatenator.concat(n,e.getItemList()),e.getItemMap().forEachEntryInOrder((function(e,t){var r=o.get(e)||[];r=Compositor.ItemListConcatenator.concat(r,t),o.set(e,r)}))},r.getFirstItem=function(){return n.length?n[n.length-1]:null},r.getFirstHittableItem=function(){var e,t;if(!n.length)return null;for(e=n.length-1;e>=0;e-=1)if((t=n[e].data)&&t.node_uid&&i(t))return n[e];return null},r.getItemClosestToPoint=function(t){var r,o,i,a,s,l,c=e.fromScreenPoint(t),u=Number.MAX_VALUE,d=-1;if(!n.length)return null;for(r=0;r<n.length;r+=1)(l=n[r].data)&&l.node_uid&&l.type===Sk.HT.ElementType.kTextNode&&(i=n[r].visual_rect,a=Math.min(Math.abs(Sk.Rect.getLeft(i)-c.x),Math.abs(Sk.Rect.getRight(i)-c.x)),s=Math.min(Math.abs(Sk.Rect.getTop(i)-c.y),Math.abs(Sk.Rect.getBottom(i)-c.y)),(o=Math.hypot(a,s))<u&&(u=o,d=r));return-1===d?null:n[d]},r.hitsFormControlNode=function(){var e,t,n=r.getFirstHittableItem();return n?((e=o.get(n.data.owner_node_uid))&&(t=e[0]),t&&n.data.node_uid!==n.data.owner_node_uid&&(n=t),n.data.formctrl?n:null):null},r.hitsTextNode=function(){var e=r.getFirstHittableItem();return e&&e.data.type===Sk.HT.ElementType.kTextNode?e:null},r.hitsNodeWithLink=function(){var e=r.getFirstHittableItem();return e&&e.data.flags&Sk.HT.ElementFlags.kHasLink?e:null},r.hitsImageNode=function(){var e=r.getFirstHittableItem();return e&&e.image_src?e:null},r.hitsScrollableContainer=function(){var e,t;if(!n.length)return null;for(e=n.length-1;e>=0;e-=1)if((t=n[e].data)&&t.flags&Sk.HT.ElementFlags.kHasScrollableContainerId)return n[e];return null},r.getItemMap=function(){return o},r.getItemList=function(){return n},r.getLayer=function(){return e}},Compositor.DisplayListTile=function(e,t,r){"use strict";var n,o=this;o.setRecording=function(e){n=e},o.getRecording=function(){return n},o.getKey=function(){return t},o.getTileRect=function(){return r},o.getLayer=function(){return e},o.hitTest=function(t){var r,o;return n?(r=new Sk.HitTestCanvas,o=n.getCullRect(),r.save(),t&&r.clipRect(t),r.translate(Sk.Rect.getX(o),Sk.Rect.getY(o)),n.playback(r),r.restore(),new Compositor.HitTestResult(e,r)):[]}},Compositor.DisplayList=function(e,t,r){"use strict";var n=this,o={},i=new Compositor.OrderedMap,a=!1;function s(e,t){return Sk.Rect.fromXYWH(e*r.width,t*r.height,r.width,r.height)}function l(e,t){return e|t<<16}function c(e){return Sk.Rect.isEmpty(e)||!Sk.Rect.intersects(e,t.getBoundsRect())?null:{start_y:Math.floor(Sk.Rect.getY(e)/r.height),end_y:Math.floor((Sk.Rect.getBottom(e)-1)/r.height),start_x:Math.floor(Sk.Rect.getX(e)/r.width),end_x:Math.floor((Sk.Rect.getRight(e)-1)/r.width)}}function u(e,r){var n,i=o[e];i||(n=function(e){return{x:65535&e,y:e>>16&65535}}(e),i=new Compositor.DisplayListTile(t,e,s(n.x,n.y)),o[e]=i),a=!0,i.setRecording(r)}n.forEachAllocatedTileInRect=function(e,r){var n,i=Sk.Rect.intersection(e,t.getBoundsRect());Sk.Rect.isEmpty(i)||(n=c(i))&&Util.forEachItem(o,(function(e,t){var o,a=function(e){return 65535&Number(e)}(e),l=function(e){return Number(e)>>16&65535}(e);if(!(a<n.start_x||a>n.end_x||l<n.start_y||l>n.end_y||(o=Sk.Rect.intersection(s(a,l),i),Sk.Rect.isEmpty(o))))return!1===r(e,o)||void 0}))},n.getTileByKey=function(e){return o[e]},n.getSolidColorInRect=function(e){var r,i=0;if(t.isPictureLayer())return n.forEachAllocatedTileInRect(e,(function(e){var t,n=o[e];if(i+=1,!n)return r=void 0,!1;if(!(t=n.getRecording()))return r=void 0,!1;if(1===i)r=t.solid_color;else if(r!==t.solid_color)return r=void 0,!1})),r},n.hasPictureFlagsInRect=function(e,t){var r=!1;return n.forEachAllocatedTileInRect(e,(function(e){var n=o[e].getRecording();if(n)return n.getProperties()&t?(r=!0,!1):void 0})),r},n.hasPictureFlagsSetInRect=function(e,t){var r=0,i=t.map((function(){return!1}));return n.forEachAllocatedTileInRect(e,(function(e){var n=o[e].getRecording();if(n)return t.forEach((function(e,t){n.getProperties()&e&&(i[t]=!0,r+=1)})),r!==t.length&&void 0})),i},n.hitTestPoint=function(e){var t=function(e){var t=c(Sk.Rect.fromXYWH(e.x,e.y,1,1));return t?(t.start_x,t.end_x,t.start_y,t.end_y,o[l(t.start_x,t.start_y)]):null}(e);return t?t.hitTest(Sk.Rect.fromXYWH(e.x,e.y,1,1)):null},n.hitTestRect=function(e){var t=null;return n.forEachAllocatedTileInRect(e,(function(r){var n=o[r];n&&(t?t.concat(n.hitTest(e)):t=n.hitTest(e))})),t},n.getItemMap=function(){var e;return i&&!a||(e=new Compositor.OrderedMap,n.forEachAllocatedTileInRect(t.getBoundsRect(),(function(t){var r=o[t];r&&r.hitTest().getItemMap().forEachEntryInOrder((function(t,r){var n=e.get(t)||[];n=Compositor.ItemListConcatenator.concat(n,r),e.set(t,n)}))})),i=e,a=!1),i},n.applyTileUpdates=function(e){var t,r,n;for(t=0;t<e.length;t+=1)n=l((r=e[t]).index_x,r.index_y),r.skr.solid_color=r.solid_color,u(n,r.skr)},n.freeAllTiles=function(){o={}},n.asDict=function(){return{tile_map:o}}},Compositor.ScrollElementWrapper=function(e,t,r){"use strict";var n,o=this,i=e.getDisplay();function a(e){var o=Util.getBrowserScrollOffset(t,i.getLayoutViewportDiv().getBoundingClientRect());(function(e){var t;return!!n&&(t=Compositor.Offset.abs(Compositor.Offset.subtract(e,n)),n=null,t.x<=2&&t.y<=2)})(o)||r(o)}function s(e,t){var r=t?EventListener.addListener:EventListener.removeListener,n=window.visualViewport;if(e===window&&n&&BrowserDetect.isMobileSafari())return r(n,"scroll",a),void r(n,"resize",a);r(e,"scroll",a)}o.scrollTo=function(e){return n=Compositor.Offset.makeCopy(e),t!==window?(t.scrollLeft=e.x,t.scrollTop=e.y):t.scrollTo(e.x,e.y),!0},o.getNode=function(){return t},o.release=function(){t&&(s(t,!1),t=null)},s(t,!0)},Compositor.ScrollbarOrientation=Object.freeze({HORIZONTAL:0,VERTICAL:1}),Compositor.ScrollbarPart=Object.freeze({THUMB:0,TRACK_BUTTONS_TICKMARKS:1,BACK_BUTTON:2,FORWARD_BUTTON:3,BACK_TRACK:4,FORWARD_TRACK:5,NO_PART:6}),Compositor.PointerResultType=Object.freeze({kUnhandled:0,kScrollbarScroll:1}),Compositor.AutoScrollStatus=Object.freeze({AUTOSCROLL_WAITING:0,AUTOSCROLL_READY:1,AUTOSCROLL_SCROLLING:2}),Compositor.AutoScrollDirection=Object.freeze({AUTOSCROLL_BACKWARD:0,AUTOSCROLL_FORWARD:1}),Compositor.CustomScrollbarHelper=function(e,t){"use strict";var r,n=this,o=0,i={};function a(e){return i[e]||Sk.Rect.makeEmpty()}n.addScrollbarPart=function(e){o=e.flags,i[e.part]=e.rect},n.setScrollElementId=function(n){n!==r&&(t.getLayerTree().unregisterScrollbar(e),r=n,t.getLayerTree().registerScrollbar(e))},n.getScrollElementId=function(){return r},n.setPosition=function(e){},n.isScrollbarHorizontal=function(){return!!(o&Sk.HT.CustomScrollbarPart.Flags.kIsHorizontal)},n.isLeftSideVerticalScrollbar=function(){return!!(o&Sk.HT.CustomScrollbarPart.Flags.kIsLeftSideVertical)},n.jumpOnTrackClick=function(){return!!(o&Sk.HT.CustomScrollbarPart.Flags.kJumpOnTrackClick)},n.supportsDragSnapBack=function(){return!!(o&Sk.HT.CustomScrollbarPart.Flags.kSupportsDragSnapBack)},n.getThumbSize=function(){var e=a(Sk.ScrollbarPart.kThumbPart);return{width:Sk.Rect.getWidth(e),height:Sk.Rect.getHeight(e)}},n.getTrackRect=function(){var t=a(Sk.ScrollbarPart.kTrackBGPart);return Sk.Rect.isEmpty(t)?e.getBoundsRect():t},n.getThumbRect=function(){return a(Sk.ScrollbarPart.kThumbPart)},n.getBackButtonRect=function(){return a(Sk.ScrollbarPart.kBackButtonStartPart)},n.getForwardButtonRect=function(){return a(Sk.ScrollbarPart.kForwardButtonEndPart)},n.release=function(){i={},r=null}},Compositor.ScrollbarController=function(e){"use strict";var t,r,n,o,i,a=this,s=e.getScrollDelegate();function l(){return e.getPropertyTrees().getScrollTree()}function c(){return e.getLayerTree()}function u(e){return e.isScrollbarHorizontal()?Compositor.ScrollbarOrientation.HORIZONTAL:Compositor.ScrollbarOrientation.VERTICAL}function d(){var e,r,n,o;if(!t)return null;for(r=t.scroll_element_id,n=c().getScrollbarsFor(r),o=0;o<n.length;++o)if(u(e=n[o])===t.orientation)return e;return null}function f(t){return e.hitTestLayerTree(t,(function(e,t){return e.isScrollbar()||e.isCustomScrollbar()?e:null}))}function p(t){var r,n=f(t);if(!n)return Compositor.PointerResultType.kUnhandled;if(n.isCustomScrollbar()){if(!(r=e.hitTest(Compositor.HitTest.kScrollableContainerId,t)))return Compositor.PointerResultType.kUnhandled;n.getCustomScrollbarHelper().setScrollElementId(r.data.scrollable_container_id)}return n.isTransparent()||e.getDisplay().getConfig().isScrollUnificationEnabled()&&l().findNodeFromElementId(n.getScrollElementId()).hasMainThreadScrolling()?Compositor.PointerResultType.kUnhandled:Compositor.PointerResultType.kScrollbarScroll}function g(){return c()&&c().getPageScaleFactorLimits()?c().getPageScaleFactorLimits().current:1}function m(){var e,t,r,n,o=d();return c().updateScrollbarGeometries(),e=o.getScrollLayerLength(),t=o.getTrackLength(),r=o.getThumbLength(),n=function(){var e,t=d();return(e=l().findNodeFromElementId(t.getScrollElementId())).scrollsOuterViewport()?(t.isScrollbarHorizontal()?Util.getInnerWidth():Util.getInnerHeight())/g():t.isScrollbarHorizontal()?e.getContainerBounds().width:e.getContainerBounds().height}(),t===r?0:(e-n)/(t-r)}function k(e,t){var n=0,o=d();switch(e){case Compositor.ScrollbarPart.BACK_BUTTON:case Compositor.ScrollbarPart.FORWARD_BUTTON:n=40*o.getScreenSpaceScaleFactorForScroll();break;case Compositor.ScrollbarPart.BACK_TRACK:case Compositor.ScrollbarPart.FORWARD_TRACK:n=function(){var e,t,n,o,i=d();return c().updateScrollbarGeometries(),e=i.hitTestPoint(r),n=(i.isScrollbarHorizontal()?e.x:e.y)-i.getThumbLength()/2,o=i.computeThumbQuadRect(),t=i.isScrollbarHorizontal()?Sk.Rect.getX(o):Sk.Rect.getY(o),Math.round(Math.abs(n-t))*m()*g()}();break;default:n=0}return n}function h(){var e,t=Date.now(),n=d(),o=t-i.last_tick_time,a=i.velocity*o/1e3,l=n.isScrollbarHorizontal()?Compositor.Offset.makeXY(a,0):Compositor.Offset.makeXY(0,a);c().updateScrollbarGeometries(),i.timer=null,i.last_tick_time=t,e=new Compositor.ScrollState(Compositor.EventType.kWheel,Compositor.Offset.makeXY(r.x,r.y),l),s.scrollUpdate(e)&&(i.timer=setTimeout(h,16))}function S(){var e=t.scroll_element_id,r=l().findNodeFromElementId(e),o=d();r&&n&&(i.last_tick_time=Date.now(),i.scroll_node=r,i.scroll_layer_length=o.getScrollLayerLength(),i.timer=setTimeout(h,16))}function y(){i&&(d()?(i.status=Compositor.AutoScrollStatus.AUTOSCROLL_SCROLLING,S()):i.status=Compositor.AutoScrollStatus.AUTOSCROLL_READY)}function v(){i&&i.timer&&(clearTimeout(i.timer),i.timer=null)}function b(){var e,n,o,a,s,l,u=d();i&&t&&i.status===Compositor.AutoScrollStatus.AUTOSCROLL_SCROLLING&&(c().updateScrollbarGeometries(),(e=u.hitTestPoint(r))&&(a=u.computeThumbQuadRect(),u.isScrollbarHorizontal()?(n=Sk.Rect.getX(a),o=Sk.Rect.getX(a)+Sk.Rect.getWidth(a),s=e.x):(n=Sk.Rect.getY(a),o=Sk.Rect.getY(a)+Sk.Rect.getHeight(a),s=e.y),(i.direction===Compositor.AutoScrollDirection.AUTOSCROLL_FORWARD&&o>s||i.direction===Compositor.AutoScrollDirection.AUTOSCROLL_BACKWARD&&n<s)&&v(),i.direction===Compositor.AutoScrollDirection.AUTOSCROLL_FORWARD&&i.scroll_layer_length!==u.getScrollLayerLength()&&(v(),S()),l=function(e){var t=d();return e===Compositor.ScrollbarPart.BACK_BUTTON?t.getBackButtonRect():e===Compositor.ScrollbarPart.FORWARD_BUTTON?t.getForwardButtonRect():e===Compositor.ScrollbarPart.BACK_TRACK?t.getBackTrackRect():e===Compositor.ScrollbarPart.FORWARD_TRACK?t.getForwardTrackRect():Sk.Rect.makeEmpty()}(i.pressed_scrollbar_part),Sk.Rect.containsPoint(l,e)?i.scroll_element_id===u.getScrollElementId()&&S():v()))}a.didRegisterScrollbar=function(e){var r=e.getScrollElementId(),n=u(e);i&&i.status===Compositor.AutoScrollStatus.AUTOSCROLL_READY&&t.scroll_element_id===r&&t.orientation===n&&setTimeout(y,0)},a.didUnregisterScrollbar=function(e){var r=e.getScrollElementId(),n=u(e);i&&i.status===Compositor.AutoScrollStatus.AUTOSCROLL_SCROLLING&&t.scroll_element_id===r&&t.orientation===n&&(setTimeout(v,0),i.status=Compositor.AutoScrollStatus.AUTOSCROLL_READY)},a.hitTest=p,a.scrollbarScrollIsActive=function(){return n},a.handlePointerDown=function(e,a){var s,l,g,m,h,S={type:Compositor.PointerResultType.kUnhandled};return p(e)!==Compositor.PointerResultType.kScrollbarScroll||(g=(s=f(e)).getScrollElementId(),t={scroll_element_id:g,orientation:u(s)},r=e,n=!0,S.phase=Compositor.GestureType.kScrollBegin,S.target_scroller=g,S.type=Compositor.PointerResultType.kScrollbarScroll,c().updateScrollbarGeometries(),l=function(e){var t=d(),r=t.hitTestPoint(e);return t.identifyScrollbarPart(r)}(e),m=s.jumpOnTrackClick()!==a,S.scroll_delta=function(e,t){var r=k(e),n=d();return e===Compositor.ScrollbarPart.BACK_BUTTON?n.isScrollbarHorizontal()?Compositor.Offset.makeXY(-r,0):Compositor.Offset.makeXY(0,-r):e===Compositor.ScrollbarPart.FORWARD_BUTTON?n.isScrollbarHorizontal()?Compositor.Offset.makeXY(r,0):Compositor.Offset.makeXY(0,r):e===Compositor.ScrollbarPart.BACK_TRACK?n.isScrollbarHorizontal()?Compositor.Offset.makeXY(-r,0):Compositor.Offset.makeXY(0,-r):e===Compositor.ScrollbarPart.FORWARD_TRACK?n.isScrollbarHorizontal()?Compositor.Offset.makeXY(r,0):Compositor.Offset.makeXY(0,r):Compositor.Offset.makeZero()}(l),(l===Compositor.ScrollbarPart.THUMB||m)&&((o={scroller_displacement:0}).drag_origin=m?function(e){var t=e.computeThumbQuadRect();return e.isScrollbarHorizontal()?Compositor.Offset.makeXY(Sk.Rect.getX(t)+Sk.Rect.getWidth(t)/2,0):Compositor.Offset.makeXY(0,Sk.Rect.getY(t)+Sk.Rect.getHeight(t)/2)}(s):s.hitTestPoint(e),o.scroll_position_at_start=s.getCurrentPos(),o.scroller_length_at_previous_move=s.getScrollLayerLength()),Compositor.Offset.isZero(S.scroll_delta)||m||!function(e){return e===Compositor.ScrollbarPart.BACK_BUTTON||e===Compositor.ScrollbarPart.FORWARD_BUTTON}(l)||((i={}).velocity=(h=S.scroll_delta,20*(d().isScrollbarHorizontal()?h.x:h.y)),i.direction=function(e){return(d().isScrollbarHorizontal()?e.x:e.y)<0?Compositor.AutoScrollDirection.AUTOSCROLL_BACKWARD:Compositor.AutoScrollDirection.AUTOSCROLL_FORWARD}(S.scroll_delta),i.pressed_scrollbar_part=l,i.scroll_element_id=g,setTimeout(y,250))),S},a.handlePointerMove=function(e){var t,n,i,a={type:Compositor.PointerResultType.kUnhandled},s=d();return r=e,s&&o?(b(),a.type=Compositor.PointerResultType.kScrollbarScroll,a.phase=Compositor.GestureType.kScrollUpdate,function(e){var t,r,n,o,i,a,s,l,u=d();if(!u||!u.supportsDragSnapBack())return!1;if(c().updateScrollbarGeometries(),r=u.getForwardTrackRect(),!(n=u.getTrackThickness())){if(!(o=u.getThumbThickness()))return!1;n=o}return i=8*n,a=u.isScrollbarHorizontal()?Sk.Rect.getY(r)-i:Sk.Rect.getX(r)-i,s=u.isScrollbarHorizontal()?Sk.Rect.getY(r)+n+i:Sk.Rect.getX(r)+n+i,t=u.fromScreenPoint(e),(l=u.isScrollbarHorizontal()?t.y:t.x)<a||l>s}(e)?(t=s.getCurrentPos()-o.scroll_position_at_start,a.scroll_delta=s.isScrollbarHorizontal()?Compositor.Offset.makeXY(-t,0):Compositor.Offset.makeXY(0,-t),a):(n=function(e){var t,r=d(),n=r.fromScreenPoint(e);return t=(r.isScrollbarHorizontal()?n.x-o.drag_origin.x:n.y-o.drag_origin.y)*m(),(o.scroll_position_at_start+t-r.getCurrentPos())*g()}(e),o.scroller_length_at_previous_move!==s.getScrollLayerLength()?(o.scroller_displacement=n,o.scroller_length_at_previous_move=s.getScrollLayerLength(),a):(n-=o.scroller_displacement,i=s.isScrollbarHorizontal()?Compositor.Offset.makeXY(n,0):Compositor.Offset.makeXY(0,n),Compositor.Offset.isZero(i)||(a.scroll_delta=i),a))):a},a.handlePointerUp=function(e){var r={type:Compositor.PointerResultType.kUnhandled};return r.phase=Compositor.GestureType.kScrollEnd,n&&(n=!1,r.type=Compositor.PointerResultType.kScrollbarScroll),v(),o=null,i=null,t=null,r}},Compositor.ScrollbarDelegate=function(e){"use strict";var t,r,n,o=this,i=null,a={};function s(t){var r=e.getLayerTreeHost(),n=e.getOwnerScrollLayer();e.isScrollbarHorizontal()?r.getPropertyTrees().getScrollTree().setScrollOffsetX(n.getScrollNode().getElementId(),t.x):r.getPropertyTrees().getScrollTree().setScrollOffsetY(n.getScrollNode().getElementId(),t.y)}o.create=function(){return t=document.createElement("div"),n=new Compositor.ScrollElementWrapper(e.getLayerTreeHost(),t,s),t.style.display="none",t.style.position="absolute",e.isScrollbarHorizontal()?(t.style.overflowX="scroll",t.style.overflowY="hidden"):(t.style.overflowX="hidden",t.style.overflowY="scroll"),t},o.getScrollbarDivForTesting=function(){return t},o.release=function(){n&&(n.release(),n=null),t&&t.parentNode&&t.parentNode.removeChild(t),i=null,a={}},o.updateBounds=function(){var r=e.getBounds(),n=Util.getScrollbarThickness(),o=Math.max(r.width,n[0]+1),i=Math.max(r.height,n[1]+1);t.style.width=o+"px",t.style.height=i+"px"},o.update=function(){var n,o;t.style.display="block",(o=e.getOwnerScrollLayer())&&(n=o.getScrollNode().getContentBounds(),a.width===n.width&&a.height===n.height||(a.width=n.width,a.height=n.height,r||((r=document.createElement("div")).style.position="absolute",r.style.display="block",t.appendChild(r)),e.isScrollbarHorizontal()?(r.style.width=n.width+"px",r.style.height="1px"):(r.style.width="1px",r.style.height=n.height+"px")))},o.setPosition=function(t){var r=Compositor.Offset.makeCopy(t);e.isScrollbarHorizontal()?r.y=0:r.x=0,n.scrollTo(r)},o.updateProjection=function(){e.applyDrawTransform(t)},o.updateClip=function(r){var n=e.getBoundsRect();(i||r)&&(i&&r&&Sk.Rect.isEqual(i,r)||(i=r?Sk.Rect.makeCopy(r):null,e.applyDrawClip(t,n,i)))},o.updateOpacity=function(){e.applyDrawOpacity(t)}},Compositor.VelocityObserver=function(e,t){"use strict";var r,n,o,i=[],a=Date.now();function s(){return 0===n.x&&0===n.y}function l(){var l,c,u,d;!function(){var t=e.fromScreenPoint({x:0,y:0,z:0});if(t){for(;i.length>5||(i.length&&Date.now()-i[0].ts)>500;)i.shift();i.push({point:t,ts:Date.now()})}}(),d=Compositor.Offset.makeZero(),i.length>=2&&(l=Date.now()-i[0].ts,c=Compositor.Offset.subtract(i[i.length-1].point,i[0].point),d=l?Compositor.Offset.makeXY(c.x/l,c.y/l):Compositor.Offset.makeZero()),n&&(u=Date.now()-a,o=Compositor.Offset.makeXY((d.x-n.x)/u,(d.y-n.y)/u),a=Date.now()),n&&Compositor.Offset.isEqual(n,d)||(n=d,0)||t(o,n),r&&s()&&(clearInterval(r),r=null)}this.update=function(){l(),r||!n||s()||(r=setInterval(l,50))},this.release=function(){r&&(clearInterval(r),r=null)}},Compositor.Projection=Object.freeze({kScreenSpace:0,kIVSL:1,kOVCL:2}),Compositor.Layer=function(e){"use strict";var t,r,n,o,i,a,s,l,c,u,d,f,p,g,m,k,h,S,y,v,b,C,_,T,w,R,x=this,D=[],M=!1,F=Sk.Region.makeEmpty(),E=Sk.Region.makeEmpty(),I={},P={},L={},O=Sk.Rect.makeEmpty(),A={},B=mat4.create(),H=mat4.create(),N=1e6,U=Math.floor(Number.MAX_SAFE_INTEGER/N),V=null,z=0;function W(e){return!!(I.flags&e)}function G(e){return!!(I.dirty_props&e)}function j(){return x.isCustomScrollbar()?T.getThumbSize():I.scrollbar_flags&Compositor.ScrollbarFlags.kHasThumb?I.thumb_size:{width:0,height:0}}function Y(){return o===Compositor.LayerType.PaintedScrollbarLayer?I.back_button_rect:x.isCustomScrollbar()?T.getBackButtonRect():Sk.Rect.makeEmpty()}function X(){return o===Compositor.LayerType.PaintedScrollbarLayer?I.forward_button_rect:x.isCustomScrollbar()?T.getForwardButtonRect():Sk.Rect.makeEmpty()}function q(){return o===Compositor.LayerType.PaintedScrollbarLayer||o===Compositor.LayerType.PaintedOverlayScrollbarLayer?I.track_rect:x.isCustomScrollbar()?T.getTrackRect():Sk.Rect.makeEmpty()}function K(){var e,t,r,n,i,a;return o===Compositor.LayerType.PaintedScrollbarLayer||x.isCustomScrollbar()?(e=x.computeThumbQuadRect(),t=q(),r=Sk.Rect.getX(t),n=Sk.Rect.getY(t),x.isScrollbarHorizontal()?(i=Sk.Rect.getX(e)-r,a=Sk.Rect.getHeight(t)):(i=Sk.Rect.getWidth(t),a=Sk.Rect.getY(e)-n),Sk.Rect.fromXYWH(r,n,i,a)):Sk.Rect.makeEmpty()}function Q(){var e,t,r,n,i,a,s;return o===Compositor.LayerType.PaintedScrollbarLayer||x.isCustomScrollbar()?(e=x.computeThumbQuadRect(),t=q(),x.isScrollbarHorizontal()?(r=Sk.Rect.getRight(t),n=Sk.Rect.getRight(e),i=Sk.Rect.getY(t),a=r-n,s=Sk.Rect.getHeight(t)):(r=Sk.Rect.getBottom(t),n=Sk.Rect.getX(t),i=Sk.Rect.getBottom(e),a=Sk.Rect.getWidth(t),s=r-i),Sk.Rect.fromXYWH(n,i,a,s)):Sk.Rect.makeEmpty()}function J(e){return"number"==typeof e&&e>=0}function Z(){return Sk.Rect.fromWH(x.getBounds().width,x.getBounds().height)}function $(){return i.getPropertyTrees().getScrollTree().getNode(x.getScrollTreeIndex())}function ee(){return i.getPropertyTrees().getTransformTree().getNode(x.getTransformTreeIndex())}function te(){return i.getPropertyTrees().getEffectTree().getNode(x.getEffectTreeIndex())}function re(e,t,r){t=null===t?"":t,(r=r||l).style[e]!==t&&(r.style[e]=t),a.isDebugEnabled()&&(r.style[e],r.style[e])}function ne(){if(!x.isDrawable()&&!x.isSurfaceLayerForOSC())return d&&(a.getTileManager().freeTilingSet(d),d=null),k&&(k.stop("became undrawable"),k=null),void f.childNodes.length;var e,t;(x.hasVideoContent()&&!k&&(k=new Compositor.VideoDelegate(i,x))&&k.start("alloc changed"),d)||(h=new Compositor.DisplayList(i,x,x.hasVideoContent()?Sk.Rect.getArea(x.getBoundsRect())>4194304?{width:2048,height:2048}:Object.freeze(x.getBounds()):x.isUntiled()?Object.freeze(x.getBounds()):Object.freeze(s.getDisplayListTileSize())),e=a.getTileManager().allocTilingSet({delta_mode:x.isCanvasBacking(),layer:x,display_list:h}),t=e.getDomNode(),a.isDebugEnabled()&&t.setAttribute("id","ts:"+i.getFid()+":"+x.id),d=e,f.childNodes.length,f.appendChild(d.getDomNode()))}function oe(){var e;(x.isLocallyPaintedScrollbarLayer(),u||(e=x.getOwnerScrollLayer(),x.isLocallyPaintedScrollbarLayer(),!e||e.isOuterViewportScrollLayer()||e.isInnerViewportScrollLayer()))||(u=new Compositor.ScrollbarDelegate(x),f.appendChild(u.create()))}function ie(e){i.getPropertyTrees().getScrollTree().setScrollOffset($().getElementId(),e,Compositor.ScrollOrigin.kOriginScrollEvent),a.callback.fire("scroll-container-scrolled")}function ae(){var e,t,r,n,o,s;if(x.isOuterViewportScrollLayer()&&x.isScrollable()&&(c||(c=new Compositor.ScrollElementWrapper(i,window,ie))),x.isOuterViewportScrollLayer())return t=(e=a.getOuterViewportScrollLayer().getScrollNode()).isUserScrollableHorizontal()&&e.maxScrollOffset().x>0,r=e.isUserScrollableVertical()&&e.maxScrollOffset().y>0,document.body.style.overflowX=t?"visible":"hidden",void(document.body.style.overflowY=r?"visible":"hidden");x.isScrollbar()&&(u&&u.update(),x.isCustomScrollbar()?l.style.display=a.isScrollbarVisible()?"block":"none":(s=x.getOwnerScrollLayer())&&!s.isOuterViewportScrollLayer()&&(o=i.getPropertyTrees().getScrollTree().getNode(s.getScrollTreeIndex()),n=x.isScrollbarHorizontal()?o.isUserScrollableHorizontal():o.isUserScrollableVertical(),l.style.display=n&&a.isScrollbarVisible()?"block":"none"))}function se(){var e,t,r,n,o=x.fromScreenSpaceRect(a.getDrawRect());return te().isHiddenByBackfaceVisibility()||x.shouldCheckBackfaceVisibility()&&(t=te().getRenderTargetId(),r=x.getTransformTreeIndex(),n=a.getDrawDstId(Compositor.Projection.kScreenSpace),ee().delegatesToParentForBackface()&&(r=ee().getParentId()),te().isContentsRoot()||(n=i.getPropertyTrees().getEffectTree().getNode(t).getTransformId()),e=i.getPropertyTrees().getTransformTree().combineTransforms(r,n),Compositor.Matrix3D.isBackFaceVisible(e))?Sk.Rect.makeEmpty():o&&Sk.Rect.isValid(o)?Sk.Rect.intersection(o,x.getBoundsRect()):x.getBoundsRect()}function le(e,t){var r=se();return Sk.Rect.isEmpty(r)||t?r:e&&!function(e,t){var r,n=Z(),o=x.getScreenSpaceScaleFactor(),i=Math.max(o[0],o[1])||1;return!(Sk.Rect.isEmpty(e)&&Sk.Rect.isEmpty(t)||!Sk.Rect.isEmpty(e)&&(r=Sk.Rect.resize(e,a.getMinimumDistanceBeforeDrawRectUpdate()/i),!(!Sk.Rect.contains(r,t)||0===Sk.Rect.getX(t)&&0!==Sk.Rect.getX(e)||0===Sk.Rect.getY(t)&&0!==Sk.Rect.getY(e)||Sk.Rect.getRight(t)===Sk.Rect.getWidth(n)&&Sk.Rect.getRight(e)!==Sk.Rect.getWidth(n)||Sk.Rect.getBottom(t)===Sk.Rect.getHeight(n)&&Sk.Rect.getBottom(e)!==Sk.Rect.getHeight(n))))}(e,r)?e:r}function ce(e,t){var r;d&&function(e,t){return 0===t.x&&0===t.y||!!e&&(Math.sign(e.x)!==Math.sign(t.x)||Math.sign(e.y)!==Math.sign(t.y))}(e,t)&&(Math.abs(t.x)>1||Math.abs(t.y)>1||(r=x.fromScreenSpaceRect(a.getScreenRect()))&&Sk.Rect.isValid(r)&&d.setHighResWindowToRect(Sk.Rect.intersection(O,r)))}function ue(){var e,t;for(D.length,e=0;e<D.length;e+=1)t=e*U,D[e].setSiblingRank(t);a.updateLthChildPaintRanks(i),a.resetCachedSurfaceLayerList()}function de(e){var t=x.getProjectionMatrixInverse(Compositor.Projection.kScreenSpace);return t?Compositor.Matrix3D.projectPoint(t,e):null}x.asDict=function(){return{id:x.id,parent_id:r?r.id:null,type:o,props:I,label:x.getLabels()}},x.updateProperties=function(e){var t;if(Util.forEachItem(e,(function(e,t){"skr_u8a"!==e&&"tile_updates"!==e&&(I[e]=t)})),W(Compositor.LayerFlags.kIsDisplayListDelta)){if(!x.getTilingSet())return;t=Z(),x.getTilingSet().requestTileType(t,x.isContentOpaque(),Compositor.TileType.kCanvasDevice),x.runOn("partial-dl-drag-end",(function(){x.getTilingSet().removeKnownTilesType(),x.getLayerTreeHost().setNeedsRepaint(x.getID(),t)}))}},x.setTree=function(e){s=e},x.isAttached=function(){return!!s},x.getID=function(){return x.id},x.getType=function(){return o},x.isDrawable=function(){return W(Compositor.LayerFlags.kIsDrawable)},x.isContentOpaque=function(){return W(Compositor.LayerFlags.kContentsOpaque)},x.shouldCheckBackfaceVisibility=function(){return W(Compositor.LayerFlags.kShouldCheckBackfaceVisibility)},x.isCanvasBacking=function(){return W(Compositor.LayerFlags.kIsCanvasBacking)},x.isScrollbar=function(){return W(Compositor.LayerFlags.kIsScrollbar)},x.isCustomScrollbar=function(){return!!T&&x.isPictureLayer()},x.getCustomScrollbarHelper=function(){return T},x.isHitTestable=function(){return W(Compositor.LayerFlags.kIsHitTestable)},x.getBackButtonRect=Y,x.getForwardButtonRect=X,x.getThumbLength=function(){var e=j();return x.isScrollbarHorizontal()?e.width:e.height},x.getThumbThickness=function(){var e=j();return x.isScrollbarHorizontal()?e.height:e.width},x.getTrackLength=function(){var e=q();return x.isScrollbarHorizontal()?Sk.Rect.getWidth(e):Sk.Rect.getHeight(e)},x.getTrackThickness=function(){var e=q();return x.isScrollbarHorizontal()?Sk.Rect.getHeight(e):Sk.Rect.getWidth(e)},x.setCurrentPos=function(e){_=e},x.getCurrentPos=function(){return _},x.setClipLayerLength=function(e){b=e},x.getClipLayerLength=function(){return b},x.setScrollLayerLength=function(e){C=e},x.getScrollLayerLength=function(){return C},x.setVerticalAdjust=function(e){z=e},x.computeThumbQuadRect=function(){var e,t,r,n,o=x.getTrackLength(),i=x.getThumbLength(),a=x.getThumbThickness(),s=Math.max(C-b,0),l=_,c=(n=q(),x.isScrollbarHorizontal()?Sk.Rect.getX(n):Sk.Rect.getY(n));return l<0?l=0:l>s&&(l=s),s>0&&(e=l/s,t=o-i,c+=Math.round(e*t)),r=0*a,x.isScrollbarHorizontal()?Sk.Rect.fromXYWH(c,z+r,i,a-r):Sk.Rect.fromXYWH(x.isLeftSideVerticalScrollbar()?x.getBounds().width-a:r,c,a-r,i)},x.getBackTrackRect=K,x.getForwardTrackRect=Q,x.identifyScrollbarPart=function(e){return x.isScrollbar()||x.isCustomScrollbar(),Sk.Rect.containsPoint(Y(),e)?Compositor.ScrollbarPart.BACK_BUTTON:Sk.Rect.containsPoint(X(),e)?Compositor.ScrollbarPart.FORWARD_BUTTON:Sk.Rect.containsPoint(K(),e)?Compositor.ScrollbarPart.BACK_TRACK:Sk.Rect.containsPoint(Q(),e)?Compositor.ScrollbarPart.FORWARD_TRACK:Sk.Rect.containsPoint(x.computeThumbQuadRect(),e)?Compositor.ScrollbarPart.THUMB:Compositor.ScrollbarPart.NO_PART},x.jumpOnTrackClick=function(){return o===Compositor.LayerType.PaintedScrollbarLayer?!!(I.scrollbar_flags&Compositor.ScrollbarFlags.kJumpOnTrackClick):!!x.isCustomScrollbar()&&T.jumpOnTrackClick()},x.supportsDragSnapBack=function(){return o===Compositor.LayerType.PaintedScrollbarLayer?!!(I.scrollbar_flags&Compositor.ScrollbarFlags.kSupportsDragSnapBack):!!x.isCustomScrollbar()&&T.supportsDragSnapBack()},x.isScrollable=function(){var e=i.getPropertyTrees().getScrollTree();return!!x.getElementId()&&!!e.findNodeFromElementId(x.getElementId())},x.isScrollerOrScrollbar=function(){return x.isScrollbar()||x.isScrollable()},x.getElementId=function(){return I.element_id,I.element_id},x.getScrollElementId=function(){return x.isCustomScrollbar()?T.getScrollElementId():I.scroll_element_id},x.getOwnerScrollLayer=function(){return x.getScrollElementId()?i.getLayerTree().getLayerByElementId(x.getScrollElementId()):null},x.isScrollbarHorizontal=function(){return x.isCustomScrollbar()?T.isScrollbarHorizontal():!!(I.scrollbar_flags&Compositor.ScrollbarFlags.kIsHorizontal)},x.isLeftSideVerticalScrollbar=function(){return x.isCustomScrollbar()?T.isLeftSideVerticalScrollbar():!!(I.scrollbar_flags&Compositor.ScrollbarFlags.kIsLeftSideVertical)},x.getBounds=function(){return I.bounds,e.id,I.bounds},x.isUntiled=function(){return!(!x.isTextureLayer()||!a.getConfig().allowClientCanvasSrc())||W(Compositor.LayerFlags.kIsUntiled)},x.onHitTestData=function(t,r){var n=r.flags,o=r.custom_scrollbar_part;n&Sk.HT.ElementFlags.kHitTestable&&Sk.Region.addRect(F,t),n&Sk.HT.ElementFlags.kInsideBlockingTouchEventHandler&&Sk.Region.addRect(E,t),r.type===Sk.HT.ElementType.kCustomScrollbarPart&&o&&(T||(T=new Compositor.CustomScrollbarHelper(x,e.lth)),T.addScrollbarPart(o))},x.subtractHittableRect=function(e){Sk.Region.subtractRect(F,e,!0)},x.hasHittableItemAt=function(e){return Sk.Region.containsPoint(F,e)},x.isUnHittableSurface=function(){return!(!x.isSurfaceLayer()||void 0===I.pointer_events_none)&&I.pointer_events_none},x.getTextureBounds=function(){return x.isTextureLayer()&&I.texture_bounds,I.texture_bounds},x.getOffsetToTransformParent=function(){return I.offset_to_transform_parent,I.offset_to_transform_parent.x,e.id,I.offset_to_transform_parent.y,e.id,I.offset_to_transform_parent},x.isTransparent=function(){return x.getScreenSpaceOpacity()<=.001},x.occludesContentBelow=function(){return x.isContentOpaque()&&1===x.getScreenSpaceOpacity()},x.getTransformTreeIndex=function(){return J(I.transform_tree_index),I.transform_tree_index},x.getClipTreeIndex=function(){return J(I.clip_tree_index),I.clip_tree_index},x.getScrollTreeIndex=function(){return J(I.scroll_tree_index),I.scroll_tree_index},x.getEffectTreeIndex=function(){return J(I.effect_tree_index),I.effect_tree_index},x.getDOMNodeId=function(){return I.node_id,I.node_id},x.getNonFastScrollableRects=function(){return I.non_fast_scrollable_rects,I.non_fast_scrollable_rects},x.getTouchActionRects=function(){return I.touch_action_region,I.touch_action_region.whole_region},x.hasMainThreadScrollingReasons=function(){return!!I.main_thread_scrolling_reasons},x.isSurfaceForChildFrame=function(){return x.isSurfaceLayer()&&!!I.frame_sink_id},x.getSurfaceFrameSinkId=function(){return I.frame_sink_id},x.getTree=function(){return s},x.getParent=function(){return r},x.setParent=function(e){r=e},x.isRoot=function(){return!x.getParent()},x.getChildren=function(){return D},x.getDisplayList=function(){return h},x.isMaskLayer=function(){return M},x.setMaskLayer=function(e){!e||e.isMaskLayer(),n=e},x.getMaskLayer=function(){return n},x.isPictureLayer=function(){return o===Compositor.LayerType.PictureLayer},x.isTextureLayer=function(){return o===Compositor.LayerType.TextureLayer},x.isSurfaceLayer=function(){return o===Compositor.LayerType.SurfaceLayer},x.isLocallyPaintedScrollbarLayer=function(){return o===Compositor.LayerType.SolidColorScrollbarLayer||o===Compositor.LayerType.PaintedScrollbarLayer||o===Compositor.LayerType.PaintedOverlayScrollbarLayer},x.isSurfaceLayerWithVideo=function(){return x.isSurfaceLayer()&&W(Compositor.LayerFlags.kIsSurfaceLayerWithVideo)},x.isSurfaceLayerForOSC=function(){return x.isSurfaceLayer()&&W(Compositor.LayerFlags.kIsSurfaceLayerForOSC)},x.hasVideoContent=function(){return o===Compositor.LayerType.VideoLayer||x.isSurfaceLayerWithVideo()},x.hasCaret=function(){var e=h?h.hitTestRect(Z()):null;return!!e&&e.getItemList().some((function(e){return e.data.display_item_type===Sk.HT.DisplayItemType.kCaret}))},x.getHitTestResultAt=function(e){var t;return h&&(t=h.hitTestPoint(e))&&t.getItemList().length?t:null},x.getBoundsRect=Z,x.hasVisualIntersect=function(e){return x.isDrawable()&&e.isDrawable()&&Sk.Rect.intersects(x.toScreenSpaceRect(),e.toScreenSpaceRect())},x.isOccludedBy=function(e){return x.paintsBefore(e)&&x.hasVisualIntersect(e)},x.getHudDiv=function(){return l?g?(l.parentNode,g):((g=document.createElement("div")).id="post",g.style.position="absolute",g.style.top="0px",g.style.left="0px",g.style.width="100%",g.style.height="100%",g.style.overflow="visible",g.style.pointerEvents="none",l.appendChild(g),g):null},x.getScrollNode=$,x.getTransformNode=ee,x.getClipNode=function(){return i.getPropertyTrees().getClipTree().getNode(x.getClipTreeIndex())},x.willDraw=function(){return!(!x.isDrawable()&&!x.isSurfaceLayerForOSC())&&(!!te().isDrawn()&&(!!x.getProjectionMatrixInverse(Compositor.Projection.kScreenSpace)&&te().getBlendMode()!==Compositor.BlendMode.kDstIn))},x.isInnerViewportScrollLayer=function(){return a.getInnerViewportScrollLayer()===x},x.isOuterViewportScrollLayer=function(){return a.getOuterViewportScrollLayer()===x},x.isOuterViewportContentLayer=function(){return a.getOuterViewportContentLayer()===x},x.scrollTo=function(e){c.scrollTo(e)},x.getScrollbarDelegate=function(){return u},x.isFixedToViewport=function(){var e,t,r,n;return x.getLayerTreeHost().isMainFrame()?(t=a.getOuterViewportContentLayer(),r=t.getTransformTreeIndex(),n=t.getScrollTreeIndex(),!!i.getPropertyTrees().getTransformTree().shouldForceFixedPosition(x.getTransformTreeIndex(),r,n)||!function(){var e=a.getOuterViewportContentLayer().getTransformTreeIndex();return i.getPropertyTrees().getTransformTree().hasPath(x.getTransformTreeIndex(),e)}()):!(!(e=a.getMainFrameSurfaceLayer(i))||!e.isFixedToViewport())},x.isFixedToBottom=function(){return!!x.getLayerTreeHost().isMainFrame()&&(!!ee()&&i.getPropertyTrees().getTransformTree().movedByOuterViewportBoundsDeltaY(ee().getId()))},x.updateProjection=function(){x.isRoot()||(x.isFixedToViewport()?(re("position","fixed"),x.isFixedToBottom()&&(re("height","100%"),re("bottom","0px"),re("top",null)),re("position","absolute",y)):(x.isFixedToBottom(),re("position","static"),y.style.clip||re("position","static",y)),d&&d.updateProjection(),k&&k.updateProjection(),x.isLocallyPaintedScrollbarLayer()&&u&&u.updateProjection(),a.getInputDelegate()&&a.getInputDelegate().didUpdateProjection(x),a.getIframeDelegate()&&a.getIframeDelegate().didUpdateProjection(x))},x.calcClipRect=function(e,t){return i.getPropertyTrees().getClipTree().combineClips(x.getClipTreeIndex(),e,t)},x.updateShadowElementClip=function(){var e=null,t=x.getDrawMatrix();"absolute"===l.style.position?(Compositor.Matrix3D.rectStaysRect(t),re("position","absolute",y)):y.childNodes.length>0&&V?(e=Sk.Rect.toCSSClip(Compositor.Matrix3D.mapRect(t,V)),re("position","absolute",y)):x.isFixedToViewport()||re("position","static",y),re("clip",e,y)},x.updateClip=function(){var e,t,r;x.isRoot()||(t=x.isFixedToViewport()?a.getInnerViewportScrollLayer().getBoundsRect():a.getOuterViewportContentLayer().getBoundsRect(),e=a.calcClipRect(x),V=null,Sk.Rect.contains(e,t)||(r=Sk.Rect.intersection(e,t),Compositor.Matrix3D.rectStaysRect(x.getDrawMatrix())?V=function(e){var t=x.getProjectionMatrixInverse(x.isFixedToViewport()?Compositor.Projection.kIVSL:Compositor.Projection.kOVCL);return t?Compositor.Matrix3D.mapRect(t,e):null}(r):(re("position","absolute"),re("clip",Sk.Rect.toCSSClip(r)))),d&&d.updateClip(V),k&&k.updateClip(V),x.isLocallyPaintedScrollbarLayer()&&u&&u.updateClip(V),a.getIframeDelegate()&&a.getIframeDelegate().didUpdateClip(x,V),x.updateShadowElementClip(),a.isDebugEnabled()&&l.setAttribute("clip_rect",Sk.Rect.toString(e)))},x.getScreenSpaceOpacity=function(){return te().getScreenSpaceOpacity()},x.updateOpacity=function(){var e=x.getScreenSpaceOpacity();d&&d.updateOpacity(),k&&k.updateOpacity(),x.isLocallyPaintedScrollbarLayer()&&u&&u.updateOpacity(),a.getInputDelegate()&&a.getInputDelegate().didUpdateOpacity(x),a.getIframeDelegate()&&a.getIframeDelegate().didUpdateOpacity(x),a.isDebugEnabled()&&l.setAttribute("opacity",e)},x.updateDebugRects=function(e,t,r,n,o){var i,s,l,c,u,d;if(a.isDebugEnabled()&&!BrowserDetect.isIE10()&&((l=P[e])&&(l.parentNode&&l.parentNode.removeChild(l),delete P[e],l=null),t.length)){for(P[e]=l=document.createElement("div"),l.style.position="absolute",l.style.left="0px",l.style.top="0px",l.style.padding="0px",l.style.margin="0px",l.style.pointerEvents="none",x.applyDrawTransform(l),i=0;i<t.length;i+=1)s=t[i],(c=document.createElement("div")).style.position="absolute",c.style.left=Sk.Rect.getX(s)+"px",c.style.top=Sk.Rect.getY(s)+"px",c.style.width=Sk.Rect.getWidth(s)+"px",c.style.height=Sk.Rect.getHeight(s)+"px",c.style.padding="0px",c.style.margin="0px",c.style.opacity="0.1",c.style.backgroundColor=r,c.style.pointerEvents="none",(u=document.createElement("div")).style.position="absolute",u.style.display="inline-block",u.style.backgroundColor=r,u.style.color=n,u.style.left=Sk.Rect.getX(s)+"px",u.style.top=Sk.Rect.getY(s)+"px",u.style.whiteSpace="nowrap",u.style.pointerEvents="none",d=e,o&&(d+=" ("+o+")"),u.textContent=d,l.appendChild(c),l.appendChild(u);x.getHudDiv().appendChild(l)}},x.setDebugFilterEnabled=function(e){!BrowserDetect.isMobileSafari()&&a.isDebugEnabled()&&(l.style.filter=e?"grayscale(100%)":null)},x.getLabels=function(){var e=[];return x.isDrawable()&&e.push("kIsDrawable"),x.isContentOpaque()&&e.push("kContentsOpaque"),x.shouldCheckBackfaceVisibility()&&e.push("kShouldCheckBackfaceVisibility"),x.isCanvasBacking()&&e.push("kIsCanvasBacking"),x.hasVideoContent()&&e.push("kVideoContent"),x.isSurfaceLayer()&&(x.isSurfaceLayerWithVideo()?e.push("kSurfaceLayerWithVideo"):x.isSurfaceLayerForOSC()?e.push("kSurfaceLayerForOSC"):e.push("kSurfaceLayer")),x.isPictureLayer()&&e.push("kPictureLayer"),x.isTextureLayer()&&e.push("kTextureLayer"),x.isMaskLayer(x)&&e.push("kMaskLayer"),x.hasMainThreadScrollingReasons()&&e.push("kHasMainThreadScrollingReasons"),x.isHitTestable()&&e.push("kIsHitTestable"),x.isInnerViewportScrollLayer()&&e.push("kIVSL"),x.isOuterViewportScrollLayer()&&e.push("kOVSL"),x.isOuterViewportContentLayer()&&e.push("kOVCL"),x.isScrollable()&&e.push("kScrollable"),x.isScrollbar()&&e.push("kScrollbar"),x.isCustomScrollbar()&&e.push("kCustomScrollbar"),x.isFixedToViewport()&&e.push("kFixed"),x.isFixedToBottom()&&e.push("kFixedToBottom"),x.isScrollbarHorizontal()&&e.push("kScrollbarHorizontal"),e},x.updateElementIdRegistration=function(){G(Compositor.DirtyProps.kElementId|Compositor.DirtyProps.kFlags|Compositor.DirtyProps.kScrollbarProps)&&(x.isScrollable()?(t&&s.unregisterElement(t),t=x.getElementId(),s.registerElement(t,x)):x.isScrollbar()?s.registerScrollbar(x):t&&(s.unregisterElement(t),t=null))},x.applyProperties=function(e){var t,r,n=i.getPropertyTrees().getScrollTree();e&&(I.dirty_props=Compositor.DirtyProps.kAll),G(Compositor.DirtyProps.kFlags|Compositor.DirtyProps.kBounds)&&(!a.isScrollbarVisible()&&x.isScrollbar()&&(l.style.display="none"),x.isLocallyPaintedScrollbarLayer()?oe():ne(),r=x.getBounds(),(x.isDrawable()||x.isSurfaceLayerForOSC())&&(x.isLocallyPaintedScrollbarLayer()?u&&u.updateBounds():(d.resize(r.width,r.height,"bounds-change"),k&&k.updateSizeAndRedraw(r)))),G(Compositor.DirtyProps.kScrollTreeIndex)&&(A.scroll&&n.deregisterObserver(A.scroll),A.scroll=n.registerObserver(x.getScrollTreeIndex(),ae)),G(Compositor.DirtyProps.kEffectTreeIndex)&&i.setLayerEffectChanged(x.getID()),G(Compositor.DirtyProps.kTransformTreeIndex)&&i.setLayerProjectionChanged(x.getID()),G(Compositor.DirtyProps.kScrollbarProps)&&ae(),G(Compositor.DirtyProps.kOffsetToTransformParent)&&i.setLayerProjectionChanged(x.getID()),G(Compositor.DirtyProps.kNodeId)&&k&&k.pairWithVideoElementIfNeeded(),G(Compositor.DirtyProps.kNonFastScrollableRegion)&&((t=x.getNonFastScrollableRects())&&t.length?s.registerNonFastLayer(x):s.unregisterNonFastLayer(x.getID())),I.loaded_tile_updates&&(h&&(h.applyTileUpdates(I.loaded_tile_updates),function(e){var t,r,n;for(t=0;t<e.length;t+=1)for(n=e[t],r=0;r<n.invalidation_region.length;r+=1)d.invalidateRect(n.invalidation_region[r])}(I.loaded_tile_updates),a.input&&a.input.didUpdateDisplayList(x),a.getInputDelegate()&&a.getInputDelegate().didUpdateDisplayList(x),a.getIframeDelegate()&&a.getIframeDelegate().didUpdateDisplayList(x)),I.loaded_tile_updates=null),a.isDebugEnabled()&&(l.setAttribute("element_id",x.getElementId()),l.setAttribute("type",o),l.setAttribute("props",JSON.stringify(I)),l.setAttribute("labels",x.getLabels().join(","))),G(Compositor.DirtyProps.kNonFastScrollableRegion|Compositor.DirtyProps.kTouchActionRegion)&&a.setNeedsDrawFrame(Compositor.DrawFrameReason.kDebugRectsChanged),G(Compositor.DirtyProps.kFrameSinkId)&&I.frame_sink_id&&i.registerChildLth(x),G(Compositor.DirtyProps.kDirtyPointerEventsNone)&&x.isSurfaceForChildFrame()&&a.callback.fire("pointer-events-status-changed",I.frame_sink_id,I.pointer_events_none),I.dirty_props=0},x.getLocalDrawRect=function(){return O},x.updateLocalDrawRect=function(){var e,t=O,r=x.getScreenSpaceScaleFactor(),n=!S||!vec3.equals(r,S);(x.isDrawable()||x.isSurfaceLayerForOSC())&&(e=function(e,t){var r=t;return e&&(r=Sk.Rect.makeCopy(t),Sk.Rect.subtract(r,e)),r}(t,O=le(t,n)),d&&!Sk.Rect.isEmpty(e)&&d.invalidateRect(e,"newly-exposed"),n&&(S=r,d&&d.hardInvalidateWithTileRecalc()),Sk.Rect.isEqual(t,O)||(a.isDebugAnnotationEnabled()&&x.updateDebugRects("["+i.getFrameSinkId()+":"+x.getID()+"] DrawRect: ",[O],"indigo",JSON.stringify(O)),d&&d.freeTiles((function(e){return!Sk.Rect.intersects(x.isPictureLayer()||x.hasVideoContent()||x.isSurfaceForChildFrame()?(Sk.Rect.isValid(O),O):x.isTextureLayer()||x.isSurfaceLayerForOSC()?x.getBoundsRect():null,e.rect)}))),a.isDebugEnabled()&&l.setAttribute("draw_rect",JSON.stringify(O)),v.update())},x.drawTilesInRect=function(e){var t;return Sk.Rect.isIntRect(e),k?k.drawFrame():(t=Sk.Region.getBoundingIntRect(d.getDirtyRegion(),e),d.drawRect(t,x.isContentOpaque()))},x.updateTexture=function(e){x.isTextureLayer(),d&&(d.playback(e,e.getCullRect(),x.isContentOpaque()),e.getProperties()&Sk.PictureFlags.kHintNeedsTextureSync&&x.getLayerTreeHost().setNeedsRepaint(x.getID(),Z(),!0))},x.updateOSCSurface=function(e){x.isSurfaceLayerForOSC(),d&&d.playback(e,e.getCullRect(),x.isContentOpaque())},x.remove=function(){var e,t=x.getContainer();if(s){if(x.id,r&&r.id,r&&r.getChildren().length,k&&k.stop("remove-layer"),x.isMaskLayer())return r.setMaskLayer(null),x.setParent(null),void x.setTree(null);t.parentNode&&(t.parentNode.removeChild(t),t.parentNode),r?(e=r.getChildren().indexOf(x),r.getChildren().splice(e,1)):s&&s.getRoot(),x.setParent(null),x.setTree(null)}},x.getContainer=function(){return l},x.getChildrenDiv=function(){return p},x.withEachAncestorAndSelf=function(e){for(var t=x;t;)e(t),t=t.getParent()},x.restartVideoDelegate=function(){k&&k.start("restart")},x.setSiblingRank=function(e){m=e,a.isDebugEnabled()&&l.setAttribute("sibling_rank",e)},x.getSiblingRank=function(){return m},x.insertChild=function(e,t,r){var n,o;if(x.id,t.getContainer(),t.getParent(),t.id,t.isMaskLayer(),x.isMaskLayer(),t.setTree(e),t.setParent(x),i.setLayerProjectionChanged(t.getID()),t.isMaskLayer())return assert_unimplemented("mask layer inserted",{lid:x.id}),void x.setMaskLayer(t);t.restartVideoDelegate(),o=p.childNodes,r>=0&&o.length,o.length,(n=o[r])?p.insertBefore(t.getContainer(),n):(assert_unimplemented(r===o.length,{sib_idx:r,layer_id:x.id,child_id:t.id,child_nodes_len:o.length}),p.appendChild(t.getContainer())),D.length,D.splice(r,0,t),function(e){var t,r=0===e?null:D[e-1],n=D[e+1],o=D[e];if(D.length,r&&n){if((t=Math.floor((r.getSiblingRank()+n.getSiblingRank())/2))===r.getSiblingRank()||t===n.getSiblingRank())return void ue()}else t=r?r.getSiblingRank()+U:n?n.getSiblingRank()-U:0;t<Number.MIN_SAFE_INTEGER||t>Number.MAX_SAFE_INTEGER?ue():o.setSiblingRank(t)}(r)},x.paintsBefore=function(e){return x.getSiblingRank()<=e.getSiblingRank()},x.walkDepthFirstIterative=function(e){for(var t,r,n,o=[x];o.length&&!e(t=o.pop());)for(t.getMaskLayer()&&o.push(t.getMaskLayer()),n=(r=t.getChildren()).length-1;n>=0;n-=1)o.push(r[n])},x.getElementsDiv=function(){return y},x.release=function(){x.getContainer()&&x.getContainer().parentNode,c&&(c.release(),c=null),u&&(u.release(),u=null),T&&(T.release(),T=null),x.isSurfaceForChildFrame()&&i.unregisterChildLth(x.getSurfaceFrameSinkId()),l.parentNode,l=null,!s&&x.getParent(),i.setLayerTilesBecameDirty(x.getID()),h=null,k&&(k.stop("destroy"),k=null),d&&(a.getTileManager().freeTilingSet(d),d=null),a.getInputDelegate()&&a.getInputDelegate().didRemoveLayer(x),a.getIframeDelegate()&&a.getIframeDelegate().didRemoveLayer(x),Util.forEachItem(L,(function(e,t){x.deregisterCallback(t)})),Util.forEachItem(A,(function(e,t){t.tree.deregisterObserver(t)})),A={},v&&(v.release(),v=null),V=null},x.isLive=function(){return!(!l||!l.parentNode)},x.hitTestSubtree=function(e,t){var r,n,o,i=x.getChildren(),a=Z();for(r=i.length-1;r>=0;r-=1)if(n=i[r].hitTestSubtree(e,t))return n;return x.isHitTestable()&&(o=x.hitTestPoint(e))&&Sk.Rect.containsPoint(a,o)?t(x,o):null},x.getProjectionMatrix=function(e){var t,r;return t=i.getPropertyTrees().getTransformTree().combineTransforms(x.getTransformTreeIndex(),e),r=x.getOffsetToTransformParent(),mat4.fromTranslation(B,[r.x,r.y,0]),mat4.multiply(B,t,B)},x.getProjectionMatrixInverse=function(e){return mat4.invert(H,a.getProjectionMatrix(e,x))},x.getDrawMatrix=function(){return a.getProjectionMatrix(x.isFixedToViewport()?Compositor.Projection.kIVSL:Compositor.Projection.kOVCL,x)},x.applyDrawTransform=function(e,t,r){var n=x.getDrawMatrix(),o=0,i=0;r&&mat4.multiply(n,n,r),t&&(o=Sk.Rect.getX(t),i=Sk.Rect.getY(t)),Compositor.Matrix3D.isIdentityOr2DTranslation(n)?function(e,t,r,n,o){var i,s=Compositor.Matrix3D.getTranslation(r),l=o+s.y;x.isFixedToBottom()&&t?(i=a.getOuterViewportScrollNode().getContainerBounds().height-(l+Sk.Rect.getHeight(t)),e.style.bottom=i+"px",e.style.top=""):(e.style.top=l+"px",e.style.bottom=""),e.style.left=n+s.x+"px",e.style.transform="",e.style.transformOrigin="",e.style.transformStyle=""}(e,t,n,o,i):function(e,t,r,n,o,i){var s,l,c=i?Compositor.Matrix3D.getScale(i):{x:1,y:1,z:1};e.style.left="0px",x.isFixedToBottom()&&t?(l=a.getOuterViewportScrollNode().getContainerBounds().height-Sk.Rect.getHeight(t)/c.y,e.style.bottom=l+"px",e.style.top=""):(e.style.top="0px",e.style.bottom=""),(n||o)&&(s=mat4.create(),mat4.fromTranslation(s,vec3.fromValues(n,o,0)),mat4.multiply(r,r,s)),e.style.transform=Compositor.Matrix3D.asCSSTransformMatrix(r),e.style.transformOrigin="0px 0px 0px"}(e,t,n,o,i,r)},x.applyDrawClip=function(e,t,r){var n=null,o=0,i=0;t&&r&&(n=Sk.Rect.intersection(t,r)),n?(Sk.Rect.isEmpty(n)||(o=Sk.Rect.getX(t),i=Sk.Rect.getY(t),n=Sk.Rect.makeOffset(n,-o,-i)),BrowserDetect.isIE()||BrowserDetect.isMobileSafari()&&BrowserDetect.getVersion()<13?re("clip",Sk.Rect.toCSSClip(n),e):re("clip-path",Sk.Rect.toCSSClipPath(t,n),e)):BrowserDetect.isIE()||BrowserDetect.isMobileSafari()&&BrowserDetect.getVersion()<13?re("clip",null,e):re("clip-path",null,e)},x.applyDrawOpacity=function(e){var t=x.getScreenSpaceOpacity();1!==t&&void 0!==t||(t=null),re("opacity",t,e)},x.toScreenSpaceRect=function(e,t){var r,n=a.getProjectionMatrix(Compositor.Projection.kScreenSpace,x);return e=e||x.getBoundsRect(),(r=Compositor.Matrix3D.mapRect(n,e)).rect_stays_rect=Compositor.Matrix3D.rectStaysRect(n),r},x.fromScreenSpaceRect=function(e,t){var r=x.getProjectionMatrixInverse(Compositor.Projection.kScreenSpace);return r?t?Compositor.Matrix3D.mapRect(r,Sk.Rect.intersection(e,a.getScreenSpaceClipRect(x))):Compositor.Matrix3D.mapRect(r,e):null},x.fromScreenPoint=de,x.toScreenPoint=function(e){var t=x.getProjectionMatrix(Compositor.Projection.kScreenSpace);return t?Compositor.Matrix3D.projectPoint(t,e):null},x.isPointClippedOut=function(e){var t=a.getScreenSpaceClipRect(x);return!Sk.Rect.containsPoint(t,e)},x.hitTestPoint=function(e){var t=de(e);return t?x.isPointClippedOut(e)?null:t:null},x.hitsWheelEventRegion=function(e){var t=I.wheel_event_region?I.wheel_event_region:Sk.Region.makeEmpty();return Sk.Region.containsPoint(t,e)},x.hitsTouchEventRegion=function(e){return Sk.Region.containsPoint(E,e)},x.hitsTouchActionRectLocal=function(e){var t,r=I.touch_action_region;return x.hitsTouchEventRegion(e)?null:r&&Sk.Region.containsPoint(r.whole_region,e)?(t=Compositor.TouchAction.kAuto,Util.forEachItem(r.touch_actions,(function(r,n){Sk.Region.containsPoint(n,e)&&(t&=r)})),{action:t}):null},x.hitTest=function(e,t){return e===Compositor.HitTest.kLayer?x.hitTestSubtree(t,(function(e,t){return e})):e===Compositor.HitTest.kScrollingOrScrollbarLayer?x.hitTestSubtree(t,(function(e,t){return e.isScrollerOrScrollbar()?e:null})):e===Compositor.HitTest.kTextureLayer?x.hitTestSubtree(t,(function(e,t){return e.isTextureLayer()?e:null})):e===Compositor.HitTest.kDrawing?x.hitTestSubtree(t,(function(e,t){return e.getHitTestResultAt(t)})):e===Compositor.HitTest.kEventTarget?x.hitTestSubtree(t,(function(e,t){var r=e.getHitTestResultAt(t);return r&&r.getFirstHittableItem()?r:null})):e===Compositor.HitTest.kScrollableContainerId?x.hitTestSubtree(t,(function(e,t){var r;return e.getDisplayList()&&(r=e.getDisplayList().hitTestPoint(t))&&r.getItemList().length?r.hitsScrollableContainer():null})):e===Compositor.HitTest.kTouchActionRegion?x.hitTestSubtree(t,(function(e,t){return e.hitsTouchActionRectLocal(t)})):e===Compositor.HitTest.kWheelEventRegion?x.hitTestSubtree(t,(function(e,t){return e.hitsWheelEventRegion(t)})):e===Compositor.HitTest.kTouchEventRegion?x.hitTestSubtree(t,(function(e,t){return e.hitsTouchEventRegion(t)})):void 0},x.getScreenSpaceScaleFactor=function(){return mat4.getScaling([],a.getProjectionMatrix(Compositor.Projection.kScreenSpace,x))},x.getScreenSpaceScaleFactorForScroll=function(){var e;return x.isScrollbar()||x.isCustomScrollbar(),e=x.getScreenSpaceScaleFactor(),x.isScrollbarHorizontal()?e[0]:e[1]},x.getRasterScaleFactor=function(){var e=x.getScreenSpaceScaleFactor(),t=i.getDeviceScaleFactor(),r=Math.max(e[0],e[1]);return 0===r?1:Math.min(a.getMaxRasterScaleFactor(),Math.ceil(r*t))},x.getLayerTreeHost=function(){return i},x.getDisplay=function(){return i.getDisplay()},x.setTilingSetVisible=function(e){d&&(d.getDomNode().style.display=e?"block":"none")},x.getTilingSet=function(){return d},x.getVideoDelegate=function(){return k},x.runOn=function(e,t){var r;r=a.callback.registerOneShot(e,0,{on_success:function(){L.hasOwnProperty(r),delete L[r],t()}}),L[r]=r},x.registerCallback=function(e,t){var r=a.callback.register(e,t);return L[r]=r,r},x.deregisterCallback=function(e){a.callback.deregister(e);delete L[e]},x.freeTiles=function(e){d&&(d.freeTiles(e),d.invalidateRect(x.getBoundsRect(),"free-tiles"))},x.id=e.id,o=e.type,i=e.lth,a=i.getDisplay(),M=e.is_mask_layer,w=document,(R=w.createElement("div")).className="svl",a.isDebugEnabled()&&(R.id="layer:"+i.getFid()+":"+x.id),R.style.position="static",R.style.left=R.style.top="0px",f=w.createElement("div"),a.isDebugEnabled()&&(f.id="content"),f.style.className="scd",f.style.pointerEvents="none",p=w.createElement("div"),a.isDebugEnabled()&&(p.id="children"),y=w.createElement("div"),a.isDebugEnabled()&&(y.id="sv-elements:"+i.getFid()+":"+x.id),y.style.position="static",y.style.margin="0px",y.style.padding="0px",y.style.overflow="visible",y.style.left=y.style.top="0px",R.appendChild(f),R.appendChild(y),R.appendChild(p),l=R,v=new Compositor.VelocityObserver(x,ce)},Compositor.GestureType={kUnknown:0,kTapDown:1,kTapUp:2,kScrollBegin:3,kScrollUpdate:4,kScrollEnd:5,kPinchBegin:6,kPinchUpdate:7,kPinchEnd:8},Compositor.TouchPhase={kBegin:0,kUpdate:1,kEnd:2},Compositor.GestureDetector=function(e){"use strict";var t;function r(e,t){return r=e,n=t,Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2))<=2;var r,n}function n(){t={type:Compositor.GestureType.kUnknown,touch_by_id:{},active_touch_count:0,touches:[]}}function o(r,n,o){t.type=r,t.touch_event_id=n,o||e.on_gesture_fn(t)}function i(e){var n,i=t;switch(i.type){case Compositor.GestureType.kUnknown:switch(e){case Compositor.TouchPhase.kBegin:if(1===i.touches.length)return o(Compositor.GestureType.kTapDown,i.touches[0].touch_event_id);if(2===i.touches.length)return o(Compositor.GestureType.kPinchBegin,i.touches[0].touch_event_id)}break;case Compositor.GestureType.kTapDown:switch(e){case Compositor.TouchPhase.kBegin:if(2===i.touches.length)return o(Compositor.GestureType.kPinchBegin,i.touches[0].touch_event_id);break;case Compositor.TouchPhase.kUpdate:return 1===i.touches.length&&i.touches[0].move_count>0?(i.delta=Compositor.Offset.makeZero(),i.last_pos=i.touches[0].start_pos,i.velocity=i.touches[0].velocity,o(Compositor.GestureType.kScrollBegin,i.touches[0].touch_event_id)):o(Compositor.GestureType.kTapDown,i.touches[0].touch_event_id,!0);case Compositor.TouchPhase.kEnd:if(1===i.touches.length&&i.touches[0].start_pos&&i.touches[0].end_pos&&r(i.touches[0].start_pos,i.touches[0].end_pos)&&i.touches[0].move_count<=0)return o(Compositor.GestureType.kTapUp,i.touches[0].touch_event_id)}break;case Compositor.GestureType.kScrollBegin:case Compositor.GestureType.kScrollUpdate:switch(e){case Compositor.TouchPhase.kUpdate:return i.touches.length,i.touches[0].move_count,n=i.touches[0].pos,i.delta=Compositor.Offset.subtract(n,i.last_pos),i.last_pos=n,i.velocity=i.touches[0].velocity,o(Compositor.GestureType.kScrollUpdate,i.touches[0].touch_event_id);default:return o(Compositor.GestureType.kScrollEnd,i.touches[0].touch_event_id)}case Compositor.GestureType.kPinchBegin:case Compositor.GestureType.kPinchUpdate:switch(e){case Compositor.TouchPhase.kUpdate:return i.touches.length,o(Compositor.GestureType.kPinchUpdate,i.touches[0].touch_event_id);default:return o(Compositor.GestureType.kPinchEnd,i.touches[0].touch_event_id)}}return o(Compositor.GestureType.kUnknown,0,!0)}function a(e){return"number"==typeof e.clientX&&e.clientY,MetricsUtils.clientToScreenPos(e.clientX,e.clientY)}function s(e,t){var r,n,o;e.pos=t,e.pos_hist.length>=2&&e.pos_hist.shift(),e.pos_hist.push({val:t,ts:Date.now()}),e.velocity=(r=e.pos_hist).length<2||o<=0||(o=r[r.length-1].ts-r[0].ts)<=0?Compositor.Offset.makeZero():(n=Compositor.Offset.subtract(r[r.length-1].val,r[0].val),Compositor.Offset.makeXY(n.x/o,n.y/o))}function l(e,r){t&&(r.end_pos=r.pos,r.end_pos,s(r,r.pos),r.touch_event_id=e.event_id,delete t.touch_by_id[r.identifier],t.active_touch_count-=1,t.active_event=e,t.active_touch_count,i(Compositor.TouchPhase.kEnd),0===t.active_touch_count&&n())}function c(e){e.touches&&t&&(Util.forEachItem(t.touch_by_id,(function(t,r){var n;for(n=0;n<e.touches.length;n+=1)if(t===String(e.touches[n].identifier))return;l(e,r)})),"touchstart"===e.type&&function(e){var r,n;for(r=0;r<e.changedTouches.length;r+=1)(n=t.touch_by_id[e.changedTouches[r].identifier])&&l(e,n)}(e))}function u(r,n){var o;if("touchstart"===r.type)return o={start_pos:a(n),pos:a(n),pos_hist:[{val:a(n),ts:Date.now()}],velocity:Compositor.Offset.makeZero(),move_count:0,identifier:n.identifier,touch_event_id:r.event_id},t.touch_by_id[n.identifier],e.hit_test_touch_event(r,a(n)),t.touch_by_id[n.identifier]=o,t.touches.push(o),t.active_touch_count+=1,t.hits_non_fast_region=r.hits_non_fast_region,t.allowed_touch_actions=r.allowed_touch_actions,t.active_event=r,void i(Compositor.TouchPhase.kBegin);r.type,(o=t.touch_by_id[n.identifier])&&(o.touch_event_id=r.event_id,o.move_count+=1,s(o,a(n)),t.active_event=r,i(Compositor.TouchPhase.kUpdate))}this.processEvent=function(e){var r,n=t;if(c(e),"touchstart"===e.type||"touchmove"===e.type)for(r=0;r<e.changedTouches.length;r+=1)u(e,e.changedTouches[r]);return n},this.getPendingGesture=function(){return t},n()},Compositor.TouchTracker=function(e){"use strict";var t=this,r=e.getMainFrame().getFid(),n=[],o={},i=0,a=1,s=2,l=3,c=0,u=1,d=2,f=3,p=!1;function g(e){switch(e){case"touchstart":return c;case"touchmove":return u;case"touchend":return d;case"touchcancel":return f}return-1}function m(e){return o[e]}function k(t,o){var i,a,s,l,c=MetricsUtils.clientToScreenPos(t.clientX,t.clientY),u=Compositor.Offset.makeXY(c.x,c.y);if(i=m(t.identifier)){if(a=i.i,l=e.getSurfaceLayerForFrame(r)){if(!(s=l.fromScreenPoint(c)))return null;u.x=s.x,u.y=s.y}}else{if(i={},(a=function(){var e;for(e=0;e<16;e+=1)if(!n[e])return e;return-1}())<0)return null;e.findTargetAndCallback(c,(function(e,t){return r=e,u.x=t.x,u.y=t.y,!0}))}return i.i=a,i.s=o,i.x=c.x,i.y=c.y,i.wx=u.x,i.wy=u.y,i.rx=void 0!==t.radiusX?t.radiusX:1,i.ry=void 0!==t.radiusY?t.radiusY:1,i.ra=void 0!==t.rotationAngle?t.rotationAngle:0,i.f=void 0!==t.force?t.force:1,i}function h(e,t){var r;switch(e){case"touchstart":case"touchmove":if(!(r=k(t,"touchstart"===e?i:a)))return;n[r.i]=r,o[t.identifier]=r;break;case"touchend":case"touchcancel":if(!(r=m(t.identifier)))return;r.s="touchend"===e?s:l}}t.isTouchEnd=function(e){return"touchend"===e.type||"touchcancel"===e.type},t.pendingTouchEnd=function(){return p},t.cancelTouch=function(e){if("touchcancel"!==e.type&&window.TouchEvent){var r=new TouchEvent("touchcancel",{touches:e.touches,targetTouches:e.targetTouches,changedTouches:e.changedTouches,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey});r.event_id=e.event_id,r.hits_touch_region=e.hits_touch_region,r.hits_non_fast_region=e.hits_non_fast_region,t.processEvent(r)}else t.processEvent(e)},t.processEvent=function(i){var a;"touchstart"===i.type?p=!0:t.isTouchEnd(i)&&(p=!1),function(e){var t;for(t=0;t<e.changedTouches.length;t+=1)h(e.type,e.changedTouches[t])}(i),(a=function(){var e,t,r=[];for(t=0;t<16&&(e=n[t]);t+=1)e.i,r.push(e);return r}()).length&&e.sendCommand(["t",r,g(i.type),i.event_id,a]),i.touches.length||(o={},n=[],r=e.getMainFrame().getFid())}},Compositor.InputDelegate=function(e,t){"use strict";var r,n,o,i,a,s,l=this,c=t.getMainFrame(),u={x:0,y:0},d={key:0,input:0,touch:0,click:0,mouse:0},f=!1,p={},g=null,m=null,k=!1,h=1,S=c.getFid();function y(e){return"touchstart"===e.type||"touchend"===e.type||"touchmove"===e.type||"touchcancel"===e.type}function v(e){return"keydown"===e.type||"keypress"===e.type||"keyup"===e.type}function b(e){return"mousemove"===e.type||"mousedown"===e.type||"mouseup"===e.type||"mouseout"===e.type||"contextmenu"===e.type||"click"===e.type}function C(e){return"wheel"===e.type}function _(e,r){t.sendCommand(["g",e,r])}function T(e,r,n){var o=t.getFrameToken(e),i=Sk.Util.getNodeKey(o,r);g!==i&&(g=i,k=!0)}function w(e,r,n){var o=t.getFrameToken(e),a=Sk.Util.getNodeKey(o,r);i.findElement(a);g=null,k=!0}function R(e,r){var n,o=t.getLthForFrame(e.fid)||c,a=o.hitTest(Compositor.HitTest.kDrawing,e.pos),s=null,l=null;return a&&(l=a.getLayer(),s=function(e){return e.hitsFormControlNode()||e.hitsNodeWithLink()||e.hitsTextNode()||e.hitsImageNode()}(a),e.htr=a),!s&&r&&(n=function(e,r){var n,o,i,a,s=r.hitTest(Compositor.HitTest.kLayer,e);return s&&(o=s.getDisplayList())?(a=t.getConfig(),(n=s.fromScreenSpaceRect(Sk.Rect.makeFromMidpoint(e,a.getTouchSize().width/2,a.getTouchSize().height/2),!0))&&(i=o.hitTestRect(n))?{item:i.getItemClosestToPoint(e),layer:s}:null):null}(e.pos,o))&&(s=n.item,l=n.layer),s&&l?(s.data.node_uid,i.hitLock(s.data.node_uid,l)):null}function x(){i.transferFocusTo(m),m=null,s=null}function D(e){f||i.hitUnlockAll(r)}function M(e,t){t.updateShadowElementClip()}function F(e,t){r===e&&(r=null),t.isLive()&&t.updateShadowElementClip()}function E(e,t,n){if(n){if(r===e)return;return r&&(i.hitUnlock(r),r=null),i.hitLock(e,t),void(r=e)}r===e&&(i.hitUnlock(r),r=null)}function I(e,t,r){r.fid=e,r.x=t.x,r.y=t.y}function P(e){var r,n,o,i=e.touches[0].pos,a={fid:c.getFid(),x:i.x,y:i.y},s=new Compositor.ScrollState(Compositor.EventType.kTouch,Compositor.Offset.makeXY(i.x,i.y),Compositor.Offset.scale(e.delta,-1),Compositor.Offset.scale(e.velocity,-1)),l=Compositor.ScrollAction.kNoAction,u=c.getScrollDelegate(),d=!1;if(e.type===Compositor.GestureType.kScrollBegin?t.findTargetAndCallback(i,(function(n,o){var c;return r=t.getLthForFrame(n),u=r.getScrollDelegate(),(l=u.doScroll(e.type,s))===Compositor.ScrollAction.kRequiresMainThreadHitTest&&(t.getConfig().isScrollUnificationEnabled(),u.doScroll(Compositor.GestureType.kScrollEnd),s.reset(),(c=r.hitTest(Compositor.HitTest.kScrollableContainerId,i))&&(s.setHasMainThreadHitTestedReasons(),s.setTargetElementId(c.data.scrollable_container_id),l=u.doScroll(e.type,s))),l===Compositor.ScrollAction.kForwardToNextFrame?(u.doScroll(Compositor.GestureType.kScrollEnd),s.reset(),!1):(S=n,I(n,o,a),!0)})):e.type===Compositor.GestureType.kScrollUpdate?(r=t.getLthForFrame(S))&&(u=r.getScrollDelegate(),l=u.doScroll(e.type,s),(n=t.getSurfaceLayerForFrame(S))&&((o=n.fromScreenPoint(i))?I(S,o,a):l=Compositor.ScrollAction.kNoAction)):(e.type,Compositor.GestureType.kScrollEnd,function(e){var r=t.getLthForFrame(S);r&&r.getScrollDelegate().doScroll(Compositor.GestureType.kScrollEnd,e),S=c.getFid(),Compositor.ScrollAction.kNoAction}(s)),l===Compositor.ScrollAction.kForwardToSurrogate)return d=u.didHandlerPreventDefault(Compositor.EventType.kTouch),e.active_event.preventDefault(),void(d||function(e,t){var r,n=e.touches[0].pos;switch(e.type){case Compositor.GestureType.kScrollBegin:r={t:"sb",x:n.x,y:n.y,wx:t.x,wy:t.y};break;case Compositor.GestureType.kScrollUpdate:r={t:"su",x:n.x,y:n.y,wx:t.x,wy:t.y,dx:e.delta.x,dy:e.delta.y};break;case Compositor.GestureType.kScrollEnd:r={t:"se",x:n.x,y:n.y,wx:t.x,wy:t.y}}e.touch_event_id,r.tid=e.touch_event_id,_(t.fid,r)}(e,a));l===Compositor.ScrollAction.kPreventNativeScroll&&e.active_event.preventDefault()}function L(e){var r,n=e.touches[0].pos,o={fid:c.getFid(),x:n.x,y:n.y};if(function(e){var t=e.allowed_touch_actions;return!(!t||(t.action&Compositor.TouchAction.kPinchZoom)!==Compositor.TouchAction.kNone&&!t.hits_touch_event_region)}(e)){switch(t.findTargetAndCallback(n,(function(e,t){return I(e,t,o),!0})),e.type){case Compositor.GestureType.kPinchBegin:r={t:"pb",x:n.x,y:n.y,wx:o.x,wy:o.y};break;case Compositor.GestureType.kPinchUpdate:r={t:"pu",x:n.x,y:n.y,wx:o.x,wy:o.y,scale:.5};break;case Compositor.GestureType.kPinchEnd:r={t:"pe",x:n.x,y:n.y,wx:o.x,wy:o.y}}r.tid=e.touch_event_id,e.active_event.preventDefault(),_(o.fid,r)}}function O(e){switch(e.type){case Compositor.GestureType.kUnknown:break;case Compositor.GestureType.kTapDown:!function(e){var r,n,o=e.touches[0].start_pos;t.findTargetAndCallback(o,(function(e,t){return n=e,!0})),r={pos:o,fid:n,type:Compositor.EventType.kTouch,active_event:e.active_event},l.doPointerDown(r),e.hit_node_uid=r.hit_node_uid,e.forward_to_surrogate=r.forward_to_surrogate,e.pointer_ctx=r}(e);break;case Compositor.GestureType.kTapUp:!function(e){l.doPointerUp(e.pointer_ctx),e.forward_to_surrogate=e.pointer_ctx.forward_to_surrogate,BrowserDetect.isMobileSafari()&&i.registerUserInitiatedFocusIfNeeded(e)&&(s&&(clearTimeout(s),s=null),s=setTimeout(x,1e3))}(e);break;case Compositor.GestureType.kScrollBegin:case Compositor.GestureType.kScrollUpdate:case Compositor.GestureType.kScrollEnd:e.type===Compositor.GestureType.kScrollBegin&&D(),P(e);break;case Compositor.GestureType.kPinchBegin:case Compositor.GestureType.kPinchUpdate:case Compositor.GestureType.kPinchEnd:e.type===Compositor.GestureType.kPinchBegin&&D(),L(e)}}function A(e,r){e.allowed_touch_actions||t.findTargetAndCallback(r,(function(n,o){var i,a=t.getLthForFrame(n);return e.allowed_touch_actions={action:Compositor.TouchAction.kAuto},(i=a.hitTest(Compositor.HitTest.kTouchActionRegion,r))?e.allowed_touch_actions.action=i.action:e.allowed_touch_actions.hits_touch_event_region=a.hitTest(Compositor.HitTest.kTouchEventRegion,r),!0}))}function B(a){"selectionchange"===a.type&&function(){var e=window.getSelection(),n=!e.isCollapsed,o=0!==e.rangeCount?e.getRangeAt(0).getBoundingClientRect():{x:0,y:0,width:0,height:0},a=MetricsUtils.clientToScreenPos(o.x,o.y),s=MetricsUtils.clientToScreenPos(o.x+o.width,o.y+o.height),l=t.getConfig(),c=l.getSelectionOverApproximation().horizontal,u=l.getSelectionOverApproximation().vertical;if(e.isCollapsed,e.isCollapsed,e.anchorNode,e.focusNode,f=n)return window.visualViewport&&window.visualViewport.dispatchEvent&&BrowserDetect.isMobileSafari()&&window.visualViewport.dispatchEvent(new CustomEvent("scroll")),c=Math.max(i.getMaxSelectionChangeDelta().x,c),u=Math.max(i.getMaxSelectionChangeDelta().y,u),a.x-=c,a.y-=u,s.x+=c,s.y+=u,void i.hitLockAllTextNodes(Sk.Rect.fromLTRB(a.x,a.y,s.x,s.y));i.hitUnlockAll(r)}(),v(a)&&p.keyboard.dispatchEvent(a),(b(a)||C(a))&&(!BrowserDetect.supportsTouchEvents()||Date.now()-d.touch>t.getConfig().getMouseEmulationTimeoutMs())&&p.mouse.dispatchEvent(a),C(a)&&p.wheel.dispatchEvent(a),y(a)&&function(t){var r;h+=1,t.event_id=h,t.hits_non_fast_region=!1,(r=n.processEvent(t)).forward_to_surrogate,r.forward_to_surrogate&&(f?o.pendingTouchEnd()&&o.isTouchEnd(t)&&o.cancelTouch(t):o.processEvent(t)),e.callback.fire("interaction",t)}(a)}function H(t){var n;t.target&&t.target.hasAttribute&&t.target.hasAttribute("data-ui-sv-prevent-push")||(e.detached?e.prevent_reattach||(e.detached=!1,Util.xframe_reload()):(!function(e){(function(e){return"keydown"===e.type||"keypress"===e.type||"keyup"===e.type||"compositionstart"===e.type||"compositionupdate"===e.type||"compositionend"===e.type||"input"===e.type||"beforeinput"===e.type||"textInput"===e.type||"selectionchange"===e.type})(e)||v(e)?(d.input=Date.now(),v(e)&&(d.key=d.input)):y(e)?(BrowserDetect.supportsTouchEvents(),d.touch=Date.now(),"touchstart"!==e.type&&"touchmove"!==e.type||(u={x:e.touches[0].clientX,y:e.touches[0].clientY})):(b(e)||C(e))&&(d.mouse=Date.now(),"mousedown"===e.type&&(d.click=d.mouse),u={x:e.clientX,y:e.clientY})}(t),B(t),(n=i.findElement(r))&&n.processInputEvent&&n.processInputEvent(t)))}function N(e){var t=e?EventListener.addListener:EventListener.removeListener;["compositionstart","compositionupdate","compositionend","input","beforeinput","textInput","change"].forEach((function(e){t(window,e,H,!1)})),["selectionchange"].forEach((function(e){t(document,e,H,!1)}))}function U(e,t){var r=e?EventListener.addListener:EventListener.removeListener;["touchstart","touchmove","touchcancel","touchend"].forEach((function(e){r(window,e,H,!0,t)}))}function V(){var t="";BrowserDetect.isMobile()&&(t+="*:not(input):not(textarea) {user-select: none; -user-select: none; -webkit-user-select: none; -moz-user-select; -ms-user-select: none;}"),BrowserDetect.isAndroidChrome()&&(t+="\nspan::selection {color: rgba(0,0,0,0); background-color: rgba(172, 206, 247, 0.6);}"),Compositor.Util.toggleStyle("sv-selection-style",t),function(){var t="@font-face {font-family: 'Menlo-Square'; src: local('Menlo-Square'), url('"+e.url_builder.buildAssetURL("/safeview-static/fonts/Menlo-Square.otf")+"');}";t+="\n@font-face {font-family: 'Menlo-Password'; src: local('Menlo-Password'), url('"+e.url_builder.buildAssetURL("/safeview-static/fonts/Menlo-Password.otf")+"');}",Compositor.Util.toggleStyle("sv-shadow-font",t)}()}function z(e,r,n,o,i,s,l,c,u,d,f){a={is_text:r,is_selected:n,is_editable:o,url:i,link_target_blank:s,cursor_name:l,frame_id:e,title:c,node_id:u,viewport_bounds:t.toScreenBounds(e,d),select_items:f}}l.doPointerDown=function(e){var r=t.getLthForFrame(e.fid),n=R(e,!0);e.forward_to_surrogate=!0,n&&(e.hit_node_uid=n.node_uid,n.processPointerEvent&&(e.forward_to_surrogate=n.processPointerEvent(e))),r.getScrollDelegate().stopScrollAnimation()},l.doPointerUp=function(e){var t=i.findElement(e.hit_node_uid),n=i.findElement(r);t?(t.processPointerEvent&&(e.forward_to_surrogate=t.processPointerEvent(e)),e.type===Compositor.EventType.kTouch&&i.hitUnlock(t)):(e.active_event.preventDefault(),n&&n.getNode().blur&&n.getNode().blur(),window.getSelection().collapse(null)),e.type!==Compositor.EventType.kTouch||f||i.hitUnlockAll(r)},l.doPointerMove=function(e){var t=R(e);t&&!f&&i.hitUnlockAll(t.node_uid)},l.doPointerClick=function(e){l.doPointerDown(e),l.doPointerUp(e)},l.getLastActivityTime=function(){return{key:d.key,mouse:Math.max(d.mouse,d.touch),click:d.click,input:d.input}},l.getLastMousePos=function(){return u},l.release=function(){U(!1,!1),N(!1),s&&(clearTimeout(s),s=null),i&&(i.release(),i=null),Util.forEachItem(p,(function(e,t){t.release()})),p=null},l.didRemoveLayer=function(e){i.didRemoveLayer(e)},l.didUpdateProjection=function(e){i.didUpdateProjection(e)},l.didUpdateOpacity=function(e){i.didUpdateOpacity(e)},l.didUpdateDisplayList=function(e){i.didUpdateDisplayList(e),k&&function(){var e,t=document.activeElement;if(!g)return k=!1,Sk.disabledRemoteCaret=!0,void(t&&"function"==typeof t.blur&&t.blur());(e=i.findElement(g))?(k=!1,e.showRemoteCaret&&(Sk.disabledRemoteCaret=!e.showRemoteCaret()),e.getNode()&&e.getNode().focus&&e.getNode()!==t&&e.getNode().focus()):m=g}()},l.getShadowElementManager=function(){return i},l.getCurrentHitTestResult=function(){return a},l.getDisplay=function(){return t},l.getSafeview=function(){return e},l.isLocallyHandledHitElement=function(e){return!!Util.findPredicateOnBranch(e.target,(function(e){return e.getAttribute&&!!e.getAttribute("sv-prevent-push")}))},l.getMouseDelegate=function(){return p.mouse},e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_FOCUS_ELEMENT,T),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_FOCUS_OUT,w),e.interp.registerOpcodeHandler("htr",z),t.callback.register("added-shadow-element",M),t.callback.register("removed-shadow-element",F),t.callback.register("shadow-element-focus-change",E),n=new Compositor.GestureDetector({on_gesture_fn:O,hit_test_touch_event:A}),i=new Compositor.ShadowElementManager(t),o=new Compositor.TouchTracker(t),p.mouse=new Compositor.MouseDelegate(l,H),p.wheel=new Compositor.WheelDelegate(l,H),p.keyboard=new Compositor.KeyboardDelegate(l,H),p.drag_and_drop=new Compositor.DragDropDelegate(l,H),N(!0),U(!0,!1),V(),Compositor.Util.toggleStyle("sv-input-style",'input[type=search]::-ms-clear {  display: none; width : 0; height: 0; }\ninput[type=search]::-ms-reveal {  display: none; width : 0; height: 0; }\ninput[type="search"]::-webkit-search-decoration,\ninput[type="search"]::-webkit-search-cancel-button,\ninput[type="search"]::-webkit-search-results-button,\ninput[type="search"]::-webkit-search-results-decoration { display: none; }\n')},Compositor.MouseButton=Object.freeze({kLeftButton:0,kMiddleButton:1,kRightButton:2}),Compositor.MouseDelegate=function(e,t){"use strict";var r,n,o,i,a,s=this,l=new Logger("mouse",{level:"info"}),c=e.getSafeview(),u=e.getDisplay(),d=u.getMainFrame(),f=Compositor.Offset.makeZero(),p={x:0,y:0,type:""},g={x:0,y:0,fid:d.getFid()},m=0,k={},h=!1,S=!1;function y(){o&&(clearTimeout(o),o=null,u.sendCommand(r),r=null,n=null)}function v(e){return BrowserDetect.isIE()&&("mousedown"===e.type||"mouseup"===e.type||"mousemove"===e.type)&&e.detail>=4&&e.detail>m?m:e.detail}function b(e,t,r){r.fid=e,r.x=t.x,r.y=t.y}function C(t){var r=!0;return"mousemove"===t.type?(a={pos:p,fid:g.fid,type:Compositor.EventType.kMouse,active_event:t},t.buttons&&(h=!0),e.doPointerMove(a),function(e){var t;e.htr&&((t=e.htr.getFirstItem())&&t.data&&t.data.cursor?document.documentElement.style.cursor=Compositor.CSS.toCursorName(t.data.cursor):document.documentElement.style.cursor=null)}(a)):"mousedown"===t.type?(S||(a={pos:p,fid:g.fid,type:Compositor.EventType.kMouse,active_event:t,forward_to_surrogate:!0},e.doPointerDown(a),S=!0),r=!!a.forward_to_surrogate):"mouseup"===t.type?(a.type,Compositor.EventType.kMouse,a.pos=p,a.active_event=t,h||t.buttons?r=!0:(e.doPointerUp(a),r=!!a.forward_to_surrogate),t.buttons||(h=!1,S=!1,a=null)):"click"===t.type&&(a={pos:p,fid:g.fid,type:Compositor.EventType.kMouse,active_event:t},e.doPointerClick(a),r=!1),r}function _(t){var a,s,h,S=MetricsUtils.clientToScreenPos(t.clientX,t.clientY),_={fid:d.getFid(),x:S.x,y:S.y};if("mousedown"===t.type&&(c.clipboard.piggyback(t),c.callback.fire("interaction",t)),function(e){!BrowserDetect.isIE()||"mousedown"!==e.type&&"mouseup"!==e.type&&"mousemove"!==e.type||("mousedown"===e.type?(m+=1,i&&(clearTimeout(i),i=null)):"mouseup"===e.type&&(i=setTimeout((function(){m=0}),500)))}(t),u.callback.fire("mouse-event",t.type,S),t.type,Util.getMouseAndKeyboardModifiers(t,l),t.button,v(t),Util.get_node_tag(t.target),!u.in_page_searcher.mouse_event_search_input(t))return function(e){var t,r=e.target?Util.get_node_tag(e.target):null;return!!document.documentElement&&(e.target&&"html"!==r?(e.target,"div"===r&&(t=e.target.getBoundingClientRect(),!(e.clientX>t.left+e.target.clientWidth&&e.clientY>t.top+e.target.clientHeight)&&(e.clientX>t.left+e.target.clientWidth||e.clientY>t.top+e.target.clientHeight))):e.clientX>document.documentElement.clientWidth||e.clientY>document.documentElement.clientHeight)}(t)?(t.type,void Util.get_node_tag(t.target)):void("contextmenu"!==t.type?"mousemove"===t.type&&"mousemove"===p.type&&Compositor.Offset.isEqual(S,p)||(f=Compositor.Offset.makeXY(t.clientX,t.clientY),p.x=g.x=S.x,p.y=g.y=S.y,p.type=t.type,u.findTargetAndCallback(S,(function(e,t){return b(e,t,_),b(e,t,g),!0})),C(t)&&"click"!==t.type&&(e.isLocallyHandledHitElement(t)||(u.callback.fire("did-mouse-move"),a=["CM-mouse",_.fid,t.type,S.x,S.y,_.x,_.y,t.button,Util.getMouseAndKeyboardModifiers(t,l),v(t)],"mousemove"===t.type&&(s=Util.calculateMouseMovement(t),n&&(s.x+=n.x,s.y+=n.y),a.push(s.x),a.push(s.y)),"mousemove"!==t.type||t.buttons?(y(),u.sendCommand(a)):(o||(o=setTimeout((function(){y()}),10)),r=a,n=s),function(e){return"mousedown"===e.type||"mouseup"===e.type}(t)&&("mousedown"===t.type?k[t.button]=!0:k[t.button]=!1,BrowserDetect.isIE()&&"mousedown"===t.type&&(h=document.activeElement,document.body.focus(),h&&h.focus()))))):c.ctx_menu_mode&&c.ctx_menu_mode.backend_driven&&t.preventDefault())}function T(e){var r=e?EventListener.addListener:EventListener.removeListener;r(document,"mousemove",t,!1),r(document,"mousedown",t,!1),r(document,"contextmenu",t,!1),r(document,"mouseup",t,!1),r(document,"mouseout",t,!1),r(document,"click",t,!1)}s.getLastMousePosFid=function(){return g.fid},s.release=function(){T(!1)},s.dispatchEvent=function(e){switch(e.type){case"mousemove":case"mousedown":case"contextmenu":case"mouseup":case"click":_(e);break;case"mouseout":t=e,"html"===Util.get_node_tag(t.target)&&delete c.last_mouse_pos;break;case"wheel":!function(e){(p=MetricsUtils.clientToScreenPos(e.clientX,e.clientY)).type=e.type}(e)}var t},s.getScreenPos=function(){return p},s.getClientPos=function(){return f},u.callback.register("scroll-container-scrolled",(function(){Util.forEachItem(k,(function(e,t){t&&(k[e]=!1,u.sendCommand(function(e,t,r,n,o,i,a,s,l,c,u){var d=["CM-mouse",t,e,r,n,o,i,a||0,0,0];return void 0!==c&&d.push(c),void 0!==u&&d.push(u),d}("mouseup",g.fid,p.x,p.y,g.x,g.y,e)))}))})),T(!0)},Compositor.WheelDelegate=function(e,t){"use strict";var r,n,o=this,i=new Logger("wheel",{level:"info"}),a=e.getSafeview(),s=e.getDisplay(),l=e.getMouseDelegate(),c=s.getMainFrame(),u=!1,d=c.getFid();function f(e,n){r&&(EventListener.removeListener.apply(Util,r),r=null),e&&(r=[document,"wheel",t,!1,n],EventListener.addListener.apply(Util,r))}function p(e,t){var n;e=e||l.getLastMousePosFid(),t=t||l.getScreenPos(),(n=(s.getLthForFrame(e)||c).getScrollDelegate().willScrollNatively(Compositor.EventType.kWheel,t))===u&&r||f(!0,u=n)}function g(){var e;n&&(n=null,(e=s.getLthForFrame(d))&&e.getScrollDelegate().doScroll(Compositor.GestureType.kScrollEnd),d=c.getFid())}function m(e,t,r){r.fid=e,r.x=t.x,r.y=t.y}function k(e,t){g(),"mousemove"===e&&(p(),n&&(clearTimeout(n),n=null))}function h(e,t){s.wheelHandlerStateChanged(e,t)}o.dispatchEvent=function(t){t.type,function(t){var r,o,l,u=void 0===t.deltaX?0:Math.round(t.deltaX),f=void 0===t.deltaY?0:Math.round(t.deltaY),k=void 0===t.wheelDeltaX?-3*u:t.wheelDeltaX,h=void 0===t.wheelDeltaY?-3*f:t.wheelDeltaY,S=a.xbrowser.getEventTarget(t),y=MetricsUtils.clientToScreenPos(t.clientX,t.clientY),v={fid:c.getFid(),x:y.x,y:y.y},b=c.getScrollDelegate(),C=new Compositor.ScrollState(Compositor.EventType.kWheel,y,Compositor.Offset.makeZero()),_=new Compositor.ScrollState(Compositor.EventType.kWheel,y,Compositor.Offset.makeXY(u,f)),T=y,w=!1;if(S){if(S.getAttribute&&!e.isLocallyHandledHitElement(t)){if(n?(clearTimeout(n),o=s.getLthForFrame(d),(l=s.getSurfaceLayerForFrame(d))&&(T=l.hitTestPoint(y)),T&&o?(b=o.getScrollDelegate(),m(d,T,v),r=b.doScroll(Compositor.GestureType.kScrollUpdate,_),n=setTimeout((function(){g()}),100)):(g(),r=Compositor.ScrollAction.kNoAction,n=null)):(s.findTargetAndCallback(y,(function(e,t){var n;return o=s.getLthForFrame(e),b=o.getScrollDelegate(),(r=b.doScroll(Compositor.GestureType.kScrollBegin,C))===Compositor.ScrollAction.kRequiresMainThreadHitTest&&(s.getConfig().isScrollUnificationEnabled(),b.doScroll(Compositor.GestureType.kScrollEnd),C.reset(),(n=o.hitTest(Compositor.HitTest.kScrollableContainerId,y))&&(C.setHasMainThreadHitTestedReasons(),C.setTargetElementId(n.data.scrollable_container_id),r=b.doScroll(Compositor.GestureType.kScrollBegin,C))),r===Compositor.ScrollAction.kForwardToNextFrame?(b.doScroll(Compositor.GestureType.kScrollEnd),C.reset(),!1):(r=b.doScroll(Compositor.GestureType.kScrollUpdate,_))===Compositor.ScrollAction.kForwardToNextFrame?(b.doScroll(Compositor.GestureType.kScrollEnd),C.reset(),_.reset(),!1):(d=e,m(e,t,v),!0)})),n=setTimeout((function(){g()}),100)),p(d,y),r===Compositor.ScrollAction.kForwardToSurrogate)return w=b.didHandlerPreventDefault(Compositor.EventType.kWheel),s.sendCommand(["CM-wheel",v.fid,y.x,y.y,v.x,v.y,u,f,k,h,!0,w]),void t.preventDefault();r===Compositor.ScrollAction.kPreventNativeScroll&&t.preventDefault(),b.getLth().hasEventListener(Compositor.EventType.kWheel)&&s.sendCommand(["CM-wheel",v.fid,y.x,y.y,v.x,v.y,u,f,k,h,!1,!1])}}else i.error({event:"tc-wheel-event-error",reason:"invalid target"})}(t)},o.release=function(){f(!1)},s.callback.register("wheel-handler-state-changed",p),s.callback.register("wheel-event-listener-changed",p),s.callback.register("mouse-event",k),a.interp.registerOpcodeHandler("did_wh_pd",h),p(),o.dispatchEvent},Compositor.KeyboardDelegate=function(e,t){"use strict";var r,n=e.getSafeview(),o=e.getDisplay(),i=new KeyMap,a=o.getMainFrame(),s=a.getFid();function l(e){s=e}function c(e,t,r){switch(r){case"undo":case"redo":n.surrogate_channel.send("execcmd",s||a.getFid(),r)}return t.preventDefault(),!1}function u(t){var l,c,u=i.getKeyCode(t),d=t.keyCode,f=t.ctrlKey,p=t.metaKey,g=t.altKey,m=!1;t.type,t.keyCode,t.charCode,l=r.get_operation(t),"keydown"!==t.type||o.in_page_searcher.is_search_focused()||(n.clipboard.piggyback(t),n.callback.fire("interaction",t)),n.callback.fire("key-event",t.target,t),n.print_handler.handlePrintKeyEventIfNeeded(t,l)||(d=Util.get_corresponding_chrome_keycode(t,d),"keypress"===t.type&&t.altKey&&(BrowserDetect.isIE()||RegExp("^.$","u").test(t.key))&&(f=!1,p=!1,g=!1,m=!0),"keyup"!==t.type&&!m&&r.tryProcess(t)||o.in_page_searcher.is_key_event_search_input(t)||e.isLocallyHandledHitElement(t)||(c=["kbd",s||a.getFid(),0,t.type,d,t.charCode,u,i.getCode(t),t.shiftKey,f,g,p],o.sendCommand(c),function(e,t,r,n){return t||r||n||"keydown"===e.type&&!i.SPECIAL_KEYS.hasOwnProperty(e.keyCode)}(t,p,f,g)&&!o.in_page_searcher.is_search_operation(t)||t.preventDefault()))}function d(e){var r=e?EventListener.addListener:EventListener.removeListener;r(document,"keydown",t,!1),r(document,"keypress",t,!1),r(document,"keyup",t,!1),n.print_handler.attachKeyEventHandler(e)}this.dispatchEvent=function(e){u(e)},this.release=function(){d(!1)},r=new ShortcutKeyHandler(n,c),d(!0),o.callback.register("input-focused",l)},Compositor.DragDropDelegate=function(e,t){"use strict";var r=new Logger("dnd-del",{level:"info"}),n=e.getSafeview(),o=e.getDisplay(),i=o.getMainFrame(),a=e.getMouseDelegate(),s=null,l=null;function c(){var e,t;e=document.getElementById("sv-drag-img"),t=a.getClientPos(),e&&(e.style.left=t.x+"px",e.style.top=t.y+"px")}function u(e,t,r,o,i,a,s,l){o.relative_to_target=!1,n.surrogate_channel.send("drag",e,{t:t,y:r,p:o,m:i,d:a,f:s,i:l})}function d(){s&&(u(s.frame,s.node,"dragleave",{x:0,y:0},{x:0,y:0},0,[{type:"text/plain"}],{0:{}}),s=null,l=null)}function f(t){var a,c,f,p,g,m,k,h,S=MetricsUtils.clientToScreenPos(t.clientX,t.clientY),y={fid:i.getFid(),x:S.x,y:S.y},v=e.getCurrentHitTestResult();n.allow_backend_dragdrop&&(o.findTargetAndCallback(S,(function(e,t){return function(e,t,r){r.fid=e,r.x=t.x,r.y=t.y}(e,t,y),!0})),v?(g=y.fid,m=v.node_id,p=t.type,t.preventDefault(),"drop"===p&&n.upload.setupDroppedUpload(t.dataTransfer.files),a={x:t.clientX,y:t.clientY,wx:y.x,wy:y.y},c=Util.calculateDragMovement(t),f=Util.getMouseAndKeyboardModifiers(t,r),k=Util.gen_dragdrop_file_list(t.dataTransfer),h=t.dataTransfer.items,s&&m===s.node||(u(g,m,"dragenter",a,{x:0,y:0},f,k,h),s&&u(s.frame,s.node,"dragleave",a,{x:0,y:0},f,k,h)),u(g,m,p,a,c,f,k,h),"drop"!==p?(s={frame:g,node:m},l&&clearTimeout(l),l=setTimeout(d,550)):s=null):o.sendCommand(["CM-mouse",y.fid,"mousemove",S.x,S.y,y.x,y.y,t.button,Util.getMouseAndKeyboardModifiers(t,r),t.detail]))}function p(e){var r=e?EventListener.addListener:EventListener.removeListener;r(document,"dragover",t||f,!1),r(document,"drop",t||f,!1)}n.interp.registerOpcodeHandler("drag-start",(function(e){var t=document.getElementById("sv-drag-img"),r=a.getClientPos(),n=r.x+"px",o=r.y+"px",i="data:image/png;base64,"+e;t||((t=document.createElement("img")).setAttribute("id","sv-drag-img"),t.src=i,t.style.position="fixed",t.style.opacity="0.7",t.style.filter="drop-shadow(0px 0px 4px gray)",t.style.left=n,t.style.top=o,t.style.transformOrigin="0px 0px 0px",t.style.transform="scale("+1/Util.getDeviceScaleFactor()+")",document.body.appendChild(t))})),n.interp.registerOpcodeHandler("drag-stop",(function(){var e=document.getElementById("sv-drag-img");e&&e.parentNode&&e.parentNode.removeChild(e)})),this.release=function(){p(!1)},p(!0),o.callback.register("did-mouse-move",c)},Compositor.IframeDelegate=function(e,t){"use strict";var r=this,n=null,o={};function i(e,t,r){r&&Util.forEachItem(o,(function(t,r){t.startsWith(e+":")&&function(e){var t=o[e];if(!t)return;t.node.parentNode&&t.node.parentNode.removeChild(t.node);delete o[e]}(t)}))}function a(e,t,r){var n=o[e],i=!1;n&&(n.layer!==t?(i=!0,"layer changed"):n.item&&r&&(Sk.Rect.isEqual(n.item.visual_rect,r.visual_rect)||(i=!0,"frame rect changed")),i&&(n.layer&&n.layer.getID(),t&&t.getID(),n.item,n.layer=t,n.item=r,s(n)))}function s(e){e.layer&&e.item?(e.node.style.display="block",function(e){Sk.Rect.toCSSStyle(e.item.visual_rect,e.node.style)}(e),l(e),c(e),u(e)):e.node.style.display="none"}function l(e){e.layer.applyDrawTransform(e.node,e.item.visual_rect)}function c(e){e.layer.applyDrawClip(e.node,e.item.visual_rect,e.layer_clip_rect)}function u(e){e.layer.applyDrawOpacity(e.node)}r.getContainer=function(){return n},r.getIframeNodeForFrame=function(e,n){var o,i,a,s,l;for(o=e,i=t.getLthForFrame(o);!i&&(s=getNodeByFrameFid(o));)o=s.fid,i=t.getLthForFrame(o);return i?(i.getLayerTree().walkDepthFirst((function(e){var t=e.getDisplayList(),r=t?t.hitTestRect(e.getBoundsRect()):null;r&&r.getItemList().some((function(t){var r=t.data;return r.frame_token===n&&r.type===Sk.HT.ElementType.kHtmlElement&&(a=e,l=t,!0)}))})),a?r.getIframeNode(a,l):null):null},r.getIframeNode=function(e,r){var i;return i=r.data.node_uid,o.hasOwnProperty(i)?a(i,e,r):function(e,r,i){var a=document.createElement("iframe");r.getID(),t.isDebugEnabled()&&(a.id="iframe:"+r.getID()+":"+e);a.style.position="absolute",a.style.border="0px",n.appendChild(a),o[e]={node:a,layer:r,item:i,layer_clip_rect:null},s(o[e])}(i,e,r),o[i].node},r.didUpdateDisplayList=function(e){var t,r,n;Util.isDictEmpty(o)||(r=(t=e.getDisplayList())?t.hitTestRect(e.getBoundsRect()):null)&&(n=r.getItemList(),Util.forEachItem(o,(function(t,r){var o,i=null;for(o=0;o<n.length;o++)if(n[o].data.node_uid===t){i=n[o];break}i?a(t,e,i):r.layer===e&&a(t,null,null)})))},r.didRemoveLayer=function(e){Util.forEachItem(o,(function(t,r){r.layer===e&&a(t,null,null)}))},r.didUpdateProjection=function(e){Util.forEachItem(o,(function(t,r){r.layer===e&&l(r)}))},r.didUpdateClip=function(e,t){Util.forEachItem(o,(function(r,n){n.layer===e&&(n.layer_clip_rect||t)&&(n.layer_clip_rect&&t&&Sk.Rect.isEqual(n.layer_clip_rect,t)||(n.layer_clip_rect=t?Sk.Rect.makeCopy(t):null,c(n)))}))},r.didUpdateOpacity=function(e){Util.forEachItem(o,(function(t,r){r.layer===e&&u(r)}))},r.release=function(){n.parentNode&&n.parentNode.removeChild(n),n=null,o={}},(n=document.createElement("div")).style.position="absolute",n.style.left=n.style.top="0px",n.style.width=n.style.height="0px",n.style.margin="0px",n.style.padding="0px",n.style.overflow="visible",document.body.appendChild(n),e.callback.register("ftim-updated",i)},Compositor.LayerTree=function(e,t,r){"use strict";var n,o,i,a=this,s=new Logger("layer-tree",{level:"info"}),l=t.getDisplay(),c={},u={},d={},f={},p={},g=1,m=!1;function k(e){return d[e]||(d[e]={}),d[e]}function h(e){var t;(t=c[e]).release(),a.unregisterElement(t.getElementId()),a.unregisterNonFastLayer(e),(t.isScrollbar()||t.isCustomScrollbar())&&a.unregisterScrollbar(t),delete c[e]}function S(e){return"number"==typeof e}function y(e){var r=t.getRootLayerId(),n={};S(r),e.forEach((function(e){var i,l,u,d=e.type,f=e.layer_id,p=f===r;S(f),d===Compositor.MutationType.kAddLayer?(i=e.layer_parent_id,l=e.layer_sibling_index,(u=a.getLayer(f))||(u=new Compositor.Layer({id:f,type:e.layer_type,is_mask_layer:-1===l,lth:t})),delete n[f],p?a.setRoot(u):(S(i),a.getLayer(i).insertChild(a,u,l)),function(e,t){c[e]=t}(f,u)):d===Compositor.MutationType.kRemoveLayer?(u=a.getLayer(f),n.hasOwnProperty(f),u?(u.walkDepthFirstIterative((function(e){e.remove(),o===e&&(o=null),n[e.id]=e})),u.getContainer().parentNode):s.error({event:"tc-layer-not-found-on-removal",id:f})):s.error({event:"tc-unknown-mutation-type",type:d})})),Util.forEachItem(n,(function(e,t){String(t.id),t.id,h(t.id)}))}function v(){o&&o.walkDepthFirstIterative((function(e){e.remove(),h(e.id)})),n.childNodes.length,Util.isDictEmpty(c),o=null}a.walkDepthFirst=function(e){o.walkDepthFirstIterative(e)},a.getLayer=function(e){return c.hasOwnProperty(e)?c[e]:null},a.getLayerByElementId=function(e){return u.hasOwnProperty(e)?u[e]:null},a.withEachLayerDo=function(e){Util.forEachItem(c,e)},a.withEachNonFastLayerDo=function(e){Util.forEachItem(f,e)},a.updateScrollbarGeometries=function(){m&&(Util.forEachItem(d,(function(e,r){var n,o,i,c,u,d,f,g,m,k,h,S;(i=(n=(o=t.getPropertyTrees()).getScrollTree()).findNodeFromElementId(e))&&(c=n.getScrollOffset(e),u=i.getContentBounds(),d=i.getContainerBounds(),(f=i===l.getInnerViewportScrollNode()||i===l.getOuterViewportScrollNode())&&(g={width:d.width,height:d.height},i===l.getInnerViewportScrollNode()?(m=l.getOuterViewportScrollNode(),c=Compositor.Offset.add(c,n.getScrollOffset(m.getElementId())),h=m.getContainerBounds(),g=Compositor.Bounds.setToMin(g,h),u=m.getContentBounds()):(k=l.getInnerViewportScrollNode(),c=Compositor.Offset.add(c,n.getScrollOffset(k.getElementId())),S=k.getContainerBounds(),g=Compositor.Bounds.setToMin(g,S)),g=Compositor.Bounds.scale(g,1/p.current),d=Compositor.Bounds.ceil(g)),Util.forEachItem(r,(function(t,r){var n=a.getLayer(r);n?(n.isScrollbarHorizontal()?(n.setCurrentPos(c.x),n.setClipLayerLength(d.width),n.setScrollLayerLength(u.width)):(n.setCurrentPos(c.y),n.setClipLayerLength(d.height),n.setScrollLayerLength(u.height)),f&&n.setVerticalAdjust(o.getInnerViewportContainerBoundsDelta().y)):s.warn({event:"no-scrollbar",id:r,scrolling_element_id:e})})))})),m=!1)},a.setScrollbarGeometriesNeedUpdate=function(){m=!0},a.getScrollbarsFor=function(e){var t=[],r=k(e);return r.horizontal&&0!==r.horizontal&&t.push(a.getLayer(r.horizontal)),r.vertical&&0!==r.vertical&&t.push(a.getLayer(r.vertical)),t},a.registerElement=function(e,t){0!==e&&(u.hasOwnProperty(e),u[e]=t)},a.unregisterElement=function(e){0!==e&&delete u[e]},a.registerScrollbar=function(e){var r=k(e.getScrollElementId());e.isScrollbarHorizontal()?r.horizontal=e.getID():r.vertical=e.getID(),a.setScrollbarGeometriesNeedUpdate(),t.getScrollbarController().didRegisterScrollbar(e)},a.unregisterScrollbar=function(e){var r=e.getScrollElementId(),n=k(r);e.isScrollbarHorizontal()?delete n.horizontal:delete n.vertical,n.hasOwnProperty("horizontal")||n.hasOwnProperty("vertical")||delete d[r],t.getScrollbarController().didUnregisterScrollbar(e)},a.registerNonFastLayer=function(e){e.getNonFastScrollableRects().length,f[e.getID()]=e},a.unregisterNonFastLayer=function(e){delete f[e]},a.release=function(){v(),n&&n.parentNode&&(n.parentNode.removeChild(n),n=null)},a.getPageScaleFactorLimits=function(){return p},a.applyCommit=function(e){!e.full_tree||e.mutations,e.full_tree&&o&&(v(),t.setInvalidateProjections()),void 0!==e.device_scale_factor&&(g=e.device_scale_factor,o&&t.hardInvalidateTiles()),void 0!==e.page_scale_factor&&function(e){p.current=e.page_scale_factor,p.min=e.min_page_scale_factor,p.max=e.max_page_scale_factor,l.isDebugEnabled()&&n.setAttribute("psf",JSON.stringify(p)),l.callback.fire("did-surrogate-change-page-scale")}(e),void 0!==e.display_list_tile_size&&(i=e.display_list_tile_size),e.mutations&&(e.mutations.length,y(e.mutations)),e.full_tree},a.getMaxDeviceScaleFactor=function(){return g},a.asDict=function(){var e={ids:[]};return Util.forEachItem(c,(function(t,r){e.ids.push(t)})),e},a.getDisplayListTileSize=function(){return Object.freeze(i)},a.getRoot=function(){return o},a.setRoot=function(e){(o=e).setTree(a),n.childNodes.length,n.appendChild(e.getContainer())},a.hitTest=function(e,t){return o?o.hitTest(e,t):null},a.hitTestLayer=function(e,t){return o?o.hitTestSubtree(e,t):null},a.freeTiles=function(e){o&&o.walkDepthFirstIterative((function(t){t.freeTiles(e)}))},a.getDiv=function(){return n},(n=document.createElement("div")).id=r,n.style.position="absolute",n.style.top="0px",n.style.left="0px",l.isDebugEnabled()&&n.setAttribute("frame_sink_id",t.getFrameSinkId())},Compositor.LayerTreeHost=function(e,t,r){"use strict";var n,o,i,a,s,l,c,u,d,f=this,p=r,g=p===t.getMainFrameSinkId(),m=new Logger("lth",{level:"info",header:function(){return{fs_id:p}}}),k=[],h=!1,S={},y={},v={},b={},C={},_={},T={},w=null,R=0,x={},D={},M=[],F=10;function E(){return f.getLayerTree()?f.getLayerTree().getRoot():null}function I(e){var r=f.getPropertyTrees().getTransformTree();return f.isMainFrame()?r.hasPath(e.getTransformTreeIndex(),t.getInnerViewportScrollLayer().getTransformTreeIndex()):t.isLthTreeReady(e.getLayerTreeHost())}function P(e,t){var r,n=e.layer_updates;for(r=0;r<n.length;r+=1)t(n[r].id,n[r])}function L(e){var t,r,n,o=[];for(e.surrogate_layer_ids&&(r=e.surrogate_layer_ids,n=[],E().walkDepthFirstIterative((function(e){n.push(e.getID())})),JSON.stringify(n)!==JSON.stringify(r)&&m.error({local_ids:n,surrogate_ids:r})),E().walkDepthFirstIterative((function(e){e.isRoot()||o.push(e)})),t=0;t<o.length-1;t+=1)o[t].getSiblingRank(),o[t+1].getSiblingRank(),o[t].paintsBefore(o[t+1])}function O(e){var r=e.commit;t.getStats().inc("commit_activation_count"),Util.isDictEmpty(r),r.reset_cache&&(E()&&E().walkDepthFirstIterative((function(e){var t=e.getDisplayList();t&&t.freeAllTiles()})),i.flush(),e.old_asset_cache&&(e.old_asset_cache.release(),e.old_asset_cache=null),e.asset_cache&&e.asset_cache.getContainer()&&document.body.insertBefore(e.asset_cache.getContainer(),document.body.firstChild)),r.special_ids&&(c=r.special_ids.root_layer_id,r.is_main_frame&&t.setSpecialIds(r.special_ids)),f.getLayerTree().applyCommit(r),f.getPropertyTrees().applyCommit(r),function(e){P(e.commit,(function(t,r){var n=f.layer_tree.getLayer(t);n?(n.isPictureLayer()&&(r.loaded_tile_updates=e.tile_updates_by_layer_id[t]),n.updateProperties(r)):m.error({event:"tc-prop-for-unknown-layer",lid:t})}))}(e),function(e){P(e,(function(e,t){var r=f.layer_tree.getLayer(e);r?r.updateElementIdRegistration():m.error({event:"tc-prop-for-unknown-layer",lid:e})}))}(r),f.getPropertyTrees().flushCaches(),function(e,t){P(e,(function(e,r){var n=f.layer_tree.getLayer(e);n?n.applyProperties(t):m.error({event:"tc-prop-for-unknown-layer",lid:e})}))}(r,!!r.special_ids),function(e){y[Compositor.EventType.kWheel]===e.wheel_event_listener&&v[Compositor.EventType.kWheel]===e.blocking_wheel_event_listener||(y[Compositor.EventType.kWheel]=e.wheel_event_listener,v[Compositor.EventType.kWheel]=e.blocking_wheel_event_listener,t.callback.fire("wheel-event-listener-changed")),y[Compositor.EventType.kTouch]===e.touch_event_listener&&v[Compositor.EventType.kTouch]===e.blocking_touch_event_listener||(y[Compositor.EventType.kTouch]=e.touch_event_listener,v[Compositor.EventType.kTouch]=e.blocking_touch_event_listener,t.callback.fire("touch-event-listener-changed"))}(r),f.getPropertyTrees().notifyObservers(),function(e){Util.isDictEmpty(e.texture_update_by_layer_id)||P(e.commit,(function(t,r){var n=f.layer_tree.getLayer(t);n&&e.texture_update_by_layer_id.hasOwnProperty(t)&&n.updateTexture(e.texture_update_by_layer_id[t])}))}(e),function(e){Util.isDictEmpty(e.surface_update_by_layer_id)||P(e.commit,(function(t,r){var n=f.layer_tree.getLayer(t);n&&e.surface_update_by_layer_id.hasOwnProperty(t)&&n.updateOSCSurface(e.surface_update_by_layer_id[t])}))}(e),t.isDebugEnabled()&&L(r),f.getLayerTree().updateScrollbarGeometries(),t.callback.fire("did-activate-tree")}function A(){E()&&(f.isMainFrame()||t.isLthTreeReady(f))&&(Util.isDictEmpty(D)&&!f.arePropertyTreesDirty()||(E().walkDepthFirstIterative((function(e){var r,n=f.getPropertyTrees().getTransformTree(),o=f.getPropertyTrees().getClipTree(),i=f.getPropertyTrees().getEffectTree();e&&e.isLive()&&I(e)&&(D.projs?b[e.getID()]=!0:n.isDirty()&&(r=n.getNode(e.getTransformTreeIndex()),n.hasDirtyAncestor(r.getId())&&(b[e.getID()]=!0)),(D.clips||n.isDirty()||o.isDirty())&&(C[e.getID()]=!0),(D.effects||i.isDirty())&&(_[e.getID()]=!0),e.isSurfaceForChildFrame()&&function(e){t.isLthAlive(e.getSurfaceFrameSinkId())&&(b[e.getID()]&&t.invalidateLthProjections(e.getSurfaceFrameSinkId()),C[e.getID()]&&t.invalidateLthClips(e.getSurfaceFrameSinkId()),_[e.getID()]&&t.invalidateLthEffects(e.getSurfaceFrameSinkId()))}(e))})),D={}))}function B(r,n,o){return new Sk.SafeviewRecording(n,o,r.asset_cache,i,e.url_builder.buildImageURLFromU8Array,t.getImageLoader(),t.getFlags()&Compositor.Options.kSyncImageLoad)}function H(e){e.state,Compositor.CommitState.kLoadNotStarted,e.state=Compositor.CommitState.kLoadStarted,function(e,t){var r=0,n=0,o=!1;function i(){t()}function a(){n+=1,o&&r===n&&i()}e.tile_updates_by_layer_id={},e.texture_update_by_layer_id={},e.surface_update_by_layer_id={},P(e.commit,(function(t,n){var o,i;if(n.layer_type===Compositor.LayerType.PictureLayer&&n.tile_updates)for(e.tile_updates_by_layer_id[t]=[],o=0;o<n.tile_updates.length;o+=1)r+=1,i=n.tile_updates[o],e.tile_updates_by_layer_id[t].push({index_x:i.index_x,index_y:i.index_y,invalidation_region:i.invalidation_region,solid_color:i.solid_color,skr:B(e,i.skr_u8a,a)});else n.layer_type===Compositor.LayerType.TextureLayer&&n.skr_u8a?(r+=1,e.texture_update_by_layer_id[t]=B(e,n.skr_u8a,a)):n.layer_type===Compositor.LayerType.SurfaceLayer&&n.skr_u8a&&(r+=1,e.surface_update_by_layer_id[t]=B(e,n.skr_u8a,a))})),o=!0,r===n&&i()}(e,(function(){e.state=Compositor.CommitState.kLoadComplete,t.setNeedsDrawFrame(Compositor.DrawFrameReason.kRecordingsLoaded)}))}function N(e){e&&t.getTimeFromLastInput()<1e3?n=setTimeout((function(){N(e)}),F):(n=null,Util.forEachItem(S,(function(e,r){r&&!Sk.Rect.isEmpty(r)&&t.sendRepaintRequest(e,r)})),S={},F=10)}f.getFid=function(){return R},f.getFrameSinkId=function(){return p},f.isMainFrame=function(){return g},f.setInvalidateProjections=function(){D.projs=!0},f.setInvalidateClips=function(){D.clips=!0},f.setInvalidateEffects=function(){D.effects=!0},f.getDisplay=function(){return t},f.getScrollDelegate=function(){return s},f.getScrollbarController=function(){return l},f.registerChildLth=function(e){var r=e.getSurfaceFrameSinkId();x[r]=e.getID(),t.registerSurface(p,M,e)},f.unregisterChildLth=function(e){t.unregisterSurface(e),delete x[e]},f.forEachChildLth=function(e){Util.forEachItem(x,e)},f.hasChildLth=function(){return!Util.isDictEmpty(x)},f.updatePaintRanks=function(e,t,r){var n,o=e.length;if(M.length!==o+1||r)for(M.length=o+1,n=0;n<o;n+=1)M[n]=e[n];M[o]=t},f.getPaintRanks=function(){return M},f.paintsBefore=function(e,t,r){var n,o=e.getPaintRanks();for(n=0;n<M.length&&n<o.length&&M[n]===o[n];n+=1);return n>=M.length&&n>=o.length?t.paintsBefore(r):n>=M.length?t.getSiblingRank()<=o[n]:n>=o.length?M[n]<r.getSiblingRank():M[n]<=o[n]},f.registerParentLth=function(e,r,n){u!==e&&(u=e,t.setNeedsDrawFrame(Compositor.DrawFrameReason.kParentLayerTreeHostChanged)),f.updatePaintRanks(r,n,!1)},f.unregisterParentLth=function(){u=null,M=[]},f.getParentLthFrameSinkId=function(){return u},f.getSurfaceLayerForChildLth=function(e){var t=x[e];return t?f.getLayerTree().getLayer(t):null},f.getPendingCommitCount=function(){return k.length},f.getRootLayerId=function(){return c},f.arePropertyTreesDirty=function(){return f.getPropertyTrees().getTransformTree().isDirty()||f.getPropertyTrees().getClipTree().isDirty()||f.getPropertyTrees().getEffectTree().isDirty()},f.setLayerProjectionChanged=function(e){b[e]=!0,t.setNeedsDrawFrame(Compositor.DrawFrameReason.kLayerProjectionChanged)},f.setLayerEffectChanged=function(e){_[e]=!0,t.setNeedsDrawFrame(Compositor.DrawFrameReason.kLayerEffectChanged)},f.setVideoSizeChanged=function(){t.setNeedsDrawFrame(Compositor.DrawFrameReason.kVideoSizeChanged)},f.setLayerTilesBecameDirty=function(e){T[e]=!0,t.setNeedsDrawFrame(Compositor.DrawFrameReason.kTilesBecameDirty)},f.invalidateTilesForNewlyExposedRegions=function(){Util.forEachItem(b,(function(e,t){var r=f.layer_tree.getLayer(e);r&&r.isLive()&&r.updateLocalDrawRect()}))},f.gatherDirtyTiles=function(){var e=[];return Util.forEachItem(T,(function(r){var n,o=f.layer_tree.getLayer(r);o&&(!o.hasVideoContent()||o.isDrawable(),n=o.getTilingSet(),o.isLive()&&o.willDraw()&&n&&I(o)&&n.forEachTileInRect(o.getLocalDrawRect(),(function(r,i,a){var s={tile_rect:n.getTileRectByIndices(i,a),layer:o};n.isRectDirty(s.tile_rect)&&(s.screen_rect=o.toScreenSpaceRect(s.tile_rect),Sk.Rect.isValid(s.screen_rect)&&!Sk.Rect.isEmpty(s.screen_rect)&&Sk.Rect.intersects(t.getDrawRect(),s.screen_rect)&&e.push(s))})))})),T={},e},f.activateReadyTrees=function(){for(var e;k.length&&(e=k[0]).state===Compositor.CommitState.kLoadComplete;)k.shift(),O(e)},f.isInAnimationFrame=function(){return t.isInAnimationFrame()},f.updateProjections=function(){Util.forEachItem(b,(function(e,t){var r=f.layer_tree.getLayer(e);r&&r.isLive()&&I(r)&&r.updateProjection()}))},f.updateClips=function(){Util.forEachItem(C,(function(e,t){var r=f.layer_tree.getLayer(e);r&&r.isLive()&&r.updateClip()}))},f.updateEffects=function(){Util.forEachItem(_,(function(e,t){var r=f.layer_tree.getLayer(e);r&&r.isLive()&&r.updateOpacity()}))},f.updateDebugRects=function(){t.getDebugRectsEnabled()&&E()&&E().walkDepthFirstIterative((function(e){e.updateDebugRects("non-fast scrollable",e.getNonFastScrollableRects(),"blue","black"),e.updateDebugRects("touch-region",e.getTouchActionRects(),"yellow","black")}))},f.invalidateLayerProjectionsAndClips=function(){f.getPropertyTrees().getTransformTree().updateStickyState(),A()},f.setNeedsRepaint=function(e,t,r){var o=S[e];o||(o=Sk.Rect.makeEmpty()),Sk.Rect.join(o,t),S[e]=o,r&&10===F&&(F=1e3,n&&(clearTimeout(n),n=null)),n||(n=setTimeout((function(){N(r)}),F))},f.toggleVideoMode=function(){E().walkDepthFirstIterative((function(e){e.hasVideoContent()&&e.getVideoDelegate().requestDisplay()}))},f.hardInvalidateTiles=function(){E()&&E().walkDepthFirstIterative((function(e){var t=e.getTilingSet();t&&t.hardInvalidateTilesInRect(e.getBoundsRect())}))},f.hitTest=function(e,t){return Compositor.Offset.isValid(t),f.layer_tree,f.layer_tree.hitTest(e,t)},f.hitTestLayerTree=function(e,t){return Compositor.Offset.isValid(e),f.layer_tree,f.layer_tree.hitTestLayer(e,t)},f.getLayerTree=function(){return f.layer_tree},f.getPropertyTrees=function(){return a},f.hasEventListener=function(e){return e===Compositor.EventType.kWheel||Compositor.EventType.kTouch,y[e]},f.hasBlockingEventListener=function(e){return e===Compositor.EventType.kWheel||Compositor.EventType.kTouch,v[e]},f.getDeviceScaleFactor=function(){return f.getLayerTree()?Math.min(t.getDeviceScaleFactor(),f.getLayerTree().getMaxDeviceScaleFactor()):1},f.getPageScaleFactor=function(){return f.getPropertyTrees().getTransformTree().getPageScaleFactor()},f.setActiveTreePageScaleFactor=function(e){var r=t.getPageScaleTransformNode(),n=f.getPropertyTrees().getTransformTree();r&&n.getPageScaleFactor()!==e&&(n.setPageScaleFactor(e),r.resetPageScale(e),f.scheduleScrollAndScaleFlush())},f.getActiveVideoNode=function(){var e,t,r=null,n=[];if(!E())return null;for(E().walkDepthFirstIterative((function(e){e.hasVideoContent()&&n.push(e)})),n.sort((function(e,t){return e.isOccludedBy(t)?1:-1})),e=0;e<n.length&&!((t=n[e].getVideoDelegate())&&(r=t.getVideoNode())&&r.videoWidth>0&&r.videoHeight>0);e+=1);return r},f.scheduleScrollAndScaleFlush=function(){w||(w=setTimeout((function(){var e,r,n,o;r=Compositor.MessageFlags.kScrollAndScaleUpdate,n=new Sk.BinaryWriter(28),o=0,n.writeUint32(r),e=n.getOffset(),n.writeUint32(0),f.getPropertyTrees().getScrollTree().forEachPendingDelta((function(e,t){n.writeUint32(e),n.writeInt32(t.x),n.writeInt32(t.y),o+=1})),n.getView().setUint32(e,o,n.isLE()),n.writeFloat32(MetricsUtils.getVisualViewportScale()),t.sendCompositorMessage(R,n.getData()),w=null}),16))},f.setContentBounds=function(e){var t=f.layer_tree.getDiv().style;t.width=e.width+"px",t.height=e.height+"px",t.overflow="hidden"},f.onCompositorMessage=function(e){var r,n=o;if(!h&&!Util.isDictEmpty(e)){if(!e.full_tree)return!0;h=!0}return R!==e.fid&&(R=e.fid,t.isDebugEnabled()&&f.getDiv().setAttribute("fid",R),t.updateFrameSink(R,p)),o&&!e.reset_cache||(d=new Compositor.TypefaceDelegate(f),o=new Sk.Deduper.Cache(d,R)),r={state:Compositor.CommitState.kLoadNotStarted,commit:e,old_asset_cache:n,asset_cache:o,reset_cache:e.reset_cache},k.push(r),H(r),!0},f.getDiv=function(){return f.layer_tree.getDiv()},f.clearDirtyLayers=function(){b={},C={},_={}},f.flushRasterCache=function(){i.flush()},f.getTypefaceDelegate=function(){return d},f.release=function(){f.layer_tree&&(f.layer_tree.release(),f.layer_tree=null),s&&(s.release(),s=null),l&&(l=null),a=null,o&&(o.release(),o=null),w&&(clearTimeout(w),w=null),n&&(clearTimeout(n),n=null),i&&(i.flush(),i=null),d&&(d.release(),d=null),k=null,x=null,D={},M=null},s=new Compositor.ScrollDelegate(e,f),l=new Compositor.ScrollbarController(f),a=new Compositor.PropertyTrees(f),f.layer_tree=new Compositor.LayerTree(e,f,"sv-content"),i=new Sk.RasterCacheClass},Compositor.TransformNode=function(e,t){"use strict";var r,n,o,i,a,s,l,c=this,u=Compositor.Offset.makeZero(),d=!1,f=!1,p={},g={};function m(){var r,a,s=i.x+o.x,l=i.y+o.y,d=o.z;return c.isScrollable()&&(s-=u.x,l-=u.y),c.isStickyPositioned()&&(s+=(r=e.stickyPositionOffset(t)).x,l+=r.y),a=mat4.fromTranslation(mat4.create(),vec3.fromValues(s,l,d)),mat4.multiply(a,a,n),mat4.translate(a,a,vec3.fromValues(-o.x,-o.y,-o.z)),a}c.getCachedTransformByDstId=function(e){return p[e]},c.setCachedTransformByDstId=function(e,t){p[e]=t},c.getCachedHasPathToDstId=function(e){return g[e]},c.setCachedHasPathToDstId=function(e,t){g[e]=t},c.clearCache=function(){p={},g={}},c.getToParentTransform=function(){return c.isStickyPositioned()?m():(l||(l=m()),l)},c.getId=function(){return t},c.getParentId=function(){return r<0?-1:r},c.getStickyPositionData=function(){return s},c.isStickyPositioned=function(){return!!(a&Compositor.TransformNodeFlags.kSticky)},c.stickyScrollAncestor=function(){return c.isStickyPositioned()?s.scroll_ancestor:-1},c.atStickyPosition=function(){return d},c.enterStickyPosition=function(){c.setDirty(),d=!0},c.leaveStickyPosition=function(){c.setDirty(),d=!1},c.movedByOuterViewportBoundsDeltaY=function(){return!!(a&Compositor.TransformNodeFlags.kMovedByOuterViewportBoundsDeltaY)},c.isScrollable=function(){return!!(a&Compositor.TransformNodeFlags.kScrolls)},c.flattensInheritedTransform=function(){return!!(a&Compositor.TransformNodeFlags.kFlattensInheritedTransform)},c.delegatesToParentForBackface=function(){return!!(a&Compositor.TransformNodeFlags.kDelegatesToParentForBackface)},c.setDirty=function(){f=!0,l=null,e.setDirty()},c.clearDirty=function(){f=!1},c.setScrollOffset=function(e){return!Compositor.Offset.isEqual(u,e)&&(u=e,c.setDirty(),!0)},c.resetPageScale=function(e){var t=[];return mat4.getScaling(t,n),(t[0]!==e||t[1]!==e||1!==t[2])&&(n=mat4.fromScaling(mat4.create(),vec3.fromValues(e,e,1)),c.setDirty(),!0)},c.getScrollOffset=function(){return Compositor.Offset.makeCopy(u)},c.update=function(e){function t(t){return e.dirty_flags,e.dirty_flags&t}t(Compositor.TransformNodeDirtyFlags.kParentId)&&(r=e.parent_id),t(Compositor.TransformNodeDirtyFlags.kTransform)&&(n=e.local),t(Compositor.TransformNodeDirtyFlags.kOrigin)&&(o=e.origin),t(Compositor.TransformNodeDirtyFlags.kPostTranslation)&&(i=e.post_translation),t(Compositor.TransformNodeDirtyFlags.kFlags)&&(a=e.flags),t(Compositor.TransformNodeDirtyFlags.kStickyPosData)&&(s=e.sticky_position_data),c.setDirty()},c.asDict=function(){return{origin:o,post_translation:i,local:n,scroll_off:u,flags:a,parent_id:r,id:t,cached_transform_by_dst_id:p,cached_has_path_to_dst_id:g}},c.isDirty=function(){return f}},Compositor.TransformTree=function(e){"use strict";var t,r=this,n=[],o=!1;function i(e,t){var n,o=r.getNode(e.getParentId());return e===t?{has_path:!0}:o?((n=o.getCachedHasPathToDstId(t.getId()))||(n=i(o,t)),e.setCachedHasPathToDstId(t.getId(),n),n):{has_path:!1}}function a(e,t){var n,o=r.getNode(e.getParentId()),i=mat4.create();return e!==t&&o?((n=o.getCachedTransformByDstId(t.getId()))||(n=a(o,t)),e.flattensInheritedTransform()&&Compositor.Matrix3D.flattenTo2d(n),i=mat4.multiply(i,n,e.getToParentTransform()),e.setCachedTransformByDstId(t.getId(),i),i):mat4.create()}function s(e){var t=r.getNode(e);return t?t.getStickyPositionData():null}r.setPageScaleFactor=function(e){t=e},r.getPageScaleFactor=function(){return t},r.applyCommit=function(e){var t=!1,o=n.length-e.transform_tree_node_count;o>0&&(n.splice(e.transform_tree_node_count,o),n.length,e.transform_tree_node_count,t=!0),e.transform_tree_mutations.forEach((function(e){var o=n[e.id];o||(o=new Compositor.TransformNode(r,e.id),n[e.id]=o),o.update(e),t=!0})),t&&r.setDirty(),n.length,e.transform_tree_node_count},r.getNode=function(e){return e<0?null:n[e]},r.getRootNode=function(){return r.getNode(0)},r.getSize=function(){return n.length},r.asDict=function(){var e,t=[];for(e=0;e<n.length;e+=1)t.push(n[e].asDict());return t},r.hasPath=function(e,t){var n=i(r.getNode(e),r.getNode(t));return n.has_path,n.has_path},r.clearTransformCache=function(){n.forEach((function(e){e.clearCache()}))},r.combineTransforms=function(e,t){return a(r.getNode(e),r.getNode(t))},r.shouldForceFixedPosition=function(e,t,n){for(var o=r.getNode(e);o&&o.getId()!==t;){if(o.isStickyPositioned()&&o.atStickyPosition())return o.stickyScrollAncestor()===n;o=r.getNode(o.getParentId())}return!1},r.movedByOuterViewportBoundsDeltaY=function(e){for(var t=r.getNode(e);t;){if(t.movedByOuterViewportBoundsDeltaY())return!0;t=r.getNode(t.getParentId())}return!1},r.setDirty=function(){o=!0},r.isDirty=function(){return o},r.hasDirtyAncestor=function(e){for(var t=r.getNode(e);t;){if(t.isDirty())return!0;t=r.getNode(t.getParentId())}return!1},r.clearDirty=function(){o=!1,n.forEach((function(e){e.clearDirty()}))},r.notifyObservers=function(){},r.stickyPositionOffset=function(t){var n,o,i,a,l,c,u,d,f,p,g,m,k=r.getNode(t),h=Compositor.Offset.makeZero(),S=s(t);return k&&S?(o=e.getPropertyTrees().getScrollTree().getNode(S.scroll_ancestor),(i=r.getNode(o.getTransformId()))?(n=Sk.Rect.makeCopy(S.constraint_box_rect),Sk.Rect.makeOffset(n,i.getScrollOffset().x,i.getScrollOffset().y),(d=s(S.nearest_node_shifting_sticky_box))&&(a=d.total_sticky_box_sticky_offset),a=a||Compositor.Offset.makeZero(),(f=s(S.nearest_node_shifting_containing_block))&&(l=f.total_containing_block_sticky_offset),l=l||Compositor.Offset.makeZero(),c=Sk.Rect.makeCopy(S.scroll_container_relative_sticky_box_rect),Sk.Rect.makeOffset(c,a.x+l.x,a.y+l.y),u=Sk.Rect.makeCopy(S.scroll_container_relative_containing_block_rect),Sk.Rect.makeOffset(u,l.x,l.y),void 0!==S.right_offset&&(p=Sk.Rect.getRight(n)-S.right_offset,(g=Math.min(0,p-Sk.Rect.getRight(c)))<(m=Math.min(0,Sk.Rect.getX(u)-Sk.Rect.getX(c)))&&(g=m),h.x+=g),void 0!==S.left_offset&&(p=Sk.Rect.getX(n)+S.left_offset,(g=Math.max(0,p-Sk.Rect.getX(c)))>(m=Math.max(0,Sk.Rect.getRight(u)-Sk.Rect.getRight(c)))&&(g=m),h.x+=g),void 0!==S.bottom_offset&&(p=Sk.Rect.getBottom(n)-S.bottom_offset,(g=Math.min(0,p-Sk.Rect.getBottom(c)))<(m=Math.min(0,Sk.Rect.getY(u)-Sk.Rect.getY(c)))&&(g=m),h.y+=g),void 0!==S.top_offset&&(p=Sk.Rect.getY(n)+S.top_offset,(g=Math.max(0,p-Sk.Rect.getY(c)))>(m=Math.max(0,Sk.Rect.getBottom(u)-Sk.Rect.getBottom(c)))&&(g=m),h.y+=g),S.total_sticky_box_sticky_offset={x:a.x+h.x,y:a.y+h.y},S.total_containing_block_sticky_offset={x:a.x+l.x+h.x,y:a.y+l.y+h.y},h):h):h},r.updateStickyState=function(){n.forEach((function(e){if(e.isStickyPositioned()){var t=r.stickyPositionOffset(e.getId());Compositor.Offset.isZero(t)?e.leaveStickyPosition():e.enterStickyPosition()}else e.leaveStickyPosition()}))}},Compositor.ScrollNode=function(e,t){"use strict";var r,n,o,i,a,s,l,c=this,u=e.getDisplay();function d(e){return!!(n&e)}c.getId=function(){return t},c.getParentId=function(){return r<0?-1:r},c.getElementId=function(){return i},c.getTransformId=function(){return o},c.isRootNode=function(){return 0===t},c.isSecondaryRootNode=function(){return 1===t},c.isScrollable=function(){return d(Compositor.ScrollNodeFlags.kScrollable)},c.isUserScrollableHorizontal=function(){return d(Compositor.ScrollNodeFlags.kUserScrollableHorizontal)},c.isUserScrollableVertical=function(){return d(Compositor.ScrollNodeFlags.kUserScrollableVertical)},c.isUserScrollable=function(){return c.isScrollable()&&(c.isUserScrollableHorizontal()||c.isUserScrollableVertical())},c.scrollsOuterViewport=function(){return d(Compositor.ScrollNodeFlags.kScrollsOuterViewport)},c.scrollsInnerViewport=function(){return d(Compositor.ScrollNodeFlags.kScrollsInnerViewport)},c.hasMainThreadScrolling=function(){return d(Compositor.ScrollNodeFlags.kMainThreadScrolling)},c.preventViewportScrollingFromInner=function(){return d(Compositor.ScrollNodeFlags.kPreventViewportScrollingFromInner)},c.getContainerBounds=function(){return a},c.getContentBounds=function(){return s},c.getOverscrollBehavior=function(){return l},c.maxScrollOffset=function(){var t,r,n,o=c.getContentBounds(),i=1;return!c.isScrollable()||Compositor.Bounds.isEmpty(o)?Compositor.Offset.makeZero():(d(Compositor.ScrollNodeFlags.kMaxScrollOffsetAffectedByPageScale)&&(i=e.getPageScaleFactor()),t=Compositor.Bounds.scale(o,i),r=c.getContainerBounds(),n=Compositor.Offset.makeXY(t.width-r.width,t.height-r.height),Compositor.Offset.scale(n,1/i),Compositor.Offset.setToMax(n,Compositor.Offset.makeZero()))},c.clampScrollOffsetToLimits=function(e){return Compositor.Offset.setToMin(e,c.maxScrollOffset()),Compositor.Offset.roundDown(Compositor.Offset.setToMax(e,Compositor.Offset.makeZero()))},c.asDict=function(){return{id:t,parent_id:r,transform_id:o,element_id:i,flags:n,container_bounds:a,content_bounds:s,overscroll_behavior:l}},c.update=function(c){function d(e){return c.dirty_flags,c.dirty_flags&e}d(Compositor.ScrollNodeDirtyFlags.kParentId)&&(r=c.parent_id),d(Compositor.ScrollNodeDirtyFlags.kTransformId)&&(o=c.transform_id),d(Compositor.ScrollNodeDirtyFlags.kElementId)&&(i=c.element_id),d(Compositor.ScrollNodeDirtyFlags.kContainerBounds)&&(a=c.container_bounds),d(Compositor.ScrollNodeDirtyFlags.kBounds)&&(s=c.bounds,u.isOuterViewportScrollNode(e,t)&&e.setContentBounds(s)),d(Compositor.ScrollNodeDirtyFlags.kOverscrollBehavior)&&(l=c.overscroll_behavior),d(Compositor.ScrollNodeDirtyFlags.kFlags)&&(n=c.flags)}},Compositor.SyncedScroll=function(e){"use strict";var t=this,r=Compositor.Offset.makeZero(),n=Compositor.Offset.makeZero();t.applyMainThreadDelta=function(e){return!Compositor.Offset.isZero(e)&&(r=Compositor.Offset.add(r,e),!0)},t.setActiveTreeScrollOffset=function(e){return!Compositor.Offset.isEqual(r,e)&&(n=Compositor.Offset.add(n,Compositor.Offset.subtract(e,r)),r=e,!0)},t.hasLocalDelta=function(){return!Compositor.Offset.isZero(n)},t.getScrollOffset=function(){return Compositor.Offset.makeCopy(r)},t.drainScrollDelta=function(){var e=Compositor.Offset.makeCopy(n);return n=Compositor.Offset.makeZero(),e},t.asDict=function(){return{scroll_offset:r}}},Compositor.ScrollTree=function(e){"use strict";var t=this,r=e.getDisplay(),n=e.getScrollDelegate(),o=[],i={},a={},s=1,l={},c={};function u(e){var t=l[e];return t||(t=new Compositor.SyncedScroll(e),l[e]=t),t}function d(){Util.forEachItem(c,(function(e,t){u(e).applyMainThreadDelta(t)&&n.didUpdateScrollOffset(e,Compositor.ScrollOrigin.kOriginSurrogate)})),c={}}t.forEachPendingDelta=function(e){Util.forEachItem(l,(function(t,r){r.hasLocalDelta()&&e(Number(t),r.drainScrollDelta())}))},t.setScrollOffset=function(r,o,i){var a=t.findNodeFromElementId(r).clampScrollOffsetToLimits(Compositor.Offset.makeCopy(o));return!!u(r).setActiveTreeScrollOffset(a)&&(n.didUpdateScrollOffset(r,i),e.scheduleScrollAndScaleFlush(),!0)},t.setScrollOffsetX=function(e,r,n){var o=Compositor.Offset.makeCopy(t.getScrollOffset(e));return o.x=r,t.setScrollOffset(e,o,n)},t.setScrollOffsetY=function(e,r,n){var o=Compositor.Offset.makeCopy(t.getScrollOffset(e));return o.y=r,t.setScrollOffset(e,o,n)},t.getScrollOffset=function(e){return u(e).getScrollOffset()},t.calcProjectedScrollOffset=function(e,r){var n,o,i=Compositor.Offset.makeCopy(r);return e.isUserScrollableHorizontal()||(i.x=0),e.isUserScrollableVertical()||(i.y=0),n=t.getScrollOffset(e.getElementId()),o=Compositor.Offset.add(n,i),e.clampScrollOffsetToLimits(Compositor.Offset.makeCopy(o))},t.scrollBy=function(e,r){var n=t.calcProjectedScrollOffset(e,r);return t.setScrollOffset(e.getElementId(),n,Compositor.ScrollOrigin.kOriginProgrammatic)},t.collectMainThreadDeltas=function(e){e.main_thread_deltas.forEach((function(e){c.hasOwnProperty(e.element_id)?c[e.element_id]=Compositor.Offset.add(c[e.element_id],e.delta):(e.element_id,c[e.element_id]=e.delta)})),r.callback.registerOneShot("did-activate-tree",0,{on_success:d})},t.asDict=function(){var e=[];return o.forEach((function(t){e.push(t.asDict())})),e},t.getSize=function(){return o.length},t.applyCommit=function(t){var r=o.length-t.scroll_tree_node_count;r>0&&(o.splice(t.scroll_tree_node_count,r),o.length,t.scroll_tree_node_count),t.scroll_tree_mutations.forEach((function(t){t.id,t.id;var r=o[t.id];r||(r=new Compositor.ScrollNode(e,t.id),o[t.id]=r),r.getId(),t.id,r.update(t)})),i={},o.forEach((function(e){e.getElementId()&&(i[e.getElementId()],i[e.getElementId()]=e)})),Util.forEachItem(l,(function(e){i[e]||(delete l[e],delete c[e])}))},t.getNode=function(e){return e<0?null:o[e]},t.findNodeFromElementId=function(e){return i[e]},t.forEachElementId=function(e){Util.forEachItem(i,e)},t.hasPath=function(e,t){for(var r=o[e];r;){if(r.getId()===t)return!0;r=o[r.getParentId()]}return!1},t.registerObserver=function(e,r){a.hasOwnProperty(e)||(a[e]={});var n=s;return s+=1,a[e][n]=r,{index:e,tree:t,id:n}},t.deregisterObserver=function(e){void 0!==e.index&&e.id,delete a[e.index][e.id]},t.notifyObservers=function(){var e=argumentsToArray(arguments);Util.forEachItem(a,(function(t){Util.forEachItem(a[t],(function(t,r){r.apply(this,e.slice(1))}))}))}},Compositor.ClipNode=function(e,t){"use strict";var r,n,o,i=this,a={};i.setCachedRectByKey=function(e,t){a[e]=Object.freeze(t)},i.getCachedRectByKey=function(e){return a[e]},i.clearCachedRects=function(){a={}},i.getId=function(){return t},i.getParentId=function(){return r<0?-1:r},i.getTransformId=function(){return n},i.getClipRect=function(){return o},i.setClipRect=function(t){o&&Sk.Rect.isEqual(o,t)||(o=Sk.Rect.makeCopy(t),e.setDirty())},i.asDict=function(){return{id:t,parent_id:r,transform_id:n,clip_rect:o}},i.update=function(t){function i(e){return t.dirty_flags,t.dirty_flags&e}i(Compositor.ClipNodeDirtyFlags.kParentId)&&(r=t.parent_id),i(Compositor.ClipNodeDirtyFlags.kTransformId)&&(n=t.transform_id),i(Compositor.ClipNodeDirtyFlags.kClipRect)&&(o=t.clip_rect),e.setDirty()}},Compositor.ClipTree=function(e){"use strict";var t=this,r=[],n=!1;function o(r,n,i){var a,s,l,c,u,d,f=t.getNode(r.getParentId());return r!==n&&f?(l=function(e,t){return e+":"+t}(n.getId(),i),(s=f.getCachedRectByKey(l))||(s=o(f,n,i)),a=Sk.Rect.intersection((c=r,u=i,d=e.getPropertyTrees().getTransformTree().combineTransforms(c.getTransformId(),u),Compositor.Matrix3D.mapRect(d,c.getClipRect())),s),r.setCachedRectByKey(l,a),a):Sk.Rect.makeLargest()}t.applyCommit=function(e){var n=!1,o=r.length-e.clip_tree_node_count;o>0&&(r.splice(e.clip_tree_node_count,o),r.length,e.clip_tree_node_count,n=!0),e.clip_tree_mutations.forEach((function(e){var o=r[e.id];o||(o=new Compositor.ClipNode(t,e.id),r[e.id]=o),o.update(e),o.getId(),e.id,n=!0})),n&&t.setDirty(),r.length,e.clip_tree_node_count},t.getNode=function(e){return e<0?null:r[e]},t.getSize=function(){return r.length},t.setDirty=function(){n=!0},t.clearDirty=function(){n=!1},t.isDirty=function(){return n},t.clearClipCache=function(){r.forEach((function(e){e.clearCachedRects()}))},t.combineClips=function(e,r,n){return o(t.getNode(e),t.getNode(r),n)},t.notifyObservers=function(){},t.asDict=function(){var e=[];return r.forEach((function(t){e.push(t.asDict())})),e}},Compositor.BlendMode=Object.freeze({kClear:0,kSrc:1,kDst:2,kSrcOver:3,kDstOver:4,kSrcIn:5,kDstIn:6}),Compositor.EffectNode=function(e,t){"use strict";var r,n,o,i,a,s,l,c=this;function u(e){return!!(l&e)}c.getId=function(){return t},c.getParentId=function(){return r<0?-1:r},c.getTransformId=function(){return i},c.getRenderTargetId=function(){return c.hasRenderSurface()||!s?t:s},c.isContentsRoot=function(){return 1===c.getRenderTargetId()},c.getScreenSpaceOpacity=function(){return n},c.getBlendMode=function(){return o},c.isHiddenByBackfaceVisibility=function(){return u(Compositor.EffectNodeFlags.kHiddenByBackfaceVisibility)},c.isDoubleSided=function(){return u(Compositor.EffectNodeFlags.kDoubleSided)},c.isSubtreeHidden=function(){return u(Compositor.EffectNodeFlags.kSubtreeHidden)},c.hasMaskingChild=function(){return u(Compositor.EffectNodeFlags.kHasMaskingChild)},c.isDrawn=function(){return u(Compositor.EffectNodeFlags.kIsDrawn)},c.hasFastRoundedCorner=function(){return u(Compositor.EffectNodeFlags.kHasFastRoundedCorner)},c.hasRenderSurface=function(){return u(Compositor.EffectNodeFlags.kHasRenderSurface)},c.asDict=function(){return{id:t,parent_id:r,opacity:n,blend_mode:o,flags:l,bv:c.isHiddenByBackfaceVisibility(),double_sided:c.isDoubleSided(),subtree_hidden:c.isSubtreeHidden(),has_masking_child:c.hasMaskingChild(),is_drawn:c.isDrawn(),transform_id:i,clip_id:a,target_id:s,fast_rounded_corner:c.hasFastRoundedCorner(),render_surface:c.hasRenderSurface()}},c.update=function(t){function c(e){return t.dirty_flags,t.dirty_flags&e}c(Compositor.EffectNodeDirtyFlags.kParentId)&&(r=t.parent_id),c(Compositor.EffectNodeDirtyFlags.kScreenSpaceOpacity)&&(n=t.opacity),c(Compositor.EffectNodeDirtyFlags.kBlendMode)&&(o=t.blend_mode),c(Compositor.EffectNodeDirtyFlags.kTransformId)&&(i=t.transform_id),c(Compositor.EffectNodeDirtyFlags.kClipId)&&(a=t.clip_id),c(Compositor.EffectNodeDirtyFlags.kTargetId)&&(s=t.target_id),c(Compositor.EffectNodeDirtyFlags.kFlags)&&(l=t.flags),e.setDirty()}},Compositor.EffectTree=function(e){"use strict";var t=this,r=[],n=!1;t.applyCommit=function(e){var n=e.effect_tree_node_count,o=r.length-n;o>0&&(r.splice(n,o),r.length),e.effect_tree_mutations.forEach((function(e){var n=r[e.id];n||(n=new Compositor.EffectNode(t,e.id),r[e.id]=n),n.update(e),n.getId(),e.id})),r.length},t.getNode=function(e){return e<0?null:r[e]},t.getSize=function(){return r.length},t.asDict=function(){var e=[];return r.forEach((function(t){e.push(t.asDict())})),e},t.setDirty=function(){n=!0},t.clearDirty=function(){n=!1},t.isDirty=function(){return n},t.notifyObservers=function(){}},Compositor.PropertyTrees=function(e){"use strict";var t=this,r=e.getScrollDelegate(),n={x:0,y:0},o={x:0,y:0},i={};function a(){i.transform.isDirty()&&i.transform.clearTransformCache(),(i.transform.isDirty()||i.clip.isDirty())&&i.clip.clearClipCache()}t.getTransformTree=function(){return i.transform},t.getScrollTree=function(){return i.scroll},t.getClipTree=function(){return i.clip},t.getEffectTree=function(){return i.effect},t.getInnerViewportContainerBoundsDelta=function(){return n},t.getOuterViewportContainerBoundsDelta=function(){return o},t.applyCommit=function(e){var t;e.property_trees_mutations&&((t=e.property_trees_mutations).inner_viewport_container_bounds_delta&&(n=t.inner_viewport_container_bounds_delta),t.outer_viewport_container_bounds_delta&&(o=t.outer_viewport_container_bounds_delta)),e.transform_tree_mutations&&i.transform.applyCommit(e),e.scroll_tree_mutations&&i.scroll.applyCommit(e),e.clip_tree_mutations&&i.clip.applyCommit(e),e.effect_tree_mutations&&i.effect.applyCommit(e),e.transform_tree_mutations&&i.scroll.forEachElementId((function(e){r.didUpdateScrollOffset(e,Compositor.ScrollOrigin.kOriginIgnore)})),e.main_thread_deltas&&i.scroll.collectMainThreadDeltas(e)},t.notifyObservers=function(){Util.forEachItem(i,(function(e,t){t.notifyObservers()}))},t.flushCaches=a,t.willDraw=function(){a(),i.transform.clearDirty(),i.clip.clearDirty(),i.effect.clearDirty()},i.transform=new Compositor.TransformTree(e),i.scroll=new Compositor.ScrollTree(e),i.clip=new Compositor.ClipTree(e),i.effect=new Compositor.EffectTree(e)},Compositor.Debug=function(e){"use strict";var t=new Logger("debug-helpers",{level:"info"}),r=e.getMainFrame();function n(){var e=r.getLayerTree();e.getRoot()&&(function(e){var r=[];e.getRoot(),e.walkDepthFirst((function(e){!function(e){for(var t=e;t.getParent();)t=t.getParent()}(e),e.getMaskLayer()&&e.getMaskLayer().getChildren().length,r.push(String(e.id))})),e.withEachLayerDo((function(e,n){-1===r.indexOf(e)&&t.error({event:"unreachable-node",id:e,type:typeof e,reachable_ids:r})})),r.forEach((function(t){e.getLayer(t)}))}(e),function(e){e.walkDepthFirst((function(e){var t,r;e.getChildren().length&&(t=e.getChildrenDiv().childNodes,r=t[0],e.getChildren().forEach((function(t){t.getContainer(),e.id,t.id,t.getContainer().getAttribute("id"),r&&r.getAttribute("id"),r=r.nextSibling})))}))}(e))}e.callback.register("did-activate-tree",n)},Compositor.Matrix3D=function(){"use strict";var e={},t=Compositor.FloatingPoint.isEqual;return e.getScale=function(e){var t=[];return mat4.getScaling(t,e),{x:t[0],y:t[1],z:t[2]}},e.hasPerspective=function(e){return 0!==e[3]||0!==e[7]||0!==e[11]||1!==e[15]},e.projectPoint=function(e,t){var r=[],n=vec4.fromValues(t.x||0,t.y||0,t.z||0,1);return vec4.transformMat4(r,n,e),r[3]?{x:r[0]/r[3],y:r[1]/r[3],z:r[2]/r[3]}:{x:0,y:0,z:0}},e.mapPoints=function(e,r){var n,o,i,a,s=[];for(n=0;n<r.length;n+=1)o=r[n],i=vec4.fromValues(o[0],o[1],0,1),a=vec4.create(),vec4.transformMat4(a,i,e),t(a[3],0)||a[3]<0?s.push(vec2.fromValues(NaN,NaN)):s.push(vec2.fromValues(a[0]/a[3],a[1]/a[3]));return s},e.rectStaysRect=e.is2DAxisPreserving=function(e){var r=0!==e[3]||0!==e[7],n=0,o=0,i=0,a=0;return t(Math.abs(e[0]),0)||(n+=1,i+=1),t(Math.abs(e[4]),0)||(n+=1,a+=1),t(Math.abs(e[1]),0)||(o+=1,i+=1),t(Math.abs(e[5]),0)||(o+=1,a+=1),n<=1&&o<=1&&i<=1&&a<=1&&!r},e.isIdentityOr2DTranslation=function(e){return 1===e[0]&&1===e[5]&&1===e[10]&&1===e[15]&&(0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&0===e[11]&&0===e[14])},e.isFlat=function(e){return t(e[2],0)&&t(e[6],0)&&t(e[8],0)&&t(e[9],0)&&t(e[10],1)&&t(e[11],0)&&t(e[14],0)},e.is2DTransform=function(r){return!!e.isFlat(r)&&!!(t(r[3],0)&&t(r[7],0)&&t(r[11],0)&&t(r[15],1))},e.getTranslation=function(e){return{x:e[12],y:e[13],z:e[14]}},e.mapRectToQuad=function(t,r){return e.mapPoints(t,Sk.Rect.toQuad(r))},e.mapRect=function(t,r){var n,o=e.mapRectToQuad(t,r),i=0;for(o.length,n=0;n<o.length;n+=1)if((i+=isNaN(o[n][0])?1:0)>1)return Sk.Rect.makeEmpty();return Sk.Rect.bboxRect(o)},e.asCSSTransformMatrix=function(t){return e.is2DTransform(t)?"matrix("+t[0]+","+t[1]+","+t[4]+","+t[5]+","+t[12]+","+t[13]+")":"matrix3d("+t[0]+","+t[1]+","+t[2]+","+t[3]+","+t[4]+","+t[5]+","+t[6]+","+t[7]+","+t[8]+","+t[9]+","+t[10]+","+t[11]+","+t[12]+","+t[13]+","+t[14]+","+t[15]+")"},e.asCanvasTransformMatrix2D=function(e){return e.length,[e[0],e[1],e[4],e[5],e[12],e[13]]},e.fromColumnMajorList=function(e){return mat4.fromValues.apply(mat4,e)},e.fromRowMajorList=function(t){var r=e.fromColumnMajorList(t);return mat4.transpose(r,r)},e.isIdentity=function(e){return mat4.exactEquals(e,mat4.create())},e.isBackFaceVisible=function(t){var r;return!e.isIdentity(t)&&(0!==(r=mat4.determinant(t))&&(t[0]*t[5]*t[15]+t[4]*t[13]*t[3]+t[12]*t[1]*t[7]-t[0]*t[13]*t[7]-t[4]*t[1]*t[15]-t[12]*t[5]*t[3])*r<0)},e.flattenTo2d=function(e){e[2]=0,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[14]=0},e}(),Compositor.InPageSearcher=function(e){"use strict";var t,r,n,o=this,i=new Logger("in-page-search",{level:"info"}),a=new ShortcutKeyHandler(e),s=!1,l=!1,c="safeview-in-page-search-div",u="safeview-in-page-search-input";function d(t,n){var o=r.value;e.surrogate_channel.send("in-page-search","query",o,t,n)}function f(){s||o.show_find(),d(!0,!1),l=!0}function p(r){l=!1,e.surrogate_channel.send("in-page-search","end",r),t&&(t.style.display="none",s=!1)}function g(t){switch(t.type){case"input":""===r.value?(n.innerHTML="",e.surrogate_channel.send("in-page-search","end","clear")):f();break;case"keydown":13===t.keyCode?t.shiftKey?o.find_prev():t.ctrlKey?p("activate"):o.find_next():27===t.keyCode&&p("keep");break;case"paste":t.stopPropagation()}}function m(e){return e.id===c}return o.insertInput=function(){var o,i,a;t||(document.head.appendChild((o="/safeview-static/css/search.css",i=e.url_builder.buildAssetURL(o),(a=document.createElement("link")).type="text/css",a.id="safeview-in-page-search-css",a.rel="stylesheet",a.href=i,a.media="all",a)),document.body.insertAdjacentHTML("beforeend",e.template.get("search-template")),t=document.getElementById(c),(n=document.getElementById("safeview-in-page-search-count")).innerHTML="",r=document.getElementById(u),EventListener.addListener(r,"keydown",g,!0),EventListener.addListener(r,"input",g,!0),EventListener.addListener(r,"paste",g,!0),BrowserDetect.isIE()?t.classList.add("safeview-in-page-search-div-ie"):BrowserDetect.isEdge()?t.classList.add("safeview-in-page-search-div-edge"):BrowserDetect.isFirefox()?t.classList.add("safeview-in-page-search-div-firefox"):BrowserDetect.isChrome()&&t.classList.add("safeview-in-page-search-div-chrome"),t.style.display="none",s=!1)},o.find_next=function(){l?d(!0,!0):f()},o.find_prev=function(){l?d(!1,!0):f()},o.show_find=function(){s||(t||o.insertInput(),t.style.display="block",s=!0),r.focus(),r.select()},o.mouse_event_search_input=function(e){if(!s||!Util.findPredicateOnBranch(e.target,m))return!1;if("mouseup"===e.type)switch(e.target.id){case"safeview-in-page-search-close-button":p("keep");break;case"safeview-in-page-search-next-button":o.find_next(),r.focus();break;case"safeview-in-page-search-prev-button":o.find_prev(),r.focus();break;default:r.focus()}return!0},o.is_key_event_search_input=function(e){return s&&e.target.id===u&&!o.is_search_operation(e)},o.is_search_operation=function(e){var t=a.get_operation(e);return"inPageSearch"===t||"inPageSearchNext"===t||"inPageSearchPrev"===t},o.is_search_focused=function(){return s&&document.activeElement===r},o.release=function(){t&&t.parentNode&&t.parentNode.removeChild(t),t=null},e.interp.registerOpcodeHandler("search_reply",(function(e,t){s&&l&&(n.innerHTML=t+"/"+e)})),e.interp.registerOpcodeHandler("search_start",(function(e){switch(e){case"new":o.show_find();break;case"next":o.find_next();break;case"prev":o.find_prev();break;default:i.error("unexpected search type="+e)}})),o},Compositor.CommitFlags=Object.freeze({kFullTree:1,kResetCache:2,kWheelEventListener:4,kBlockingWheelEventListener:8,kDirtySpecialIds:16,kDirtyDSF:32,kHasMutations:64,kDirtyPageScaleFactorAndLimits:128,kDirtyDisplayListTileSize:256,kTouchEventListener:512,kBlockingTouchEventListener:1024,kDirtyConfig:2048,kHasMainThreadDeltas:4096,kDirtyTransformTree:8192,kDirtyScrollTree:16384,kDirtyClipTree:32768,kDirtyEffectTree:65536,kIsSubFrame:1<<17,kDirtyViewportContainerBoundsDelta:1<<18}),Compositor.DirtyProps=Object.freeze({kFlags:1,kBounds:2,kOffsetToTransformParent:4,kBackgroundColor:8,kNodeId:16,kNonFastScrollableRegion:32,kDirtyTiles:64,kTextureBounds:128,kTouchActionRegion:256,kTransformTreeIndex:512,kClipTreeIndex:1024,kScrollTreeIndex:2048,kEffectTreeIndex:4096,kElementId:8192,kScrollbarProps:16384,kFrameSinkId:32768,kDirtyPointerEventsNone:65536,kWheelEventRegion:1<<17,kAll:4294967295}),Compositor.LayerFlags=Object.freeze({kContentsOpaque:2,kIsDrawable:4,kShouldCheckBackfaceVisibility:8,kHasWillChangeTransformHint:64,kHideLayerAndSubTree:128,kIsCanvasBacking:256,kIsScrollbar:512,kIsHitTestable:2048,kIsSurfaceLayerWithVideo:4096,kIsUntiled:16384,kIsDisplayListDelta:32768,kIsSurfaceLayerForOSC:65536}),Compositor.StickyPositionConstraint=Object.freeze({kIsSticky:1,kIsAnchoredLeft:2,kIsAnchoredRight:4,kIsAnchoredTop:8,kIsAnchoredBottom:16}),Compositor.LayerType=Object.freeze({Unknown:0,Layer:1,PictureLayer:2,SolidColorScrollbarLayer:3,VideoLayer:4,TextureLayer:5,SurfaceLayer:6,PaintedScrollbarLayer:7,PaintedOverlayScrollbarLayer:8}),Compositor.MutationType=Object.freeze({kAddLayer:0,kRemoveLayer:1}),Compositor.TouchAction=Object.freeze({kNone:0,kPanLeft:1,kPanRight:2,kPanX:3,kPanUp:4,kPanDown:8,kPanY:12,kPan:15,kPinchZoom:16,kManipulation:31,kDoubleTapZoom:32,kInternalPanXScrolls:64,kInternalNotWritable:128,kAuto:255,kMax:255}),Compositor.MessageFlags=Object.freeze({kFrameDelay:0,kPixelDistance:1,kInvalidateAllLayers:2,kInvalidateLayerRect:3,kInvalidateLayerTree:4,kSetDebugDataEnabled:5,kScrollAndScaleUpdate:6,kDisplayListDelta:7}),Compositor.PropertyTreesDirtyFlags=Object.freeze({kInnerViewportContainerBoundsDelta:1,kOuterViewportContainerBoundsDelta:2}),Compositor.TransformNodeFlags=Object.freeze({kMovedByOuterViewportBoundsDeltaY:1,kSticky:2,kScrolls:4,kFlattensInheritedTransform:8,kDelegatesToParentForBackface:16}),Compositor.ScrollNodeFlags=Object.freeze({kScrollable:1,kUserScrollableHorizontal:2,kUserScrollableVertical:4,kMaxScrollOffsetAffectedByPageScale:8,kScrollsInnerViewport:16,kScrollsOuterViewport:32,kShouldFlatten:64,kMainThreadScrolling:128,kPreventViewportScrollingFromInner:256}),Compositor.TransformNodeDirtyFlags=Object.freeze({kParentId:1,kTransform:2,kOrigin:4,kPostTranslation:8,kFlags:16,kStickyPosData:32}),Compositor.ScrollNodeDirtyFlags=Object.freeze({kParentId:1,kTransformId:2,kElementId:4,kContainerBounds:8,kBounds:16,kOverscrollBehavior:32,kFlags:64}),Compositor.ClipNodeDirtyFlags=Object.freeze({kParentId:1,kTransformId:2,kClipRect:4}),Compositor.EffectNodeDirtyFlags=Object.freeze({kParentId:1,kScreenSpaceOpacity:2,kBlendMode:4,kTransformId:8,kClipId:16,kFlags:32,kTargetId:64}),Compositor.EffectNodeFlags=Object.freeze({kHiddenByBackfaceVisibility:1,kDoubleSided:2,kTrilinearFiltering:4,kIsDrawn:8,kSubtreeHidden:16,kHasMaskingChild:32,kHasFastRoundedCorner:64,kHasRenderSurface:128}),Compositor.OverscrollBehaviorType=Object.freeze({kNone:0,kAuto:1,kContain:2}),Compositor.ScrollbarFlags=Object.freeze({kIsOverlay:1,kIsHorizontal:2,kIsLeftSideVertical:4,kHasThumb:8,kJumpOnTrackClick:16,kSupportsDragSnapBack:32}),Compositor.ConfigFlags=Object.freeze({kPreferAsyncScrolling:1,kEnableDOMRasterization:2,kEnableDOMText:4,kPruneOccludedTiles:8,kPreferScrollingCorrectness:16,kAllowCSSGradients:32,kAllowDisplayListDeltaForDrag:64,kEnableScrollUnification:128,kUseNewPictureShader:256,kAllowClientCanvasSrc:512}),Compositor.BinaryReader=function(){"use strict";function e(e){var t,r={};return t=e.readUint32(),r.type=1&t,r.layer_id=t>>1,r.type===Compositor.MutationType.kAddLayer&&(r.layer_type=e.readUint32(),r.layer_parent_id=e.readInt32(),-1!==r.layer_parent_id&&(r.layer_sibling_index=e.readInt32())),r}function t(e){var t={};function r(e){return t.dirty_flags,t.dirty_flags&e}return t.dirty_flags=e.readUint32(),t.id=e.readInt32(),r(Compositor.TransformNodeDirtyFlags.kParentId)&&(t.parent_id=e.readInt32()),r(Compositor.TransformNodeDirtyFlags.kTransform)&&(t.local=function(e){var t,r,n=e.readUint32();return n&(Sk.MatrixMask.Scale|Sk.MatrixMask.Affine|Sk.MatrixMask.Perspective)?r=Compositor.Matrix3D.fromRowMajorList(e.readFloat32Array(16)):n&Sk.MatrixMask.Translate?(t=e.readFloat32Array(3),r=mat4.fromTranslation(mat4.create(),t)):r=mat4.create(),r}(e)),r(Compositor.TransformNodeDirtyFlags.kOrigin)&&(t.origin={x:e.readFloat32(),y:e.readFloat32(),z:e.readFloat32()}),r(Compositor.TransformNodeDirtyFlags.kPostTranslation)&&(t.post_translation={x:e.readFloat32(),y:e.readFloat32()}),r(Compositor.TransformNodeDirtyFlags.kFlags)&&(t.flags=e.readUint32()),r(Compositor.TransformNodeDirtyFlags.kStickyPosData)&&(t.sticky_position_data=function(e){var t={},r=e.readUint32();return Compositor.StickyPositionConstraint.kIsSticky,r&Compositor.StickyPositionConstraint.kIsAnchoredLeft&&(t.left_offset=e.readFloat32()),r&Compositor.StickyPositionConstraint.kIsAnchoredRight&&(t.right_offset=e.readFloat32()),r&Compositor.StickyPositionConstraint.kIsAnchoredTop&&(t.top_offset=e.readFloat32()),r&Compositor.StickyPositionConstraint.kIsAnchoredBottom&&(t.bottom_offset=e.readFloat32()),t.constraint_box_rect=e.readRect(),t.scroll_container_relative_sticky_box_rect=e.readRect(),t.scroll_container_relative_containing_block_rect=e.readRect(),t.scroll_ancestor=e.readInt32(),t.nearest_node_shifting_sticky_box=e.readInt32(),t.nearest_node_shifting_containing_block=e.readInt32(),t}(e)),t}function r(e){var t,r={};function n(e){return r.dirty_flags,r.dirty_flags&e}return r.dirty_flags=e.readUint32(),r.id=e.readInt32(),n(Compositor.ScrollNodeDirtyFlags.kParentId)&&(r.parent_id=e.readInt32()),n(Compositor.ScrollNodeDirtyFlags.kTransformId)&&(r.transform_id=e.readInt32()),n(Compositor.ScrollNodeDirtyFlags.kElementId)&&(r.element_id=e.readUint32(),r.element_id),n(Compositor.ScrollNodeDirtyFlags.kContainerBounds)&&(r.container_bounds={width:e.readUint32(),height:e.readUint32()}),n(Compositor.ScrollNodeDirtyFlags.kBounds)&&(r.bounds={width:e.readUint32(),height:e.readUint32()}),n(Compositor.ScrollNodeDirtyFlags.kOverscrollBehavior)&&(r.overscroll_behavior={},t=e.readUint32(),r.overscroll_behavior.x=t>>16&65535,r.overscroll_behavior.y=65535&t),n(Compositor.ScrollNodeDirtyFlags.kFlags)&&(r.flags=e.readUint32()),r}function n(e){var t={};function r(e){return t.dirty_flags,t.dirty_flags&e}return t.dirty_flags=e.readUint32(),t.id=e.readInt32(),r(Compositor.ClipNodeDirtyFlags.kParentId)&&(t.parent_id=e.readInt32()),r(Compositor.ClipNodeDirtyFlags.kTransformId)&&(t.transform_id=e.readInt32()),r(Compositor.ClipNodeDirtyFlags.kClipRect)&&(t.clip_rect=e.readRect()),t}function o(e){var t={};function r(e){return t.dirty_flags,t.dirty_flags&e}return t.dirty_flags=e.readUint32(),t.id=e.readInt32(),r(Compositor.EffectNodeDirtyFlags.kParentId)&&(t.parent_id=e.readInt32()),r(Compositor.EffectNodeDirtyFlags.kScreenSpaceOpacity)&&(t.opacity=e.readFloat32()),r(Compositor.EffectNodeDirtyFlags.kBlendMode)&&(t.blend_mode=e.readUint32()),r(Compositor.EffectNodeDirtyFlags.kTransformId)&&(t.transform_id=e.readInt32()),r(Compositor.EffectNodeDirtyFlags.kClipId)&&(t.clip_id=e.readInt32()),r(Compositor.EffectNodeDirtyFlags.kTargetId)&&(t.target_id=e.readInt32()),r(Compositor.EffectNodeDirtyFlags.kFlags)&&(t.flags=e.readUint32()),t}function i(e){return{element_id:e.readUint32(),delta:{x:e.readFloat32(),y:e.readFloat32()}}}function a(e){return e.readUint32()+":"+e.readUint32()}function s(e,t){var r,n,o,i,s,l,c,u,d,f={};function p(e){return f.dirty_props,f.dirty_props&e}function g(e){var t=Sk.Region.makeEmpty();for(l=e.readUint32(),c=0;c<l;c+=1)Sk.Region.addRect(t,e.readRect());return t}if(f.dirty_props=e.readUint32(),f.layer_type=e.readUint32(),f.id=e.readInt32(),d=f.layer_type,!1,Util.forEachItem(Compositor.LayerType,(function(e,t){if(d===t)return!0,!0})),f.dirty_props&Compositor.DirtyProps.kFlags&&(f.flags=e.readUint32()),f.dirty_props&Compositor.DirtyProps.kBounds&&(f.bounds={width:e.readUint32(),height:e.readUint32()}),p(Compositor.DirtyProps.kOffsetToTransformParent)&&(f.offset_to_transform_parent={x:e.readFloat32(),y:e.readFloat32()}),f.dirty_props&Compositor.DirtyProps.kBackgroundColor&&(f.background_color=e.readUint32()),p(Compositor.DirtyProps.kTransformTreeIndex)&&(f.transform_tree_index=e.readInt32()),p(Compositor.DirtyProps.kClipTreeIndex)&&(f.clip_tree_index=e.readInt32()),p(Compositor.DirtyProps.kScrollTreeIndex)&&(f.scroll_tree_index=e.readInt32()),p(Compositor.DirtyProps.kEffectTreeIndex)&&(f.effect_tree_index=e.readInt32()),f.dirty_props&Compositor.DirtyProps.kNodeId&&(f.node_id=e.readInt32()),f.dirty_props&Compositor.DirtyProps.kNonFastScrollableRegion&&(f.non_fast_scrollable_rects=g(e)),f.dirty_props&Compositor.DirtyProps.kWheelEventRegion&&(f.wheel_event_region=g(e)),f.dirty_props&Compositor.DirtyProps.kTouchActionRegion){for(r=e.readUint32(),i=Sk.Region.makeEmpty(),s={},c=0;c<r;++c){for(o=e.readUint32(),l=o>>16&65535,s[n=65535&o]=Sk.Region.makeEmpty(),u=0;u<l;u+=1)Sk.Region.addRect(s[n],e.readRect());Sk.Region.addRegion(i,s[n])}f.touch_action_region={whole_region:i,touch_actions:s}}return p(Compositor.DirtyProps.kElementId)&&(f.element_id=e.readUint32()),f.layer_type===Compositor.LayerType.PictureLayer?f.dirty_props&Compositor.DirtyProps.kDirtyTiles&&function(e,t){var r,n,o,i,a,s,l,c=e.readUint32();for(t.tile_updates=[],r=0;r<c;r+=1){for(s={},o=e.readUint32(),s.index_x=65535&o,s.index_y=o>>16&65535,a=(i=e.readUint32())>>16&65535,l=!!(1&i),s.invalidation_region=[],n=0;n<a;n+=1)s.invalidation_region.push(e.readRect());l&&(s.solid_color=e.readUint32()),s.skr_u8a=e.readByteArray(),t.tile_updates.push(s)}}(e,f):f.layer_type===Compositor.LayerType.TextureLayer?(f.dirty_props&Compositor.DirtyProps.kTextureBounds&&(f.texture_bounds={width:e.readUint32(),height:e.readUint32()}),f.dirty_props&Compositor.DirtyProps.kDirtyTiles&&(f.skr_u8a=e.readByteArray())):f.layer_type===Compositor.LayerType.PaintedScrollbarLayer||f.layer_type===Compositor.LayerType.SolidColorScrollbarLayer||f.layer_type===Compositor.LayerType.PaintedOverlayScrollbarLayer?p(Compositor.DirtyProps.kScrollbarProps)&&(f.scroll_element_id=e.readUint32(),f.scrollbar_flags=e.readUint32(),t&&(f.layer_type===Compositor.LayerType.PaintedOverlayScrollbarLayer?(f.track_rect=e.readRect(),f.scrollbar_flags&Compositor.ScrollbarFlags.kHasThumb&&(f.thumb_size={width:e.readUint32(),height:e.readUint32()})):f.layer_type===Compositor.LayerType.PaintedScrollbarLayer?(f.track_rect=e.readRect(),f.back_button_rect=e.readRect(),f.forward_button_rect=e.readRect(),f.scrollbar_flags&Compositor.ScrollbarFlags.kHasThumb&&(f.thumb_size={width:e.readUint32(),height:e.readUint32()})):f.layer_type===Compositor.LayerType.SolidColorScrollbarLayer&&(f.thumb_thickness=e.readInt32(),f.track_start=e.readInt32()))):f.layer_type===Compositor.LayerType.SurfaceLayer&&(p(Compositor.DirtyProps.kFrameSinkId)&&(f.frame_sink_id=a(e)),p(Compositor.DirtyProps.kDirtyPointerEventsNone)&&(f.pointer_events_none=!!e.readUint32()),p(Compositor.DirtyProps.kDirtyTiles)&&(f.skr_u8a=e.readByteArray())),f}this.readCommit=function(l,c){var u,d,f,p,g,m=new Sk.BinaryReader(l),k={},h=c.getConfig().isScrollUnificationEnabled();function S(e){return d&e}return k.fid=m.readUint32(),u=m.readUint32(),h?k.flags=d=u:(k.flags=d=262143&u,f=u>>18),k.is_main_frame=!(d&Compositor.CommitFlags.kIsSubFrame),k.full_tree=!!(d&Compositor.CommitFlags.kFullTree),k.reset_cache=!!(d&Compositor.CommitFlags.kResetCache),k.wheel_event_listener=!!(d&Compositor.CommitFlags.kWheelEventListener),k.blocking_wheel_event_listener=!!(d&Compositor.CommitFlags.kBlockingWheelEventListener),k.touch_event_listener=!!(d&Compositor.CommitFlags.kTouchEventListener),k.blocking_touch_event_listener=!!(d&Compositor.CommitFlags.kBlockingTouchEventListener),k.is_main_frame||(k.frame_sink_id=a(m)),d&Compositor.CommitFlags.kDirtySpecialIds&&(k.special_ids={},k.special_ids.root_layer_id=m.readInt32(),k.is_main_frame&&(k.special_ids.inner_scroll=m.readInt32(),k.special_ids.outer_scroll=m.readInt32(),k.special_ids.outer_content=m.readInt32(),k.special_ids.page_scale=m.readInt32())),d&Compositor.CommitFlags.kDirtyDSF&&(k.device_scale_factor=m.readFloat32()),d&Compositor.CommitFlags.kDirtyConfig&&(k.config={max_pre_draw_distance:m.readFloat32(),pre_draw_distance_factor:m.readFloat32(),pre_draw_distance_factor_for_dom_raster:m.readFloat32(),flags:m.readUint32()},!h&&Compositor.Util.checkFlag(k.config.flags,Compositor.ConfigFlags.kEnableScrollUnification)&&(h=!0,k.flags=d=u)),d&Compositor.CommitFlags.kDirtyPageScaleFactorAndLimits&&(k.page_scale_factor=m.readFloat32(),k.min_page_scale_factor=m.readFloat32(),k.max_page_scale_factor=m.readFloat32()),d&Compositor.CommitFlags.kDirtyDisplayListTileSize&&(p=m.readUint32(),g=m.readUint32(),k.display_list_tile_size=Object.freeze({width:p,height:g})),S(Compositor.CommitFlags.kDirtyViewportContainerBoundsDelta)&&(k.property_trees_mutations=function(e){var t={},r=e.readUint32(),n=Compositor.PropertyTreesDirtyFlags;return r&n.kInnerViewportContainerBoundsDelta&&(t.inner_viewport_container_bounds_delta={x:e.readFloat32(),y:e.readFloat32()}),r&n.kOuterViewportContainerBoundsDelta&&(t.outer_viewport_container_bounds_delta={x:e.readFloat32(),y:e.readFloat32()}),t}(m)),S(Compositor.CommitFlags.kDirtyTransformTree)&&(k.transform_tree_node_count=m.readUint32(),k.transform_tree_mutations=function(e){var r,n=[],o=e.readUint32();for(r=0;r<o;r+=1)n.push(t(e));return n}(m)),S(Compositor.CommitFlags.kDirtyScrollTree)&&(k.scroll_tree_node_count=m.readUint32(),k.scroll_tree_mutations=function(e){var t,n=[],o=e.readUint32();for(t=0;t<o;t+=1)n.push(r(e));return n}(m)),S(Compositor.CommitFlags.kDirtyClipTree)&&(k.clip_tree_node_count=m.readUint32(),k.clip_tree_mutations=function(e){var t,r=[],o=e.readUint32();for(t=0;t<o;t+=1)r.push(n(e));return r}(m)),S(Compositor.CommitFlags.kDirtyEffectTree)&&(k.effect_tree_node_count=m.readUint32(),k.effect_tree_mutations=function(e){var t,r=[],n=e.readUint32();for(t=0;t<n;t+=1)r.push(o(e));return r}(m)),S(Compositor.CommitFlags.kHasMainThreadDeltas)&&(k.main_thread_deltas=function(e){var t,r=[],n=e.readUint32();for(t=0;t<n;t+=1)r.push(i(e));return r}(m)),d&Compositor.CommitFlags.kHasMutations&&(k.mutations=function(t){var r,n=[],o=t.readUint32();for(r=0;r<o;r+=1)n.push(e(t));return n}(m)),h&&(f=m.readUint32()),k.layer_updates=function(e,t,r){var n,o=[];for(n=0;n<t;n+=1)o.push(s(e,r));return o}(m,f,h),Object.freeze(k)}},Compositor.VideoMode={kCopy:0,kNative:1},Compositor.VideoDelegate=function(e,t){"use strict";var r,n,o,i,a,s=this,l=new Logger("video-del",{level:"info",header:function(){return{lid:t.getID(),fc:e.getDisplay().getFrameCount()}}}),c=e.getDisplay(),u={},d=0,f=0,p=0,g=0,m=!1,k=!1,h=null;function S(){n&&c.getMediaDiv().appendChild(n)}function y(r,o){t.getDOMNodeId()===o&&e.getFid()===r&&n&&(n=null)}function v(){var e;c.isDebugEnabled()&&(o||((o=document.createElement("div")).style.position="absolute",o.style.left="0px",o.style.top="0px",o.style.backgroundColor="#FF851B",o.style.color="white",t.getHudDiv()&&t.getHudDiv().appendChild(o)),e=d?f/d:0,o.textContent="Video: "+d+" FPS, "+e.toFixed(2)+" ms/F")}function b(e,o){var i=e.canvas;(BrowserDetect.isFirefox()||BrowserDetect.isChrome()&&BrowserDetect.isMac()&&BrowserDetect.getVersion()<71)&&i.drawVideoRect(n,Sk.Rect.fromXYWH(0,0,1,1),Sk.Rect.fromXYWH(0,0,1,1)),c.isVideoEnabled()?i.drawVideoRect(n,Sk.Rect.fromWH(n.videoWidth,n.videoHeight),t.getBoundsRect(),r):i.drawRRect({rect:Sk.Rect.fromWH(Sk.Rect.getWidth(o),Sk.Rect.getHeight(o))},r)}function C(){var e=Util.now();return c.isInAnimationFrame(),Compositor.VideoMode.kCopy,!!t.getTilingSet().drawTilesInRect(t.getBoundsRect(),b)&&(Util.now()-p>=1e3?(v(),d=0,f=0,p=Util.now()):(d+=1,f+=Util.now()-e),!0)}function _(e){return e===Compositor.VideoMode.kCopy||(Compositor.VideoMode.kNative,c.isNativeVideoEnabled()&&!m)}function T(){a&&(clearTimeout(a),a=null),d=0,f=0,v()}function w(e,t){n&&c.isDebugEnabled()&&n.setAttribute("debug_"+e,t)}function R(){var e,r,o,i=t.getBoundsRect();c.isInAnimationFrame(),void 0!==n.videoWidth&&n.videoHeight,n.lastVideoWidth=n.videoWidth,n.lastVideoHeight=n.videoHeight,n.videoWidth>0&&n.videoHeight>0?(w("debug","got dims "+n.videoWidth+"x"+n.videoHeight),o=mat4.create(),e=Sk.Rect.getWidth(i)/n.videoWidth,r=Sk.Rect.getHeight(i)/n.videoHeight,c.isDebugEnabled()&&(n.setAttribute("sx",e),n.setAttribute("sy",r)),mat4.scale(o,o,vec3.fromValues(e,r,1))):w("debug","awaiting dims"),t.applyDrawTransform(n,i,o)}function x(){var e,r,o,a,s;i!==Compositor.VideoMode.kCopy&&(n&&(e=1,r=1,o=t.getBoundsRect(),a=o,s=h,void 0!==n.videoWidth&&n.videoHeight,n.videoWidth>0&&n.videoHeight>0&&h&&(Sk.Rect.isEmpty(o)||(e=n.videoWidth/Sk.Rect.getWidth(o),r=n.videoHeight/Sk.Rect.getHeight(o)),1===e&&1===r||(a=Sk.Rect.fromWH(n.videoWidth,n.videoHeight),s=Sk.Rect.scaleXY(h,e,r))),t.applyDrawClip(n,a,s)))}function D(){t.applyDrawOpacity(n)}function M(e){t.getTilingSet().invalidateRect(t.getLocalDrawRect(),e)}function F(){return c.isInAnimationFrame(),S(),t.setTilingSetVisible(!0),o&&(o.style.display="block"),M("video-switch-to-copy"),!0}function E(e,r){if(c.isInAnimationFrame(),n&&i!==e){if(!_(e))return i=Compositor.VideoMode.kCopy,void F();if(r&&(m=!0),e===Compositor.VideoMode.kNative)return c.isInAnimationFrame(),T(),t.setTilingSetVisible(!1),t.getContainer().appendChild(n),s.updateProjection(),x(),s.updateOpacity(),o&&(o.style.display="none"),void(i=e);Compositor.VideoMode.kCopy,i!==e&&(i=e,F())}}function I(){var e;t.hasVideoContent(),n||(e=t.getDOMNodeId())&&(n=getNodeByUidOnly(e))&&(n.style.position="absolute",c.isDebugEnabled()&&n.setAttribute("video_layer",t.getID()),A(n,!0),s.updateSizeAndRedraw(t.getBounds()),s.requestDisplay())}function P(){i!==Compositor.VideoMode.kCopy||!n||Util.now()-g<1e3/30||n.paused||M("video-needs-redraw")}function L(r){n?(w("state",r.type),w("src",n.src),w("currentSrc",n.currentSrc),i!==Compositor.VideoMode.kCopy?i!==Compositor.VideoMode.kNative||"timeupdate"!==r.type&&"loadedmetadata"!==r.type||n.lastVideoWidth===n.videoWidth&&n.lastVideoHeight===n.videoHeight||(e.setVideoSizeChanged(),t.runOn("will-draw",(function(){n&&(R(),x(),D())}))):function(e){"play"!==e.type&&"seeked"!==e.type&&"loadeddata"!==e.type&&"canplay"!==e.type||M("video-copy-mode-event")}(r)):l.error({event:"tc-unexpected-video-event",reason:"not paired with video element"})}function O(e){e===t.getDOMNodeId()&&I()}function A(e,t){var r=t?EventListener.addListener:EventListener.removeListener;["play","pause","seeked","canplay","loadeddata","loadedmetadata","timeupdate"].forEach((function(t){r(e,t,L)}))}s.drawFrame=function(){return c.isInAnimationFrame(),i!==Compositor.VideoMode.kCopy||(_(Compositor.VideoMode.kNative)&&(a||(a=setTimeout((function(){a=null,n&&i!==Compositor.VideoMode.kNative&&t.runOn("will-draw",(function(){E(Compositor.VideoMode.kNative)}))}),500))),n&&n.parentNode?(g=Util.now(),C()):(l.error({event:"tc-video-draw-error",video:!!n,attached:!!n&&!!n.parentNode,reason:"video element is in unplayable state"}),!0))},s.updateProjection=function(){i!==Compositor.VideoMode.kCopy&&n&&R()},s.updateClip=function(e){(h||e)&&(h=e?Sk.Rect.makeCopy(e):null,x())},s.updateOpacity=function(){i!==Compositor.VideoMode.kCopy&&n&&D()},s.requestDisplay=function(){t.runOn("will-draw",(function(){E(c.isNativeVideoEnabled()?Compositor.VideoMode.kNative:Compositor.VideoMode.kCopy)}))},s.pairWithVideoElementIfNeeded=I,s.updateSizeAndRedraw=function(e){n&&i===Compositor.VideoMode.kCopy&&C()},s.stop=function(e){k&&(t.getID(),T(),S(),n&&(A(n,!1),n=null,i=null),Util.forEachItem(u,(function(e,t){c.callback.deregister(t)})),u={},k=!1)},s.start=function(e){t.getID(),k=!0,u.media_node_insert=c.callback.register("media-node-inserted",O),u.begin_animation_frame=c.callback.register("begin-animation-frame",P),c.callback.register("remove-media-node",y),I()},s.getVideoNode=function(){return n},r=Sk.Paint.makePaint({filterQuality:Sk.FilterQuality.kMedium})},Compositor.GraphWidgetType=Object.freeze({kRateWidget:1,kValueWidget:2}),Compositor.GraphWidget=function(e,t,r,n,o){"use strict";var i,a,s,l=this,c=Date.now(),u=[],d=0;function f(e){e=Math.round(e),a.firstChild&&a.removeChild(a.firstChild),a.appendChild(document.createTextNode(e+" "+t))}function p(e){var t=30/r[1];return Math.round(t*e),Math.min(30,Math.max(Math.round(t*e),1))}l.getDiv=function(){return i},l.getHelpMsg=function(){return o},l.update=function(t){var o,i,a,l,g,m,k,h=Math.max(1,Date.now()-c),S=0,y=0;if(t.length){if(s.childNodes.length>=70)o=s.firstChild,s.removeChild(o);else for((o=document.createElement("div")).style.width="1px",o.style.float="left",o.style.overflow="hidden",k=0;k<n;k+=1)(i=document.createElement("div")).style.display="block",i.style.width="1px",i.style.padding="0px 0px 0px 0px",o.appendChild(i);for(k=0;k<t.length;k+=1)g=t[k][0],m=t[k][1]||"rgb(0, 255, 0)",void 0===u[k]&&(u[k]=0),u[k]+=g,d+=y+=g,e===Compositor.GraphWidgetType.kRateWidget?a=p(u[k]*(1e3/h)):e===Compositor.GraphWidgetType.kValueWidget&&(a=p(g)),(l=o.childNodes[k]).style.top=S+"px",l.style.height=a+"px",l.style.backgroundColor=g>r[1]?"rgb(255, 0, 0)":m,S+=a;h>=1e3&&(e===Compositor.GraphWidgetType.kRateWidget?f(d/(h/1e3)):e===Compositor.GraphWidgetType.kValueWidget&&f(y),u=[],d=0,c=Date.now()),s.appendChild(o)}},e===Compositor.GraphWidgetType.kRateWidget||Compositor.GraphWidgetType.kValueWidget,(a=document.createElement("div")).id="sv-text:"+t,a.style.color="rgb(0, 255, 0)",a.style.fontFamily="Arial",a.style.fontSize="9px",a.style.fontWeight="bold",a.style.lineHeight="15px",f(""),(s=document.createElement("div")).id="sv-graph:"+t,s.style.position="relative",s.style.width="74px",s.style.height="30px",s.style.backgroundColor="rgb(0, 0, 0)",s.style.transform="rotateX(180deg)",s.style.overflow="hidden",(i=document.createElement("div")).id="sv-widget:"+t,i.style.display="inline-block",i.style.textAlign="left",i.style.padding="0px 0px 3px 3px",i.style.margin="5px",i.style.backgroundColor="rgb(0, 0, 0)",i.style.borderRadius="3px 3px 3px 3px",i.style.overflow="visible",i.style.opacity="0.8",i.style.filter="drop-shadow(0 0 40px #333)",i.appendChild(a),i.appendChild(s)},Compositor.HUD=function(e,t){"use strict";var r,n,o,i=this,a=Date.now(),s={};function l(){n||(n=window.requestAnimationFrame((function(){n=null,Date.now()-a>=t&&(e(s),a=Date.now()),l()})))}function c(){s.cps=new Compositor.GraphWidget(Compositor.GraphWidgetType.kRateWidget,"CPS",[0,30],1,"Commits Per Second"),s.fps=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"FPS",[0,70],1,"Frames Per Second"),s.sfps=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"SFPS",[0,70],1,"Surrogate FPS"),s.cql=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"CQL",[0,100],1,"Commit Queue Length"),s.crx=new Compositor.GraphWidget(Compositor.GraphWidgetType.kRateWidget,"DR (KB)",[0,200],2,"Data Rate (TX & RX)"),s.canvas=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"CANV (MB)",[0,600],4,"Canvas Memory Usage"),s.ptn_count=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"PTNC",[0,40],4,"Property Tree Node Count"),s.ptn_mutations=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"PTNM",[0,40],4,"Property Tree Node Mutation Rate"),s.fdt=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"FDT",[0,200],1,"Frames Drawing Time (ms)"),s.vtc=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"VTC",[0,100],1,"Visible Tiles Count"),Util.forEachItem(s,(function(e,t){r.appendChild(t.getDiv()),EventListener.addListener(t.getDiv(),"mouseover",(function(e){var r;o.style.display="block",r=t.getHelpMsg(),o.firstChild&&o.removeChild(o.firstChild),o.appendChild(document.createTextNode(r))})),EventListener.addListener(t.getDiv(),"mouseout",(function(e){o.style.display="none"}))}))}void 0===t&&(t=100),i.getDiv=function(){return r},i.start=function(){l()},i.stop=function(){n&&(window.cancelAnimationFrame(n),n=null)},i.show=function(){r.style.display="block"},i.hide=function(){r.style.display="none"},i.addWidget=function(e){var t=document.createElement("div");return t.id=e,r.appendChild(t),t},i.updateWidget=function(e,t){e&&(e.firstChild&&e.removeChild(e.firstChild),t?(e.style.display="block",e.appendChild(document.createTextNode(t))):e.style.display="none")},i.release=function(){i.stop(),r&&r.parentNode&&r.parentNode.removeChild(r),r=null},(o=document.createElement("div")).id="sv-tooltip:"+name,o.style.display="none",o.style.position="fixed",o.style.left="50%",o.style.top="40%",o.style.transform="translate(-50%, -50%)",o.style.padding="10px",o.style.color="white",o.style.backgroundColor="rgba(40, 40, 40, 0.9)",o.style.borderRadius="3px 3px 3px 3px",(r=document.createElement("div")).id="sv-hud",r.style.display="none",r.style.position="fixed",r.style.top="10%",r.style.right="15px",r.style.width="80px",r.appendChild(o),c()},Compositor.RequestAnimationFrame=function(e){"use strict";var t,r,n=this,o="visibilitychange",i=!1;function a(){t=null,e(),i&&(t=window.requestAnimationFrame(a))}function s(){t&&(window.cancelAnimationFrame(t),t=null),r&&(clearInterval(r),r=null),Util.isTabVisible()?t=window.requestAnimationFrame(a):r=window.setInterval(e,3e3)}n.start=function(){i=!0,EventListener.addListener(document,o,s),s()},n.stop=function(){i&&(EventListener.removeListener(document,o,s),t&&(window.cancelAnimationFrame(t),t=null),r&&(clearInterval(r),r=null),i=!1)},n.release=function(){n.stop()},n.runOne=function(){a()},window.requestAnimationFrame&&window.cancelAnimationFrame},Compositor.ScrollThread=Object.freeze({kScrollOnSurrogateMainThread:0,kScrollOnLocalJavaScriptThread:1,kScrollOnLocalImplThread:2,kScrollIgnored:3}),Compositor.ScrollOrigin=Object.freeze({kOriginSurrogate:0,kOriginScrollEvent:1,kOriginProgrammatic:2,kOriginIgnore:3}),Compositor.ScrollAction=Object.freeze({kNoAction:0,kForwardToSurrogate:1,kPreventNativeScroll:2,kAllowNativeScroll:3,kForwardToNextFrame:4,kRequiresMainThreadHitTest:5}),Compositor.MainThreadScrollStrictness=Object.freeze({kLow:0,kMedium:1,kHigh:2,kSevere:3}),Compositor.MainThreadScrollingReason=Object.freeze({kNotScrollingOnMain:0,kScrollingOnMainForAnyReason:1,kHasBackgroundAttachmentFixedObjects:4,kPopupNoThreadedInput:16,kPreferNonCompositedScrolling:32768,kBackgroundNeedsRepaintOnScroll:65536,kNotOpaqueForTextAndLCDText:32,kCantPaintScrollingBackgroundAndLCDText:64,kScrollbarScrolling:128,kNonFastScrollableRegion:256,kFailedHitTest:512,kNoScrollingLayer:1024,kWheelEventHandlerRegion:8192,kTouchEventHandlerRegion:16384,kMainThreadScrollingReasonLast:16}),Compositor.PreventDefaultObserver=function(e,t){"use strict";var r=this,n=t.getDisplay(),o={};r.didHandlerPreventDefault=function(e){return e===Compositor.EventType.kWheel||Compositor.EventType.kTouch,!!o[e]},r.wheelHandlerStateChanged=function(e){var t=o[e];e===Compositor.EventType.kWheel||Compositor.EventType.kTouch,t&&clearTimeout(t),t=setTimeout((function(){delete o[e],n.callback.fire("wheel-handler-state-changed")}),5e3),o[e]=t,n.callback.fire("wheel-handler-state-changed")},r.release=function(){Util.forEachItem(o,(function(e,t){t&&clearTimeout(t)})),o=null}},Compositor.ScrollState=function(e,t,r,n){"use strict";var o,i=this,a=Compositor.Offset.makeCopy(r),s=!1,l=!1,c=!1;i.getPosition=function(){return t},i.getVelocity=function(){return n},i.getEventType=function(){return e},i.getRemainingDelta=function(){return a},i.getTargetElementId=function(){return o},i.setTargetElementId=function(e){o=e},i.setHasMainThreadHitTestedReasons=function(){l=!0},i.hasMainThreadHitTestedReasons=function(){return l},i.setIsScrollbarInteraction=function(){c=!0},i.isScrollbarInteraction=function(){return c},i.hasRemainingDelta=function(){return!Compositor.Offset.isZero(a)},i.wasDeltaConsumed=function(){return s},i.consumeDelta=function(e){return Compositor.Offset.isZero(e)||(s=!0),Compositor.Offset.subtract(a,e,a)},i.asDict=function(){return{pos:t,rem_delta:a,target_element_id:o}},i.reset=function(){a.x=a.y=0,s=!1,o=null,l=!1},Compositor.Offset.isValid(t)},Compositor.ScrollAnimator=function(e,t){"use strict";var r,n,o,i,a,s=this;function l(){var t=Date.now()-a,r=Compositor.Offset.makeXY(o.x?Math.min(o.x/.003,2e3):0,o.y?Math.min(o.y/.003,2e3):0),l=Compositor.Offset.makeXY(r.x?t/r.x:1,r.y?t/r.y:1),c=Compositor.Offset.makeXY(l.x<=1?Compositor.Util.quadBezier(l.x,o.x,0,0):0,l.y<=1?Compositor.Util.quadBezier(l.y,o.y,0,0):0),u=Date.now()-i,d=Compositor.Offset.multiply(c,Compositor.Offset.scale(n,u)),f=new Compositor.ScrollState(Compositor.EventType.kTouch,Compositor.Offset.makeZero(),d);l.x,l.y,e.scrollUpdate(f),i=Date.now(),l.x>=1&&l.y>=1&&s.stop()}s.start=function(e){r||(n=Compositor.Offset.sign(e),o=Compositor.Offset.abs(e),i=Date.now(),a=Date.now(),l(),r=setInterval(l,16))},s.stop=function(){r&&(clearInterval(r),r=null,t())}},Compositor.ScrollDelegate=function(e,t){"use strict";var r,n,o,i,a,s=this,l=Compositor.MainThreadScrollStrictness.kMedium,c=t.getDisplay();function u(){return t.getPropertyTrees().getScrollTree()}function d(e,r){var n;return l>=Compositor.MainThreadScrollStrictness.kMedium&&e.hasMainThreadScrolling()?{thread:Compositor.ScrollThread.kScrollOnSurrogateMainThread,reason:"main-thread-scrolling-reason"}:r.hasOwnProperty(e.getId())?{thread:Compositor.ScrollThread.kScrollOnSurrogateMainThread,reason:"non-fast-scrollable"}:c.isNativeOVSLScrollingEnabled()&&e.scrollsOuterViewport()?{thread:Compositor.ScrollThread.kScrollOnLocalImplThread,reason:"scrolls-outer-viewport"}:t.getLayerTree().getLayerByElementId(e.getElementId())||e.scrollsInnerViewport()||e.isRootNode()||e.isSecondaryRootNode()?e.isScrollable()?(n=e.maxScrollOffset()).x<=0&&n.y<=0&&!e.scrollsOuterViewport()&&!e.scrollsInnerViewport()?{thread:Compositor.ScrollThread.kScrollIgnored,reason:"cannot-scroll"}:{thread:Compositor.ScrollThread.kScrollOnLocalJavaScriptThread,reason:"does-not-scroll-ovsl"}:{thread:Compositor.ScrollThread.kScrollIgnored,reason:"not-scrollable"}:{thread:Compositor.ScrollThread.kScrollOnSurrogateMainThread,reason:"no-scrolling-layer"}}function f(e){return e?e.scrollsInnerViewport()&&!e.preventViewportScrollingFromInner()?c.getOuterViewportScrollNode():e:null}function p(e,t){var r,n,o;if(!t)return!0;if(e.isScrollbar())return!0;for(n=(o=u()).getNode(e.getScrollTreeIndex());o.getNode(n.getParentId());n=o.getNode(n.getParentId()))if(n.isScrollable()){r=f(n);break}return!!r&&(t.isScrollable()?r.getId()===t.getScrollTreeIndex():(t.isScrollbar(),!1))}function g(e){var t=e.thread;return t===Compositor.ScrollThread.kScrollOnLocalJavaScriptThread||t===Compositor.ScrollThread.kScrollOnLocalImplThread}function m(e,r,n){var o,i,a,s,l,f,m,k,h=r.getPosition();if(m=e.getScrollTreeIndex(),(k=e.getOwnerScrollLayer())&&(m=k.getScrollTreeIndex()),!p(e,o=t.hitTest(Compositor.HitTest.kScrollingOrScrollbarLayer,h))){if(!c.getConfig().getPreferAsyncScrolling())return n.thread=Compositor.ScrollThread.kScrollOnSurrogateMainThread,n.reason="unreliable-initial-scroll-hit-test",e;m=o.getScrollTreeIndex()}for(i=function(e){var r={},n=[];return t.getLayerTree().withEachNonFastLayerDo((function(e,t){n.push(t)})),n.sort((function(e,t){return e.paintsBefore(t)?1:-1})),n.forEach((function(t){var n,o,i;if((i=t.getNonFastScrollableRects()).length&&(n=t.hitTestPoint(e)))for(o=0;o<i.length;o+=1)Sk.Rect.containsPoint(i[o],n)&&(r[t.getScrollTreeIndex()]=!0)})),r}(h),a=u().getNode(m);a;){if((s=d(a,i)).thread===Compositor.ScrollThread.kScrollOnSurrogateMainThread)return Util.copyDict(s,n),a;g(s)&&!l&&(l=a),a=u().getNode(a.getParentId())}return l?((f=c.getOuterViewportScrollNode())&&l.scrollsInnerViewport()&&!l.preventViewportScrollingFromInner()&&(l=f),s=d(l,i),Util.copyDict(s,n),l):(n.thread=Compositor.ScrollThread.kScrollIgnored,n.reason="locally-scrollable-scroll-node-not-found",null)}function k(e,t){var r,n,o;return!!Compositor.Offset.isZero(e)||(r=u().getScrollOffset(t.getElementId()),n=u().calcProjectedScrollOffset(t,e),!Compositor.Offset.isEqual(r,n)&&(o=Compositor.Offset.subtract(n,r),!(Compositor.Offset.angleBetween(e,o)>=45)||(t.scrollsOuterViewport(),!1)))}function h(e,t){var r=e.getOverscrollBehavior();return!(0!==t.x&&r.x!==Compositor.OverscrollBehaviorType.kAuto||0!==t.y&&r.y!==Compositor.OverscrollBehaviorType.kAuto)}function S(e,t){for(var r=c.getOuterViewportScrollNode(),n=[];t;t=u().getNode(t.getParentId())){if(t===r){n.unshift(t);break}if(t.isScrollable()&&(k(e.getRemainingDelta(),t)&&n.unshift(t),!h(t,e.getRemainingDelta()))){n.length&&n[0]===t||n.unshift(t);break}}return n}function y(e){var r,n,i,a,k={},h=e.getPosition(),y=e.getTargetElementId(),v=c.getConfig().isScrollUnificationEnabled();if(Compositor.Offset.isZero(e.getRemainingDelta()),!(i=t.hitTest(Compositor.HitTest.kLayer,h)))return k.thread=Compositor.ScrollThread.kScrollIgnored,k.reason="no-layer-was-hit",k;if(function(e,r){var n=e.getEventType(),o=e.getPosition();return!!t.hasBlockingEventListener(n)&&!!r.getScrollNode().isUserScrollable()&&(!(!r.isTextureLayer()||!t.hitTest(Compositor.HitTest.kTouchActionRegion,o))||l>=Compositor.MainThreadScrollStrictness.kSevere||!!(l>=Compositor.MainThreadScrollStrictness.kHigh&&s.didHandlerPreventDefault(n)&&(t.hitTest(Compositor.HitTest.kWheelEventRegion,o)||t.hitTest(Compositor.HitTest.kTouchEventRegion,o))))}(e,i))return{thread:Compositor.ScrollThread.kScrollOnSurrogateMainThread,reason:"requires-main-thread-scrolling"};if(y){if(!(r=u().findNodeFromElementId(y)))return{thread:Compositor.ScrollThread.kScrollIgnored,reason:"no-scroll-node-for-id"}}else if(v){if(e.hasMainThreadHitTestedReasons())return{thread:Compositor.ScrollThread.kScrollIgnored,reason:"hit-test-bouncing"};if(!(a=function(e){var r,n,o=[],i={hit_test_successful:!1,scroll_node:null};return t.hitTestLayerTree(e,(function(e,t){return o.push(e),!!e.isScrollerOrScrollbar()&&(r=e,!0)})),o.forEach((function(t){var n;p(t,r)?(n=t.hitTestPoint(e),Sk.Region.containsPoint(t.getNonFastScrollableRects(),n)&&(i.main_thread_hit_test_reasons=Compositor.MainThreadScrollingReason.kNonFastScrollableRegion)):i.main_thread_hit_test_reasons=Compositor.MainThreadScrollingReason.kFailedHitTest})),i.main_thread_hit_test_reasons?i:(r&&r.isScrollbar()&&(r=t.getLayerTree().getLayerByElementId(r.getScrollElementId())),r?(n=u().getNode(r.getScrollTreeIndex()),i.scroll_node=f(n),i.hit_test_successful=!0,i):(i.hit_test_successful=!0,c.getInnerViewportScrollNode()&&(i.scroll_node=f(c.getInnerViewportScrollNode())),i))}(h)).hit_test_successful)return k.main_thread_hit_test_reasons=a.main_thread_hit_test_reasons,k;r=a.scroll_node}else{if(!(r=m(i,e,k))&&(t.hasEventListener(Compositor.EventType.kWheel)||t.hasEventListener(Compositor.EventType.kTouch))&&!t.isMainFrame())return{thread:Compositor.ScrollThread.kScrollOnSurrogateMainThread,reason:"has-wheel-or-touch-listener"};if(!g(k))return k}return(n=S(e,r)).length?(r=n[n.length-1],o=r.getElementId(),d(r,{})):{thread:Compositor.ScrollThread.kScrollIgnored,reason:"no-scroll-node-after-chain-resolution"}}function v(e){var t,r;return!!(t=u().findNodeFromElementId(n||o))&&(!!(r=n?[t]:S(e,t)).length&&(function(e,t){var r=u(),n=e.getRemainingDelta(),i=r.getScrollOffset(t.getElementId()),a=r.calcProjectedScrollOffset(t,n),s=Compositor.Offset.subtract(a,i);c.isNativeOVSLScrollingEnabled()&&t.scrollsOuterViewport()||r.scrollBy(t,s),e.consumeDelta(s),o=t.getElementId()}(e,r[r.length-1]),e.wasDeltaConsumed()&&n!==o&&(n=o),e.wasDeltaConsumed()))}function b(){n&&(n=null),o=null}function C(){var e;return!!n&&((e=u().findNodeFromElementId(n))&&e.scrollsOuterViewport())}s.getLth=function(){return t},s.wheelHandlerStateChanged=function(e){r.wheelHandlerStateChanged(e)},s.didHandlerPreventDefault=function(e){return r.didHandlerPreventDefault(e)},s.willScrollNatively=function(e,t){return y(new Compositor.ScrollState(e,t,Compositor.Offset.makeXY(0,0))).thread===Compositor.ScrollThread.kScrollOnLocalImplThread},s.didUpdateScrollOffset=function(e,r){var n=u(),o=n.findNodeFromElementId(e),i=t.getPropertyTrees().getTransformTree().getNode(o.getTransformId()),a=n.getScrollOffset(e),s=t.getLayerTree().getLayerByElementId(o.getElementId());i?(i.setScrollOffset(a),function(e,r){t.getLayerTree().setScrollbarGeometriesNeedUpdate(),t.getLayerTree().getScrollbarsFor(e).forEach((function(e){e.isLocallyPaintedScrollbarLayer()&&e.getScrollbarDelegate()?e.getScrollbarDelegate().setPosition(r):e.isCustomScrollbar()&&e.getCustomScrollbarHelper().setPosition(r)}))}(e,a),c.isNativeOVSLScrollingEnabled()&&s&&s.isOuterViewportScrollLayer()&&(Compositor.ScrollOrigin.kOriginProgrammatic,r===Compositor.ScrollOrigin.kOriginSurrogate&&s.scrollTo(a))):c.getConfig().isScrollUnificationEnabled()},s.scrollUpdate=v,s.doScroll=function(e,r){if(e===Compositor.GestureType.kScrollEnd)return r&&r.getEventType()===Compositor.EventType.kTouch&&i.thread===Compositor.ScrollThread.kScrollOnLocalJavaScriptThread?(r.getVelocity(),(a=new Compositor.ScrollAnimator(s,(function(){b(),i=null,a=null}))).start(r.getVelocity())):(b(),i=null),Compositor.ScrollAction.kNoAction;if(e===Compositor.GestureType.kScrollBegin)a&&(a.stop(),a=null),i&&r.isScrollbarInteraction()!==i.is_scrollbar_interaction&&(b(),i=null),(i=y(r)).is_scrollbar_interaction=r.isScrollbarInteraction(),r.hasRemainingDelta();else if(e===Compositor.GestureType.kScrollUpdate){if(!i)return Compositor.ScrollAction.kNoAction;i.thread===Compositor.ScrollThread.kScrollOnLocalJavaScriptThread&&(v(r)||t.isMainFrame()||r.isScrollbarInteraction()||(i.thread=Compositor.ScrollThread.kScrollIgnored))}return i.thread,i.reason,i.main_thread_hit_test_reasons?Compositor.ScrollAction.kRequiresMainThreadHitTest:i.thread===Compositor.ScrollThread.kScrollOnSurrogateMainThread?Compositor.ScrollAction.kForwardToSurrogate:i.thread===Compositor.ScrollThread.kScrollIgnored?t.isMainFrame()?Compositor.ScrollAction.kForwardToSurrogate:Compositor.ScrollAction.kForwardToNextFrame:c.isNativeOVSLScrollingEnabled()?i.thread===Compositor.ScrollThread.kScrollOnLocalImplThread||C()?Compositor.ScrollAction.kAllowNativeScroll:n?(C(),n&&(i.thread,Compositor.ScrollThread.kScrollOnLocalImplThread),Compositor.ScrollAction.kPreventNativeScroll):BrowserDetect.isMobileSafari()?Compositor.ScrollAction.kAllowNativeScroll:Compositor.ScrollAction.kPreventNativeScroll:Compositor.ScrollAction.kPreventNativeScroll},s.onPointerEventScrollResult=function(e,t){var r,n,o;return t&&(t.type,Compositor.PointerResultType.kScrollbarScroll),r=t.phase,o=t.scroll_delta||Compositor.Offset.makeZero(),r!==Compositor.GestureType.kScrollBegin||Compositor.Offset.isZero(o)||((n=new Compositor.ScrollState(Compositor.EventType.kWheel,Compositor.Offset.makeXY(e.x,e.y),Compositor.Offset.makeZero())).setIsScrollbarInteraction(),n.setTargetElementId(t.target_scroller),s.doScroll(Compositor.GestureType.kScrollBegin,n),r=Compositor.GestureType.kScrollUpdate),(n=new Compositor.ScrollState(Compositor.EventType.kWheel,Compositor.Offset.makeXY(e.x,e.y),o)).setIsScrollbarInteraction(),n.setTargetElementId(t.target_scroller),s.doScroll(r,n)},s.stopScrollAnimation=function(){a&&(a.stop(),a=null)},s.release=function(){s.stopScrollAnimation(),r&&(r.release(),r=null)},r=new Compositor.PreventDefaultObserver(e,t),c.getConfig().getPreferScrollingCorrectness()&&(l=Compositor.MainThreadScrollStrictness.kSevere)},Compositor.VisualViewportDelegate=function(e,t){"use strict";var r,n,o=t.getMainFrame(),i=new Compositor.ManagedListeners,a=!0,s=Util.getScreenOrientationType();function l(){var e=MetricsUtils.getVisualViewportMetrics();return{scroll_off:Compositor.Offset.makeXY(e.x,e.y),scale:MetricsUtils.getVisualViewportScale()}}function c(e){var r=t.getInnerViewportScrollNode();r&&(o.setActiveTreePageScaleFactor(e.scale),o.getPropertyTrees().getScrollTree().setScrollOffset(r.getElementId(),e.scroll_off,Compositor.ScrollOrigin.kOriginScrollEvent))}function u(){var r,n=e.getLayoutViewport(),o=t.getOuterViewportScrollNode();BrowserDetect.isMobile()&&(n.width!==o.getContainerBounds().width||MetricsUtils.maybeSplitView()?n.width=o.getContainerBounds().width:n.width="device-width",r=t.getMainFrame().getLayerTree().getPageScaleFactorLimits(),Util.isDictEmpty(r),BrowserDetect.isMobileSafariOnIPhone()||BrowserDetect.isAndroidChrome()?(n.initial_scale=r.current,n.minimum_scale=r.min,n.maximum_scale=r.max):(void 0!==r.min&&(n.minimum_scale=Math.round(100*r.min)/100),void 0!==r.max&&(n.maximum_scale=Math.round(100*r.max)/100)),e.setLayoutViewport(n))}function d(){var n,o;!a&&(n=e.getLayoutViewport(),!(o=t.getOuterViewportScrollNode())||n.width===o.getContainerBounds().width||MetricsUtils.maybeSplitView()&&"number"==typeof n.width&&Math.abs(n.width-o.getContainerBounds().width)<5)||(t.getInnerViewportScrollNode(),u(),c(r),a=!1)}function f(){a?t.getInnerViewportScrollNode():(t.getInnerViewportScrollNode(),u())}function p(){var e=l();r&&Compositor.Offset.isEqual(e.scroll_off,r.scroll_off)&&e.scale===r.scale||(c(e),r=e)}function g(){var e,r,n=Util.getScreenOrientationType();s!==n&&((r=t.getOuterViewportScrollNode())&&(e=o.getPropertyTrees().getScrollTree().getScrollOffset(r.getElementId()),window.scrollTo(e.x,e.y)),s=n)}this.asDict=function(){return{}},this.release=function(){i&&(i.release(),i=null)},n=Util.getVisualViewport(),BrowserDetect.isMobileSafari()&&i.add([[window,"resize",g,!1]]),n?i.add([[n,"resize",p],[n,"scroll",p]]):BrowserDetect.isMobileSafari()&&i.add([[window,"scroll",p,!1]]),t.callback.register("did-activate-tree",d),t.callback.register("did-surrogate-change-page-scale",f),r=l()},Compositor.TileManager=function(){"use strict";var e=this,t=new Compositor.Set((function(e){return e.fid+":"+e.lid+":"+e.key})),r=new Compositor.Set((function(e){return e.getLayer().getLayerTreeHost().getFid()+":"+e.getLayer().getID()})),n={},o=0;function i(e){return e.fid+":"+e.lid+e.key}e.allocTilingSet=function(e){var t=new Compositor.TilingSet(e);return r.has(t),r.add(t),t},e.freeTilingSet=function(e){r.remove(e),e.release()},e.forEachTilingSet=function(e){r.forEachItem(e)},e.forEachTile=function(e){t.forEachItem(e)},e.addTile=function(e){t.add(e),e.type===Compositor.TileType.kCanvas&&(n[e.rsf]||(n[e.rsf]={}),n[e.rsf][i(e)]=e),o+=e.mem_size},e.removeTile=function(e){e.type===Compositor.TileType.kCanvas&&delete n[e.rsf][i(e)],t.remove(e),o-=e.mem_size},e.asDict=function(){return{mem_size:o,tiles:t.asDict(),tiles_by_rsf:n}}},Compositor.RemoteInputTracker=function(e,t){"use strict";var r={};function n(e,t){r[e]||(r[e]={}),r[e][t]||(r[e][t]={value:null,caret_pos:null})}function o(e,o,i){n(e,o),r[e][o].value=i,t.callback.fire("input-value-changed",e,o,i)}function i(e,o,i){JSON.stringify(i),n(e,o),r[e][o].caret_pos=i,t.callback.fire("input-caret-changed",e,o,i)}function a(e,o,i){var a;for(JSON.stringify(o),JSON.stringify(i),a=0;a<o.length;a+=1)r[e]&&delete r[e][o[a]];Util.forEachItem(i,(function(o,i){n(e,o),r[e][o].value=i,t.callback.fire("input-value-changed",e,o,i)}))}this.getState=function(e,t){return r[e]?r[e][t]:null},this.asDict=function(){return r},e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_INPUT_VALUE,o),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_CARET_POS,i),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_INPUTS_UPDATE,a),e.interp.hasOpcodeHandler(e.interp.OPCODES.REMOTING_V2_SET_SELECTIONS)||e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_SET_SELECTIONS,(function(){}))},Compositor.ShadowAnchorNode=function(){"use strict";var e,t=this,r=!1;t.rewriteUntrustedUrl=function(e){return e=e.trim(),Util.startsWithAnyOf(e,["http:","https:"])?Util.rewriteRawHref(e):(safeview.pairing_dict&&safeview.pairing_dict.client_caps&&safeview.pairing_dict.client_caps.applicationLinks&&(r=Util.startsWithAnyOf(e,safeview.pairing_dict.client_caps.applicationLinks)),r?e:"about:blank#blocked")},t.onPointerEventsStatusChanged=function(t){e.style.pointerEvents=t?"none":"auto"},t.getType=function(){return Sk.SE.Type.kShadowAnchorNode},t.update=function(r){var n=r[0].data.link_url,o=t.rewriteUntrustedUrl(n);e.setAttribute("href",o)},t.updateProjection=function(t,r){var n,o=Sk.Rect.makeEmpty();for(n=0;n<r.length;n+=1)Sk.Rect.join(o,r[n].canvas_bounds);Sk.Rect.toCSSStyle(o,e.style),t.applyDrawTransform(e,o)},t.release=function(){e.parentNode,e=null},t.getNode=function(){return e},t.processPointerEvent=function(t){var n,o=t.active_event;return"touchend"===o.type&&r?(e.click(),o.preventDefault(),o.stopPropagation(),!1):"click"!==o.type&&"mousedown"!==o.type&&"mouseup"!==o.type||((n=function(e){if(e.button,e.button!==Compositor.MouseButton.kLeftButton)return!0;if(BrowserDetect.isMac()){if(e.ctrlKey)return!0;if(e.metaKey)return!0}return!1}(o))||"click"!==o.type||o.preventDefault(),!n)},t.init=function(t){var r;(r=document.createElement("a")).style.position="absolute",r.style.display="block",r.style.backgroundColor="transparent",r.style.color="transparent",e=r}},Compositor.ShadowElementManager=function(e){"use strict";var t,r,n,o,i,a=this,s=new Logger("sem",{level:"info"}),l=!1,c={},u={},d={},f={},p={},g={},m=0,k=0,h={};function S(t){var r,n,o=u[t];if(o&&(function(e){var t,r,n;e.getFid&&(t=e.getFid(),h.hasOwnProperty(t)&&(n=h[t],r=0,n.forEach((function(t){t.getNodeUid()!==e.getNodeUid()&&(r+=1)})),r!==n.length&&n.splice(r,1),0===n.length&&delete h[t]))}(o),r=o.getNode(),o.focus_fn&&EventListener.setListenersEnabled(!1,r,["focus"],o.focus_fn),o.blur_fn&&EventListener.setListenersEnabled(!1,r,["blur"],o.blur_fn),r.parentNode.removeChild(r),e.callback.fire("removed-shadow-element",t,o.layer),o.release(),o.items=null,o.layer=null,delete u[t],o.layer&&o.layer.getLayerTreeHost())){if(n=o.layer.getLayerTreeHost().getFrameSinkId(),!d.hasOwnProperty(n))return;delete d[n][t]}}function y(e){u[e]&&(l?S(e):c.hasOwnProperty(e)||(c[e]=Date.now(),n||(n=setInterval((function(){if(Util.isDictEmpty(c))return clearInterval(n),void(n=null);Util.forEachItem(c,(function(e,t){Date.now()-t<1e3||(delete c[e],S(e))}))}),200))))}function v(e){var t=e.getFid();e.setForceReadOnly&&g.hasOwnProperty(t)&&e.setForceReadOnly(!!g[t].is_readonly)}function b(e){var t=e.getFid(),r=e.getNodeId();g.hasOwnProperty(t)&&g[t].is_readonly&&g[t].has_exception&&safeview.surrogate_channel.send("mi-query-ro-exception",Number(t),String(r))}function C(e){return e.data.type===Sk.HT.ElementType.kFormControl}function _(t,r,n){var o=r[0];return C(o)?function(t,r,n){var o=t.data.node_id,i=t.data.node_uid,a=t.data.formctrl,s=null;switch(a.type,a.type){case Sk.HT.FormControlElement.Type.kInput:case Sk.HT.FormControlElement.Type.kTextArea:case Sk.HT.FormControlElement.Type.kContentEditable:s=new Compositor.ShadowTextControl(Number(n),Number(o),String(i),e.getRemoteInputTracker().getState(n,o));break;case Sk.HT.FormControlElement.Type.kSelect:s=new Compositor.ShadowSelect(Number(n),Number(o),String(i));break;default:return null}return g.hasOwnProperty(n)?(v(s),b(s),s):(h.hasOwnProperty(n)||(h[n]=[]),h[n].push(s),s)}(o,0,e.getFrameTreeNodeId(o.data.frame_token)):o.data.flags&Sk.HT.ElementFlags.kHasLink&&p.hasOwnProperty(o.data.node_uid)?function(e){return window.TPROXY_ENABLED||g.hasOwnProperty(e)&&!g[e].is_readonly}(e.getFrameTreeNodeId(o.data.frame_token))?new Compositor.ShadowAnchorNode:null:function(e){return!(e.data.type!==Sk.HT.ElementType.kTextNode||e.data.flags&Sk.HT.ElementFlags.kInShadowTree||e.data.flags&Sk.HT.ElementFlags.kHasContentEditableOwner)}(o)&&p.hasOwnProperty(o.data.node_uid)?new Compositor.ShadowTextNode(e):function(e){return e.data.type===Sk.HT.ElementType.kImageElement}(o)&&p.hasOwnProperty(o.data.node_uid)?new Compositor.ShadowImageNode:null}function T(e){return e[0].data.type===Sk.HT.ElementType.kFormControl}function w(e,t,r,n){e.getNode().parentNode&&e.layer&&e.items&&e.layer===r&&function(e,t){var r={};return e.length===t.length&&(e.forEach((function(e){var t=Compositor.ItemListConcatenator.itemToKey(e);r[t]=e})),t.every((function(e){var t,n=Compositor.ItemListConcatenator.itemToKey(e);return!!r.hasOwnProperty(n)&&(t=r[n],e.data.display_item_type===Sk.HT.DisplayItemType.kOther&&t.blobs.length===e.blobs.length&&t.data.text===e.data.text||(e.stringified||(e.stringified=JSON.stringify(e)),!(!t.stringified||t.stringified!==e.stringified)))})))}(e.items,t)||(e.getType()!==Sk.SE.Type.kShadowTextControl||M(t)?(e.items=t,e.layer=r,e.update(t)):e.update(t))}function R(t,r,n){r?t.onFocusEvent&&t.onFocusEvent(n):t.onBlurEvent&&t.onBlurEvent(n),e.callback.fire("shadow-element-focus-change",t.node_uid,t.layer,r)}function x(t,r,n){var o=u[t],i=n.getLayerTreeHost().getFrameSinkId();if(function(e){c.hasOwnProperty(e)&&delete c[e]}(t),!o){if(!(o=_(0,r)))return null;u[t]=o,d[i]||(d[i]={}),d[i][t]=1,o.node_uid=t,o.items=r,o.layer=n,o.init(r),o.getNode()&&o.getNode().parentNode,e.isDebugEnabled()&&(o.getNode().setAttribute("nuid",t),o.getNode().setAttribute("lid",n.getID()),o.getNode().setAttribute("item_count",r.length),r[0].data.debug_name&&o.getNode().setAttribute("debug",r[0].data.debug_name),o.getNode().setAttribute("blob_count",r[0].blobs.length)),(o.onBlurEvent||o.onFocusEvent)&&(o.focus_fn=R.curry(o,!0),o.blur_fn=R.curry(o,!1),EventListener.setListenersEnabled(!0,o.getNode(),["focus"],o.focus_fn),EventListener.setListenersEnabled(!0,o.getNode(),["blur"],o.blur_fn)),f.hasOwnProperty(i)&&o.onPointerEventsStatusChanged&&o.onPointerEventsStatusChanged(f[i])}return o.getNode(),w(o,r,n),o}function D(r,n,o){var i,s,l,c,d=r.getDisplayList(),f=null,g=null;d&&((s=n?r.fromScreenSpaceRect(n):r.getBoundsRect())&&(f=r.getDisplayList().hitTestRect(s))&&f.getItemList().length&&(l=f.getItemList(),c=null,l.forEach((function(e){2===e.data.type&&(c&&(m=Math.max(m,Math.abs(Sk.Rect.getX(e.visual_rect)-Sk.Rect.getX(c.visual_rect))),k=Math.max(k,Math.abs(Sk.Rect.getY(e.visual_rect)-Sk.Rect.getY(c.visual_rect)))),c=e)})),i=f.getItemMap(),Util.forEachItem(u,(function(e,t){t.layer===r&&(i.has(e)&&Sk.Rect.intersects(t.items[0].visual_rect,s)||y(e))})),i.forEachEntryInOrder((function(n,i){if(Sk.Rect.intersects(i[0].visual_rect,s)){o&&(p[n]=!0);var a=x(n,i,r);a&&(!function(r,n){var o=null;T(r.items)?r.getNode().parentNode!==t&&t.appendChild(r.getNode()):r.getNode().parentNode!==r.layer.getElementsDiv()&&(o=n&&n.getNode().parentNode===r.layer.getElementsDiv()?n.getNode().nextSibling:r.layer.getElementsDiv().childNodes[0],r.layer.getElementsDiv().insertBefore(r.getNode(),o),e.callback.fire("added-shadow-element",r.node_uid,r.layer))}(a,g),g=a)}})),a.didUpdateProjection(r,s),a.didUpdateOpacity(r)))}function M(e){var t;for(t=0;t<e.length;t+=1)if(e[t].data.display_item_type===Sk.HT.DisplayItemType.kBoxDecorationBackground)return e[t];return null}function F(t,r,n){var o=e.getFrameToken(t),i=Sk.Util.getNodeKey(o,r),a=u[i];a&&a.setValue(n)}function E(t,r,n){var o=e.getFrameToken(t),i=Sk.Util.getNodeKey(o,r),a=u[i];a&&a.setCaretPos(n)}function I(e,t){f[e]=t,d.hasOwnProperty(e)&&Util.forEachItem(d[e],(function(e,r){var n=u[e];n&&n.onPointerEventsStatusChanged&&n.onPointerEventsStatusChanged(t)}))}function P(t,r,n){var o=e.getFrameToken(t),i=Sk.Util.getNodeKey(o,r),s=a.findElement(i);s&&s.setForceReadOnly&&(s.setForceReadOnly(!n),s.isFocused&&s.isFocused()&&s.getNode()&&(BrowserDetect.isMobileSafari()?s.getNode().blur():s.getNode().focus()))}function L(e,t,r,n,o){g.hasOwnProperty(e)&&r!==g[e].is_readonly&&a.forEachShadowElement((function(t,n){n.setForceReadOnly&&n.getFid&&n.getFid()===e&&n.setForceReadOnly(r)})),g[e]={},g[e].is_readonly=r,g[e].has_exception=o,safeview.callback.fire("enable_readonly_bar",r,n),h.hasOwnProperty(e)&&(h[e].forEach((function(e){v(e),b(e)})),delete h[e])}a.deleteShadowElement=function(e){e.getNodeUid&&S(e.getNodeUid())},a.setNoPendingRemoval=function(e){l=e},a.getMaxSelectionChangeDelta=function(){return{x:m,y:k}},a.didUpdateDisplayList=function(e){D(e)},a.didRemoveLayer=function(e){Util.forEachItem(u,(function(t,r){r.layer===e&&y(t)}))},a.hitUnlockAll=function(e){p={},Util.forEachItem(u,(function(t,r){C(r.items[0])||(e&&t===e||S(t))}))},a.hitLock=function(e,t){var r=a.findElement(e);return p[e]=!0,r||(D(t),r=a.findElement(e)),r},a.hitUnlock=function(e){p.hasOwnProperty(e)&&delete p[e]},a.hitLockAllTextNodes=function(t){var r=e.getMainFrame().getLayerTree();t&&r&&r.getRoot()&&r.getRoot().walkDepthFirstIterative((function(e){D(e,t,!0)}))},a.findElement=function(e){return e?u[e]:null},a.forEachShadowElement=function(e){Util.forEachItem(u,e)},a.didUpdateProjection=function(e,t){void 0===t&&(t=e.getBoundsRect()),Util.forEachItem(u,(function(r,n){var o,i,a;n.layer!==e||void 0!==t&&!Sk.Rect.intersects(n.items[0].visual_rect,t)||(n.updateProjection?n.updateProjection(n.layer,n.items):(i=M(n.items))?(n.items,o=n.getNode(),a=i.border_box_rect||i.visual_rect,"textarea"===o.type&&n.getType()===Sk.SE.Type.kShadowTextControl&&(a=n.calcCompositedBoxRect(a)),T(n.items)&&(n.layer.isFixedToViewport()?o.style.position="fixed":o.style.position="absolute"),Sk.Rect.toCSSStyle(a,o.style),n.layer.applyDrawTransform(o,a)):s.error({event:"missing-box-item",se_type:n.getType(),se_node:n.getNode()}))}))},a.didUpdateOpacity=function(e){Util.forEachItem(u,(function(t,r){r.layer===e&&(r.updateOpacity?r.updateOpacity(r.layer,r.items):r.layer.applyDrawOpacity(r.getNode()))}))},a.registerUserInitiatedFocusIfNeeded=function(e){var t=e.touches[0].start_pos;return!a.findElement(e.hit_node_uid)&&(r.style.left=t.x+"px",r.style.top=t.y+"px",r.focus(),!0)},a.transferFocusTo=function(e){var t=a.findElement(e);t&&t.getType()===Sk.SE.Type.kShadowTextControl&&t.getNode().focus(),r.style.left="-1000px",r.style.top="-1000px"},a.unregisterSurface=function(e){delete f[e]},a.release=function(){e.callback.deregister("input-value-changed",F),e.callback.deregister("input-caret-changed",E),e.callback.deregister("pointer-events-status-changed",I),t&&t.parentNode&&(t.parentNode.removeChild(t),t=null)},e.callback.register("input-value-changed",F),e.callback.register("input-caret-changed",E),e.callback.register("pointer-events-status-changed",I),safeview.interp.registerOpcodeHandler(safeview.interp.OPCODES.REMOTING_V2_SET_READONLY_EXCEPTION,P),safeview.interp.deregisterOpcodeHandler(safeview.interp.OPCODES.READONLY_STATUS_CHANGED),safeview.interp.registerOpcodeHandler(safeview.interp.OPCODES.READONLY_STATUS_CHANGED,L),safeview.interp.registerOpcodeHandler("datetime-chooser",(function(){})),o=document.createElement("div"),e.isDebugEnabled()&&(o.id="sv-shadow-elements"),o.position="absolute",o.style.margin="0px",o.style.padding="0px",o.style.left=o.style.top="0px",o.style.width=o.style.height="0px",o.style.overflow="visible",t=o,r=BrowserDetect.isMobileSafari()?((i=document.createElement("input")).setAttribute("type","text"),i.setAttribute("readonly","1"),i.setAttribute("class","sv-focus-placeholder"),e.isDebugEnabled()&&(i.id="sv-focus-placeholder"),i.style.position="absolute",i.style.caretColor="transparent",i.style.opacity="0",i.style.height="0px",i.style.width="0px",i.style.left="-1000px",i.style.top="-1000px",i.style.fontSize="20px",i.style.margin="0px",i.style.padding="0px",i.style.borderRadius="0px",i.style.webkitAppearance="none",i.style.outline="none",i.style.borderColor="rgba(0,0,0,0)",i.style.backgroundColor="rgba(0,0,0,0)",i.style.userSelect="auto",i.style.webkitUserSelect="auto",t.appendChild(i),i):null,document.body.appendChild(t)},Compositor.ShadowImageNode=function(){"use strict";var e,t=this;t.onPointerEventsStatusChanged=function(t){e.style.pointerEvents=t?"none":"auto"},t.getType=function(){return Sk.SE.Type.kShadowImageNode},t.release=function(){e=null},t.update=function(t){var r=t[0].image_src;r!==e.src&&e.setAttribute("src",r)},t.updateProjection=function(t,r){var n,o=Sk.Rect.makeEmpty();for(n=0;n<r.length;n+=1)Sk.Rect.join(o,r[n].canvas_bounds);Sk.Rect.toCSSStyle(o,e.style),t.applyDrawTransform(e,o)},t.getNode=function(){return e},t.updateOpacity=function(e,t){},t.init=function(t){var r=t[0];r.data.type,Sk.HT.ElementType.kImageElement,e=function(e){var t=new Image;return t.setAttribute("src",e.image_src),t.style.position="absolute",t.style.opacity="0",t.style.margin=t.style.padding="0px",t}(r)}},Compositor.ShadowSelect=function(e,t,r){"use strict";var n,o=this,i=new Logger("shadow-select",{level:"info"}),a=!1,s=!1;function l(r){var n=r.target.value;safeview.sendCommand(["CM-select",e,t,Number(n)])}o.onPointerEventsStatusChanged=function(e){n.style.pointerEvents=e?"none":"auto"},o.getType=function(){return Sk.SE.Type.kShadowSelect},o.release=function(){EventListener.setListenersEnabled(!1,n,["change"],l),n=null},o.update=function(e){var t=e[0].data.formctrl.flags;s=!!(t&Sk.HT.FormControlElement.Flags.kDisabled),a||s?n.setAttribute("disabled","1"):n.removeAttribute("disabled"),Compositor.FormCtrlUtils.setAutoFillAttrs(n,e[0].data.formctrl)},o.getNode=function(){return n},o.setForceReadOnly=function(e){a=e,n&&(a||s?n.setAttribute("disabled","1"):n.removeAttribute("disabled"))},o.getFid=function(){return e},o.getNodeId=function(){return t},o.getNodeUid=function(){return r},o.updateOpacity=function(e,t){},o.init=function(e){var t,r,o,a,s=e[0].data.formctrl;t=s.select.items,(r=document.createElement("select")).setAttribute("sv-prevent-push",!0),r.style.position="absolute",r.style.opacity="0",r.style.margin=r.style.padding="0px",r.style.cursor="inherit",r.style.fontSize="20px",r.style.width=r.style.height="0px",BrowserDetect.isSafari()&&(r.style.webkitAppearance="none"),a=null,t.forEach((function(e){switch(e.type){case Sk.HT.SelectItem.Type.kSeparator:(o=document.createElement("option")).textContent="-----",o.setAttribute("disabled",!0),r.appendChild(o),a=null;break;case Sk.HT.SelectItem.Type.kGroup:(o=document.createElement("optgroup")).setAttribute("label",e.label),r.appendChild(o),a=o;break;case Sk.HT.SelectItem.Type.kOption:(o=document.createElement("option")).textContent=e.label,o.setAttribute("value",e.index),e.flags&Sk.HT.SelectItem.Flags.kChecked&&o.setAttribute("selected",!0),e.flags&Sk.HT.SelectItem.Flags.kEnabled||o.setAttribute("disabled",!0),e.flags&Sk.HT.SelectItem.Flags.kHidden&&(o.setAttribute("hidden",!0),o.style.display="none",o.style.visibility="hidden"),e.flags&Sk.HT.SelectItem.Flags.kInGroup?a.appendChild(o):(a=null,r.appendChild(o));break;default:i.error({event:"tc-unrecognized-select-item-type",type:e.type})}})),EventListener.setListenersEnabled(!0,r,["change"],l),n=r}},Compositor.FormCtrlUtils=function(){"use strict";var e={};function t(e,t){var r;if(e.input){switch(e.input.type){case Sk.HT.InputElement.Type.kNumber:r="number";break;case Sk.HT.InputElement.Type.kEmail:r="email";break;case Sk.HT.InputElement.Type.kPassword:r="password";break;case Sk.HT.InputElement.Type.kSearch:r="search";break;case Sk.HT.InputElement.Type.kTel:r="tel";break;case Sk.HT.InputElement.Type.kDate:r="date";break;case Sk.HT.InputElement.Type.kDatetimeLocal:r="datetime-local";break;case Sk.HT.InputElement.Type.kMonth:r="month";break;case Sk.HT.InputElement.Type.kTime:r="time";break;case Sk.HT.InputElement.Type.kWeek:r="week";break;case Sk.HT.InputElement.Type.kColor:r="color";break;default:r="text"}t.setAttribute("type",r)}}return e.setAutoFillAttrs=function(e,r){if(window.TPROXY_ENABLED)r.id_attr&&e.setAttribute("id",r.id_attr),r.name_attr&&e.setAttribute("name",r.name_attr),r.autocomplete_attr&&e.setAttribute("autocomplete",r.autocomplete_attr),t(r,e);else{if(e.setAttribute("autocomplete","off"),!r.input)return;r.input.type===Sk.HT.InputElement.Type.kPassword?(e.setAttribute("type","url"),BrowserDetect.isChrome()&&(e.style.caretColor=Sk.Paint.skColorToCSSColor(r.color)),e.style.fontFamily="Menlo-Password"):r.input.type!==Sk.HT.InputElement.Type.kEmail&&t(r,e)}},e.populateBaseTemporalProperties=function(e,t){var r=t.input;window.Date&&r&&r.flags&Sk.HT.InputElement.Flags.kIsBaseTemporal&&(e.setAttribute("sv-base-temporal",0),["min","max"].forEach((function(t){var n,o=r[t];o&&!isNaN(o)&&(n=new Date(o),e.setAttribute(t,n.toISOString().slice(0,16)))})),function(e,t){var r,n,o=e.input,i=o.value;switch(o.flags,Sk.HT.InputElement.Flags.kIsBaseTemporal,r=isNaN(i)?new Date:new Date(i),o.type){case Sk.HT.InputElement.Type.kDate:n=r.toISOString().slice(0,10);break;case Sk.HT.InputElement.Type.kDatetimeLocal:n=r.toISOString().slice(0,16);break;case Sk.HT.InputElement.Type.kMonth:n=r.toISOString().slice(0,7);break;case Sk.HT.InputElement.Type.kTime:n=r.toTimeString().slice(0,5);break;case Sk.HT.InputElement.Type.kWeek:n=r.toISOString().slice(0,16);break;default:n=""}t.setAttribute("value",n)}(t,e))},e}(),Compositor.ShadowTextControl=function(e,t,r,n){"use strict";var o,i,a,s=this,l=!1,c=!1,u=!1,d=!1,f=!1;function p(){return a.type===Sk.HT.FormControlElement.Type.kContentEditable}function g(){return a.type===Sk.HT.FormControlElement.Type.kInput}function m(){return g()&&a.input.type===Sk.HT.InputElement.Type.kColor}function k(){return o.hasAttribute("sv-base-temporal")}function h(){return g()}function S(r){safeview.sendCommand([r,e,t,o.value])}function y(){var e;return!!g()||(!!a.enterkeyhint_attr||a.type===Sk.HT.FormControlElement.Type.kTextArea&&(1===(e=a.textarea).rows&&e.flags&Sk.HT.TextAreaElement.Flags.kHasFormOwner&&BrowserDetect.isMobileSafari()&&!BrowserDetect.isMobileSafariOnIPhone()))}function v(e){return BrowserDetect.isMobile()&&!k()?Math.max(16,e):e}function b(){o.style.color=l?Sk.Paint.skColorToCSSColor(a.color):"rgba(0,0,0,0)",Compositor.FormCtrlUtils.setAutoFillAttrs(o,a)}function C(e){h()&&l!==e&&(l=e,e?Sk.focusedElementInfoByNodeId[r]={type:o.getAttribute("type")}:delete Sk.focusedElementInfoByNodeId[r],b(),s.layer&&s.layer.getTilingSet()&&s.layer.getTilingSet().invalidateRect(s.layer.getBoundsRect()))}s.getType=function(){return Sk.SE.Type.kShadowTextControl},s.calcCompositedBoxRect=function(e){var t=Sk.Rect.makeCopy(s.layer.getClipNode().getClipRect()),r=s.layer.getTransformNode().getScrollOffset();return Sk.Rect.translate(t,r.x,r.y),Sk.Rect.intersection(e,t)},s.setValue=function(e){o.value!==e&&(o.value=e)},s.setCaretPos=function(e){try{o.selectionStart=e.start,o.selectionEnd=e.end}catch(e){o.getAttribute("type")}},s.processPointerEvent=function(e){return p()&&(o.value=""),!(h()&&c)},s.processInputEvent=function(r){switch(r.type,r.data,o.value,o.selectionStart,r.target,r.target.localName,r.target.id,r.target.getAttribute&&r.target.getAttribute("nid"),r.type){case"beforeinput":i=o.value;break;case"input":p()?function(){var r,n,a,s=0;if((r=o.value)!==i){for(;s<r.length&&s<i.length&&r[s]===i[s];)s+=1;for(n=i.length-s,a=r.substring(s),s=0;s<n;s+=1)safeview.sendCommand(["kbd",safeview.fid||0,0,"keydown",8,8,"Backspace","Backspace",!1,!1,!1,!1]),safeview.sendCommand(["kbd",safeview.fid||0,0,"keyup",8,8,"Backspace","Backspace",!1,!1,!1,!1]);safeview.sendCommand(["mi-editable",e,t,n,a,f])}}():k()?safeview.sendCommand(["input",e,t,o.value]):m()?S(r.type):(null===o.selectionStart?(o.getAttribute("type"),n=a=-1):(n=o.selectionStart,a=o.selectionEnd),safeview.sendCommand(["mi-simpleinput",e,t,o.value,n,a,f]));break;case"change":m()&&S(r.type);break;case"keydown":case"keyup":!function(t){var r=new KeyMap;"Enter"===t.key&&y()?safeview.sendCommand(["kbd",e||0,0,t.type,13,13,t.key,r.getCode(t),!1,!1,!1,!1]):("Backspace"===t.key&&p()&&""===o.value&&safeview.sendCommand(["kbd",e,0,t.type,8,8,t.key,r.getCode(t),!1,!1,!1,!1]),f=!("keyup"===t.type))}(r)}var n,a},s.update=function(e){var t,r,n,i,l;r=!!((t=(a=e[0].data.formctrl).flags)&Sk.HT.FormControlElement.Flags.kDisabled),d=!!(t&Sk.HT.FormControlElement.Flags.kReadOnly),n=u||d,i=!!(t&Sk.HT.FormControlElement.Flags.kAutoCapitalize),l=!!(t&Sk.HT.FormControlElement.Flags.kHasEnterKeyHint),Sk.Font.applyFontStyle(o,a,v(a.font_size),v(a.font_size),a.typeface_id,s.layer.getLayerTreeHost().getFid()),b(),o.style.padding="0px",o.style.paddingLeft=a.padding_left+"px",o.style.paddingTop=a.padding_top+"px",o.style.paddingRight=a.padding_right+"px",o.style.paddingBottom=a.padding_bottom+"px",o.style.borderLeftWidth=a.border_width_left+"px",o.style.borderTopWidth=a.border_width_top+"px",o.style.borderRightWidth=a.border_width_right+"px",o.style.borderBottomWidth=a.border_width_bottom+"px",o.style.textIndent=a.text_indent+"px",a.flags&Sk.HT.FormControlElement.Flags.kRightToLeft&&(o.style.direction="rtl"),o.style.boxSizing="border-box",r?o.setAttribute("disabled","1"):o.removeAttribute("disabled"),n?o.setAttribute("readonly","1"):o.removeAttribute("readonly"),i?o.setAttribute("autocapitalize","on"):o.removeAttribute("autocapitalize"),l?o.setAttribute("enterkeyhint",a.enterkeyhint_attr):o.removeAttribute("enterkeyhint"),o.setAttribute("spellcheck","false"),o.setAttribute("custom_formctrl_flags",t),Compositor.FormCtrlUtils.setAutoFillAttrs(o,a),Compositor.FormCtrlUtils.populateBaseTemporalProperties(o,a),m()&&o.setAttribute("value",Sk.Paint.skColorToHexadecimalColor(a.input.color))},s.onFocusEvent=function(e){C(!0),o.focus(),c=!0},s.onBlurEvent=function(e){C(!1),p()&&(o.value=""),c=!1},s.release=function(){C(!1),o=null,p()||null===e||safeview.sendCommand(["mi-unregister",e,t])},s.onPointerEventsStatusChanged=function(e){o.style.pointerEvents=e?"none":"auto"},s.getNode=function(){return o},s.showRemoteCaret=function(){return!h()},s.isFocused=function(){return c},s.setForceReadOnly=function(e){u=e,o&&(u||d?o.setAttribute("readonly","1"):o.removeAttribute("readonly"))},s.getFid=function(){return e},s.getNodeId=function(){return t},s.getNodeUid=function(){return r},s.updateOpacity=function(e,t){h()&&e.applyDrawOpacity(o)},s.init=function(r){(function(e){e.input?o=document.createElement("input"):(e.textarea||e.contenteditable)&&(o=document.createElement("textarea")),o.style.position="absolute",h()||(o.style.caretColor="transparent",o.style.opacity="0"),o.style.left=o.style.top="0px",o.style.width=o.style.height="0px",o.style.fontSize="20px",o.style.margin=o.style.padding="0px",o.style.borderRadius="0px",o.style.webkitAppearance="none",o.style.outline="none",o.style.borderColor="rgba(0,0,0,0)",o.style.backgroundColor="rgba(0,0,0,0)",o.style.userSelect="auto",o.style.webkitUserSelect="auto",o.setAttribute("sv-prevent-push",!0)})(a=r[0].data.formctrl),n&&(n.value&&s.setValue(n.value),n.caret_pos&&s.setCaretPos(n.caret_pos)),p()||safeview.sendCommand(["mi-register",e,t])}},Compositor.ShadowTextNode=function(e){"use strict";var t,r=this,n=new Logger("stn",{level:"info"});function o(e,t){var r=document.createElement("span");return r.textContent=e,r.style.padding="0px",r.style.margin="0px",r.style.fontSize=t+"px",r.style.userSelect="text",r.style.webkitUserSelect="text",BrowserDetect.isMobileSafari()||(r.style.display="inline-block",r.style.verticalAlign="text-bottom"," "===e&&(r.innerHTML="&nbsp")),r}function i(e,t){for(var r=0;t<e.length&&""===e[t].trim();)t+=1,r+=1;return r}function a(e,t,r){for(var n=Math.ceil(r/t);t>1;)e.appendChild(o(" ",n)),r-=n,t-=1;e.appendChild(o(" ",r))}function s(e){(new Sk.TextBlobIterator).forEachRun(e.blob,null,(function(t,r,n){var o=r.paint.textSize/Sk.Paint.kCanonicalTextSizeForPaths;!function(e,t,r,n,o){var i=r,a=r,s=n,l=n;e.forEachGlyph(t,r,n,(function(e,t,r){var n=Sk.Rect.roundOut0(Sk.Rect.scale(e.bounds,o)),c=Math.floor(t)+Sk.Rect.getX(n),u=Math.floor(r)+Sk.Rect.getY(n);i=Math.min(i,c),s=Math.min(s,u),a=Math.max(a,c+Sk.Rect.getWidth(n)),l=Math.max(l,u+Sk.Rect.getHeight(n))})),t.bounds=Sk.Rect.fromLTRB(i,s,a,l)}(t,r,e.x,e.y,o),e.bounds?e.bounds=Sk.Rect.join(e.bounds,r.bounds):e.bounds=Sk.Rect.makeCopy(r.bounds)}))}function l(t,r,n,s,l,c,u){var d,f,p,g=function(t){var r=document.createElement("div");return r.style.position="absolute",e.isDebugEnabled()&&(r.id="blob-div-"+t.data.node_uid),r.style.padding="0px",r.style.margin="0px",r.style.color="rgba(0,0,0,0)",r.style.fontFamily="Menlo-Square",r.style.userSelect="auto",r.style.webkitUserSelect="auto",r.style.whiteSpace="pre",r}(t),m=n,k=Sk.Rect.getTop(t.data.box_rect),h=n,S=Sk.Rect.getBottom(t.data.box_rect),y=new Sk.TextBlobIterator,v=0,b=t.data.text,C=0;return s.runs.length,y.forEachRun(s,null,(function(e,t,s){var u=t.paint.textSize/Sk.Paint.kCanonicalTextSizeForPaths;v=Math.max(v,t.paint.textSize),e.forEachGlyph(t,l,c,(function(e,t,s){var l=b[r],c=Sk.Rect.roundOut0(Sk.Rect.scale(e.bounds,u)),d=Math.floor(t)-n;0!==(C=i(b,r))&&(a(g,C,d),n+=d,d=0,r+=C),(l=b[r])&&(d+=Sk.Rect.getX(c)+Sk.Rect.getWidth(c),g.appendChild(o(l,d)),n+=d,r+=1),m=Math.min(m,Math.floor(t)),k=Math.min(k,Math.floor(s)+Sk.Rect.getY(c)),h=Math.max(h,n),S=Math.max(S,Math.floor(s)+Sk.Rect.getY(c)+Sk.Rect.getHeight(c))}))})),r!==b.length&&0!==(C=i(b,r))&&C===b.length-r&&(a(g,C,Sk.Rect.getRight(t.data.box_rect)-n),n=Sk.Rect.getRight(t.data.box_rect),r=b.length),r===b.length&&(h=Math.max(h,Sk.Rect.getRight(t.data.box_rect))),d=Sk.Matrix.mapRect(u,Sk.Rect.fromLTRB(m,k,h,S)),f=Sk.Rect.makeCopy(d),Sk.Rect.translate(f,-Sk.Rect.getX(t.canvas_bounds),-Sk.Rect.getY(t.canvas_bounds)),Sk.Rect.toCSSStyle(f,g.style),p=S-k,g.style.fontSize=p+"px",g.style.lineHeight=p+"px",g.style.paddingBottom="10vh",g.style.paddingRight="10vw",BrowserDetect.isSamsungBrowser()&&(g.style.lineHeight="normal",g.childNodes.forEach((function(e){var t=parseFloat(e.style.fontSize);t&&(e.style.minHeight=p+"px",e.style.transform="scaleY("+p/t+")",e.style.transformOrigin="0 0")}))),{char_index:r,sel_pos:n,node:g}}function c(r,o){var i;i=t.firstChild,r.forEach((function(r){var a,c=Compositor.ItemListConcatenator.itemToKey(r),u=0,d=Sk.Rect.getLeft(r.data.box_rect),f={};if(o[c])i=o[c].nextSibling;else if((a=document.createElement("div")).key=c,e.isDebugEnabled()&&(a.id="text-item-"+r.data.node_uid,r.data.debug_name&&a.setAttribute("debug",r.data.debug_name)),a.style.padding=a.style.margin="0px",a.style.position="absolute",function(e){return!(e.data.flags&Sk.HT.ElementFlags.kInShadowTree||!(e.data.flags&Sk.HT.ElementFlags.kSelectable))}(r)){if(!r.data.text)return n.error("no text for the text item available!"),void t.insertBefore(a,i);r.blobs.forEach((function(e){var t,n,o;if(u!==r.data.text.length){if(r.blobs.length>1){if(e.bounds||s(e),o=Sk.Rect.toString(e.bounds),f.hasOwnProperty(o)&&(f[o].paint.strokeWidth!==e.paint.strokeWidth||f[o].ctm!==e.ctm))return;f[o]=e}(t=l(r,u,d,e.blob,e.x,e.y,e.ctm)).node&&(u=t.char_index,d=t.sel_pos,(n=document.createElement("div")).appendChild(t.node),a.appendChild(n))}})),t.insertBefore(a,i)}else t.insertBefore(a,i)}))}r.getType=function(){return Sk.SE.Type.kShadowTextNode},r.onPointerEventsStatusChanged=function(e){r.getNode().style.pointerEvents=e?"none":"auto"},r.release=function(){t.parentNode,t=null},r.update=function(e){var r={};!function(e,r){var n;for(e.forEach((function(e){var t=Compositor.ItemListConcatenator.itemToKey(e);r[t]=null})),n=t.firstChild;n;)n.key,r.hasOwnProperty(n.key)&&(r[n.key]=n),n=n.nextSibling}(e,r),function(e){var r,n;for(n=t.firstChild;n;)r=n.nextSibling,n.key,e.hasOwnProperty(n.key)||t.removeChild(n),n=r}(r),c(e,r)},r.updateProjection=function(e,r){var n,o;for(t.childNodes.length,r.length,n=0;n<r.length;n+=1)o=t.childNodes[n],Sk.Rect.toCSSStyle(r[n].canvas_bounds,o.style),e.applyDrawTransform(o,r[n].canvas_bounds)},r.updateOpacity=function(e,r){var n,o;for(t.childNodes.length,r.length,n=0;n<r.length;n+=1)o=t.childNodes[n],e.applyDrawOpacity(o)},r.getNode=function(){return t},r.init=function(e){t=document.createElement("div")}},Compositor.TypefaceDelegate=function(e){"use strict";var t=this,r=(new Sk.Logger("ff-del",{level:"info"}),new Sk.Deduper.ObjectMap),n={},o={};function i(e){switch(e){case Sk.FontSlant.kNormal:return"normal";case Sk.FontSlant.kItalic:return"italic";case Sk.FontSlant.kOblique:return"oblique"}}function a(e){switch(e){case Sk.FontStretch.kUltraCondensed_Width:return"ultra-condensed";case Sk.FontStretch.kExtraCondensed_Width:return"extra-condensed";case Sk.FontStretch.kCondensed_Width:return"condensed";case Sk.FontStretch.kSemiCondensed_Width:return"semi-condensed";case Sk.FontStretch.kNormal_Width:return"normal";case Sk.FontStretch.kSemiExpanded_Width:return"semi-expanded";case Sk.FontStretch.kExpanded_Width:return"expanded";case Sk.FontStretch.kExtraExpanded_Width:return"extra-expanded";case Sk.FontStretch.kUltraExpanded_Width:return"ultra-expanded"}}function s(e){switch(e.toLowerCase()){case"ital":case"opsz":case"slnt":case"wdth":case"wght":return!0}return!1}function l(e){var t,r="";for(t=3;t>=0;t-=1)r+=String.fromCharCode(e>>8*t&255);return r}function c(e){var t,r,n,o=[];if(e.coordinates.length){for(t=0;t<e.coordinates.length;t+=1)n=s(n=l((r=e.coordinates[t])[0]))?n.toLowerCase():n.toUpperCase(),o.push('"'+n+'" '+r[1].toFixed(0));return o.join(", ")}}function u(e,t,r){var n,o;for(o=0;o<e.coordinates.length;o+=1)if(l((n=e.coordinates[o])[0]).toLowerCase()===t.toLowerCase())return n[1].toFixed(0);return r}t.registerCallback=function(e,t){n[e]=t},t.deregisterCallback=function(e){n.hasOwnProperty(e),delete n[e]},t.add=function(t,s,l){r.add(t,s,l),BrowserDetect.supportsFontAPI()&&s.font_data&&function(t){t.font_data;var r=Sk.Font.getFamilyName(e.getFid(),t.id),s={weight:String(u(t,"wght",t.weight)),stretch:u(t,"wdth")?void 0:a(t.width),style:u(t,"slnt")?void 0:i(t.slant),display:"swap",featureSettings:c(t)},l=new window.FontFace(r,t.font_data,s);l.load(),document.fonts.add(l),o[r],o[r]=l,l.loaded.then((function(){Util.forEachItem(n,(function(e,t){t()}))}))}(s)},t.reset=function(){Util.forEachItem(o,(function(e,t){document.fonts.delete(t)})),o={},r.reset()},t.release=function(){t.reset()},t.get=r.get,t.getStats=r.getStats,t.reset()};